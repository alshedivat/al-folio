<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pic_dev: walkingsearch.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pic_dev<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Particle-in-Cell / CFD development codebase</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('walkingsearch_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">walkingsearch.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Header file for particle location functions using the walking search algorithm.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;petsc.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="variables_8h_source.html">variables.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logging_8h_source.html">logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="setup_8h_source.html">setup.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for walkingsearch.h:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h__dep__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="walkingsearch_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2ed7a27dd4de3fbd6bb46684482ce165" id="r_a2ed7a27dd4de3fbd6bb46684482ce165"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a2ed7a27dd4de3fbd6bb46684482ce165">GetCellCharacteristicSize</a> (const <a class="el" href="variables__old_8h.html#structCell">Cell</a> *cell, PetscReal *cellSize)</td></tr>
<tr class="memdesc:a2ed7a27dd4de3fbd6bb46684482ce165"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates a characteristic length of the cell for threshold scaling.  <br /></td></tr>
<tr class="separator:a2ed7a27dd4de3fbd6bb46684482ce165"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a621082a77ddbec81ffd282870175b603" id="r_a621082a77ddbec81ffd282870175b603"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a> (const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> v1, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> v2, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> v3, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> v4, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> cell_centroid, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> p_target, PetscReal *d_signed, const PetscReal threshold)</td></tr>
<tr class="memdesc:a621082a77ddbec81ffd282870175b603"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the signed distance from a point to the plane approximating a quadrilateral face.  <br /></td></tr>
<tr class="separator:a621082a77ddbec81ffd282870175b603"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7af34c8e2ed4672f0e1f83829159bbe6" id="r_a7af34c8e2ed4672f0e1f83829159bbe6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a7af34c8e2ed4672f0e1f83829159bbe6">CalculateDistancesToCellFaces</a> (const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> p, const <a class="el" href="variables__old_8h.html#structCell">Cell</a> *cell, PetscReal *d, const PetscReal threshold)</td></tr>
<tr class="memdesc:a7af34c8e2ed4672f0e1f83829159bbe6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the signed distances from a point to each face of a cubic cell.  <br /></td></tr>
<tr class="separator:a7af34c8e2ed4672f0e1f83829159bbe6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7db2c59feb52c21a5d3bcd2bd67bbb43" id="r_a7db2c59feb52c21a5d3bcd2bd67bbb43"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a7db2c59feb52c21a5d3bcd2bd67bbb43">DeterminePointPosition</a> (PetscReal *d, PetscInt *result)</td></tr>
<tr class="memdesc:a7db2c59feb52c21a5d3bcd2bd67bbb43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Classifies a point based on precomputed face distances.  <br /></td></tr>
<tr class="separator:a7db2c59feb52c21a5d3bcd2bd67bbb43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae14b1946c4c34cae5455bdfd632eb98e" id="r_ae14b1946c4c34cae5455bdfd632eb98e"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#ae14b1946c4c34cae5455bdfd632eb98e">GetCellVerticesFromGrid</a> (<a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coor, PetscInt idx, PetscInt idy, PetscInt idz, <a class="el" href="variables__old_8h.html#structCell">Cell</a> *cell)</td></tr>
<tr class="memdesc:ae14b1946c4c34cae5455bdfd632eb98e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the coordinates of the eight vertices of a cell based on grid indices.  <br /></td></tr>
<tr class="separator:ae14b1946c4c34cae5455bdfd632eb98e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9a2ec1317c83d6dfad52415b83cd6e6" id="r_af9a2ec1317c83d6dfad52415b83cd6e6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#af9a2ec1317c83d6dfad52415b83cd6e6">InitializeTraversalParameters</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle, PetscInt *idx, PetscInt *idy, PetscInt *idz, PetscInt *traversal_steps)</td></tr>
<tr class="memdesc:af9a2ec1317c83d6dfad52415b83cd6e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes traversal parameters for locating a particle.  <br /></td></tr>
<tr class="separator:af9a2ec1317c83d6dfad52415b83cd6e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afae6265db91aa72254a050c0b6159dab" id="r_afae6265db91aa72254a050c0b6159dab"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#afae6265db91aa72254a050c0b6159dab">CheckCellWithinLocalGrid</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, PetscInt idx, PetscInt idy, PetscInt idz, PetscBool *is_within)</td></tr>
<tr class="memdesc:afae6265db91aa72254a050c0b6159dab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the current cell indices are within the local grid boundaries.  <br /></td></tr>
<tr class="separator:afae6265db91aa72254a050c0b6159dab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb77aa5204ab90392c67f10a55227bb6" id="r_acb77aa5204ab90392c67f10a55227bb6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#acb77aa5204ab90392c67f10a55227bb6">RetrieveCurrentCell</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, PetscInt idx, PetscInt idy, PetscInt idz, <a class="el" href="variables__old_8h.html#structCell">Cell</a> *cell)</td></tr>
<tr class="memdesc:acb77aa5204ab90392c67f10a55227bb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the coordinates of the eight vertices of the current cell.  <br /></td></tr>
<tr class="separator:acb77aa5204ab90392c67f10a55227bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a556871801ba0b3214285a2ca1fe622ac" id="r_a556871801ba0b3214285a2ca1fe622ac"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a556871801ba0b3214285a2ca1fe622ac">EvaluateParticlePosition</a> (const <a class="el" href="variables__old_8h.html#structCell">Cell</a> *cell, PetscReal *d, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> p, PetscInt *position, const PetscReal threshold)</td></tr>
<tr class="memdesc:a556871801ba0b3214285a2ca1fe622ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the spatial relationship of a particle relative to a cubic cell.  <br /></td></tr>
<tr class="separator:a556871801ba0b3214285a2ca1fe622ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab2bd86e92a9adc67d49622e20a03dbf" id="r_aab2bd86e92a9adc67d49622e20a03dbf"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#aab2bd86e92a9adc67d49622e20a03dbf">LocateParticleInGrid</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle)</td></tr>
<tr class="memdesc:aab2bd86e92a9adc67d49622e20a03dbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locates the grid cell containing a particle using a walking search.  <br /></td></tr>
<tr class="separator:aab2bd86e92a9adc67d49622e20a03dbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8afd9555f9998b48ff70b2361d0e79d0" id="r_a8afd9555f9998b48ff70b2361d0e79d0"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a8afd9555f9998b48ff70b2361d0e79d0">UpdateCellIndicesBasedOnDistances</a> (PetscReal d[<a class="el" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a>], PetscInt *idx, PetscInt *idy, PetscInt *idz, DMDALocalInfo *info)</td></tr>
<tr class="memdesc:a8afd9555f9998b48ff70b2361d0e79d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the cell indices based on the signed distances to each face.  <br /></td></tr>
<tr class="separator:a8afd9555f9998b48ff70b2361d0e79d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ca65b2e2a59f60caee7b0f363141f46" id="r_a0ca65b2e2a59f60caee7b0f363141f46"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a0ca65b2e2a59f60caee7b0f363141f46">FinalizeTraversal</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle, PetscInt traversal_steps, PetscBool cell_found, PetscInt idx, PetscInt idy, PetscInt idz)</td></tr>
<tr class="memdesc:a0ca65b2e2a59f60caee7b0f363141f46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finalizes the traversal by reporting the results.  <br /></td></tr>
<tr class="separator:a0ca65b2e2a59f60caee7b0f363141f46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9aedf40cb1545b554e113ebb0863859d" id="r_a9aedf40cb1545b554e113ebb0863859d"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a9aedf40cb1545b554e113ebb0863859d">FindOwnerOfCell</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, PetscInt i, PetscInt j, PetscInt k, PetscMPIInt *owner_rank)</td></tr>
<tr class="memdesc:a9aedf40cb1545b554e113ebb0863859d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the MPI rank that owns a given global cell index.  <br /></td></tr>
<tr class="separator:a9aedf40cb1545b554e113ebb0863859d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b63dfe82e0fdee5c2c3bdd477f9901f" id="r_a0b63dfe82e0fdee5c2c3bdd477f9901f"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a0b63dfe82e0fdee5c2c3bdd477f9901f">LocateParticleOrFindMigrationTarget_TEST</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle, <a class="el" href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a> *status_out)</td></tr>
<tr class="memdesc:a0b63dfe82e0fdee5c2c3bdd477f9901f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locates a particle's host cell or identifies its migration target using a robust walk search.  <br /></td></tr>
<tr class="separator:a0b63dfe82e0fdee5c2c3bdd477f9901f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64b2ff5399052580bffaa58562dc0bcd" id="r_a64b2ff5399052580bffaa58562dc0bcd"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#a64b2ff5399052580bffaa58562dc0bcd">ReportSearchOutcome</a> (const <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle, <a class="el" href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a> status, PetscInt traversal_steps)</td></tr>
<tr class="memdesc:a64b2ff5399052580bffaa58562dc0bcd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logs the final outcome of the particle location search.  <br /></td></tr>
<tr class="separator:a64b2ff5399052580bffaa58562dc0bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8ed9e0a01de5ee0f332170562b1f9ea" id="r_ae8ed9e0a01de5ee0f332170562b1f9ea"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="walkingsearch_8h.html#ae8ed9e0a01de5ee0f332170562b1f9ea">UpdateCellIndicesBasedOnDistancesTEST</a> (PetscReal d[<a class="el" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a>], PetscInt *idx, PetscInt *idy, PetscInt *idz)</td></tr>
<tr class="memdesc:ae8ed9e0a01de5ee0f332170562b1f9ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the cell indices based on the signed distances to each face.  <br /></td></tr>
<tr class="separator:ae8ed9e0a01de5ee0f332170562b1f9ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for particle location functions using the walking search algorithm. </p>
<p>This file contains declarations of functions that implement the walking search algorithm to locate particles within a computational grid. It includes functions for computing distances to cell faces, determining particle positions relative to cells, and updating traversal parameters. </p>

<p class="definition">Definition in file <a class="el" href="walkingsearch_8h_source.html">walkingsearch.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7af34c8e2ed4672f0e1f83829159bbe6" name="a7af34c8e2ed4672f0e1f83829159bbe6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7af34c8e2ed4672f0e1f83829159bbe6">&#9670;&#160;</a></span>CalculateDistancesToCellFaces()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode CalculateDistancesToCellFaces </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCell">Cell</a> *&#160;</td>
          <td class="paramname"><em>cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscReal&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the signed distances from a point to each face of a cubic cell. </p>
<p>This function calculates the signed distances from a specified point <code>p</code> to each of the six faces of a cubic cell. The cell is defined by its eight vertices, and the distances are stored in the memory location pointed to by <code>d</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>The target point in 3D space. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell</td><td>Pointer to a <code><a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a></code> structure that defines the cubic cell via its vertices. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d</td><td>A pointer to an array of six <code>PetscReal</code> values where the computed signed distances will be stored. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">threshold</td><td>A <code>PetscReal</code> value that specifies the minimum distance below which a computed distance is considered to be zero.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>This function calculates the signed distances from a specified point <code>p</code> to each of the six faces of a cubic cell. The cell is defined by its eight vertices, and the distances are stored in the memory location pointed to by <code>d</code>. Each distance corresponds to a specific face of the cell, as enumerated by the <code>Face</code> enumeration. A threshold value is used to determine when a distance should be considered effectively zero, accounting for floating-point precision limitations.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>The target point in 3D space for which distances to the cell's faces are to be calculated. Represented by the <code><a class="el" href="variables__old_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a></code> structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell</td><td>A pointer to a <code><a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a></code> structure that defines the cubic cell via its eight vertices. The vertices must be ordered consistently to ensure correct normal directions for each face. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d</td><td>A pointer to an array of six <code>PetscReal</code> values where the computed signed distances will be stored. Each index in the array corresponds to a specific face as defined by the <code>Face</code> enumeration:<ul>
<li>d[LEFT]: Distance to the Left Face of the cell.</li>
<li>d[RIGHT]: Distance to the Right Face of the cell.</li>
<li>d[BOTTOM]: Distance to the Bottom Face of the cell.</li>
<li>d[TOP]: Distance to the Top Face of the cell.</li>
<li>d[FRONT]: Distance to the Front Face of the cell.</li>
<li>d[BACK]: Distance to the Back Face of the cell. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">threshold</td><td>A <code>PetscReal</code> value that specifies the minimum distance below which a computed distance is considered to be zero. This helps in mitigating issues arising from floating-point arithmetic inaccuracies.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 if the function executes successfully. If an error occurs, a non-zero error code is returned, indicating the type of failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The vertices of the cell must be ordered in a counter-clockwise manner when viewed from outside the cell. This ordering ensures that the normal vectors computed for each face point outward, which is essential for correctly determining the sign of the distances.</li>
<li>All four vertices defining a face must lie on a non-degenerate (i.e., non-flat) plane. Degenerate planes can lead to undefined normal vectors and incorrect distance calculations.</li>
<li>The <code>threshold</code> parameter provides flexibility in handling cases where the point <code>p</code> is extremely close to a face, allowing the user to define what constitutes "close enough" to be treated as zero distance based on the specific requirements of their application. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00271">271</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  272</span>{</div>
<div class="line"><span class="lineno">  273</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  274</span>    <span class="comment">// Validate that the &#39;cell&#39; pointer is not NULL to prevent dereferencing a null pointer.</span></div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">if</span> (cell == NULL) {</div>
<div class="line"><span class="lineno">  276</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - &#39;cell&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  277</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - &#39;cell&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  278</span>    }</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>    <span class="comment">// Validate that the &#39;d&#39; pointer is not NULL to ensure there is memory allocated for distance storage.</span></div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">if</span> (d == NULL) {</div>
<div class="line"><span class="lineno">  282</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - &#39;d&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  283</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - &#39;d&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  284</span>    }</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>    <span class="comment">// Compute the centroid of the entire cell</span></div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> cell_centroid = {0.0, 0.0, 0.0};</div>
<div class="line"><span class="lineno">  288</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; ++i) {</div>
<div class="line"><span class="lineno">  289</span>      cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> += cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  290</span>      cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> += cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  291</span>      cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> += cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  292</span>    }</div>
<div class="line"><span class="lineno">  293</span>    cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> /= 8.0;</div>
<div class="line"><span class="lineno">  294</span>    cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> /= 8.0;</div>
<div class="line"><span class="lineno">  295</span>    cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> /= 8.0;</div>
<div class="line"><span class="lineno">  296</span> </div>
<div class="line"><span class="lineno">  297</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - Cell Centroid: (%.6e, %.6e, %.6e)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  298</span>          cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);    </div>
<div class="line"><span class="lineno">  299</span> </div>
<div class="line"><span class="lineno">  300</span>    </div>
<div class="line"><span class="lineno">  301</span>    <span class="comment">// Compute the signed distance from point &#39;p&#39; to the BACK face of the cell.</span></div>
<div class="line"><span class="lineno">  302</span>    <span class="comment">// The BACK face is defined by vertices 0, 3, 2, and 1, with its normal vector pointing in the -z direction.</span></div>
<div class="line"><span class="lineno">  303</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a>(</div>
<div class="line"><span class="lineno">  304</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[0], <span class="comment">// Vertex 0</span></div>
<div class="line"><span class="lineno">  305</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[3], <span class="comment">// Vertex 3</span></div>
<div class="line"><span class="lineno">  306</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[2], <span class="comment">// Vertex 2</span></div>
<div class="line"><span class="lineno">  307</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[1], <span class="comment">// Vertex 1</span></div>
<div class="line"><span class="lineno">  308</span>    cell_centroid,     <span class="comment">// Cell centroid </span></div>
<div class="line"><span class="lineno">  309</span>        p,                  <span class="comment">// Target point</span></div>
<div class="line"><span class="lineno">  310</span>        &amp;d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>],           <span class="comment">// Storage location for the BACK face distance</span></div>
<div class="line"><span class="lineno">  311</span>        threshold           <span class="comment">// Threshold for zero distance</span></div>
<div class="line"><span class="lineno">  312</span>    );  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    <span class="comment">// Compute the signed distance from point &#39;p&#39; to the FRONT face of the cell.</span></div>
<div class="line"><span class="lineno">  315</span>    <span class="comment">// The FRONT face is defined by vertices 4, 7, 6, and 5, with its normal vector pointing in the +z direction.</span></div>
<div class="line"><span class="lineno">  316</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a>(</div>
<div class="line"><span class="lineno">  317</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[4], <span class="comment">// Vertex 4</span></div>
<div class="line"><span class="lineno">  318</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[7], <span class="comment">// Vertex 7</span></div>
<div class="line"><span class="lineno">  319</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[6], <span class="comment">// Vertex 6</span></div>
<div class="line"><span class="lineno">  320</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[5], <span class="comment">// Vertex 5</span></div>
<div class="line"><span class="lineno">  321</span>    cell_centroid,     <span class="comment">// Cell centroid </span></div>
<div class="line"><span class="lineno">  322</span>        p,                  <span class="comment">// Target point</span></div>
<div class="line"><span class="lineno">  323</span>        &amp;d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a>],          <span class="comment">// Storage location for the FRONT face distance</span></div>
<div class="line"><span class="lineno">  324</span>        threshold           <span class="comment">// Threshold for zero distance</span></div>
<div class="line"><span class="lineno">  325</span>    );  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    <span class="comment">// Compute the signed distance from point &#39;p&#39; to the BOTTOM face of the cell.</span></div>
<div class="line"><span class="lineno">  328</span>    <span class="comment">// The BOTTOM face is defined by vertices 0, 1, 6, and 7, with its normal vector pointing in the -y direction.</span></div>
<div class="line"><span class="lineno">  329</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a>(</div>
<div class="line"><span class="lineno">  330</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[0], <span class="comment">// Vertex 0</span></div>
<div class="line"><span class="lineno">  331</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[1], <span class="comment">// Vertex 1</span></div>
<div class="line"><span class="lineno">  332</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[6], <span class="comment">// Vertex 6</span></div>
<div class="line"><span class="lineno">  333</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[7], <span class="comment">// Vertex 7</span></div>
<div class="line"><span class="lineno">  334</span>    cell_centroid,     <span class="comment">// Cell centroid </span></div>
<div class="line"><span class="lineno">  335</span>        p,                  <span class="comment">// Target point</span></div>
<div class="line"><span class="lineno">  336</span>        &amp;d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>],         <span class="comment">// Storage location for the BOTTOM face distance</span></div>
<div class="line"><span class="lineno">  337</span>        threshold           <span class="comment">// Threshold for zero distance</span></div>
<div class="line"><span class="lineno">  338</span>    );  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    <span class="comment">// Compute the signed distance from point &#39;p&#39; to the TOP face of the cell.</span></div>
<div class="line"><span class="lineno">  341</span>    <span class="comment">// The TOP face is defined by vertices 3, 4, 5, and 2, with its normal vector pointing in the +y direction.</span></div>
<div class="line"><span class="lineno">  342</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a>(</div>
<div class="line"><span class="lineno">  343</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[3], <span class="comment">// Vertex 3</span></div>
<div class="line"><span class="lineno">  344</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[4], <span class="comment">// Vertex 4</span></div>
<div class="line"><span class="lineno">  345</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[5], <span class="comment">// Vertex 5</span></div>
<div class="line"><span class="lineno">  346</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[2], <span class="comment">// Vertex 2</span></div>
<div class="line"><span class="lineno">  347</span>    cell_centroid,     <span class="comment">// Cell centroid </span></div>
<div class="line"><span class="lineno">  348</span>    p,                  <span class="comment">// Target point</span></div>
<div class="line"><span class="lineno">  349</span>        &amp;d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a>],            <span class="comment">// Storage location for the TOP face distance</span></div>
<div class="line"><span class="lineno">  350</span>        threshold           <span class="comment">// Threshold for zero distance</span></div>
<div class="line"><span class="lineno">  351</span>    );  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  352</span> </div>
<div class="line"><span class="lineno">  353</span>    <span class="comment">// Compute the signed distance from point &#39;p&#39; to the LEFT face of the cell.</span></div>
<div class="line"><span class="lineno">  354</span>    <span class="comment">// The LEFT face is defined by vertices 0, 7, 4, and 3, with its normal vector pointing in the -x direction.</span></div>
<div class="line"><span class="lineno">  355</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a>(</div>
<div class="line"><span class="lineno">  356</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[0], <span class="comment">// Vertex 0</span></div>
<div class="line"><span class="lineno">  357</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[7], <span class="comment">// Vertex 7</span></div>
<div class="line"><span class="lineno">  358</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[4], <span class="comment">// Vertex 4</span></div>
<div class="line"><span class="lineno">  359</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[3], <span class="comment">// Vertex 3</span></div>
<div class="line"><span class="lineno">  360</span>    cell_centroid,     <span class="comment">// Cell centroid </span></div>
<div class="line"><span class="lineno">  361</span>    p,                  <span class="comment">// Target point</span></div>
<div class="line"><span class="lineno">  362</span>        &amp;d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>],           <span class="comment">// Storage location for the LEFT face distance</span></div>
<div class="line"><span class="lineno">  363</span>        threshold           <span class="comment">// Threshold for zero distance</span></div>
<div class="line"><span class="lineno">  364</span>    );  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>    <span class="comment">// Compute the signed distance from point &#39;p&#39; to the RIGHT face of the cell.</span></div>
<div class="line"><span class="lineno">  367</span>    <span class="comment">// The RIGHT face is defined by vertices 1, 2, 5, and 6, with its normal vector pointing in the +x direction.</span></div>
<div class="line"><span class="lineno">  368</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a>(</div>
<div class="line"><span class="lineno">  369</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[1], <span class="comment">// Vertex 1</span></div>
<div class="line"><span class="lineno">  370</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[2], <span class="comment">// Vertex 2</span></div>
<div class="line"><span class="lineno">  371</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[5], <span class="comment">// Vertex 5</span></div>
<div class="line"><span class="lineno">  372</span>        cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[6], <span class="comment">// Vertex 6</span></div>
<div class="line"><span class="lineno">  373</span>    cell_centroid,     <span class="comment">// Cell centroid </span></div>
<div class="line"><span class="lineno">  374</span>        p,                  <span class="comment">// Target point</span></div>
<div class="line"><span class="lineno">  375</span>        &amp;d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a>],          <span class="comment">// Storage location for the RIGHT face distance</span></div>
<div class="line"><span class="lineno">  376</span>        threshold           <span class="comment">// Threshold for zero distance</span></div>
<div class="line"><span class="lineno">  377</span>    );  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - Populated d: &quot;</span></div>
<div class="line"><span class="lineno">  380</span>          <span class="stringliteral">&quot;d[LEFT=%d]=%.3e, d[RIGHT=%d]=%.3e, d[BOTTOM=%d]=%.3e, &quot;</span></div>
<div class="line"><span class="lineno">  381</span>          <span class="stringliteral">&quot;d[TOP=%d]=%.3e, d[FRONT=%d]=%.3e, d[BACK=%d]=%.3e\n&quot;</span>,</div>
<div class="line"><span class="lineno">  382</span>          <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>, d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>], <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a>, d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a>], <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>, d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>],</div>
<div class="line"><span class="lineno">  383</span>          <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a>, d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a>], <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a>, d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a>], <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>, d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>]);</div>
<div class="line"><span class="lineno">  384</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;CalculateDistancesToCellFaces - Raw d: &quot;</span></div>
<div class="line"><span class="lineno">  385</span>          <span class="stringliteral">&quot;[%.3e, %.3e, %.3e, %.3e, %.3e, %.3e]\n&quot;</span>,</div>
<div class="line"><span class="lineno">  386</span>          d[0], d[1], d[2], d[3], d[4], d[5]);</div>
<div class="line"><span class="lineno">  387</span>    </div>
<div class="line"><span class="lineno">  388</span>    <span class="keywordflow">return</span> 0; <span class="comment">// Indicate successful execution of the function.</span></div>
<div class="line"><span class="lineno">  389</span>}</div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00207">logging.h:207</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a></div><div class="ttdeci">@ LOG_ERROR</div><div class="ttdoc">Critical errors that may halt the program.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a></div><div class="ttdeci">@ TOP</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a></div><div class="ttdeci">@ FRONT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a></div><div class="ttdeci">@ BOTTOM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a></div><div class="ttdeci">@ BACK</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a></div><div class="ttdeci">@ LEFT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a></div><div class="ttdeci">@ RIGHT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a994289a1b1801d93075b37b69c129e82"><div class="ttname"><a href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">Cell::vertices</a></div><div class="ttdeci">Cmpnts vertices[8]</div><div class="ttdoc">Coordinates of the eight vertices of the cell.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00161">variables.h:161</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structCmpnts"><div class="ttname"><a href="variables__old_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a621082a77ddbec81ffd282870175b603"><div class="ttname"><a href="walkingsearch_8c.html#a621082a77ddbec81ffd282870175b603">ComputeSignedDistanceToPlane</a></div><div class="ttdeci">PetscErrorCode ComputeSignedDistanceToPlane(const Cmpnts v1, const Cmpnts v2, const Cmpnts v3, const Cmpnts v4, const Cmpnts cell_centroid, const Cmpnts p_target, PetscReal *d_signed, const PetscReal threshold)</div><div class="ttdoc">Computes the signed distance from a point to the plane approximating a quadrilateral face.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00102">walkingsearch.c:102</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a7af34c8e2ed4672f0e1f83829159bbe6_cgraph.svg" width="478" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a7af34c8e2ed4672f0e1f83829159bbe6_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="afae6265db91aa72254a050c0b6159dab" name="afae6265db91aa72254a050c0b6159dab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afae6265db91aa72254a050c0b6159dab">&#9670;&#160;</a></span>CheckCellWithinLocalGrid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode CheckCellWithinLocalGrid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscBool *&#160;</td>
          <td class="paramname"><em>is_within</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the current cell indices are within the local grid boundaries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idx</td><td>The i-index of the current cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idy</td><td>The j-index of the current cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idz</td><td>The k-index of the current cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">is_within</td><td>Pointer to a PetscBool that will be set to PETSC_TRUE if within bounds, else PETSC_FALSE.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>Checks if the current cell indices are within the local grid boundaries.</p>
<p>This function determines if the provided global cell indices (idx, idy, idz) fall within the range of cells covered by the current process's owned and ghost NODES. A cell C(i,j,k) (origin N(i,j,k)) is considered within this ghosted region if its origin node N(i,j,k) is within the rank's ghosted nodal region, AND node N(i+1,j+1,k+1) is also within it (to ensure the entire cell extent is covered by available node data). More simply, we check if the cell's origin node is within the range of nodes that can form the start of a ghosted cell.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context (needs user-&gt;fda for node info). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idx</td><td>The global i-index of the cell's origin node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idy</td><td>The global j-index of the cell's origin node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idz</td><td>The global k-index of the cell's origin node. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">is_within</td><td>Pointer to a PetscBool that will be set to PETSC_TRUE if within ghosted bounds, else PETSC_FALSE.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00650">650</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  651</span>{</div>
<div class="line"><span class="lineno">  652</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  653</span>    DMDALocalInfo info_nodes; <span class="comment">// Node information from the DMDA that defines ghost regions (user-&gt;fda)</span></div>
<div class="line"><span class="lineno">  654</span> </div>
<div class="line"><span class="lineno">  655</span>    PetscFunctionBeginUser; <span class="comment">// Assuming this is part of your PETSc style</span></div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>    <span class="comment">// Validate inputs</span></div>
<div class="line"><span class="lineno">  658</span>    <span class="keywordflow">if</span> (user == NULL || is_within == NULL) {</div>
<div class="line"><span class="lineno">  659</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Input pointer is NULL in CheckCellWithinLocalGrid.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  660</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;Input pointer is NULL in CheckCellWithinLocalGrid.&quot;</span>);</div>
<div class="line"><span class="lineno">  661</span>    }</div>
<div class="line"><span class="lineno">  662</span>    <span class="keywordflow">if</span> (user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a> == NULL) {</div>
<div class="line"><span class="lineno">  663</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;user-&gt;fda is NULL in CheckCellWithinLocalGrid. Cannot get ghost info.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  664</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;user-&gt;fda is NULL. Cannot get ghost info.&quot;</span>);</div>
<div class="line"><span class="lineno">  665</span>    }</div>
<div class="line"><span class="lineno">  666</span> </div>
<div class="line"><span class="lineno">  667</span>    <span class="comment">// Get node info from user-&gt;fda (this DMDA has the ghost layer information for nodes)</span></div>
<div class="line"><span class="lineno">  668</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info_nodes); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  669</span> </div>
<div class="line"><span class="lineno">  670</span>    <span class="comment">// Determine the range of GLOBAL CELL INDICES that are covered by this rank&#39;s ghosted NODAL region.</span></div>
<div class="line"><span class="lineno">  671</span>    <span class="comment">// A cell C(i,j,k) has origin node N(i,j,k).</span></div>
<div class="line"><span class="lineno">  672</span>    <span class="comment">// The ghosted nodal region starts at global node index info_nodes.gxs and has info_nodes.gxm nodes.</span></div>
<div class="line"><span class="lineno">  673</span> </div>
<div class="line"><span class="lineno">  674</span>    <span class="comment">// Global starting index of the first cell whose origin node is within the ghosted nodal region.</span></div>
<div class="line"><span class="lineno">  675</span>    PetscInt gxs_cell_global_start = info_nodes.gxs;</div>
<div class="line"><span class="lineno">  676</span>    PetscInt gys_cell_global_start = info_nodes.gys;</div>
<div class="line"><span class="lineno">  677</span>    PetscInt gzs_cell_global_start = info_nodes.gzs;</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>    <span class="comment">// Number of cells that can be formed starting from nodes within the ghosted nodal region.</span></div>
<div class="line"><span class="lineno">  680</span>    <span class="comment">// If there are N ghosted nodes (info_nodes.gxm), they can be origins for N-1 cells.</span></div>
<div class="line"><span class="lineno">  681</span>    PetscInt gxm_cell_local_count = (info_nodes.gxm &gt; 0) ? info_nodes.gxm - 1 : 0;</div>
<div class="line"><span class="lineno">  682</span>    PetscInt gym_cell_local_count = (info_nodes.gym &gt; 0) ? info_nodes.gym - 1 : 0;</div>
<div class="line"><span class="lineno">  683</span>    PetscInt gzm_cell_local_count = (info_nodes.gzm &gt; 0) ? info_nodes.gzm - 1 : 0;</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>    <span class="comment">// Global exclusive end index for cells whose origins are in the ghosted nodal region. </span></div>
<div class="line"><span class="lineno">  686</span>    PetscInt gxe_cell_global_end_exclusive = gxs_cell_global_start + gxm_cell_local_count;</div>
<div class="line"><span class="lineno">  687</span>    PetscInt gye_cell_global_end_exclusive = gys_cell_global_start + gym_cell_local_count;</div>
<div class="line"><span class="lineno">  688</span>    PetscInt gze_cell_global_end_exclusive = gzs_cell_global_start + gzm_cell_local_count;</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>    <span class="comment">// Check if the given global cell index (idx, idy, idz) falls within this range.</span></div>
<div class="line"><span class="lineno">  691</span>    <span class="comment">// This means the origin node of cell (idx,idy,idz) is within the rank&#39;s accessible ghosted node region,</span></div>
<div class="line"><span class="lineno">  692</span>    <span class="comment">// and that node can indeed serve as a cell origin (i.e., it&#39;s not the very last node in the ghosted region).</span></div>
<div class="line"><span class="lineno">  693</span>    <span class="keywordflow">if</span> (idx &gt;= gxs_cell_global_start &amp;&amp; idx &lt; gxe_cell_global_end_exclusive &amp;&amp;</div>
<div class="line"><span class="lineno">  694</span>        idy &gt;= gys_cell_global_start &amp;&amp; idy &lt; gye_cell_global_end_exclusive &amp;&amp;</div>
<div class="line"><span class="lineno">  695</span>        idz &gt;= gzs_cell_global_start &amp;&amp; idz &lt; gze_cell_global_end_exclusive) {</div>
<div class="line"><span class="lineno">  696</span>        *is_within = PETSC_TRUE;</div>
<div class="line"><span class="lineno">  697</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  698</span>        *is_within = PETSC_FALSE;</div>
<div class="line"><span class="lineno">  699</span>    }</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Cell (origin node glob idx) (%d, %d, %d) is %s the ghosted local grid (covered cell origins x:[%d..%d), y:[%d..%d), z:[%d..%d)).\n&quot;</span>,</div>
<div class="line"><span class="lineno">  702</span>              idx, idy, idz, (*is_within) ? <span class="stringliteral">&quot;within&quot;</span> : <span class="stringliteral">&quot;outside&quot;</span>,</div>
<div class="line"><span class="lineno">  703</span>              gxs_cell_global_start, gxe_cell_global_end_exclusive,</div>
<div class="line"><span class="lineno">  704</span>              gys_cell_global_start, gye_cell_global_end_exclusive,</div>
<div class="line"><span class="lineno">  705</span>              gzs_cell_global_start, gze_cell_global_end_exclusive);</div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  708</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a69966d928601d61d4f526636f84396c5"><div class="ttname"><a href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">UserCtx::fda</a></div><div class="ttdeci">DM fda</div><div class="ttdoc">DMDA for primary 3-component vector fields (e.g., Velocity).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_afae6265db91aa72254a050c0b6159dab_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a621082a77ddbec81ffd282870175b603" name="a621082a77ddbec81ffd282870175b603"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a621082a77ddbec81ffd282870175b603">&#9670;&#160;</a></span>ComputeSignedDistanceToPlane()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeSignedDistanceToPlane </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>v2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>v3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>v4</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>cell_centroid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>p_target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>d_signed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscReal&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the signed distance from a point to the plane approximating a quadrilateral face. </p>
<p>This function calculates the signed distance from a given point <code>p_target</code> to the plane approximating a quadrilateral face defined by points <code>v1</code>, <code>v2</code>, <code>v3</code>, and <code>v4</code>. The plane's initial normal is determined using two edge vectors emanating from <code>v1</code> (i.e., <code>v2-v1</code> and <code>v4-v1</code>).</p>
<p><b>Normal Orientation:</b> The initial normal's orientation is checked against the cell's interior. A vector from the face centroid to the cell centroid (<code>vec_face_to_cell_centroid</code>) is computed. If the dot product of the initial normal and <code>vec_face_to_cell_centroid</code> is positive, it means the initial normal is pointing towards the cell's interior (it's an inward normal relative to the cell). In this case, the normal is flipped to ensure it points outward.</p>
<p><b>Signed Distance Convention:</b> The signed distance is the projection of the vector from <code>p_target</code> to the face's centroid onto the (now guaranteed) outward-pointing plane's normal vector.</p><ul>
<li><code>d_signed &lt; 0</code>: <code>p_target</code> is "outside" and "beyond" the face, in the direction of the outward normal. This is the primary case indicating the particle has crossed this face.</li>
<li><code>d_signed &gt; 0</code>: <code>p_target</code> is "outside" but "behind" the face (on the same side as the cell interior relative to this face plane).</li>
<li><code>d_signed = 0</code>: <code>p_target</code> is on the face plane (within threshold).</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>First vertex defining the face (used as origin for initial normal calculation). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Second vertex defining the face (used for first edge vector: v2-v1). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v3</td><td>Third vertex defining the face (used for face centroid calculation). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v4</td><td>Fourth vertex defining the face (used for second edge vector: v4-v1). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell_centroid</td><td>The centroid of the 8-vertex cell to which this face belongs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_target</td><td>The point from which the distance to the plane is calculated. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d_signed</td><td>Pointer to store the computed signed distance. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">threshold</td><td>The threshold below which the absolute distance is considered zero.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The order of vertices <code>v1, v2, v3, v4</code> is used for calculating the face centroid. The order of <code>v1, v2, v4</code> is used for the initial normal calculation.</li>
<li>The <code>cell_centroid</code> is crucial for robustly determining the outward direction of the normal.</li>
</ul>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, PETSC_ERR_ARG_NULL if <code>d_signed</code> is NULL, or PETSC_ERR_USER if a degenerate plane (near-zero normal) is detected. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00102">102</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  105</span>{</div>
<div class="line"><span class="lineno">  106</span>    PetscErrorCode ierr = 0;</div>
<div class="line"><span class="lineno">  107</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>    <span class="keywordflow">if</span> (d_signed == NULL) {</div>
<div class="line"><span class="lineno">  112</span>        ierr = MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  113</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;ComputeSignedDistanceToPlane - Output pointer &#39;d_signed&#39; is NULL on rank %d.\n&quot;</span>, rank);</div>
<div class="line"><span class="lineno">  114</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;Output pointer &#39;d_signed&#39; must not be NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  115</span>    }</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;ComputeSignedDistanceToPlane - Target point: (%.6e, %.6e, %.6e)\n&quot;</span>, p_target.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, p_target.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, p_target.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  118</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Cell Centroid: (%.6e, %.6e, %.6e)\n&quot;</span>, cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  119</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Face Vertices:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  120</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;    v1: (%.6e, %.6e, %.6e)\n&quot;</span>, v1.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, v1.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, v1.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  121</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;    v2: (%.6e, %.6e, %.6e)\n&quot;</span>, v2.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, v2.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, v2.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  122</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;    v3: (%.6e, %.6e, %.6e)\n&quot;</span>, v3.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, v3.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, v3.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  123</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;    v4: (%.6e, %.6e, %.6e)\n&quot;</span>, v4.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, v4.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, v4.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>    <span class="comment">// --- Calculate Edge Vectors for Initial Normal Computation ---</span></div>
<div class="line"><span class="lineno">  126</span>    PetscReal edge1_x = v2.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - v1.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  127</span>    PetscReal edge1_y = v2.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - v1.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  128</span>    PetscReal edge1_z = v2.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - v1.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    PetscReal edge2_x = v4.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - v1.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  131</span>    PetscReal edge2_y = v4.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - v1.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  132</span>    PetscReal edge2_z = v4.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - v1.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  133</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Edge1 (v2-v1): (%.6e, %.6e, %.6e)\n&quot;</span>, edge1_x, edge1_y, edge1_z);</div>
<div class="line"><span class="lineno">  134</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Edge2 (v4-v1): (%.6e, %.6e, %.6e)\n&quot;</span>, edge2_x, edge2_y, edge2_z);</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>    <span class="comment">// --- Compute Initial Normal Vector (Cross Product: edge1 x edge2) ---</span></div>
<div class="line"><span class="lineno">  137</span>    PetscReal normal_x_initial = edge1_y * edge2_z - edge1_z * edge2_y;</div>
<div class="line"><span class="lineno">  138</span>    PetscReal normal_y_initial = edge1_z * edge2_x - edge1_x * edge2_z;</div>
<div class="line"><span class="lineno">  139</span>    PetscReal normal_z_initial = edge1_x * edge2_y - edge1_y * edge2_x;</div>
<div class="line"><span class="lineno">  140</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Initial Raw Normal (edge1 x edge2): (%.6e, %.6e, %.6e)\n&quot;</span>, normal_x_initial, normal_y_initial, normal_z_initial);</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    PetscReal normal_magnitude = sqrt(normal_x_initial * normal_x_initial +</div>
<div class="line"><span class="lineno">  143</span>                                   normal_y_initial * normal_y_initial +</div>
<div class="line"><span class="lineno">  144</span>                                   normal_z_initial * normal_z_initial);</div>
<div class="line"><span class="lineno">  145</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Initial Normal Magnitude: %.6e\n&quot;</span>, normal_magnitude);</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordflow">if</span> (normal_magnitude &lt; 1.0e-12) {</div>
<div class="line"><span class="lineno">  148</span>        ierr = MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  149</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>,</div>
<div class="line"><span class="lineno">  150</span>                  <span class="stringliteral">&quot;ComputeSignedDistanceToPlane - Degenerate plane detected on rank %d. Normal magnitude (%.3e) is too small.\n&quot;</span>,</div>
<div class="line"><span class="lineno">  151</span>                  rank, normal_magnitude);</div>
<div class="line"><span class="lineno">  152</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;  Offending vertices for normal: v1(%.3e,%.3e,%.3e), v2(%.3e,%.3e,%.3e), v4(%.3e,%.3e,%.3e)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  153</span>                  v1.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>,v1.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>,v1.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, v2.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>,v2.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>,v2.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, v4.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>,v4.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>,v4.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  154</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_USER, <span class="stringliteral">&quot;Degenerate plane detected (normal vector is near zero).&quot;</span>);</div>
<div class="line"><span class="lineno">  155</span>    }</div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>    <span class="comment">// --- Calculate the Centroid of the Four Face Vertices (v1, v2, v3, v4) ---</span></div>
<div class="line"><span class="lineno">  158</span>    PetscReal face_centroid_x = 0.25 * (v1.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + v2.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + v3.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + v4.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  159</span>    PetscReal face_centroid_y = 0.25 * (v1.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + v2.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + v3.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + v4.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  160</span>    PetscReal face_centroid_z = 0.25 * (v1.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + v2.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + v3.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + v4.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  161</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Face Centroid: (%.6e, %.6e, %.6e)\n&quot;</span>, face_centroid_x, face_centroid_y, face_centroid_z);</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>    <span class="comment">// --- Orient the Normal to Point Outward from the Cell ---</span></div>
<div class="line"><span class="lineno">  164</span>    <span class="comment">// Vector from face centroid to cell centroid</span></div>
<div class="line"><span class="lineno">  165</span>    PetscReal vec_fc_to_cc_x = cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - face_centroid_x;</div>
<div class="line"><span class="lineno">  166</span>    PetscReal vec_fc_to_cc_y = cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - face_centroid_y;</div>
<div class="line"><span class="lineno">  167</span>    PetscReal vec_fc_to_cc_z = cell_centroid.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - face_centroid_z;</div>
<div class="line"><span class="lineno">  168</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Vec (FaceCentroid -&gt; CellCentroid): (%.6e, %.6e, %.6e)\n&quot;</span>, vec_fc_to_cc_x, vec_fc_to_cc_y, vec_fc_to_cc_z);</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    <span class="comment">// Dot product of initial normal with vector from face centroid to cell centroid</span></div>
<div class="line"><span class="lineno">  171</span>    PetscReal dot_prod_orientation = normal_x_initial * vec_fc_to_cc_x +</div>
<div class="line"><span class="lineno">  172</span>                                     normal_y_initial * vec_fc_to_cc_y +</div>
<div class="line"><span class="lineno">  173</span>                                     normal_z_initial * vec_fc_to_cc_z;</div>
<div class="line"><span class="lineno">  174</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Dot Product for Orientation (N_initial . Vec_FC_to_CC): %.6e\n&quot;</span>, dot_prod_orientation);</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>    PetscReal normal_x = normal_x_initial;</div>
<div class="line"><span class="lineno">  177</span>    PetscReal normal_y = normal_y_initial;</div>
<div class="line"><span class="lineno">  178</span>    PetscReal normal_z = normal_z_initial;</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>    <span class="comment">// If dot_prod_orientation &gt; 0, initial normal points towards cell interior, so flip it.</span></div>
<div class="line"><span class="lineno">  181</span>    <span class="keywordflow">if</span> (dot_prod_orientation &gt; 1.0e-9) { <span class="comment">// Use a small epsilon to avoid issues if dot product is extremely close to zero</span></div>
<div class="line"><span class="lineno">  182</span>        normal_x = -normal_x_initial;</div>
<div class="line"><span class="lineno">  183</span>        normal_y = -normal_y_initial;</div>
<div class="line"><span class="lineno">  184</span>        normal_z = -normal_z_initial;</div>
<div class="line"><span class="lineno">  185</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Initial normal was inward (dot_prod &gt; 0). Flipped normal.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  186</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dot_prod_orientation == 0.0 &amp;&amp; normal_magnitude &gt; 1e-12) {</div>
<div class="line"><span class="lineno">  187</span>        <span class="comment">// This case is ambiguous or face plane contains cell centroid.</span></div>
<div class="line"><span class="lineno">  188</span>        <span class="comment">// This might happen for highly symmetric cells or if face_centroid IS cell_centroid (e.g. 2D cell).</span></div>
<div class="line"><span class="lineno">  189</span>        <span class="comment">// For now, we keep the original normal direction based on v1,v2,v4 ordering.</span></div>
<div class="line"><span class="lineno">  190</span>        <span class="comment">// A more robust solution for this edge case might be needed if it occurs often.</span></div>
<div class="line"><span class="lineno">  191</span>        ierr = MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  192</span>         <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;ComputeSignedDistanceToPlane - Rank %d: Dot product for normal orientation is zero. Normal direction might be ambiguous. Keeping initial normal direction from (v2-v1)x(v4-v1).\n&quot;</span>, rank);</div>
<div class="line"><span class="lineno">  193</span>    }</div>
<div class="line"><span class="lineno">  194</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Oriented Raw Normal: (%.6e, %.6e, %.6e)\n&quot;</span>, normal_x, normal_y, normal_z);</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>    <span class="comment">// --- Normalize the (Now Outward-Pointing) Normal Vector ---</span></div>
<div class="line"><span class="lineno">  198</span>    <span class="comment">// Note: normal_magnitude was calculated from initial normal.</span></div>
<div class="line"><span class="lineno">  199</span>    <span class="comment">// If we flipped, magnitude is the same.</span></div>
<div class="line"><span class="lineno">  200</span>    normal_x /= normal_magnitude;</div>
<div class="line"><span class="lineno">  201</span>    normal_y /= normal_magnitude;</div>
<div class="line"><span class="lineno">  202</span>    normal_z /= normal_magnitude;</div>
<div class="line"><span class="lineno">  203</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Normalized Outward Normal: (%.6f, %.6f, %.6f)\n&quot;</span>, normal_x, normal_y, normal_z);</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>    <span class="comment">// --- Compute Vector from Target Point to Face Centroid ---</span></div>
<div class="line"><span class="lineno">  207</span>    PetscReal vec_p_to_fc_x = face_centroid_x - p_target.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  208</span>    PetscReal vec_p_to_fc_y = face_centroid_y - p_target.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  209</span>    PetscReal vec_p_to_fc_z = face_centroid_z - p_target.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    <span class="comment">// --- Compute Signed Distance ---</span></div>
<div class="line"><span class="lineno">  212</span>    *d_signed = vec_p_to_fc_x * normal_x +</div>
<div class="line"><span class="lineno">  213</span>                vec_p_to_fc_y * normal_y +</div>
<div class="line"><span class="lineno">  214</span>                vec_p_to_fc_z * normal_z;</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Raw Signed Distance (using outward normal): %.15e\n&quot;</span>, *d_signed);</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>    <span class="comment">// --- Apply Threshold ---</span></div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">if</span> (fabs(*d_signed) &lt; threshold) {</div>
<div class="line"><span class="lineno">  220</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;  Distance %.15e is less than threshold %.1e. Setting to 0.0.\n&quot;</span>, *d_signed, threshold);</div>
<div class="line"><span class="lineno">  221</span>        *d_signed = 0.0;</div>
<div class="line"><span class="lineno">  222</span>    }</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;ComputeSignedDistanceToPlane - Final Signed Distance: %.15e\n&quot;</span>, *d_signed);</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  227</span>}</div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a></div><div class="ttdeci">@ LOG_WARNING</div><div class="ttdoc">Non-critical issues that warrant attention.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00030">logging.h:30</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a621082a77ddbec81ffd282870175b603_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a7db2c59feb52c21a5d3bcd2bd67bbb43" name="a7db2c59feb52c21a5d3bcd2bd67bbb43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7db2c59feb52c21a5d3bcd2bd67bbb43">&#9670;&#160;</a></span>DeterminePointPosition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode DeterminePointPosition </td>
          <td>(</td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Classifies a point based on precomputed face distances. </p>
<p>Given an array of six distances d[NUM_FACES] from the point to each face of a hexahedral cell, this function determines: 0 =&gt; inside 1 =&gt; on a single face 2 =&gt; on an edge (2 faces = 0) 3 =&gt; on a corner (3+ faces = 0) -1 =&gt; outside</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>Array of six face distances. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result</td><td>Pointer to an integer classification: {0,1,2,3,-1}.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00407">407</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  408</span>{</div>
<div class="line"><span class="lineno">  409</span>    </div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  412</span>    <span class="keywordflow">if</span> (d == NULL) {</div>
<div class="line"><span class="lineno">  413</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;DeterminePointPosition - &#39;d&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  414</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;DeterminePointPosition - Input parameter &#39;d&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  415</span>    }</div>
<div class="line"><span class="lineno">  416</span>    <span class="keywordflow">if</span> (result == NULL) {</div>
<div class="line"><span class="lineno">  417</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;DeterminePointPosition - &#39;result&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  418</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;DeterminePointPosition - Output parameter &#39;result&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  419</span>    }</div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>    <span class="comment">// Initialize flags</span></div>
<div class="line"><span class="lineno">  422</span>    PetscBool isInside = PETSC_TRUE;</div>
<div class="line"><span class="lineno">  423</span>    PetscBool isOnBoundary = PETSC_FALSE;</div>
<div class="line"><span class="lineno">  424</span>    PetscInt IntersectionCount = 0; <span class="comment">// Counts the number of intersections of the point with various planes of the cell.</span></div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    <span class="comment">// Analyze distances to determine position</span></div>
<div class="line"><span class="lineno">  427</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a>; i++) {</div>
<div class="line"><span class="lineno">  428</span>        <span class="keywordflow">if</span>(d[i] &lt;  0.0) {</div>
<div class="line"><span class="lineno">  429</span>            isInside = PETSC_FALSE; <span class="comment">// Point is outside in at least one direction</span></div>
<div class="line"><span class="lineno">  430</span>        }</div>
<div class="line"><span class="lineno">  431</span>        <span class="keywordflow">if</span>(d[i] == 0.0) {</div>
<div class="line"><span class="lineno">  432</span>            isOnBoundary = PETSC_TRUE; <span class="comment">// Point is exactly at least one face</span></div>
<div class="line"><span class="lineno">  433</span>            IntersectionCount++; </div>
<div class="line"><span class="lineno">  434</span>        }</div>
<div class="line"><span class="lineno">  435</span>    }</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>    <span class="comment">// Set the result based on flags</span></div>
<div class="line"><span class="lineno">  438</span>    <span class="keywordflow">if</span>(isInside) {</div>
<div class="line"><span class="lineno">  439</span>        *result = 0; <span class="comment">// Inside the cell</span></div>
<div class="line"><span class="lineno">  440</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DeterminePointPosition - Particle is inside the cell.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  441</span>    }</div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isOnBoundary) {</div>
<div class="line"><span class="lineno">  443</span>      <span class="keywordflow">if</span>(IntersectionCount == 1){ </div>
<div class="line"><span class="lineno">  444</span>          *result = 1; <span class="comment">// on face</span></div>
<div class="line"><span class="lineno">  445</span>          <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DeterminePointPosition - Particle is on a face of the cell.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  446</span>      }</div>
<div class="line"><span class="lineno">  447</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(IntersectionCount == 2){ </div>
<div class="line"><span class="lineno">  448</span>          *result = 2; <span class="comment">// on edge</span></div>
<div class="line"><span class="lineno">  449</span>          <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DeterminePointPosition - Particle is on an edge of the cell.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  450</span>      }</div>
<div class="line"><span class="lineno">  451</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(IntersectionCount &gt;= 3){ </div>
<div class="line"><span class="lineno">  452</span>          *result = 3; <span class="comment">// on corner</span></div>
<div class="line"><span class="lineno">  453</span>          <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DeterminePointPosition - Particle is on a corner of the cell.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  454</span>      }</div>
<div class="line"><span class="lineno">  455</span>    }</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  457</span>        *result = -1; <span class="comment">// Outside the cell</span></div>
<div class="line"><span class="lineno">  458</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DeterminePointPosition - Particle is outside the cell.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  459</span>    }</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">return</span> 0; <span class="comment">// Indicate successful execution</span></div>
<div class="line"><span class="lineno">  462</span>}</div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a></div><div class="ttdeci">@ NUM_FACES</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00146">variables.h:145</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a7db2c59feb52c21a5d3bcd2bd67bbb43_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a556871801ba0b3214285a2ca1fe622ac" name="a556871801ba0b3214285a2ca1fe622ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a556871801ba0b3214285a2ca1fe622ac">&#9670;&#160;</a></span>EvaluateParticlePosition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode EvaluateParticlePosition </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCell">Cell</a> *&#160;</td>
          <td class="paramname"><em>cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscReal&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determines the spatial relationship of a particle relative to a cubic cell. </p>
<p>This function evaluates whether a particle located at a specific point <code>p</code> in 3D space is positioned inside the cell, on the boundary of the cell, or outside the cell. The determination is based on the signed distances from the particle to each of the six faces of the cell. The function utilizes the computed distances to ascertain the particle's position with respect to the cell boundaries, considering a threshold to account for floating-point precision.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cell</td><td>A pointer to a <code><a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a></code> structure that defines the cubic cell via its vertices. The cell's geometry is essential for accurately computing the distances to each face. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>A pointer to an array of six <code>PetscReal</code> values that store the signed distances from the particle to each face of the cell. These distances are typically computed using the <code>CalculateDistancesToCellFaces</code> function. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>The location of the particle in 3D space, represented by the <code><a class="el" href="variables__old_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a></code> structure. This point is the reference for distance calculations to the cell's faces. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">position</td><td>A pointer to an integer that will be set based on the particle's position relative to the cell:<ul>
<li><code>0</code>: The particle is inside the cell.</li>
<li><code>1</code>: The particle is on the boundary of the cell.</li>
<li><code>-1</code>: The particle is outside the cell. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">threshold</td><td>A <code>PetscReal</code> value that defines the minimum distance below which a computed distance is considered to be zero. This threshold helps in mitigating inaccuracies due to floating-point arithmetic, especially when determining if the particle lies exactly on the boundary.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> if the function executes successfully. If an error occurs, a non-zero error code is returned, indicating the type of failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>It is assumed that the <code>d</code> array has been properly allocated and contains valid distance measurements before calling this function.</li>
<li>The function relies on <code>CalculateDistancesToCellFaces</code> to accurately compute the signed distances to each face. Any inaccuracies in distance calculations can affect the determination of the particle's position.</li>
<li>The <code>threshold</code> parameter should be chosen based on the specific precision requirements of the application to balance between sensitivity and robustness against floating-point errors.</li>
<li>The function includes a debug statement that prints the face distances, which can be useful for verifying the correctness of distance computations during development or troubleshooting. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00811">811</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  812</span>{</div>
<div class="line"><span class="lineno">  813</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  814</span>    PetscReal cellSize;</div>
<div class="line"><span class="lineno">  815</span>    PetscReal cellThreshold;</div>
<div class="line"><span class="lineno">  816</span> </div>
<div class="line"><span class="lineno">  817</span>    <span class="comment">// Validate input pointers to ensure they are not NULL, preventing potential segmentation faults.</span></div>
<div class="line"><span class="lineno">  818</span>    <span class="keywordflow">if</span> (cell == NULL || position == NULL) {</div>
<div class="line"><span class="lineno">  819</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;EvaluateParticlePosition - One or more input pointers are NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  820</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;EvaluateParticlePosition - One or more input pointers are NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  821</span>    }</div>
<div class="line"><span class="lineno">  822</span>  </div>
<div class="line"><span class="lineno">  823</span>    <span class="comment">// Compute a local cell size</span></div>
<div class="line"><span class="lineno">  824</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a2ed7a27dd4de3fbd6bb46684482ce165">GetCellCharacteristicSize</a>(cell, &amp;cellSize); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  825</span> </div>
<div class="line"><span class="lineno">  826</span>    <span class="comment">// scale base threshold by cell size (ex: if threshold = 1e-6 and cell size = 0.01, cellThreshold = 1e-8)</span></div>
<div class="line"><span class="lineno">  827</span>    cellThreshold = threshold*cellSize; </div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span>    <span class="comment">// Invoke the function to calculate signed distances from the particle to each face of the cell.</span></div>
<div class="line"><span class="lineno">  830</span>    <span class="comment">// The distances are stored in the array pointed to by &#39;d&#39;.</span></div>
<div class="line"><span class="lineno">  831</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a7af34c8e2ed4672f0e1f83829159bbe6">CalculateDistancesToCellFaces</a>(p, cell, d, cellThreshold); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  832</span>    CHKERRQ(ierr); <span class="comment">// Check for errors in distance calculation.</span></div>
<div class="line"><span class="lineno">  833</span> </div>
<div class="line"><span class="lineno">  834</span> </div>
<div class="line"><span class="lineno">  835</span>    <span class="comment">// Catch degenerate-plane error manually:</span></div>
<div class="line"><span class="lineno">  836</span>    <span class="keywordflow">if</span> (ierr == PETSC_ERR_USER) {</div>
<div class="line"><span class="lineno">  837</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>,</div>
<div class="line"><span class="lineno">  838</span>                  <span class="stringliteral">&quot;EvaluateParticlePosition - Skipping cell due to degenerate face.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  839</span>        <span class="comment">// We can set *position = -1 here</span></div>
<div class="line"><span class="lineno">  840</span>        *position = -1; <span class="comment">// treat as outside</span></div>
<div class="line"><span class="lineno">  841</span>        <span class="keywordflow">return</span> 0; <span class="comment">// not a fatal error, just skip</span></div>
<div class="line"><span class="lineno">  842</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  843</span>        CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  844</span>    }</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span> </div>
<div class="line"><span class="lineno">  847</span>    <span class="comment">// Debugging output: Print the computed distances to each face for verification purposes.</span></div>
<div class="line"><span class="lineno">  848</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;EvaluateParticlePosition - Face Distances:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  849</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>() == <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a> &amp;&amp; <a class="code hl_function" href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a>(__func__)) <a class="code hl_function" href="logging_8h.html#a9baaed9103be8264832b39c7dbb2ce1a">LOG_FACE_DISTANCES</a>(d); </div>
<div class="line"><span class="lineno">  850</span>    CHKERRQ(ierr); <span class="comment">// Check for errors in printing distances.</span></div>
<div class="line"><span class="lineno">  851</span> </div>
<div class="line"><span class="lineno">  852</span>    <span class="comment">// Determine the particle&#39;s position relative to the cell based on the computed distances.</span></div>
<div class="line"><span class="lineno">  853</span>    <span class="comment">// The function sets the value pointed to by &#39;position&#39; accordingly:</span></div>
<div class="line"><span class="lineno">  854</span>    <span class="comment">// 0 for inside, 1 (2 or 3) for on the boundary, and -1 for outside.</span></div>
<div class="line"><span class="lineno">  855</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a7db2c59feb52c21a5d3bcd2bd67bbb43">DeterminePointPosition</a>(d,position); </div>
<div class="line"><span class="lineno">  856</span>    CHKERRQ(ierr); <span class="comment">// Check for errors in position determination.</span></div>
<div class="line"><span class="lineno">  857</span> </div>
<div class="line"><span class="lineno">  858</span>    <span class="keywordflow">return</span> 0; <span class="comment">// Indicate successful execution of the function.</span></div>
<div class="line"><span class="lineno">  859</span>}</div>
<div class="ttc" id="alogging_8h_html_a2358badbcda33fc9d80ebd6a59d2a2cd"><div class="ttname"><a href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a></div><div class="ttdeci">PetscBool is_function_allowed(const char *functionName)</div><div class="ttdoc">Checks if a given function is in the allow-list.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00159">logging.c:159</a></div></div>
<div class="ttc" id="alogging_8h_html_a9585f583c260f40a73f2490914edc689"><div class="ttname"><a href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a></div><div class="ttdeci">LogLevel get_log_level()</div><div class="ttdoc">Retrieves the current logging level from the environment variable LOG_LEVEL.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00049">logging.c:49</a></div></div>
<div class="ttc" id="alogging_8h_html_a9baaed9103be8264832b39c7dbb2ce1a"><div class="ttname"><a href="logging_8h.html#a9baaed9103be8264832b39c7dbb2ce1a">LOG_FACE_DISTANCES</a></div><div class="ttdeci">PetscErrorCode LOG_FACE_DISTANCES(PetscReal *d)</div><div class="ttdoc">Prints the signed distances to each face of the cell.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00229">logging.c:229</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a2ed7a27dd4de3fbd6bb46684482ce165"><div class="ttname"><a href="walkingsearch_8c.html#a2ed7a27dd4de3fbd6bb46684482ce165">GetCellCharacteristicSize</a></div><div class="ttdeci">PetscErrorCode GetCellCharacteristicSize(const Cell *cell, PetscReal *cellSize)</div><div class="ttdoc">Estimates a characteristic length of the cell for threshold scaling.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00025">walkingsearch.c:25</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a7af34c8e2ed4672f0e1f83829159bbe6"><div class="ttname"><a href="walkingsearch_8c.html#a7af34c8e2ed4672f0e1f83829159bbe6">CalculateDistancesToCellFaces</a></div><div class="ttdeci">PetscErrorCode CalculateDistancesToCellFaces(const Cmpnts p, const Cell *cell, PetscReal *d, const PetscReal threshold)</div><div class="ttdoc">Computes the signed distances from a point to each face of a cubic cell.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00271">walkingsearch.c:271</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a7db2c59feb52c21a5d3bcd2bd67bbb43"><div class="ttname"><a href="walkingsearch_8c.html#a7db2c59feb52c21a5d3bcd2bd67bbb43">DeterminePointPosition</a></div><div class="ttdeci">PetscErrorCode DeterminePointPosition(PetscReal *d, PetscInt *result)</div><div class="ttdoc">Classifies a point based on precomputed face distances.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00407">walkingsearch.c:407</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a556871801ba0b3214285a2ca1fe622ac_cgraph.svg" width="100%" height="524"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a556871801ba0b3214285a2ca1fe622ac_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a0ca65b2e2a59f60caee7b0f363141f46" name="a0ca65b2e2a59f60caee7b0f363141f46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ca65b2e2a59f60caee7b0f363141f46">&#9670;&#160;</a></span>FinalizeTraversal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode FinalizeTraversal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>traversal_steps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscBool&#160;</td>
          <td class="paramname"><em>cell_found</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finalizes the traversal by reporting the results. </p>
<p>This function prints the outcome of the traversal, indicating whether the particle was found within a cell or not, and updates the particle's cell indices accordingly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure to update with cell indices. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">traversal_steps</td><td>The number of traversal steps taken. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cell_found</td><td>Flag indicating whether the particle was found within a cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idx</td><td>The i-index of the found cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idy</td><td>The j-index of the found cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idz</td><td>The k-index of the found cell.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00977">977</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  978</span>{</div>
<div class="line"><span class="lineno">  979</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  980</span>    <span class="keywordflow">if</span> (user == NULL || particle == NULL) {</div>
<div class="line"><span class="lineno">  981</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;FinalizeTraversal - One or more input pointers are NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  982</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;FinalizeTraversal - One or more input pointers are NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  983</span>    }</div>
<div class="line"><span class="lineno">  984</span> </div>
<div class="line"><span class="lineno">  985</span>    <span class="keywordflow">if</span> (cell_found) {</div>
<div class="line"><span class="lineno">  986</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;FinalizeTraversal - Particle located in cell (%d, %d, %d) after %d traversal steps.\n&quot;</span>,</div>
<div class="line"><span class="lineno">  987</span>            idx, idy, idz, traversal_steps);</div>
<div class="line"><span class="lineno">  988</span>    }</div>
<div class="line"><span class="lineno">  989</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  990</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;FinalizeTraversal - Particle could not be located within the grid after %d traversal steps.\n&quot;</span>, (PetscInt)traversal_steps);</div>
<div class="line"><span class="lineno">  991</span>        particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0] = -1;</div>
<div class="line"><span class="lineno">  992</span>        particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1] = -1;</div>
<div class="line"><span class="lineno">  993</span>        particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2] = -1;</div>
<div class="line"><span class="lineno">  994</span>    }</div>
<div class="line"><span class="lineno">  995</span> </div>
<div class="line"><span class="lineno">  996</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;FinalizeTraversal - Completed final traversal sync across all ranks.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  997</span> </div>
<div class="line"><span class="lineno">  998</span> </div>
<div class="line"><span class="lineno">  999</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1000</span>}</div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a90250e79337972756b8ce1daae2321f9"><div class="ttname"><a href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">Particle::cell</a></div><div class="ttdeci">PetscInt cell[3]</div><div class="ttdoc">Computational indices (i, j, k) of the cell containing the particle.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00167">variables.h:167</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9aedf40cb1545b554e113ebb0863859d" name="a9aedf40cb1545b554e113ebb0863859d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9aedf40cb1545b554e113ebb0863859d">&#9670;&#160;</a></span>FindOwnerOfCell()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode FindOwnerOfCell </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscMPIInt *&#160;</td>
          <td class="paramname"><em>owner_rank</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the MPI rank that owns a given global cell index. </p>
<p>This function performs a linear search through the pre-computed decomposition map (<code>user-&gt;RankCellInfoMap</code>) to determine which process is responsible for the cell with global indices (i, j, k). It is the definitive method for resolving cell ownership in the "Walk and Handoff" migration algorithm.</p>
<p>If the provided indices are outside the range of any rank (e.g., negative or beyond the global domain), the function will not find an owner and <code>owner_rank</code> will be set to -1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure, which must contain the initialized <code>RankCellInfoMap</code> and <code>num_ranks</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>Global i-index of the cell to find. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">j</td><td>Global j-index of the cell to find. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>Global k-index of the cell to find. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">owner_rank</td><td>Pointer to a <code>PetscMPIInt</code> where the resulting owner rank will be stored. It is set to -1 if no owner is found.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a non-zero PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l01026">1026</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1027</span>{</div>
<div class="line"><span class="lineno"> 1028</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1029</span>    PetscMPIInt size;</div>
<div class="line"><span class="lineno"> 1030</span> </div>
<div class="line"><span class="lineno"> 1031</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1032</span> </div>
<div class="line"><span class="lineno"> 1033</span>    ierr = MPI_Comm_size(PETSC_COMM_WORLD,&amp;size); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1034</span> </div>
<div class="line"><span class="lineno"> 1035</span>    <span class="comment">// --- 1. Input Validation ---</span></div>
<div class="line"><span class="lineno"> 1036</span>    <span class="keywordflow">if</span> (!user || !user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac6a8eb8e8fd8e5b5c674384576890517">RankCellInfoMap</a>) {</div>
<div class="line"><span class="lineno"> 1037</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;UserCtx or RankCellInfoMap is not initialized in FindOwnerOfCell.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1038</span>    }</div>
<div class="line"><span class="lineno"> 1039</span>    <span class="keywordflow">if</span> (!owner_rank) {</div>
<div class="line"><span class="lineno"> 1040</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;Output pointer owner_rank is NULL in FindOwnerOfCell.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1041</span>    }</div>
<div class="line"><span class="lineno"> 1042</span> </div>
<div class="line"><span class="lineno"> 1043</span>    <span class="comment">// --- 2. Linear Search through the Decomposition Map ---</span></div>
<div class="line"><span class="lineno"> 1044</span>    <span class="comment">// Initialize to a &quot;not found&quot; state.</span></div>
<div class="line"><span class="lineno"> 1045</span>    *owner_rank = -1;</div>
<div class="line"><span class="lineno"> 1046</span> </div>
<div class="line"><span class="lineno"> 1047</span>    <span class="comment">// Loop through the map, which contains the ownership info for every rank &#39;r&#39;.</span></div>
<div class="line"><span class="lineno"> 1048</span>    <span class="keywordflow">for</span> (PetscMPIInt r = 0; r &lt; size; ++r) {</div>
<div class="line"><span class="lineno"> 1049</span>        <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structRankCellInfo">RankCellInfo</a> *info = &amp;user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac6a8eb8e8fd8e5b5c674384576890517">RankCellInfoMap</a>[r];</div>
<div class="line"><span class="lineno"> 1050</span> </div>
<div class="line"><span class="lineno"> 1051</span>        <span class="comment">// A rank owns a cell if the cell&#39;s index is within its start (inclusive)</span></div>
<div class="line"><span class="lineno"> 1052</span>        <span class="comment">// and end (exclusive) range for all three dimensions.</span></div>
<div class="line"><span class="lineno"> 1053</span>        <span class="keywordflow">if</span> ((i &gt;= info-&gt;<a class="code hl_variable" href="variables__old_8h.html#a19272b97c7c160d257dbe0fc8da2f2d8">xs_cell</a> &amp;&amp; i &lt; info-&gt;xs_cell + info-&gt;<a class="code hl_variable" href="variables__old_8h.html#a7b338865846c21925fbb6b968cdf385f">xm_cell</a>) &amp;&amp;</div>
<div class="line"><span class="lineno"> 1054</span>            (j &gt;= info-&gt;<a class="code hl_variable" href="variables__old_8h.html#a118b3648071bd642f8d066878ba920a7">ys_cell</a> &amp;&amp; j &lt; info-&gt;ys_cell + info-&gt;<a class="code hl_variable" href="variables__old_8h.html#a823852c48e9bdaa32c354ae7b41f29d7">ym_cell</a>) &amp;&amp;</div>
<div class="line"><span class="lineno"> 1055</span>            (k &gt;= info-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4d6a4d14075dd0718f49111d91c61e1d">zs_cell</a> &amp;&amp; k &lt; info-&gt;zs_cell + info-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4b91bc588672c42d8917bf335d1a754e">zm_cell</a>))</div>
<div class="line"><span class="lineno"> 1056</span>        {</div>
<div class="line"><span class="lineno"> 1057</span>            *owner_rank = r; <span class="comment">// We found the owner.</span></div>
<div class="line"><span class="lineno"> 1058</span>            <span class="keywordflow">break</span>;           <span class="comment">// The search is over, exit the loop.</span></div>
<div class="line"><span class="lineno"> 1059</span>        }</div>
<div class="line"><span class="lineno"> 1060</span>    }</div>
<div class="line"><span class="lineno"> 1061</span> </div>
<div class="line"><span class="lineno"> 1062</span>    <span class="comment">// --- 3. Logging for Diagnostics ---</span></div>
<div class="line"><span class="lineno"> 1063</span>    <span class="comment">// This is extremely useful for debugging particle migration issues.</span></div>
<div class="line"><span class="lineno"> 1064</span>    <span class="keywordflow">if</span> (*owner_rank == -1) {</div>
<div class="line"><span class="lineno"> 1065</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;FindOwnerOfCell: No owner found for global cell (%d, %d, %d). It is likely outside the domain.\n&quot;</span>, i, j, k);</div>
<div class="line"><span class="lineno"> 1066</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1067</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;FindOwnerOfCell: Owner of cell (%d, %d, %d) is Rank %d.\n&quot;</span>, i, j, k, *owner_rank);</div>
<div class="line"><span class="lineno"> 1068</span>    }</div>
<div class="line"><span class="lineno"> 1069</span> </div>
<div class="line"><span class="lineno"> 1070</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1071</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a118b3648071bd642f8d066878ba920a7"><div class="ttname"><a href="variables__old_8h.html#a118b3648071bd642f8d066878ba920a7">RankCellInfo::ys_cell</a></div><div class="ttdeci">PetscInt ys_cell</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00184">variables.h:184</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a19272b97c7c160d257dbe0fc8da2f2d8"><div class="ttname"><a href="variables__old_8h.html#a19272b97c7c160d257dbe0fc8da2f2d8">RankCellInfo::xs_cell</a></div><div class="ttdeci">PetscInt xs_cell</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00184">variables.h:184</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4b91bc588672c42d8917bf335d1a754e"><div class="ttname"><a href="variables__old_8h.html#a4b91bc588672c42d8917bf335d1a754e">RankCellInfo::zm_cell</a></div><div class="ttdeci">PetscInt zm_cell</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00185">variables.h:185</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4d6a4d14075dd0718f49111d91c61e1d"><div class="ttname"><a href="variables__old_8h.html#a4d6a4d14075dd0718f49111d91c61e1d">RankCellInfo::zs_cell</a></div><div class="ttdeci">PetscInt zs_cell</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00184">variables.h:184</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a7b338865846c21925fbb6b968cdf385f"><div class="ttname"><a href="variables__old_8h.html#a7b338865846c21925fbb6b968cdf385f">RankCellInfo::xm_cell</a></div><div class="ttdeci">PetscInt xm_cell</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00185">variables.h:185</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a823852c48e9bdaa32c354ae7b41f29d7"><div class="ttname"><a href="variables__old_8h.html#a823852c48e9bdaa32c354ae7b41f29d7">RankCellInfo::ym_cell</a></div><div class="ttdeci">PetscInt ym_cell</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00185">variables.h:185</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac6a8eb8e8fd8e5b5c674384576890517"><div class="ttname"><a href="variables__old_8h.html#ac6a8eb8e8fd8e5b5c674384576890517">UserCtx::RankCellInfoMap</a></div><div class="ttdeci">RankCellInfo * RankCellInfoMap</div><div class="ttdoc">List of RankCellInfo objects which contain the cells owned by each rank.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00648">variables.h:648</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structRankCellInfo"><div class="ttname"><a href="variables__old_8h.html#structRankCellInfo">RankCellInfo</a></div><div class="ttdoc">A lean struct to hold the global cell ownership range for a single MPI rank.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00183">variables.h:183</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a9aedf40cb1545b554e113ebb0863859d_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2ed7a27dd4de3fbd6bb46684482ce165" name="a2ed7a27dd4de3fbd6bb46684482ce165"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ed7a27dd4de3fbd6bb46684482ce165">&#9670;&#160;</a></span>GetCellCharacteristicSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode GetCellCharacteristicSize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCell">Cell</a> *&#160;</td>
          <td class="paramname"><em>cell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>cellSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimates a characteristic length of the cell for threshold scaling. </p>
<p>For a hexahedral cell with vertices cell-&gt;vertices[0..7], we approximate the cell size by some measuree.g. average edge length or diagonal. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cell</td><td>A pointer to the <a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a> structure </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cellSize</td><td>A pointer to a PetscReal where the characteristic size is stored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00025">25</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   26</span>{</div>
<div class="line"><span class="lineno">   27</span>    PetscErrorCode ierr = 0;</div>
<div class="line"><span class="lineno">   28</span>    <span class="keywordflow">if</span> (!cell || !cellSize) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, </div>
<div class="line"><span class="lineno">   29</span>        <span class="stringliteral">&quot;GetCellCharacteristicSize: Null pointer(s).&quot;</span>);</div>
<div class="line"><span class="lineno">   30</span> </div>
<div class="line"><span class="lineno">   31</span>    <span class="comment">// A simple approach: compute the average of the distances between</span></div>
<div class="line"><span class="lineno">   32</span>    <span class="comment">// all pairs of adjacent vertices that share an edge. That gives</span></div>
<div class="line"><span class="lineno">   33</span>    <span class="comment">// a typical measure of cell dimension. For a uniform grid, you</span></div>
<div class="line"><span class="lineno">   34</span>    <span class="comment">// could do something simpler.</span></div>
<div class="line"><span class="lineno">   35</span> </div>
<div class="line"><span class="lineno">   36</span>    PetscInt edges[12][2] = {</div>
<div class="line"><span class="lineno">   37</span>        {0,1},{1,2},{2,3},{3,0},  <span class="comment">// bottom face edges</span></div>
<div class="line"><span class="lineno">   38</span>        {4,5},{5,6},{6,7},{7,4},  <span class="comment">// top face edges</span></div>
<div class="line"><span class="lineno">   39</span>        {0,7},{1,6},{2,5},{3,4}   <span class="comment">// vertical edges</span></div>
<div class="line"><span class="lineno">   40</span>    };</div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span>    PetscReal totalEdgeLen = 0.0;</div>
<div class="line"><span class="lineno">   43</span>    <span class="keywordflow">for</span> (PetscInt i=0; i&lt;12; i++) {</div>
<div class="line"><span class="lineno">   44</span>        PetscInt vA = edges[i][0];</div>
<div class="line"><span class="lineno">   45</span>        PetscInt vB = edges[i][1];</div>
<div class="line"><span class="lineno">   46</span>        <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> A = cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[vA];</div>
<div class="line"><span class="lineno">   47</span>        <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> B = cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[vB];</div>
<div class="line"><span class="lineno">   48</span>        PetscReal dx = B.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - A.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">   49</span>        PetscReal dy = B.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - A.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">   50</span>        PetscReal dz = B.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - A.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">   51</span>        PetscReal edgeLen = sqrt(dx*dx + dy*dy + dz*dz);</div>
<div class="line"><span class="lineno">   52</span>        totalEdgeLen += edgeLen;</div>
<div class="line"><span class="lineno">   53</span>    }</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>    <span class="comment">// Average edge length</span></div>
<div class="line"><span class="lineno">   56</span>    *cellSize = totalEdgeLen / 12.0;</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>    <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">   59</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a2ed7a27dd4de3fbd6bb46684482ce165_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae14b1946c4c34cae5455bdfd632eb98e" name="ae14b1946c4c34cae5455bdfd632eb98e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae14b1946c4c34cae5455bdfd632eb98e">&#9670;&#160;</a></span>GetCellVerticesFromGrid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode GetCellVerticesFromGrid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>coor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structCell">Cell</a> *&#160;</td>
          <td class="paramname"><em>cell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the coordinates of the eight vertices of a cell based on grid indices. </p>
<p>This function populates the <code>cell</code> structure with the coordinates of the eight vertices of a hexahedral cell given its grid indices <code>(idx, idy, idz)</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">coor</td><td>Pointer to a 3D array of <code><a class="el" href="variables__old_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a></code> structures representing the grid coordinates. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idx</td><td>The i-index of the cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idy</td><td>The j-index of the cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idz</td><td>The k-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cell</td><td>Pointer to a <code><a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a></code> structure to store the cell's vertices.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>This function populates the <code>cell</code> structure with the coordinates of the eight vertices of a hexahedral cell given its grid indices <code>(idx, idy, idz)</code>. The vertex numbering follows the convention depicted in the provided figure:</p>
<div class="fragment"><div class="line">         (i,j+1,k)</div>
<div class="line">        3---------------------------2(i+1,j+1,k)</div>
<div class="line">       /|                          /|</div>
<div class="line">      / |                         / |</div>
<div class="line">     /  |                        /  |</div>
<div class="line">    /   |                       /   |</div>
<div class="line">   /    |                      /    |</div>
<div class="line">  /     |                     /     |</div>
<div class="line"> /      |                    /      |</div>
<div class="line">4-------|------------------5        |</div>
<div class="line">|       |                   |       |</div>
<div class="line">|(i,j+1,k+1)                |       |       </div>
<div class="line">|       |                   |       |</div>
<div class="line">|       0-------------------|-------1 (i+1,j,k)</div>
<div class="line">|       /                   |      /</div>
<div class="line">|      /                    |     /</div>
<div class="line">|     /                     |    /</div>
<div class="line">|    /                      |   /</div>
<div class="line">|   /                       |  /</div>
<div class="line">|  /                        | /</div>
<div class="line">| /                         |/</div>
<div class="line">7---------------------------6</div>
<div class="line">(i,j,k+1)                  (i+1,j,k+1)</div>
</div><!-- fragment --><p><b>Vertex Numbering and Positions:</b></p><ul>
<li><b>Vertex 0</b>: <code>(i, j, k)</code>  <code>cell-&gt;vertices[0]</code></li>
<li><b>Vertex 1</b>: <code>(i+1, j, k)</code>  <code>cell-&gt;vertices[1]</code></li>
<li><b>Vertex 2</b>: <code>(i+1, j+1, k)</code>  <code>cell-&gt;vertices[2]</code></li>
<li><b>Vertex 3</b>: <code>(i, j+1, k)</code>  <code>cell-&gt;vertices[3]</code></li>
<li><b>Vertex 4</b>: <code>(i, j+1, k+1)</code>  <code>cell-&gt;vertices[4]</code></li>
<li><b>Vertex 5</b>: <code>(i+1, j+1, k+1)</code>  <code>cell-&gt;vertices[5]</code></li>
<li><b>Vertex 6</b>: <code>(i+1, j, k+1)</code>  <code>cell-&gt;vertices[6]</code></li>
<li><b>Vertex 7</b>: <code>(i, j, k+1)</code>  <code>cell-&gt;vertices[7]</code></li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">coor</td><td>Pointer to a 3D array of <code><a class="el" href="variables__old_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a></code> structures representing the grid coordinates. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idx</td><td>The i-index of the cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idy</td><td>The j-index of the cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idz</td><td>The k-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cell</td><td>Pointer to a <code><a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a></code> structure to store the cell's vertices.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 to indicate successful execution. Non-zero on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>It is assumed that the grid indices <code>(idx, idy, idz)</code> are within valid bounds.</li>
<li>The <code>coor</code> array should be properly initialized with accurate coordinates for all grid points.</li>
<li>The function assumes unit spacing between grid points. Modify the coordinate assignments if your grid spacing differs.</li>
<li>The boundary checks have been removed as they are performed before calling this function. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00521">521</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  523</span>{</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  526</span>    <span class="keywordflow">if</span> (coor == NULL) {</div>
<div class="line"><span class="lineno">  527</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;GetCellVerticesFromGrid - &#39;coor&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  528</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;GetCellVerticesFromGrid - Input array &#39;coor&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  529</span>    }</div>
<div class="line"><span class="lineno">  530</span>    <span class="keywordflow">if</span> (cell == NULL) {</div>
<div class="line"><span class="lineno">  531</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;GetCellVerticesFromGrid - &#39;cell&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  532</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;GetCellVerticesFromGrid - Output parameter &#39;cell&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  533</span>    }</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>    <span class="comment">// Assign vertices based on grid indices matching the figure</span></div>
<div class="line"><span class="lineno">  536</span>    <span class="comment">// Vertex numbering follows the convention depicted in the figure</span></div>
<div class="line"><span class="lineno">  537</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[0] = coor[idz][idy][idx];         <span class="comment">// Vertex 0: (i,   j,   k)</span></div>
<div class="line"><span class="lineno">  538</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[1] = coor[idz][idy][idx+1];       <span class="comment">// Vertex 1: (i+1, j,   k)</span></div>
<div class="line"><span class="lineno">  539</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[2] = coor[idz][idy+1][idx+1];     <span class="comment">// Vertex 2: (i+1, j+1, k)</span></div>
<div class="line"><span class="lineno">  540</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[3] = coor[idz][idy+1][idx];       <span class="comment">// Vertex 3: (i,   j+1, k)</span></div>
<div class="line"><span class="lineno">  541</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[4] = coor[idz+1][idy+1][idx];     <span class="comment">// Vertex 4: (i,   j+1, k+1)</span></div>
<div class="line"><span class="lineno">  542</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[5] = coor[idz+1][idy+1][idx+1];   <span class="comment">// Vertex 5: (i+1, j+1, k+1)</span></div>
<div class="line"><span class="lineno">  543</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[6] = coor[idz+1][idy][idx+1];     <span class="comment">// Vertex 6: (i+1, j,   k+1)</span></div>
<div class="line"><span class="lineno">  544</span>    cell-&gt;<a class="code hl_variable" href="variables__old_8h.html#a994289a1b1801d93075b37b69c129e82">vertices</a>[7] = coor[idz+1][idy][idx];       <span class="comment">// Vertex 7: (i,   j,   k+1)</span></div>
<div class="line"><span class="lineno">  545</span> </div>
<div class="line"><span class="lineno">  546</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;GetCellVerticesFromGrid - Retrieved vertices for cell (%d, %d, %d).\n&quot;</span>, idx, idy, idz);</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>    <span class="keywordflow">return</span> 0; <span class="comment">// Indicate successful execution</span></div>
<div class="line"><span class="lineno">  549</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_ae14b1946c4c34cae5455bdfd632eb98e_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="af9a2ec1317c83d6dfad52415b83cd6e6" name="af9a2ec1317c83d6dfad52415b83cd6e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9a2ec1317c83d6dfad52415b83cd6e6">&#9670;&#160;</a></span>InitializeTraversalParameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeTraversalParameters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>traversal_steps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes traversal parameters for locating a particle. </p>
<p>This function sets the initial cell indices based on the local grid boundaries and initializes the traversal step counter.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure containing its location. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idx</td><td>Pointer to store the initial i-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idy</td><td>Pointer to store the initial j-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idz</td><td>Pointer to store the initial k-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">traversal_steps</td><td>Pointer to store the initial traversal step count.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>This function sets the initial cell indices for the grid search.</p><ul>
<li>If the particle has valid previous cell indices (not -1,-1,-1), the search starts from that previous cell.</li>
<li>Otherwise (e.g., first time locating the particle), the search starts from the beginning corner (xs, ys, zs) of the local grid domain owned by the current process. It also initializes the traversal step counter.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure containing its location and previous cell (if any). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idx</td><td>Pointer to store the initial i-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idy</td><td>Pointer to store the initial j-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idz</td><td>Pointer to store the initial k-index of the cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">traversal_steps</td><td>Pointer to store the initial traversal step count.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00571">571</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  572</span>{</div>
<div class="line"><span class="lineno">  573</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  574</span>    DMDALocalInfo info;</div>
<div class="line"><span class="lineno">  575</span> </div>
<div class="line"><span class="lineno">  576</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  577</span>    <span class="keywordflow">if</span> (user == NULL || particle == NULL || idx == NULL || idy == NULL || idz == NULL || traversal_steps == NULL) {</div>
<div class="line"><span class="lineno">  578</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;InitializeTraversalParameters - One or more input pointers are NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  579</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;InitializeTraversalParameters - One or more input pointers are NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  580</span>    }</div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>    <span class="comment">// Get grid information (needed for fallback start and potentially validation)</span></div>
<div class="line"><span class="lineno">  583</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>    <span class="comment">// --- Check if the particle has a valid previous cell ID ---</span></div>
<div class="line"><span class="lineno">  586</span>    <span class="comment">// Assuming particle-&gt;cell stores the *global* indices</span></div>
<div class="line"><span class="lineno">  587</span>    <span class="keywordflow">if</span> (particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0] &gt;= 0 &amp;&amp; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1] &gt;= 0 &amp;&amp; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2] &gt;= 0) {</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>      <span class="comment">// It sees a valid cell ID exists.</span></div>
<div class="line"><span class="lineno">  590</span>      <span class="comment">// Before using it, it explicitly checks if this cell is accessible.</span></div>
<div class="line"><span class="lineno">  591</span>      PetscBool is_handoff_cell_valid;</div>
<div class="line"><span class="lineno">  592</span>      ierr = <a class="code hl_function" href="walkingsearch_8c.html#afae6265db91aa72254a050c0b6159dab">CheckCellWithinLocalGrid</a>(user, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2], &amp;is_handoff_cell_valid); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>      <span class="keywordflow">if</span> (is_handoff_cell_valid) {</div>
<div class="line"><span class="lineno">  595</span>        <span class="comment">// FAST PATH: The check passed. The cell is safe. Use it.</span></div>
<div class="line"><span class="lineno">  596</span>        *idx = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0];</div>
<div class="line"><span class="lineno">  597</span>        *idy = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1];</div>
<div class="line"><span class="lineno">  598</span>        *idz = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2];</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>     <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeTraversalParameters - Particle %lld has previous cell (%d, %d, %d). Starting search there.\n&quot;</span>,</div>
<div class="line"><span class="lineno">  601</span>           (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, *idx, *idy, *idz); <span class="comment">// Cast id to long long for printing PetscInt64</span></div>
<div class="line"><span class="lineno">  602</span>    </div>
<div class="line"><span class="lineno">  603</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  604</span>        <span class="comment">// SAFE FALLBACK: The check failed! The handoff cell is NOT safe.</span></div>
<div class="line"><span class="lineno">  605</span>        <span class="comment">// Discard the unsafe handoff cell and revert to starting at the</span></div>
<div class="line"><span class="lineno">  606</span>        <span class="comment">// guaranteed-safe local corner.</span></div>
<div class="line"><span class="lineno">  607</span>        *idx = info.xs;</div>
<div class="line"><span class="lineno">  608</span>        *idy = info.ys;</div>
<div class="line"><span class="lineno">  609</span>        *idz = info.zs;</div>
<div class="line"><span class="lineno">  610</span>      }</div>
<div class="line"><span class="lineno">  611</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  612</span>        <span class="comment">// No valid previous cell ID (e.g., -1,-1,-1 or first time).</span></div>
<div class="line"><span class="lineno">  613</span>        <span class="comment">// Start from the first cell in the local owned grid domain.</span></div>
<div class="line"><span class="lineno">  614</span>        *idx = info.xs;</div>
<div class="line"><span class="lineno">  615</span>        *idy = info.ys;</div>
<div class="line"><span class="lineno">  616</span>        *idz = info.zs;</div>
<div class="line"><span class="lineno">  617</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeTraversalParameters - Particle %lld has no valid previous cell. Starting search at local corner (%d, %d, %d).\n&quot;</span>,</div>
<div class="line"><span class="lineno">  618</span>                  (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, *idx, *idy, *idz);</div>
<div class="line"><span class="lineno">  619</span>    }</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>    <span class="comment">// Initialize traversal step counter</span></div>
<div class="line"><span class="lineno">  622</span>    *traversal_steps = 0;</div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>    <span class="comment">// Log the chosen starting point</span></div>
<div class="line"><span class="lineno">  625</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;InitializeTraversalParameters - Traversal for particle %lld initialized to start at cell (%d, %d, %d).\n&quot;</span>,</div>
<div class="line"><span class="lineno">  626</span>               (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, *idx, *idy, *idz);</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  629</span>}</div>
<div class="ttc" id="avariables__old_8h_html_aecd4cd7f1da07e3f3d6e1fb6cf71a44b"><div class="ttname"><a href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">Particle::PID</a></div><div class="ttdeci">PetscInt64 PID</div><div class="ttdoc">Unique Particle ID.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00166">variables.h:166</a></div></div>
<div class="ttc" id="avariables__old_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdoc">DMDA for scalar fields (e.g., Pressure, Nvert).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_afae6265db91aa72254a050c0b6159dab"><div class="ttname"><a href="walkingsearch_8c.html#afae6265db91aa72254a050c0b6159dab">CheckCellWithinLocalGrid</a></div><div class="ttdeci">PetscErrorCode CheckCellWithinLocalGrid(UserCtx *user, PetscInt idx, PetscInt idy, PetscInt idz, PetscBool *is_within)</div><div class="ttdoc">Checks if the current GLOBAL CELL indices are within the LOCAL GHOSTED grid boundaries accessible by ...</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00650">walkingsearch.c:650</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_af9a2ec1317c83d6dfad52415b83cd6e6_cgraph.svg" width="460" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_af9a2ec1317c83d6dfad52415b83cd6e6_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aab2bd86e92a9adc67d49622e20a03dbf" name="aab2bd86e92a9adc67d49622e20a03dbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab2bd86e92a9adc67d49622e20a03dbf">&#9670;&#160;</a></span>LocateParticleInGrid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode LocateParticleInGrid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Locates the grid cell containing a particle using a walking search. </p>
<p>This function implements a walking search algorithm to find the specific cell (identified by global indices i, j, k) that encloses the particle's physical location (<code>particle-&gt;loc</code>).</p>
<p>The search starts from an initial guess cell (either the particle's previously known cell or the corner of the local process domain) and iteratively steps to adjacent cells based on the signed distances from the particle to the faces of the current cell.</p>
<p>Upon successful location (<code>position == 0</code>), the particle's <code>cell</code> field is updated with the found indices (i,j,k), and the corresponding interpolation <code>weights</code> are calculated and stored using the distances (<code>d</code>) relative to the final cell.</p>
<p>Handles particles exactly on cell boundaries by attempting a tie-breaker if the search gets stuck oscillating between adjacent cells due to the boundary condition.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure containing grid information (DMDA, coordinates) and domain boundaries. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure. Its <code>loc</code> field provides the target position. On successful return, its <code>cell</code> and <code>weights</code> fields are updated. On failure, <code>cell</code> is set to <code>{-1, -1, -1}</code> and <code>weights</code> to <code>{0.0, 0.0, 0.0}</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. Non-zero error codes may indicate issues during coordinate access, distance calculation, or other internal errors. A return code of 0 does not guarantee the particle was found; check <code>particle-&gt;cell[0] &gt;= 0</code> afterward.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Relies on helper functions like <code>InitializeTraversalParameters</code>, <code>CheckCellWithinLocalGrid</code>, <code>RetrieveCurrentCell</code>, <code>EvaluateParticlePosition</code>, <code>UpdateCellIndicesBasedOnDistances</code>, <code>UpdateParticleWeights</code>, and <code>FinalizeTraversal</code>. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Ensure <code>particle-&gt;loc</code> is set correctly before calling. </dd>
<dd>
The function may fail to find the particle if it lies outside the domain accessible by the current process (including ghost cells) or if <code>MAX_TRAVERSAL</code> steps are exceeded. </dd></dl>

</div>
</div>
<a id="a0b63dfe82e0fdee5c2c3bdd477f9901f" name="a0b63dfe82e0fdee5c2c3bdd477f9901f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b63dfe82e0fdee5c2c3bdd477f9901f">&#9670;&#160;</a></span>LocateParticleOrFindMigrationTarget_TEST()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode LocateParticleOrFindMigrationTarget_TEST </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a> *&#160;</td>
          <td class="paramname"><em>status_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Locates a particle's host cell or identifies its migration target using a robust walk search. </p>
<p>This is the core search engine. It starts from a guess cell and walks through the grid. It returns a definitive, actionable status indicating the outcome:</p><ul>
<li><code>ACTIVE_AND_LOCATED</code>: The particle was found in a cell on the current rank.</li>
<li><code>MIGRATING_OUT</code>: The particle was found to belong to another rank. <code>particle-&gt;destination_rank</code> is set.</li>
<li><code>LOST</code>: The search failed to find the particle within the global domain.</li>
</ul>
<p>This function is globally aware and can walk across MPI rank boundaries. It contains robust checks for global domain boundaries and a tie-breaker for numerically "stuck" particles on cell faces.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> containing all grid and domain info. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct. Its fields are updated based on the search outcome. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">status_out</td><td>The final, actionable status of the particle after the search.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a non-zero PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l01094">1094</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1097</span>{</div>
<div class="line"><span class="lineno"> 1098</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1099</span>    PetscMPIInt    rank;</div>
<div class="line"><span class="lineno"> 1100</span>    </div>
<div class="line"><span class="lineno"> 1101</span>    <span class="comment">// --- Search State Variables ---</span></div>
<div class="line"><span class="lineno"> 1102</span>    PetscInt  idx, idy, idz;           <span class="comment">// Current search cell global indices</span></div>
<div class="line"><span class="lineno"> 1103</span>    PetscInt  traversal_steps;         <span class="comment">// Counter to prevent infinite loops</span></div>
<div class="line"><span class="lineno"> 1104</span>    PetscBool search_concluded = PETSC_FALSE; <span class="comment">// Flag to terminate the main while loop</span></div>
<div class="line"><span class="lineno"> 1105</span> </div>
<div class="line"><span class="lineno"> 1106</span>    <span class="comment">// --- Oscillation/Stuck Loop Detection Variables ---</span></div>
<div class="line"><span class="lineno"> 1107</span>    PetscInt  repeatedIndexCount = 0;</div>
<div class="line"><span class="lineno"> 1108</span>    PetscInt  prevIdx = PETSC_MIN_INT, prevIdy = PETSC_MIN_INT, prevIdz = PETSC_MIN_INT;</div>
<div class="line"><span class="lineno"> 1109</span>    PetscInt  last_position_result = -999;</div>
<div class="line"><span class="lineno"> 1110</span> </div>
<div class="line"><span class="lineno"> 1111</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1112</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1113</span>    <a class="code hl_define" href="logging_8h.html#a708710f957e5e79050260f913282f8dc">LOG_FUNC_TIMER_BEGIN_EVENT</a>(<a class="code hl_variable" href="logging_8h.html#a665f66d88010af3842e75cc7f1a00b94">EVENT_IndividualLocation</a>, <a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>);</div>
<div class="line"><span class="lineno"> 1114</span> </div>
<div class="line"><span class="lineno"> 1115</span>    <span class="comment">// --- 1. Initialize the Search ---</span></div>
<div class="line"><span class="lineno"> 1116</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#af9a2ec1317c83d6dfad52415b83cd6e6">InitializeTraversalParameters</a>(user, particle, &amp;idx, &amp;idy, &amp;idz, &amp;traversal_steps); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1117</span> </div>
<div class="line"><span class="lineno"> 1118</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot; The Threshold for considering a particle to be at a face is %.9f.\n&quot;</span>,<a class="code hl_define" href="walkingsearch_8c.html#a00719a0387f578831fd8b092bd4d38d3">DISTANCE_THRESHOLD</a>);</div>
<div class="line"><span class="lineno"> 1119</span>    </div>
<div class="line"><span class="lineno"> 1120</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot; [PID %lld]Traversal Initiated at : i = %d, j = %d, k = %d.\n&quot;</span>,(<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>,idx,idy,idz); </div>
<div class="line"><span class="lineno"> 1121</span>    </div>
<div class="line"><span class="lineno"> 1122</span>    <span class="comment">// --- 2. Main Walking Search Loop ---</span></div>
<div class="line"><span class="lineno"> 1123</span>    <span class="keywordflow">while</span> (!search_concluded &amp;&amp; traversal_steps &lt; <a class="code hl_define" href="walkingsearch_8c.html#a0b04c9114da8773de79936038f5c36a0">MAX_TRAVERSAL</a>) {</div>
<div class="line"><span class="lineno"> 1124</span>        traversal_steps++;</div>
<div class="line"><span class="lineno"> 1125</span> </div>
<div class="line"><span class="lineno"> 1126</span>        <span class="comment">// --- 2a. GLOBAL Domain Boundary Check ---</span></div>
<div class="line"><span class="lineno"> 1127</span>        <span class="keywordflow">if</span> (idx &lt; 0 || idx &gt;= user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> || idy &lt; 0 || idy &gt;= user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> || idz &lt; 0 || idz &gt;= user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>) {</div>
<div class="line"><span class="lineno"> 1128</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;[PID %lld]: Walked outside GLOBAL domain boundaries to invalid cell (%d,%d,%d). Search fails.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1129</span>                      (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, idx, idy, idz);</div>
<div class="line"><span class="lineno"> 1130</span>            idx = -1; <span class="comment">// Invalidate the result to signal failure</span></div>
<div class="line"><span class="lineno"> 1131</span>            <span class="keywordflow">break</span>;    <span class="comment">// Exit the loop immediately</span></div>
<div class="line"><span class="lineno"> 1132</span>        }</div>
<div class="line"><span class="lineno"> 1133</span> </div>
<div class="line"><span class="lineno"> 1134</span>        <span class="comment">// --- 2b. LOCAL GHOST REGION CHECK (PREVENTS SEGV) ---</span></div>
<div class="line"><span class="lineno"> 1135</span>        <span class="comment">// Before trying to access cell data, check if we have it.</span></div>
<div class="line"><span class="lineno"> 1136</span>        PetscBool is_cell_local;</div>
<div class="line"><span class="lineno"> 1137</span>        ierr = <a class="code hl_function" href="walkingsearch_8c.html#afae6265db91aa72254a050c0b6159dab">CheckCellWithinLocalGrid</a>(user, idx, idy, idz, &amp;is_cell_local); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1138</span>        <span class="keywordflow">if</span> (!is_cell_local) {</div>
<div class="line"><span class="lineno"> 1139</span>            <span class="comment">// We have walked outside the local rank&#39;s ghost region.</span></div>
<div class="line"><span class="lineno"> 1140</span>            <span class="comment">// This definitively means the particle belongs to another rank.</span></div>
<div class="line"><span class="lineno"> 1141</span>            <span class="comment">// Conclude the search here; the current (idx,idy,idz) is the handoff cell.</span></div>
<div class="line"><span class="lineno"> 1142</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;[PID %lld]: Walked outside local ghost region to cell (%d,%d,%d). Concluding search for handoff.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1143</span>                      (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, idx, idy, idz);</div>
<div class="line"><span class="lineno"> 1144</span>            search_concluded = PETSC_TRUE;</div>
<div class="line"><span class="lineno"> 1145</span>            <span class="keywordflow">continue</span>; <span class="comment">// Skip the rest of the loop; proceed to finalization.</span></div>
<div class="line"><span class="lineno"> 1146</span>        }</div>
<div class="line"><span class="lineno"> 1147</span>    </div>
<div class="line"><span class="lineno"> 1148</span>        <span class="comment">// --- 2c. Stuck Loop Detection &amp; Enhanced Tie-Breaker ---</span></div>
<div class="line"><span class="lineno"> 1149</span>        <span class="keywordflow">if</span> (idx == prevIdx &amp;&amp; idy == prevIdy &amp;&amp; idz == prevIdz) {</div>
<div class="line"><span class="lineno"> 1150</span>            repeatedIndexCount++;</div>
<div class="line"><span class="lineno"> 1151</span>            <span class="keywordflow">if</span> (repeatedIndexCount &gt; <a class="code hl_define" href="walkingsearch_8c.html#a7545f0e5f8baa17e18c74b9cf8009084">REPEAT_COUNT_THRESHOLD</a>) {</div>
<div class="line"><span class="lineno"> 1152</span>                <span class="comment">// Only apply tie-breaker if we are stuck for the right reason (on a boundary)</span></div>
<div class="line"><span class="lineno"> 1153</span>                <span class="keywordflow">if</span> (last_position_result &gt;= 1) {</div>
<div class="line"><span class="lineno"> 1154</span>                    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;LocateOrMigrate [PID %lld]: Stuck on boundary of cell (%d,%d,%d) for %d steps. Applying enhanced tie-breaker.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1155</span>                              (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, idx, idy, idz, repeatedIndexCount);</div>
<div class="line"><span class="lineno"> 1156</span>                    </div>
<div class="line"><span class="lineno"> 1157</span>                    <span class="comment">// Re-evaluate at the stuck cell to get definitive weights</span></div>
<div class="line"><span class="lineno"> 1158</span>                    <a class="code hl_struct" href="variables__old_8h.html#structCell">Cell</a> final_cell;</div>
<div class="line"><span class="lineno"> 1159</span>                    PetscReal final_d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a>];</div>
<div class="line"><span class="lineno"> 1160</span>                    PetscInt final_position; <span class="comment">// Dummy variable</span></div>
<div class="line"><span class="lineno"> 1161</span>                    </div>
<div class="line"><span class="lineno"> 1162</span>                    ierr = <a class="code hl_function" href="walkingsearch_8c.html#acb77aa5204ab90392c67f10a55227bb6">RetrieveCurrentCell</a>(user, idx, idy, idz, &amp;final_cell); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1163</span>                    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a556871801ba0b3214285a2ca1fe622ac">EvaluateParticlePosition</a>(&amp;final_cell, final_d, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>, &amp;final_position, <a class="code hl_define" href="walkingsearch_8c.html#a00719a0387f578831fd8b092bd4d38d3">DISTANCE_THRESHOLD</a>);</div>
<div class="line"><span class="lineno"> 1164</span>                    </div>
<div class="line"><span class="lineno"> 1165</span>                    <span class="keywordflow">if</span> (ierr == 0) { <span class="comment">// If evaluation succeeded</span></div>
<div class="line"><span class="lineno"> 1166</span>                        ierr = <a class="code hl_function" href="ParticleSwarm_8h.html#a0001e483238e2b600cb9aa23a6e5338c">UpdateParticleWeights</a>(final_d, particle); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1167</span>                        search_concluded = PETSC_TRUE; <span class="comment">// Conclude search, accepting this cell.</span></div>
<div class="line"><span class="lineno"> 1168</span>                    } <span class="keywordflow">else</span> { <span class="comment">// Evaluation failed (e.g., degenerate cell)</span></div>
<div class="line"><span class="lineno"> 1169</span>                        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;[PID %lld]: Tie-breaker failed during final evaluation at cell (%d,%d,%d). Search fails.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1170</span>                                  (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, idx, idy, idz);</div>
<div class="line"><span class="lineno"> 1171</span>                        idx = -1; <span class="comment">// Invalidate result</span></div>
<div class="line"><span class="lineno"> 1172</span>                        search_concluded = PETSC_TRUE;</div>
<div class="line"><span class="lineno"> 1173</span>                    }</div>
<div class="line"><span class="lineno"> 1174</span>                } <span class="keywordflow">else</span> { <span class="comment">// Stuck for the wrong reason (not on a boundary)</span></div>
<div class="line"><span class="lineno"> 1175</span>                    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;[PID %lld]: Search is stuck at cell (%d,%d,%d) but not on a boundary. This indicates a logic error. Failing search.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1176</span>                              (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, idx, idy, idz);</div>
<div class="line"><span class="lineno"> 1177</span>                    idx = -1; <span class="comment">// Invalidate result</span></div>
<div class="line"><span class="lineno"> 1178</span>                    search_concluded = PETSC_TRUE;</div>
<div class="line"><span class="lineno"> 1179</span>                }</div>
<div class="line"><span class="lineno"> 1180</span>                <span class="keywordflow">if</span>(search_concluded) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1181</span>            }</div>
<div class="line"><span class="lineno"> 1182</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1183</span>            repeatedIndexCount = 0;</div>
<div class="line"><span class="lineno"> 1184</span>        }</div>
<div class="line"><span class="lineno"> 1185</span>        prevIdx = idx; prevIdy = idy; prevIdz = idz;</div>
<div class="line"><span class="lineno"> 1186</span> </div>
<div class="line"><span class="lineno"> 1187</span>        <span class="comment">// --- 2d. Geometric Evaluation ---</span></div>
<div class="line"><span class="lineno"> 1188</span>        <a class="code hl_struct" href="variables__old_8h.html#structCell">Cell</a>      current_cell;</div>
<div class="line"><span class="lineno"> 1189</span>        PetscReal distances[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a>];</div>
<div class="line"><span class="lineno"> 1190</span>        PetscInt  position_in_cell;</div>
<div class="line"><span class="lineno"> 1191</span> </div>
<div class="line"><span class="lineno"> 1192</span>        ierr = <a class="code hl_function" href="walkingsearch_8c.html#acb77aa5204ab90392c67f10a55227bb6">RetrieveCurrentCell</a>(user, idx, idy, idz, &amp;current_cell); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1193</span>        ierr = <a class="code hl_function" href="walkingsearch_8c.html#a556871801ba0b3214285a2ca1fe622ac">EvaluateParticlePosition</a>(&amp;current_cell, distances, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>, &amp;position_in_cell, <a class="code hl_define" href="walkingsearch_8c.html#a00719a0387f578831fd8b092bd4d38d3">DISTANCE_THRESHOLD</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1194</span>        last_position_result = position_in_cell;</div>
<div class="line"><span class="lineno"> 1195</span> </div>
<div class="line"><span class="lineno"> 1196</span>        <span class="comment">// --- 2e. Decision Making ---</span></div>
<div class="line"><span class="lineno"> 1197</span>        <span class="keywordflow">if</span> (position_in_cell &gt;= 0) { <span class="comment">// Particle is INSIDE or ON THE BOUNDARY</span></div>
<div class="line"><span class="lineno"> 1198</span>            search_concluded = PETSC_TRUE;</div>
<div class="line"><span class="lineno"> 1199</span>            ierr = <a class="code hl_function" href="ParticleSwarm_8h.html#a0001e483238e2b600cb9aa23a6e5338c">UpdateParticleWeights</a>(distances, particle); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1200</span>        } <span class="keywordflow">else</span> { <span class="comment">// Particle is OUTSIDE</span></div>
<div class="line"><span class="lineno"> 1201</span>            ierr = <a class="code hl_function" href="walkingsearch_8c.html#ae8ed9e0a01de5ee0f332170562b1f9ea">UpdateCellIndicesBasedOnDistancesTEST</a>(distances, &amp;idx, &amp;idy, &amp;idz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1202</span>        }</div>
<div class="line"><span class="lineno"> 1203</span>    }</div>
<div class="line"><span class="lineno"> 1204</span> </div>
<div class="line"><span class="lineno"> 1205</span>    <span class="comment">// --- 3. Finalize and Determine Actionable Status ---</span></div>
<div class="line"><span class="lineno"> 1206</span>    <span class="keywordflow">if</span> (idx == -1 || (!search_concluded &amp;&amp; traversal_steps &gt;= <a class="code hl_define" href="walkingsearch_8c.html#a0b04c9114da8773de79936038f5c36a0">MAX_TRAVERSAL</a>)) {</div>
<div class="line"><span class="lineno"> 1207</span>        <span class="keywordflow">if</span> (idx != -1) {</div>
<div class="line"><span class="lineno"> 1208</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;[PID %lld]: Search FAILED, exceeded MAX_TRAVERSAL limit of %d.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1209</span>                      (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, <a class="code hl_define" href="walkingsearch_8c.html#a0b04c9114da8773de79936038f5c36a0">MAX_TRAVERSAL</a>);</div>
<div class="line"><span class="lineno"> 1210</span>        }</div>
<div class="line"><span class="lineno"> 1211</span>        *status_out = <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581a339435bd0d4a842c6107333c908a5317">LOST</a>;</div>
<div class="line"><span class="lineno"> 1212</span>        particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0] = -1; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1] = -1; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2] = -1;</div>
<div class="line"><span class="lineno"> 1213</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1214</span>        <span class="comment">// Search succeeded in finding a candidate cell, now determine its owner.</span></div>
<div class="line"><span class="lineno"> 1215</span>        PetscMPIInt owner_rank;</div>
<div class="line"><span class="lineno"> 1216</span>        ierr = <a class="code hl_function" href="walkingsearch_8c.html#a9aedf40cb1545b554e113ebb0863859d">FindOwnerOfCell</a>(user, idx, idy, idz, &amp;owner_rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1217</span> </div>
<div class="line"><span class="lineno"> 1218</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot; [PID %ld] Owner rank : %d.\n&quot;</span>,particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>,owner_rank);</div>
<div class="line"><span class="lineno"> 1219</span>    </div>
<div class="line"><span class="lineno"> 1220</span>        <span class="comment">// Always update the particle&#39;s cell index. It&#39;s a good guess for the receiving rank.</span></div>
<div class="line"><span class="lineno"> 1221</span>        particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0] = idx; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1] = idy; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2] = idz;</div>
<div class="line"><span class="lineno"> 1222</span> </div>
<div class="line"><span class="lineno"> 1223</span>        <span class="keywordflow">if</span> (owner_rank == rank) {</div>
<div class="line"><span class="lineno"> 1224</span>            *status_out = <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581a97d609accacbcc1a41e4da5ac052f253">ACTIVE_AND_LOCATED</a>;</div>
<div class="line"><span class="lineno"> 1225</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (owner_rank != -1) {</div>
<div class="line"><span class="lineno"> 1226</span>            <span class="comment">// Particle belongs to another rank. Return the direct, actionable status.</span></div>
<div class="line"><span class="lineno"> 1227</span>            *status_out = <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581af0c3b8144a24d2379a1580a6cd48d329">MIGRATING_OUT</a>;</div>
<div class="line"><span class="lineno"> 1228</span>            particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a76cdf3edbcd6aa56f5a2ba8645e999ea">destination_rank</a> = owner_rank;</div>
<div class="line"><span class="lineno"> 1229</span>        } <span class="keywordflow">else</span> { <span class="comment">// Found a valid index, but no owner in the map.</span></div>
<div class="line"><span class="lineno"> 1230</span>            *status_out = <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581a339435bd0d4a842c6107333c908a5317">LOST</a>;</div>
<div class="line"><span class="lineno"> 1231</span>            particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0] = -1; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1] = -1; particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2] = -1;</div>
<div class="line"><span class="lineno"> 1232</span>        }</div>
<div class="line"><span class="lineno"> 1233</span>    }</div>
<div class="line"><span class="lineno"> 1234</span> </div>
<div class="line"><span class="lineno"> 1235</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;[Rank %d][PID %ld] Search complete.\n&quot;</span>,rank,particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>);</div>
<div class="line"><span class="lineno"> 1236</span> </div>
<div class="line"><span class="lineno"> 1237</span>    <span class="comment">// --- 4. Report the Final Outcome ---</span></div>
<div class="line"><span class="lineno"> 1238</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#a64b2ff5399052580bffaa58562dc0bcd">ReportSearchOutcome</a>(particle, *status_out, traversal_steps); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1239</span>    </div>
<div class="line"><span class="lineno"> 1240</span>    <a class="code hl_define" href="logging_8h.html#a5c922c07e2aff193a0c312e373a0ec31">LOG_FUNC_TIMER_END_EVENT</a>(<a class="code hl_variable" href="logging_8h.html#a665f66d88010af3842e75cc7f1a00b94">EVENT_IndividualLocation</a>, <a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>);</div>
<div class="line"><span class="lineno"> 1241</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1242</span>}</div>
<div class="ttc" id="aParticleSwarm_8h_html_a0001e483238e2b600cb9aa23a6e5338c"><div class="ttname"><a href="ParticleSwarm_8h.html#a0001e483238e2b600cb9aa23a6e5338c">UpdateParticleWeights</a></div><div class="ttdeci">PetscErrorCode UpdateParticleWeights(PetscReal *d, Particle *particle)</div><div class="ttdoc">Updates a particle's interpolation weights based on distances to cell faces.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l01015">ParticleSwarm.c:1015</a></div></div>
<div class="ttc" id="alogging_8h_html_a5c922c07e2aff193a0c312e373a0ec31"><div class="ttname"><a href="logging_8h.html#a5c922c07e2aff193a0c312e373a0ec31">LOG_FUNC_TIMER_END_EVENT</a></div><div class="ttdeci">#define LOG_FUNC_TIMER_END_EVENT(eventID, scope)</div><div class="ttdoc">Ends timing a function by:</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00462">logging.h:462</a></div></div>
<div class="ttc" id="alogging_8h_html_a665f66d88010af3842e75cc7f1a00b94"><div class="ttname"><a href="logging_8h.html#a665f66d88010af3842e75cc7f1a00b94">EVENT_IndividualLocation</a></div><div class="ttdeci">PetscLogEvent EVENT_IndividualLocation</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00036">logging.c:36</a></div></div>
<div class="ttc" id="alogging_8h_html_a708710f957e5e79050260f913282f8dc"><div class="ttname"><a href="logging_8h.html#a708710f957e5e79050260f913282f8dc">LOG_FUNC_TIMER_BEGIN_EVENT</a></div><div class="ttdeci">#define LOG_FUNC_TIMER_BEGIN_EVENT(eventID, scope)</div><div class="ttdoc">Begins timing a function by:</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00436">logging.h:436</a></div></div>
<div class="ttc" id="avariables_8h_html_a347829443e8a679209e21f7f04f51581a339435bd0d4a842c6107333c908a5317"><div class="ttname"><a href="variables_8h.html#a347829443e8a679209e21f7f04f51581a339435bd0d4a842c6107333c908a5317">LOST</a></div><div class="ttdeci">@ LOST</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00139">variables.h:139</a></div></div>
<div class="ttc" id="avariables_8h_html_a347829443e8a679209e21f7f04f51581a97d609accacbcc1a41e4da5ac052f253"><div class="ttname"><a href="variables_8h.html#a347829443e8a679209e21f7f04f51581a97d609accacbcc1a41e4da5ac052f253">ACTIVE_AND_LOCATED</a></div><div class="ttdeci">@ ACTIVE_AND_LOCATED</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00137">variables.h:137</a></div></div>
<div class="ttc" id="avariables_8h_html_a347829443e8a679209e21f7f04f51581af0c3b8144a24d2379a1580a6cd48d329"><div class="ttname"><a href="variables_8h.html#a347829443e8a679209e21f7f04f51581af0c3b8144a24d2379a1580a6cd48d329">MIGRATING_OUT</a></div><div class="ttdeci">@ MIGRATING_OUT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00138">variables.h:138</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3f5ec0e4536c9ccaa3d663f14d47f904"><div class="ttname"><a href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">UserCtx::KM</a></div><div class="ttdeci">PetscInt KM</div><div class="ttdoc">Global grid dimensions (number of cells in i,j,k).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a71cca12cd9fb0796634a7076eeb9b50b"><div class="ttname"><a href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">Particle::loc</a></div><div class="ttdeci">Cmpnts loc</div><div class="ttdoc">Physical location (x,y,z) of the particle.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00168">variables.h:168</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a76cdf3edbcd6aa56f5a2ba8645e999ea"><div class="ttname"><a href="variables__old_8h.html#a76cdf3edbcd6aa56f5a2ba8645e999ea">Particle::destination_rank</a></div><div class="ttdeci">PetscMPIInt destination_rank</div><div class="ttdoc">Target rank for migration (only valid if status MIGRATING_OUT)</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00172">variables.h:172</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aa55a2a246e904b3569075eb4de0092a6"><div class="ttname"><a href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">UserCtx::JM</a></div><div class="ttdeci">PetscInt JM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad1904cdee33ebeffba809c883f7e9641"><div class="ttname"><a href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">UserCtx::IM</a></div><div class="ttdeci">PetscInt IM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structCell"><div class="ttname"><a href="variables__old_8h.html#structCell">Cell</a></div><div class="ttdoc">Defines the vertices of a single hexahedral grid cell.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00160">variables.h:160</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a00719a0387f578831fd8b092bd4d38d3"><div class="ttname"><a href="walkingsearch_8c.html#a00719a0387f578831fd8b092bd4d38d3">DISTANCE_THRESHOLD</a></div><div class="ttdeci">#define DISTANCE_THRESHOLD</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00011">walkingsearch.c:11</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a0b04c9114da8773de79936038f5c36a0"><div class="ttname"><a href="walkingsearch_8c.html#a0b04c9114da8773de79936038f5c36a0">MAX_TRAVERSAL</a></div><div class="ttdeci">#define MAX_TRAVERSAL</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00010">walkingsearch.c:10</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a556871801ba0b3214285a2ca1fe622ac"><div class="ttname"><a href="walkingsearch_8c.html#a556871801ba0b3214285a2ca1fe622ac">EvaluateParticlePosition</a></div><div class="ttdeci">PetscErrorCode EvaluateParticlePosition(const Cell *cell, PetscReal *d, const Cmpnts p, PetscInt *position, const PetscReal threshold)</div><div class="ttdoc">Determines the spatial relationship of a particle relative to a cubic cell.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00811">walkingsearch.c:811</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a64b2ff5399052580bffaa58562dc0bcd"><div class="ttname"><a href="walkingsearch_8c.html#a64b2ff5399052580bffaa58562dc0bcd">ReportSearchOutcome</a></div><div class="ttdeci">PetscErrorCode ReportSearchOutcome(const Particle *particle, ParticleLocationStatus status, PetscInt traversal_steps)</div><div class="ttdoc">Logs the final outcome of the particle location search.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l01247">walkingsearch.c:1247</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a7545f0e5f8baa17e18c74b9cf8009084"><div class="ttname"><a href="walkingsearch_8c.html#a7545f0e5f8baa17e18c74b9cf8009084">REPEAT_COUNT_THRESHOLD</a></div><div class="ttdeci">#define REPEAT_COUNT_THRESHOLD</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00012">walkingsearch.c:12</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_a9aedf40cb1545b554e113ebb0863859d"><div class="ttname"><a href="walkingsearch_8c.html#a9aedf40cb1545b554e113ebb0863859d">FindOwnerOfCell</a></div><div class="ttdeci">PetscErrorCode FindOwnerOfCell(UserCtx *user, PetscInt i, PetscInt j, PetscInt k, PetscMPIInt *owner_rank)</div><div class="ttdoc">Finds the MPI rank that owns a given global cell index.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l01026">walkingsearch.c:1026</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_acb77aa5204ab90392c67f10a55227bb6"><div class="ttname"><a href="walkingsearch_8c.html#acb77aa5204ab90392c67f10a55227bb6">RetrieveCurrentCell</a></div><div class="ttdeci">PetscErrorCode RetrieveCurrentCell(UserCtx *user, PetscInt idx, PetscInt idy, PetscInt idz, Cell *cell)</div><div class="ttdoc">Retrieves the coordinates of the eight vertices of the current cell.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00722">walkingsearch.c:722</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_ae8ed9e0a01de5ee0f332170562b1f9ea"><div class="ttname"><a href="walkingsearch_8c.html#ae8ed9e0a01de5ee0f332170562b1f9ea">UpdateCellIndicesBasedOnDistancesTEST</a></div><div class="ttdeci">PetscErrorCode UpdateCellIndicesBasedOnDistancesTEST(PetscReal d[NUM_FACES], PetscInt *idx, PetscInt *idy, PetscInt *idz)</div><div class="ttdoc">Updates the cell indices based on the signed distances to each face.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00882">walkingsearch.c:882</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_af9a2ec1317c83d6dfad52415b83cd6e6"><div class="ttname"><a href="walkingsearch_8c.html#af9a2ec1317c83d6dfad52415b83cd6e6">InitializeTraversalParameters</a></div><div class="ttdeci">PetscErrorCode InitializeTraversalParameters(UserCtx *user, Particle *particle, PetscInt *idx, PetscInt *idy, PetscInt *idz, PetscInt *traversal_steps)</div><div class="ttdoc">Initializes traversal parameters for locating a particle.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00571">walkingsearch.c:571</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a0b63dfe82e0fdee5c2c3bdd477f9901f_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a0b63dfe82e0fdee5c2c3bdd477f9901f_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a64b2ff5399052580bffaa58562dc0bcd" name="a64b2ff5399052580bffaa58562dc0bcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64b2ff5399052580bffaa58562dc0bcd">&#9670;&#160;</a></span>ReportSearchOutcome()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ReportSearchOutcome </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a>&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>traversal_steps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logs the final outcome of the particle location search. </p>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l01247">1247</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1250</span>{</div>
<div class="line"><span class="lineno"> 1251</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1252</span>    <span class="keywordflow">switch</span> (status) {</div>
<div class="line"><span class="lineno"> 1253</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581a97d609accacbcc1a41e4da5ac052f253">ACTIVE_AND_LOCATED</a>:</div>
<div class="line"><span class="lineno"> 1254</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Search SUCCESS [PID %lld]: Located in global cell (%d, %d, %d) after %d steps.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1255</span>                      (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2], traversal_steps);</div>
<div class="line"><span class="lineno"> 1256</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1257</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581af0c3b8144a24d2379a1580a6cd48d329">MIGRATING_OUT</a>:</div>
<div class="line"><span class="lineno"> 1258</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Search SUCCESS [PID %lld]: Identified for migration to Rank %d. Handoff cell is (%d, %d, %d) after %d steps.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1259</span>                      (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a76cdf3edbcd6aa56f5a2ba8645e999ea">destination_rank</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2], traversal_steps);</div>
<div class="line"><span class="lineno"> 1260</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1261</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581a339435bd0d4a842c6107333c908a5317">LOST</a>:</div>
<div class="line"><span class="lineno"> 1262</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;Search FAILED [PID %lld]: Particle is LOST after %d steps.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1263</span>                      (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, traversal_steps);</div>
<div class="line"><span class="lineno"> 1264</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1265</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno"> 1266</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;Search ended with unexpected status %d for PID %lld.\n&quot;</span>, status, (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>);</div>
<div class="line"><span class="lineno"> 1267</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1268</span>    }</div>
<div class="line"><span class="lineno"> 1269</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1270</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_a64b2ff5399052580bffaa58562dc0bcd_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="acb77aa5204ab90392c67f10a55227bb6" name="acb77aa5204ab90392c67f10a55227bb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb77aa5204ab90392c67f10a55227bb6">&#9670;&#160;</a></span>RetrieveCurrentCell()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode RetrieveCurrentCell </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>idz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structCell">Cell</a> *&#160;</td>
          <td class="paramname"><em>cell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the coordinates of the eight vertices of the current cell. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idx</td><td>The i-index of the current cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idy</td><td>The j-index of the current cell. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">idz</td><td>The k-index of the current cell. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cell</td><td>Pointer to a <a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a> structure to store the cell's vertices.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00722">722</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  723</span>{</div>
<div class="line"><span class="lineno">  724</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  725</span>    Vec Coor;</div>
<div class="line"><span class="lineno">  726</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coor_array;</div>
<div class="line"><span class="lineno">  727</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  728</span>    DMDALocalInfo info_nodes;</div>
<div class="line"><span class="lineno">  729</span> </div>
<div class="line"><span class="lineno">  730</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  731</span>    <span class="keywordflow">if</span> (user == NULL || cell == NULL) {</div>
<div class="line"><span class="lineno">  732</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;RetrieveCurrentCell - One or more input pointers are NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  733</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;RetrieveCurrentCell - One or more input pointers are NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  734</span>    }</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>    <span class="comment">// Get local coordinates</span></div>
<div class="line"><span class="lineno">  737</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;Coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  738</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, Coor, &amp;coor_array); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  739</span> </div>
<div class="line"><span class="lineno">  740</span>    <span class="comment">// Get the local grid information FOR THE GHOSTED ARRAY from user-&gt;fda</span></div>
<div class="line"><span class="lineno">  741</span>    <span class="comment">// This info contains the mapping between global and local indices.</span></div>
<div class="line"><span class="lineno">  742</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info_nodes); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>    PetscInt  idx_local = idx; <span class="comment">// - info_nodes.gxs;</span></div>
<div class="line"><span class="lineno">  745</span>    PetscInt  idy_local = idy; <span class="comment">// - info_nodes.gys;</span></div>
<div class="line"><span class="lineno">  746</span>    PetscInt  idz_local = idz; <span class="comment">// - info_nodes.gzs;</span></div>
<div class="line"><span class="lineno">  747</span>    </div>
<div class="line"><span class="lineno">  748</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot; [Rank %d] Getting vertex coordinates for cell: %d,%d,%d whose local coordinates are %d,%d,%d.\n&quot;</span>,rank,idx,idy,idz,idx_local,idy_local,idz_local);</div>
<div class="line"><span class="lineno">  749</span>    </div>
<div class="line"><span class="lineno">  750</span>    <span class="comment">// Get the current cell&#39;s vertices</span></div>
<div class="line"><span class="lineno">  751</span>    ierr = <a class="code hl_function" href="walkingsearch_8c.html#ae14b1946c4c34cae5455bdfd632eb98e">GetCellVerticesFromGrid</a>(coor_array, idx_local, idy_local, idz_local, cell); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>    <span class="comment">// Restore array</span></div>
<div class="line"><span class="lineno">  754</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, Coor, &amp;coor_array); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  755</span> </div>
<div class="line"><span class="lineno">  756</span>    <span class="comment">// Get MPI rank for debugging</span></div>
<div class="line"><span class="lineno">  757</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  758</span> </div>
<div class="line"><span class="lineno">  759</span>    <span class="comment">// Debug: Print cell vertices</span></div>
<div class="line"><span class="lineno">  760</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;RetrieveCurrentCell - Cell (%d, %d, %d) vertices \n&quot;</span>, idx, idy, idz);</div>
<div class="line"><span class="lineno">  761</span>    ierr = <a class="code hl_function" href="logging_8h.html#ad2278570e8ce1a71bb269a51f9a20d88">LOG_CELL_VERTICES</a>(cell, rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  762</span> </div>
<div class="line"><span class="lineno">  763</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  764</span>}</div>
<div class="ttc" id="alogging_8h_html_ad2278570e8ce1a71bb269a51f9a20d88"><div class="ttname"><a href="logging_8h.html#ad2278570e8ce1a71bb269a51f9a20d88">LOG_CELL_VERTICES</a></div><div class="ttdeci">PetscErrorCode LOG_CELL_VERTICES(const Cell *cell, PetscMPIInt rank)</div><div class="ttdoc">Prints the coordinates of a cell's vertices.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00189">logging.c:189</a></div></div>
<div class="ttc" id="awalkingsearch_8c_html_ae14b1946c4c34cae5455bdfd632eb98e"><div class="ttname"><a href="walkingsearch_8c.html#ae14b1946c4c34cae5455bdfd632eb98e">GetCellVerticesFromGrid</a></div><div class="ttdeci">PetscErrorCode GetCellVerticesFromGrid(Cmpnts ***coor, PetscInt idx, PetscInt idy, PetscInt idz, Cell *cell)</div><div class="ttdoc">Retrieves the coordinates of the eight vertices of a cell based on grid indices.</div><div class="ttdef"><b>Definition</b> <a href="walkingsearch_8c_source.html#l00521">walkingsearch.c:521</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_acb77aa5204ab90392c67f10a55227bb6_cgraph.svg" width="392" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_acb77aa5204ab90392c67f10a55227bb6_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a8afd9555f9998b48ff70b2361d0e79d0" name="a8afd9555f9998b48ff70b2361d0e79d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8afd9555f9998b48ff70b2361d0e79d0">&#9670;&#160;</a></span>UpdateCellIndicesBasedOnDistances()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode UpdateCellIndicesBasedOnDistances </td>
          <td>(</td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>d</em>[NUM_FACES], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DMDALocalInfo *&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the cell indices based on the signed distances to each face. </p>
<p>This function modifies the cell indices (<code>idx</code>, <code>idy</code>, <code>idz</code>) to move towards the direction where the particle is likely to be located, based on positive distances indicating that the particle is outside in that particular direction.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>An array of six <code>PetscReal</code> values representing the signed distances to each face:<ul>
<li>d[LEFT]: Left Face</li>
<li>d[RIGHT]: Right Face</li>
<li>d[BOTTOM]: Bottom Face</li>
<li>d[TOP]: Top Face</li>
<li>d[FRONT]: Front Face</li>
<li>d[BACK]: Back Face </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idx</td><td>Pointer to the i-index of the cell to be updated. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idy</td><td>Pointer to the j-index of the cell to be updated. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idz</td><td>Pointer to the k-index of the cell to be updated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>DMDALocalInfo structure that holds local &amp; global domain bounds.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

</div>
</div>
<a id="ae8ed9e0a01de5ee0f332170562b1f9ea" name="ae8ed9e0a01de5ee0f332170562b1f9ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8ed9e0a01de5ee0f332170562b1f9ea">&#9670;&#160;</a></span>UpdateCellIndicesBasedOnDistancesTEST()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode UpdateCellIndicesBasedOnDistancesTEST </td>
          <td>(</td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>d</em>[NUM_FACES], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>idz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the cell indices based on the signed distances to each face. </p>
<p>This function modifies the cell indices (<code>idx</code>, <code>idy</code>, <code>idz</code>) to move towards the direction where the particle is likely to be located, based on positive distances indicating that the particle is outside in that particular direction.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>An array of six <code>PetscReal</code> values representing the signed distances to each face:<ul>
<li>d[LEFT]: Left Face</li>
<li>d[RIGHT]: Right Face</li>
<li>d[BOTTOM]: Bottom Face</li>
<li>d[TOP]: Top Face</li>
<li>d[FRONT]: Front Face</li>
<li>d[BACK]: Back Face </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idx</td><td>Pointer to the i-index of the cell to be updated. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idy</td><td>Pointer to the j-index of the cell to be updated. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">idz</td><td>Pointer to the k-index of the cell to be updated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>DMDALocalInfo structure that holds local &amp; global domain bounds.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="walkingsearch_8c_source.html#l00882">882</a> of file <a class="el" href="walkingsearch_8c_source.html">walkingsearch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  883</span>{</div>
<div class="line"><span class="lineno">  884</span> </div>
<div class="line"><span class="lineno">  885</span>  <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  886</span><span class="comment">    PetscInt cxm,cxs;  // maximum &amp; minimum cell ID in x</span></div>
<div class="line"><span class="lineno">  887</span><span class="comment">    PetscInt cym,cys;  // maximum &amp; minimum cell ID in y</span></div>
<div class="line"><span class="lineno">  888</span><span class="comment">    PetscInt czm,czs;  // maximum &amp; minimum cell ID in z</span></div>
<div class="line"><span class="lineno">  889</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  890</span><span class="comment">    cxs = info-&gt;xs; cxm = cxs + info-&gt;xm - 2;</span></div>
<div class="line"><span class="lineno">  891</span><span class="comment">    cys = info-&gt;ys; cym = cys + info-&gt;ym - 2;</span></div>
<div class="line"><span class="lineno">  892</span><span class="comment">    czs = info-&gt;zs; czm = czs + info-&gt;zm - 2; </span></div>
<div class="line"><span class="lineno">  893</span><span class="comment">  */</span></div>
<div class="line"><span class="lineno">  894</span> </div>
<div class="line"><span class="lineno">  895</span>  <span class="comment">//    LOG_ALLOW(LOCAL, LOG_DEBUG, &quot;UpdateCellIndicesBasedOnDistances - Received d: &quot;</span></div>
<div class="line"><span class="lineno">  896</span>  <span class="comment">//    &quot;d[LEFT=%d]=%.3e, d[RIGHT=%d]=%.3e, d[BOTTOM=%d]=%.3e, &quot;</span></div>
<div class="line"><span class="lineno">  897</span>  <span class="comment">//          &quot;d[TOP=%d]=%.3e, d[FRONT=%d]=%.3e, d[BACK=%d]=%.3e\n&quot;,</span></div>
<div class="line"><span class="lineno">  898</span>        <span class="comment">//        LEFT, d[LEFT], RIGHT, d[RIGHT], BOTTOM, d[BOTTOM],</span></div>
<div class="line"><span class="lineno">  899</span>        <span class="comment">//  TOP, d[TOP], FRONT, d[FRONT], BACK, d[BACK]);</span></div>
<div class="line"><span class="lineno">  900</span>    <span class="comment">//  LOG_ALLOW(LOCAL, LOG_DEBUG, &quot;UpdateCellIndicesBasedOnDistances - Raw d: &quot;</span></div>
<div class="line"><span class="lineno">  901</span>  <span class="comment">//          &quot;[%.3e, %.3e, %.3e, %.3e, %.3e, %.3e]\n&quot;,</span></div>
<div class="line"><span class="lineno">  902</span>  <span class="comment">//          d[0], d[1], d[2], d[3], d[4], d[5]);</span></div>
<div class="line"><span class="lineno">  903</span>    </div>
<div class="line"><span class="lineno">  904</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  905</span>    <span class="keywordflow">if</span> (d == NULL) {</div>
<div class="line"><span class="lineno">  906</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - &#39;d&#39; is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  907</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Input array &#39;d&#39; is NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  908</span>    }</div>
<div class="line"><span class="lineno">  909</span>    <span class="keywordflow">if</span> (idx == NULL || idy == NULL || idz == NULL) {</div>
<div class="line"><span class="lineno">  910</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - One or more index pointers are NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  911</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - One or more index pointers are NULL.&quot;</span>);</div>
<div class="line"><span class="lineno">  912</span>    }</div>
<div class="line"><span class="lineno">  913</span> </div>
<div class="line"><span class="lineno">  914</span>    <span class="comment">// Debug: Print current face distances</span></div>
<div class="line"><span class="lineno">  915</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Current Face Distances:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  916</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>() == <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a> &amp;&amp; <a class="code hl_function" href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a>(__func__)) <a class="code hl_function" href="logging_8h.html#a9baaed9103be8264832b39c7dbb2ce1a">LOG_FACE_DISTANCES</a>(d);</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>    <span class="comment">// Update k-direction based on FRONT and BACK distances</span></div>
<div class="line"><span class="lineno">  919</span>    <span class="keywordflow">if</span> (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a>] &lt; 0.0) {</div>
<div class="line"><span class="lineno">  920</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Condition met: d[FRONT] &lt; 0.0, incrementing idz.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  921</span>        (*idz) += 1;</div>
<div class="line"><span class="lineno">  922</span>    }</div>
<div class="line"><span class="lineno">  923</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>] &lt; 0.0){</div>
<div class="line"><span class="lineno">  924</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Condition met: d[BACK] &lt; 0.0, decrementing idz.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  925</span>        (*idz) -= 1;</div>
<div class="line"><span class="lineno">  926</span>    }</div>
<div class="line"><span class="lineno">  927</span> </div>
<div class="line"><span class="lineno">  928</span>    <span class="comment">// Update i-direction based on LEFT and RIGHT distances</span></div>
<div class="line"><span class="lineno">  929</span>    <span class="keywordflow">if</span> (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>] &lt; 0.0) {</div>
<div class="line"><span class="lineno">  930</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Condition met: d[LEFT] &lt; 0.0, decrementing idx.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  931</span>        (*idx) -= 1;</div>
<div class="line"><span class="lineno">  932</span>    }</div>
<div class="line"><span class="lineno">  933</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a>] &lt; 0.0) {</div>
<div class="line"><span class="lineno">  934</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Condition met: d[RIGHT] &lt; 0.0, incrementing idx.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  935</span>        (*idx) += 1;</div>
<div class="line"><span class="lineno">  936</span>    }</div>
<div class="line"><span class="lineno">  937</span> </div>
<div class="line"><span class="lineno">  938</span>    <span class="comment">// Update j-direction based on BOTTOM and TOP distances</span></div>
<div class="line"><span class="lineno">  939</span>    <span class="keywordflow">if</span> (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>] &lt; 0.0) {</div>
<div class="line"><span class="lineno">  940</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Condition met: d[BOTTOM] &lt; 0.0, decrementing idy.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  941</span>        (*idy) -= 1;</div>
<div class="line"><span class="lineno">  942</span>    }</div>
<div class="line"><span class="lineno">  943</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a>] &lt; 0.0) {</div>
<div class="line"><span class="lineno">  944</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Condition met: d[TOP] &lt; 0.0, incrementing idy.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  945</span>        (*idy) += 1;</div>
<div class="line"><span class="lineno">  946</span>    }</div>
<div class="line"><span class="lineno">  947</span> </div>
<div class="line"><span class="lineno">  948</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  949</span><span class="comment">    // The &#39;cell&#39; corners you can reference go from [xs .. xs+xm-1], but</span></div>
<div class="line"><span class="lineno">  950</span><span class="comment">    // to form a valid cell in x, you need (idx+1) in range, so max is (xs+xm-2).</span></div>
<div class="line"><span class="lineno">  951</span><span class="comment">    *idx = PetscMax(cxs,               PetscMin(*idx, cxm));</span></div>
<div class="line"><span class="lineno">  952</span><span class="comment">    *idy = PetscMax(cys,               PetscMin(*idy, cym));</span></div>
<div class="line"><span class="lineno">  953</span><span class="comment">    *idz = PetscMax(czs,               PetscMin(*idz, czm));</span></div>
<div class="line"><span class="lineno">  954</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  955</span> </div>
<div class="line"><span class="lineno">  956</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;UpdateCellIndicesBasedOnDistances - Updated Indices  - idx, idy, idz: %d, %d, %d\n&quot;</span>, *idx, *idy, *idz);</div>
<div class="line"><span class="lineno">  957</span> </div>
<div class="line"><span class="lineno">  958</span>    <span class="keywordflow">return</span> 0; <span class="comment">// Indicate successful execution</span></div>
<div class="line"><span class="lineno">  959</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_ae8ed9e0a01de5ee0f332170562b1f9ea_cgraph.svg" width="426" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="walkingsearch_8h_ae8ed9e0a01de5ee0f332170562b1f9ea_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="walkingsearch_8h.html">walkingsearch.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
