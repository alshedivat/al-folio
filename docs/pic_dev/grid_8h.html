<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PICurv: grid.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PICurv<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">A Parallel Particle-In-Cell Solver for Curvilinear LES</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('grid_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">grid.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Public interface for grid, solver, and metric setup routines.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="variables_8h_source.html">variables.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logging_8h_source.html">logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="io_8h_source.html">io.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="setup_8h_source.html">setup.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for grid.h:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8h__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8h__dep__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="grid_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a04f0887f08166a2a8d01411f39fa1a40" id="r_a04f0887f08166a2a8d01411f39fa1a40"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8h.html#a04f0887f08166a2a8d01411f39fa1a40">DefineAllGridDimensions</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:a04f0887f08166a2a8d01411f39fa1a40"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the parsing and setting of grid dimensions for all blocks.  <br /></td></tr>
<tr class="separator:a04f0887f08166a2a8d01411f39fa1a40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0b95ab3ac28c8df985e38b888c9bb52" id="r_aa0b95ab3ac28c8df985e38b888c9bb52"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8h.html#aa0b95ab3ac28c8df985e38b888c9bb52">InitializeAllGridDMs</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:aa0b95ab3ac28c8df985e38b888c9bb52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the creation of DMDA objects for every block and multigrid level.  <br /></td></tr>
<tr class="separator:aa0b95ab3ac28c8df985e38b888c9bb52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2aef4bb6fc2d2223a52ff6a45c7c600" id="r_ab2aef4bb6fc2d2223a52ff6a45c7c600"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8h.html#ab2aef4bb6fc2d2223a52ff6a45c7c600">AssignAllGridCoordinates</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:ab2aef4bb6fc2d2223a52ff6a45c7c600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the assignment of physical coordinates to all DMDA objects.  <br /></td></tr>
<tr class="separator:ab2aef4bb6fc2d2223a52ff6a45c7c600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0c39bc7c78a15bedf9f1415ab1dded4" id="r_ae0c39bc7c78a15bedf9f1415ab1dded4"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8h.html#ae0c39bc7c78a15bedf9f1415ab1dded4">ComputeLocalBoundingBox</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *localBBox)</td></tr>
<tr class="memdesc:ae0c39bc7c78a15bedf9f1415ab1dded4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the local bounding box of the grid on the current process.  <br /></td></tr>
<tr class="separator:ae0c39bc7c78a15bedf9f1415ab1dded4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afac52c252de784d5bcd7fe7a2e642982" id="r_afac52c252de784d5bcd7fe7a2e642982"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8h.html#afac52c252de784d5bcd7fe7a2e642982">GatherAllBoundingBoxes</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **allBBoxes)</td></tr>
<tr class="memdesc:afac52c252de784d5bcd7fe7a2e642982"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gathers local bounding boxes from all MPI processes to rank 0.  <br /></td></tr>
<tr class="separator:afac52c252de784d5bcd7fe7a2e642982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a325b9d5da4b9b2c79d278fb848215632" id="r_a325b9d5da4b9b2c79d278fb848215632"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8h.html#a325b9d5da4b9b2c79d278fb848215632">BroadcastAllBoundingBoxes</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **bboxlist)</td></tr>
<tr class="memdesc:a325b9d5da4b9b2c79d278fb848215632"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts the bounding box information collected on rank 0 to all other ranks.  <br /></td></tr>
<tr class="separator:a325b9d5da4b9b2c79d278fb848215632"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Public interface for grid, solver, and metric setup routines. </p>

<p class="definition">Definition in file <a class="el" href="grid_8h_source.html">grid.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ab2aef4bb6fc2d2223a52ff6a45c7c600" name="ab2aef4bb6fc2d2223a52ff6a45c7c600"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2aef4bb6fc2d2223a52ff6a45c7c600">&#9670;&#160;</a></span>AssignAllGridCoordinates()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode AssignAllGridCoordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the assignment of physical coordinates to all DMDA objects. </p>
<p>This function manages the entire process of populating the coordinate vectors for every DMDA across all multigrid levels and blocks. It follows a two-part strategy that is essential for multigrid methods:</p>
<ol type="1">
<li><b>Populate Finest Level:</b> It first loops through each block and calls a helper (<code>SetFinestLevelCoordinates</code>) to set the physical coordinates for the highest-resolution grid (the finest multigrid level).</li>
<li><b>Restrict to Coarser Levels:</b> It then iterates downwards from the finest level, calling a helper (<code>RestrictCoordinates</code>) to copy the coordinate values from the fine grid nodes to their corresponding parent nodes on the coarser grids. This ensures all levels represent the exact same geometry.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, containing the configured <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00317">317</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  318</span>{</div>
<div class="line"><span class="lineno">  319</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  320</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserMG">UserMG</a>         *usermg = &amp;simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>;</div>
<div class="line"><span class="lineno">  321</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  324</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Assigning physical coordinates to all grid DMs...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  325</span> </div>
<div class="line"><span class="lineno">  326</span>    <span class="comment">// --- Part 1: Populate the Finest Grid Level ---</span></div>
<div class="line"><span class="lineno">  327</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Setting coordinates for the finest grid level (%d)...\n&quot;</span>, usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1);</div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  329</span>        <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *fine_user = &amp;usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  330</span>        ierr = <a class="code hl_function" href="grid_8c.html#acb950cd51656702b75ea84d6477d0d97">SetFinestLevelCoordinates</a>(fine_user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  331</span>    }</div>
<div class="line"><span class="lineno">  332</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Finest level coordinates have been set for all blocks.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>    <span class="comment">// --- Part 2: Restrict Coordinates to Coarser Levels ---</span></div>
<div class="line"><span class="lineno">  336</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Restricting coordinates to coarser grid levels...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  337</span>    <span class="keywordflow">for</span> (PetscInt level = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 2; level &gt;= 0; level--) {</div>
<div class="line"><span class="lineno">  338</span>        <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  339</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *coarse_user = &amp;usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[level].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  340</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *fine_user   = &amp;usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[level + 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  341</span>            ierr = <a class="code hl_function" href="grid_8c.html#a5b5fe86ae6791885769361fca4ad6b2f">RestrictCoordinates</a>(coarse_user, fine_user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  342</span>        }</div>
<div class="line"><span class="lineno">  343</span>    }</div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Physical coordinates assigned to all grid levels and blocks.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  346</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  347</span>}</div>
<div class="ttc" id="agrid_8c_html_a5b5fe86ae6791885769361fca4ad6b2f"><div class="ttname"><a href="grid_8c.html#a5b5fe86ae6791885769361fca4ad6b2f">RestrictCoordinates</a></div><div class="ttdeci">static PetscErrorCode RestrictCoordinates(UserCtx *coarse_user, UserCtx *fine_user)</div><div class="ttdoc">Populates coarse grid coordinates by restricting from a fine grid.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00617">grid.c:617</a></div></div>
<div class="ttc" id="agrid_8c_html_acb950cd51656702b75ea84d6477d0d97"><div class="ttname"><a href="grid_8c.html#acb950cd51656702b75ea84d6477d0d97">SetFinestLevelCoordinates</a></div><div class="ttdeci">static PetscErrorCode SetFinestLevelCoordinates(UserCtx *user)</div><div class="ttdoc">A router that populates the coordinates for a single finest-level DMDA.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00367">grid.c:367</a></div></div>
<div class="ttc" id="alogging_8h_html_a3de33738fd3c7e77bffbcfaefc3e7645"><div class="ttname"><a href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a></div><div class="ttdeci">#define GLOBAL</div><div class="ttdoc">Scope for global logging across all processes.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00045">logging.h:45</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00207">logging.h:207</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_a22580e0e52ca8ddccc76d24c96f00e4a"><div class="ttname"><a href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">SimCtx::block_number</a></div><div class="ttdeci">PetscInt block_number</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00523">variables.h:523</a></div></div>
<div class="ttc" id="avariables_8h_html_a41a6127b3c012c516a7dcc56c3696a84"><div class="ttname"><a href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">SimCtx::usermg</a></div><div class="ttdeci">UserMG usermg</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00560">variables.h:560</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a10f4f7dc00a854759067cf96ab66485a"><div class="ttname"><a href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">UserMG::mgctx</a></div><div class="ttdeci">MGCtx * mgctx</div><div class="ttdoc">Array of multigrid contexts, one for each level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00429">variables.h:429</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4a7154d09d7dee5e3dd7f0323dfb4ff3"><div class="ttname"><a href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">MGCtx::user</a></div><div class="ttdeci">UserCtx * user</div><div class="ttdoc">Pointer to the main application context for this level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00419">variables.h:419</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aac8e0dd714804b073dbb32c0ad84b2eb"><div class="ttname"><a href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">UserMG::mglevels</a></div><div class="ttdeci">PetscInt mglevels</div><div class="ttdoc">Total number of multigrid levels.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00426">variables.h:426</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserCtx"><div class="ttname"><a href="variables__old_8h.html#structUserCtx">UserCtx</a></div><div class="ttdoc">User-defined context containing data specific to a single computational grid level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00582">variables.h:582</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserMG"><div class="ttname"><a href="variables__old_8h.html#structUserMG">UserMG</a></div><div class="ttdoc">User-level context for managing the entire multigrid hierarchy.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00425">variables.h:425</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8h_ab2aef4bb6fc2d2223a52ff6a45c7c600_cgraph.svg" width="100%" height="382"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_ab2aef4bb6fc2d2223a52ff6a45c7c600_icgraph.svg" width="507" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a325b9d5da4b9b2c79d278fb848215632" name="a325b9d5da4b9b2c79d278fb848215632"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a325b9d5da4b9b2c79d278fb848215632">&#9670;&#160;</a></span>BroadcastAllBoundingBoxes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode BroadcastAllBoundingBoxes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **&#160;</td>
          <td class="paramname"><em>bboxlist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcasts the bounding box information collected on rank 0 to all other ranks. </p>
<p>This function assumes that <code><a class="el" href="grid_8h.html#afac52c252de784d5bcd7fe7a2e642982" title="Gathers local bounding boxes from all MPI processes to rank 0.">GatherAllBoundingBoxes()</a></code> was previously called, so <code>bboxlist</code> is allocated and populated on rank 0. All other ranks will allocate memory for <code>bboxlist</code>, and this function will use MPI_Bcast to distribute the bounding box data to them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure. (Currently unused in this function, but kept for consistency.) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bboxlist</td><td>Pointer to the array of BoundingBoxes. On rank 0, this should point to a valid array of size 'size' (where size is the number of MPI ranks). On non-root ranks, this function will allocate memory for <code>bboxlist</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on MPI or PETSc-related errors.</dd></dl>
<p>Broadcasts the bounding box information collected on rank 0 to all other ranks.</p>
<p>After GatherAllBoundingBoxes, rank 0 has an array of <code>size</code> boxes. This routine makes sure every rank ends up with its own malloc’d copy.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> (unused here, but kept for signature). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bboxlist</td><td>On entry: rank 0’s array; on exit: every rank’s array. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l01037">1037</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1038</span>{</div>
<div class="line"><span class="lineno"> 1039</span>  PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1040</span>  PetscMPIInt    rank, size;</div>
<div class="line"><span class="lineno"> 1041</span> </div>
<div class="line"><span class="lineno"> 1042</span>  <span class="keywordflow">if</span> (!bboxlist) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL,</div>
<div class="line"><span class="lineno"> 1043</span>                          <span class="stringliteral">&quot;BroadcastAllBoundingBoxes: NULL pointer&quot;</span>);</div>
<div class="line"><span class="lineno"> 1044</span> </div>
<div class="line"><span class="lineno"> 1045</span>  ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1046</span>  ierr = MPI_Comm_size(PETSC_COMM_WORLD, &amp;size); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1047</span> </div>
<div class="line"><span class="lineno"> 1048</span>  <span class="comment">/* Non-root ranks must allocate before the Bcast */</span></div>
<div class="line"><span class="lineno"> 1049</span>  <span class="keywordflow">if</span> (rank != 0) {</div>
<div class="line"><span class="lineno"> 1050</span>    *bboxlist = (<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>));</div>
<div class="line"><span class="lineno"> 1051</span>    <span class="keywordflow">if</span> (!*bboxlist) SETERRABORT(PETSC_COMM_WORLD, PETSC_ERR_MEM,</div>
<div class="line"><span class="lineno"> 1052</span>                                <span class="stringliteral">&quot;BroadcastAllBoundingBoxes: malloc failed&quot;</span>);</div>
<div class="line"><span class="lineno"> 1053</span>  }</div>
<div class="line"><span class="lineno"> 1054</span> </div>
<div class="line"><span class="lineno"> 1055</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1056</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno"> 1057</span>    <span class="stringliteral">&quot;Rank %d: about to MPI_Bcast(%d boxes)\n&quot;</span>, rank, size);</div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>  <span class="comment">/* Collective: every rank must call */</span></div>
<div class="line"><span class="lineno"> 1060</span>  ierr = MPI_Bcast(*bboxlist, size * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>), MPI_BYTE,</div>
<div class="line"><span class="lineno"> 1061</span>                   0, PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1062</span>  CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1063</span> </div>
<div class="line"><span class="lineno"> 1064</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1065</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno"> 1066</span>    <span class="stringliteral">&quot;Rank %d: completed MPI_Bcast(%d boxes)\n&quot;</span>, rank, size);</div>
<div class="line"><span class="lineno"> 1067</span> </div>
<div class="line"><span class="lineno"> 1068</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1069</span>}</div>
<div class="ttc" id="alogging_8h_html_a2ebe7667b52c478f7ff365f296d4c8ae"><div class="ttname"><a href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a></div><div class="ttdeci">#define LOG_ALLOW_SYNC(scope, level, fmt,...)</div><div class="ttdoc">----— DEBUG ---------------------------------------— #define LOG_ALLOW(scope, level,...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00274">logging.h:274</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structBoundingBox"><div class="ttname"><a href="variables__old_8h.html#structBoundingBox">BoundingBox</a></div><div class="ttdoc">Defines a 3D axis-aligned bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00154">variables.h:154</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_a325b9d5da4b9b2c79d278fb848215632_icgraph.svg" width="534" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae0c39bc7c78a15bedf9f1415ab1dded4" name="ae0c39bc7c78a15bedf9f1415ab1dded4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0c39bc7c78a15bedf9f1415ab1dded4">&#9670;&#160;</a></span>ComputeLocalBoundingBox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeLocalBoundingBox </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *&#160;</td>
          <td class="paramname"><em>localBBox</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the local bounding box of the grid on the current process. </p>
<p>This function calculates the minimum and maximum coordinates of the local grid points owned by the current MPI process and stores the computed bounding box in the provided structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">localBBox</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structure to store the computed bounding box.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>This function calculates the minimum and maximum coordinates (x, y, z) of the local grid points owned by the current MPI process. It iterates over the local portion of the grid, examines each grid point's coordinates, and updates the minimum and maximum values accordingly.</p>
<p>The computed bounding box is stored in the provided <code>localBBox</code> structure, and the <code>user-&gt;bbox</code> field is also updated with this bounding box for consistency within the user context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. This context must be properly initialized before calling this function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">localBBox</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structure where the computed local bounding box will be stored. The structure should be allocated by the caller.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00702">702</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  703</span>{</div>
<div class="line"><span class="lineno">  704</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  705</span>    PetscInt i, j, k;</div>
<div class="line"><span class="lineno">  706</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  707</span>    PetscInt xs, ys, zs, xe, ye, ze;</div>
<div class="line"><span class="lineno">  708</span>    DMDALocalInfo info;</div>
<div class="line"><span class="lineno">  709</span>    Vec coordinates;</div>
<div class="line"><span class="lineno">  710</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coordArray;</div>
<div class="line"><span class="lineno">  711</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> minCoords, maxCoords;</div>
<div class="line"><span class="lineno">  712</span> </div>
<div class="line"><span class="lineno">  713</span>    <span class="comment">// Start of function execution</span></div>
<div class="line"><span class="lineno">  714</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Entering the function.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  715</span> </div>
<div class="line"><span class="lineno">  716</span>    <span class="comment">// Validate input Pointers</span></div>
<div class="line"><span class="lineno">  717</span>    <span class="keywordflow">if</span> (!user) {</div>
<div class="line"><span class="lineno">  718</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Input &#39;user&#39; Pointer is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  719</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_NULL;</div>
<div class="line"><span class="lineno">  720</span>    }</div>
<div class="line"><span class="lineno">  721</span>    <span class="keywordflow">if</span> (!localBBox) {</div>
<div class="line"><span class="lineno">  722</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Output &#39;localBBox&#39; Pointer is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  723</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_NULL;</div>
<div class="line"><span class="lineno">  724</span>    }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <span class="comment">// Get MPI rank</span></div>
<div class="line"><span class="lineno">  727</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>    <span class="comment">// Get the local coordinates vector from the DMDA</span></div>
<div class="line"><span class="lineno">  730</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;coordinates);</div>
<div class="line"><span class="lineno">  731</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  732</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error getting local coordinates vector.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  733</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  734</span>    }</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>    <span class="keywordflow">if</span> (!coordinates) {</div>
<div class="line"><span class="lineno">  737</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Coordinates vector is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  738</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_NULL;</div>
<div class="line"><span class="lineno">  739</span>    }</div>
<div class="line"><span class="lineno">  740</span> </div>
<div class="line"><span class="lineno">  741</span>    <span class="comment">// Access the coordinate array for reading</span></div>
<div class="line"><span class="lineno">  742</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, coordinates, &amp;coordArray);</div>
<div class="line"><span class="lineno">  743</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  744</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error accessing coordinate array.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  745</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  746</span>    }</div>
<div class="line"><span class="lineno">  747</span> </div>
<div class="line"><span class="lineno">  748</span>    <span class="comment">// Get the local grid information (indices and sizes)</span></div>
<div class="line"><span class="lineno">  749</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info);</div>
<div class="line"><span class="lineno">  750</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  751</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error getting DMDA local info.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  752</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  753</span>    }</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>    </div>
<div class="line"><span class="lineno">  756</span>    xs = info.gxs; xe = xs + info.gxm;</div>
<div class="line"><span class="lineno">  757</span>    ys = info.gys; ye = ys + info.gym;</div>
<div class="line"><span class="lineno">  758</span>    zs = info.gzs; ze = zs + info.gzm;</div>
<div class="line"><span class="lineno">  759</span>    </div>
<div class="line"><span class="lineno">  760</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  761</span><span class="comment">    xs = info.xs; xe = xs + info.xm;</span></div>
<div class="line"><span class="lineno">  762</span><span class="comment">    ys = info.ys; ye = ys + info.ym;</span></div>
<div class="line"><span class="lineno">  763</span><span class="comment">    zs = info.zs; ze = zs + info.zm;</span></div>
<div class="line"><span class="lineno">  764</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  765</span>    </div>
<div class="line"><span class="lineno">  766</span>    <span class="comment">// Initialize min and max coordinates with extreme values</span></div>
<div class="line"><span class="lineno">  767</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = PETSC_MAX_REAL;</div>
<div class="line"><span class="lineno">  768</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = PETSC_MIN_REAL;</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d] Grid indices (Including Ghosts): xs=%d, xe=%d, ys=%d, ye=%d, zs=%d, ze=%d.\n&quot;</span>,rank, xs, xe, ys, ye, zs, ze);</div>
<div class="line"><span class="lineno">  771</span> </div>
<div class="line"><span class="lineno">  772</span>    <span class="comment">// Iterate over the local grid to find min and max coordinates</span></div>
<div class="line"><span class="lineno">  773</span>    <span class="keywordflow">for</span> (k = zs; k &lt; ze; k++) {</div>
<div class="line"><span class="lineno">  774</span>        <span class="keywordflow">for</span> (j = ys; j &lt; ye; j++) {</div>
<div class="line"><span class="lineno">  775</span>            <span class="keywordflow">for</span> (i = xs; i &lt; xe; i++) {</div>
<div class="line"><span class="lineno">  776</span>                <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> coord = coordArray[k][j][i];</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>                <span class="comment">// Update min and max coordinates</span></div>
<div class="line"><span class="lineno">  779</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &lt; minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  780</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &lt; minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  781</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &lt; minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  782</span> </div>
<div class="line"><span class="lineno">  783</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &gt; maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  784</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &gt; maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  785</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &gt; maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  786</span>            }</div>
<div class="line"><span class="lineno">  787</span>        }</div>
<div class="line"><span class="lineno">  788</span>    }</div>
<div class="line"><span class="lineno">  789</span> </div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span>    <span class="comment">// Add tolerance to bboxes.</span></div>
<div class="line"><span class="lineno">  792</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> =  minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  793</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> =  minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  794</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> =  minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  795</span> </div>
<div class="line"><span class="lineno">  796</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> =  maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  797</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> =  maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  798</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> =  maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  799</span> </div>
<div class="line"><span class="lineno">  800</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot; Tolerance added to the limits: %.8e .\n&quot;</span>,(PetscReal)<a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>);</div>
<div class="line"><span class="lineno">  801</span>       </div>
<div class="line"><span class="lineno">  802</span>    <span class="comment">// Log the computed min and max coordinates</span></div>
<div class="line"><span class="lineno">  803</span>     <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;[Rank %d]minCoords=(%.6f, %.6f, %.6f), maxCoords=(%.6f, %.6f, %.6f).\n&quot;</span>,rank,minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span>    </div>
<div class="line"><span class="lineno">  807</span>    <span class="comment">// Restore the coordinate array</span></div>
<div class="line"><span class="lineno">  808</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, coordinates, &amp;coordArray);</div>
<div class="line"><span class="lineno">  809</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  810</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error restoring coordinate array.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  811</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  812</span>    }</div>
<div class="line"><span class="lineno">  813</span> </div>
<div class="line"><span class="lineno">  814</span>    <span class="comment">// Set the local bounding box</span></div>
<div class="line"><span class="lineno">  815</span>    localBBox-&gt;<a class="code hl_variable" href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">min_coords</a> = minCoords;</div>
<div class="line"><span class="lineno">  816</span>    localBBox-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">max_coords</a> = maxCoords;</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>    <span class="comment">// Update the bounding box inside the UserCtx for consistency</span></div>
<div class="line"><span class="lineno">  819</span>    user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a> = *localBBox;</div>
<div class="line"><span class="lineno">  820</span> </div>
<div class="line"><span class="lineno">  821</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Exiting the function successfully.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  822</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  823</span>}</div>
<div class="ttc" id="agrid_8c_html_a0fecd69049f6a1716f0f0b8fd5a88c68"><div class="ttname"><a href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a></div><div class="ttdeci">#define BBOX_TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00006">grid.c:6</a></div></div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a></div><div class="ttdeci">@ LOG_ERROR</div><div class="ttdoc">Critical errors that may halt the program.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4d66dc20efb64cf45770997139fae524"><div class="ttname"><a href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">BoundingBox::max_coords</a></div><div class="ttdeci">Cmpnts max_coords</div><div class="ttdoc">Maximum x, y, z coordinates of the bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00156">variables.h:156</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a69966d928601d61d4f526636f84396c5"><div class="ttname"><a href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">UserCtx::fda</a></div><div class="ttdeci">DM fda</div><div class="ttdoc">DMDA for primary 3-component vector fields (e.g., Velocity).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a6b5da58d79c9c0ed6e9368c9677d5260"><div class="ttname"><a href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">BoundingBox::min_coords</a></div><div class="ttdeci">Cmpnts min_coords</div><div class="ttdoc">Minimum x, y, z coordinates of the bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00155">variables.h:155</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ae85e7171c483d180ffe8759fd13b4312"><div class="ttname"><a href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">UserCtx::bbox</a></div><div class="ttdeci">BoundingBox bbox</div><div class="ttdoc">Bounding box for the local processor's grid domain.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00593">variables.h:593</a></div></div>
<div class="ttc" id="avariables__old_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdoc">DMDA for scalar fields (e.g., Pressure, Nvert).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structCmpnts"><div class="ttname"><a href="variables__old_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8h_ae0c39bc7c78a15bedf9f1415ab1dded4_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a04f0887f08166a2a8d01411f39fa1a40" name="a04f0887f08166a2a8d01411f39fa1a40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04f0887f08166a2a8d01411f39fa1a40">&#9670;&#160;</a></span>DefineAllGridDimensions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode DefineAllGridDimensions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the parsing and setting of grid dimensions for all blocks. </p>
<p>This function serves as the high-level entry point for defining the geometric properties of each grid block in the simulation. It iterates through every block defined by <code>simCtx-&gt;block_number</code>.</p>
<p>For each block, it performs two key actions:</p><ol type="1">
<li>It explicitly sets the block's index (<code>_this</code>) in the corresponding <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code> struct for the finest multigrid level. This makes the context "self-aware".</li>
<li>It calls a helper function (<code>ParseAndSetGridInputs</code>) to handle the detailed work of parsing options or files to populate the rest of the geometric properties for that specific block (e.g., <code>IM</code>, <code>Min_X</code>, <code>rx</code>).</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, which contains the number of blocks and the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy to be configured. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00057">57</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   58</span>{</div>
<div class="line"><span class="lineno">   59</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">   60</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno">   61</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a>        *fine_users;</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> == 0) {</div>
<div class="line"><span class="lineno">   66</span>        SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;MG levels not set. Cannot get finest_users.&quot;</span>);</div>
<div class="line"><span class="lineno">   67</span>    }</div>
<div class="line"><span class="lineno">   68</span>    <span class="comment">// Get the UserCtx array for the finest grid level</span></div>
<div class="line"><span class="lineno">   69</span>    fine_users = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>;</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Defining grid dimensions for %d blocks...\n&quot;</span>, nblk);</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    <span class="comment">// Loop over each block to configure its grid dimensions and geometry.</span></div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">   75</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: --- Configuring Geometry for Block %d ---\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, bi);</div>
<div class="line"><span class="lineno">   76</span> </div>
<div class="line"><span class="lineno">   77</span>        <span class="comment">// Before calling any helpers, set the block index in the context.</span></div>
<div class="line"><span class="lineno">   78</span>        <span class="comment">// This makes the UserCtx self-aware of which block it represents.</span></div>
<div class="line"><span class="lineno">   79</span>        fine_users[bi].<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a> = bi;</div>
<div class="line"><span class="lineno">   80</span> </div>
<div class="line"><span class="lineno">   81</span>        <span class="comment">// Call the helper function for this specific block. It can now derive</span></div>
<div class="line"><span class="lineno">   82</span>        <span class="comment">// all necessary information from the UserCtx pointer it receives.</span></div>
<div class="line"><span class="lineno">   83</span>        ierr = <a class="code hl_function" href="grid_8c.html#a526448d3a1e34b608f7167a59f1d7e04">ParseAndSetGridInputs</a>(&amp;fine_users[bi]); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   84</span>    }</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">   87</span>}</div>
<div class="ttc" id="agrid_8c_html_a526448d3a1e34b608f7167a59f1d7e04"><div class="ttname"><a href="grid_8c.html#a526448d3a1e34b608f7167a59f1d7e04">ParseAndSetGridInputs</a></div><div class="ttdeci">static PetscErrorCode ParseAndSetGridInputs(UserCtx *user)</div><div class="ttdoc">Determines the grid source and calls the appropriate parsing routine.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00020">grid.c:20</a></div></div>
<div class="ttc" id="avariables_8h_html_a19aa807b9181b13618527d6c4eb6fa89"><div class="ttname"><a href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">SimCtx::rank</a></div><div class="ttdeci">PetscMPIInt rank</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00477">variables.h:477</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4f7c5fd8843d026101b193e9236e1192"><div class="ttname"><a href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">UserCtx::_this</a></div><div class="ttdeci">PetscInt _this</div><div class="ttdoc">Legacy block index, for multi-block contexts.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_a04f0887f08166a2a8d01411f39fa1a40_cgraph.svg" width="658" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_a04f0887f08166a2a8d01411f39fa1a40_icgraph.svg" width="506" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="afac52c252de784d5bcd7fe7a2e642982" name="afac52c252de784d5bcd7fe7a2e642982"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afac52c252de784d5bcd7fe7a2e642982">&#9670;&#160;</a></span>GatherAllBoundingBoxes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode GatherAllBoundingBoxes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **&#160;</td>
          <td class="paramname"><em>allBBoxes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gathers local bounding boxes from all MPI processes to rank 0. </p>
<p>This function computes the local bounding box on each process, then collects all local bounding boxes on the root process (rank 0) using MPI. The result is stored in an array of <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structures on rank 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">allBBoxes</td><td>Pointer to a pointer where the array of gathered bounding boxes will be stored on rank 0. The caller on rank 0 must free this array.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>This function first computes the local bounding box on each process by calling <code>ComputeLocalBoundingBox</code>. It then uses an MPI gather operation to collect all local bounding boxes on the root process (rank 0). On rank 0, it allocates an array of <code><a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a></code> structures to hold the gathered data and returns it via the <code>allBBoxes</code> Pointer. On other ranks, <code>allBBoxes</code> is set to <code>NULL</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. This context must be properly initialized before calling this function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">allBBoxes</td><td>Pointer to a Pointer where the array of gathered bounding boxes will be stored on rank 0. On rank 0, this will point to the allocated array; on other ranks, it will be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> on success, non-zero on failure.</dd></dl>
<p>Broadcasts the bounding box information collected on rank 0 to all other ranks.</p>
<p>This function assumes that <code><a class="el" href="grid_8c.html#afac52c252de784d5bcd7fe7a2e642982" title="Gathers local bounding boxes from all MPI processes to rank 0.">GatherAllBoundingBoxes()</a></code> was previously called, so <code>bboxlist</code> is allocated and populated on rank 0. All other ranks will allocate memory for <code>bboxlist</code>, and this function will use MPI_Bcast to distribute the bounding box data to them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure. (Currently unused in this function, but kept for consistency.) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bboxlist</td><td>Pointer to the array of BoundingBoxes. On rank 0, this should point to a valid array of size 'size' (where size is the number of MPI ranks). On non-root ranks, this function will allocate memory for <code>bboxlist</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on MPI or PETSc-related errors.</dd></dl>
<p>Gathers local bounding boxes from all MPI processes to rank 0.</p>
<p>Each rank computes its local bounding box, then all ranks participate in an MPI_Gather to send their <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> to rank 0. Rank 0 allocates the result array and returns it via allBBoxes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> (must be non-NULL). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">allBBoxes</td><td>On rank 0, receives malloc’d array of size <code>size</code>. On other ranks, set to NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00978">978</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  979</span>{</div>
<div class="line"><span class="lineno">  980</span>  PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  981</span>  PetscMPIInt    rank, size;</div>
<div class="line"><span class="lineno">  982</span>  <a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>    *bboxArray = NULL;</div>
<div class="line"><span class="lineno">  983</span>  <a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>     localBBox;</div>
<div class="line"><span class="lineno">  984</span> </div>
<div class="line"><span class="lineno">  985</span>  <span class="comment">/* Validate */</span></div>
<div class="line"><span class="lineno">  986</span>  <span class="keywordflow">if</span> (!user || !allBBoxes) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL,</div>
<div class="line"><span class="lineno">  987</span>                                    <span class="stringliteral">&quot;GatherAllBoundingBoxes: NULL pointer&quot;</span>);</div>
<div class="line"><span class="lineno">  988</span> </div>
<div class="line"><span class="lineno">  989</span>  ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno">  990</span>  ierr = MPI_Comm_size(PETSC_COMM_WORLD, &amp;size); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno">  991</span> </div>
<div class="line"><span class="lineno">  992</span>  <span class="comment">/* Compute local bbox */</span></div>
<div class="line"><span class="lineno">  993</span>  ierr = <a class="code hl_function" href="grid_8c.html#ae0c39bc7c78a15bedf9f1415ab1dded4">ComputeLocalBoundingBox</a>(user, &amp;localBBox); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>  <span class="comment">/* Ensure everyone is synchronized before the gather */</span></div>
<div class="line"><span class="lineno">  996</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno">  997</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno">  998</span>    <span class="stringliteral">&quot;Rank %d: about to MPI_Gather(localBBox)\n&quot;</span>, rank);</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span>  <span class="comment">/* Allocate on root */</span></div>
<div class="line"><span class="lineno"> 1001</span>  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line"><span class="lineno"> 1002</span>    bboxArray = (<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>));</div>
<div class="line"><span class="lineno"> 1003</span>    <span class="keywordflow">if</span> (!bboxArray) SETERRABORT(PETSC_COMM_WORLD, PETSC_ERR_MEM,</div>
<div class="line"><span class="lineno"> 1004</span>                                <span class="stringliteral">&quot;GatherAllBoundingBoxes: malloc failed&quot;</span>);</div>
<div class="line"><span class="lineno"> 1005</span>  }</div>
<div class="line"><span class="lineno"> 1006</span> </div>
<div class="line"><span class="lineno"> 1007</span>  <span class="comment">/* Collective: every rank must call */</span></div>
<div class="line"><span class="lineno"> 1008</span>  ierr = MPI_Gather(&amp;localBBox, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>), MPI_BYTE,</div>
<div class="line"><span class="lineno"> 1009</span>                    bboxArray, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>), MPI_BYTE,</div>
<div class="line"><span class="lineno"> 1010</span>                    0, PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1011</span>  CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1012</span> </div>
<div class="line"><span class="lineno"> 1013</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1014</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno"> 1015</span>    <span class="stringliteral">&quot;Rank %d: completed MPI_Gather(localBBox)\n&quot;</span>, rank);</div>
<div class="line"><span class="lineno"> 1016</span> </div>
<div class="line"><span class="lineno"> 1017</span>  <span class="comment">/* Return result */</span></div>
<div class="line"><span class="lineno"> 1018</span>  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line"><span class="lineno"> 1019</span>    *allBBoxes = bboxArray;</div>
<div class="line"><span class="lineno"> 1020</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1021</span>    *allBBoxes = NULL;</div>
<div class="line"><span class="lineno"> 1022</span>  }</div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1025</span>}</div>
<div class="ttc" id="agrid_8c_html_ae0c39bc7c78a15bedf9f1415ab1dded4"><div class="ttname"><a href="grid_8c.html#ae0c39bc7c78a15bedf9f1415ab1dded4">ComputeLocalBoundingBox</a></div><div class="ttdeci">PetscErrorCode ComputeLocalBoundingBox(UserCtx *user, BoundingBox *localBBox)</div><div class="ttdoc">Computes the local bounding box of the grid on the current process.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00702">grid.c:702</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_afac52c252de784d5bcd7fe7a2e642982_cgraph.svg" width="443" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_afac52c252de784d5bcd7fe7a2e642982_icgraph.svg" width="512" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa0b95ab3ac28c8df985e38b888c9bb52" name="aa0b95ab3ac28c8df985e38b888c9bb52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0b95ab3ac28c8df985e38b888c9bb52">&#9670;&#160;</a></span>InitializeAllGridDMs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeAllGridDMs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the creation of DMDA objects for every block and multigrid level. </p>
<p>This function systematically builds the entire DMDA hierarchy. It first calculates the dimensions (IM, JM, KM) for all coarse grids based on the finest grid's dimensions and the semi-coarsening flags. It then iterates from the coarsest to the finest level, calling a powerful helper function (<code>InitializeSingleGridDM</code>) to create the DMs for each block, ensuring that finer grids are properly aligned with their coarser parents for multigrid efficiency.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, containing the configured <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00230">230</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  231</span>{</div>
<div class="line"><span class="lineno">  232</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  233</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserMG">UserMG</a>         *usermg = &amp;simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>;</div>
<div class="line"><span class="lineno">  234</span>    <a class="code hl_struct" href="variables__old_8h.html#structMGCtx">MGCtx</a>          *mgctx = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>;</div>
<div class="line"><span class="lineno">  235</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  238</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Creating DMDA objects for all levels and blocks...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>    <span class="comment">// --- Part 1: Calculate Coarse Grid Dimensions &amp; VALIDATE ---</span></div>
<div class="line"><span class="lineno">  241</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Calculating and validating coarse grid dimensions...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  242</span>    <span class="keywordflow">for</span> (PetscInt level = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 2; level &gt;= 0; level--) {</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  244</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user_coarse = &amp;mgctx[level].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  245</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user_fine   = &amp;mgctx[level + 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span>            user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> = user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a> ? user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> : (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1) / 2;</div>
<div class="line"><span class="lineno">  248</span>            user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> = user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a> ? user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> : (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1) / 2;</div>
<div class="line"><span class="lineno">  249</span>            user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> = user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a> ? user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> : (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1) / 2;</div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>            <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Block %d, Level %d dims calculated: %d x %d x %d\n&quot;</span>,</div>
<div class="line"><span class="lineno">  252</span>                      simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, bi, level, user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>, user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>, user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>            <span class="comment">// Validation check from legacy MGDACreate to ensure coarsening is possible</span></div>
<div class="line"><span class="lineno">  255</span>            PetscInt check_i = user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> * (2 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a>) - (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a>);</div>
<div class="line"><span class="lineno">  256</span>            PetscInt check_j = user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> * (2 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a>) - (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a>);</div>
<div class="line"><span class="lineno">  257</span>            PetscInt check_k = user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> * (2 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a>) - (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a>);</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>            <span class="keywordflow">if</span> (check_i + check_j + check_k != 0) {</div>
<div class="line"><span class="lineno">  260</span>          <span class="comment">//      SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONG,</span></div>
<div class="line"><span class="lineno">  261</span>          <span class="comment">//           &quot;Grid at level %d, block %d cannot be coarsened from %dx%dx%d to %dx%dx%d with the given semi-coarsening flags. Check grid dimensions.&quot;,</span></div>
<div class="line"><span class="lineno">  262</span>              <span class="comment">//          level, bi, user_fine-&gt;IM, user_fine-&gt;JM, user_fine-&gt;KM, user_coarse-&gt;IM, user_coarse-&gt;JM, user_coarse-&gt;KM);</span></div>
<div class="line"><span class="lineno">  263</span>          <a class="code hl_define" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>,<span class="stringliteral">&quot;WARNING: Grid at level %d, block %d can&#39;t be consistently coarsened further.\n&quot;</span>, level, bi);</div>
<div class="line"><span class="lineno">  264</span>            }</div>
<div class="line"><span class="lineno">  265</span>        }</div>
<div class="line"><span class="lineno">  266</span>    }</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>    <span class="comment">// --- Part 2: Create DMs from Coarse to Fine for each Block ---</span></div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  270</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;--- Creating DMs for Block %d ---\n&quot;</span>, bi);</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>        <span class="comment">// Create the coarsest level DM first (passing NULL for the coarse_user)</span></div>
<div class="line"><span class="lineno">  273</span>        ierr = <a class="code hl_function" href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a>(&amp;mgctx[0].user[bi], NULL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>        <span class="comment">// Create finer level DMs, passing the next-coarser context for alignment</span></div>
<div class="line"><span class="lineno">  276</span>        <span class="keywordflow">for</span> (PetscInt level = 1; level &lt; usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a>; level++) {</div>
<div class="line"><span class="lineno">  277</span>            ierr = <a class="code hl_function" href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a>(&amp;mgctx[level].user[bi], &amp;mgctx[level-1].user[bi]); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  278</span>        }</div>
<div class="line"><span class="lineno">  279</span>    }</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="comment">// --- Optional: View the finest DM for debugging verification ---</span></div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>() &gt;= <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>) {</div>
<div class="line"><span class="lineno">  283</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;--- Viewing Finest DMDA (Level %d, Block 0) ---\n&quot;</span>, usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1);</div>
<div class="line"><span class="lineno">  284</span>        ierr = DMView(mgctx[usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].user[0].da, PETSC_VIEWER_STDOUT_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  285</span>    }</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;DMDA object creation complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  288</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  289</span>}</div>
<div class="ttc" id="agrid_8c_html_a7de9f73019e4a260a2edd616dcd40a6b"><div class="ttname"><a href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a></div><div class="ttdeci">static PetscErrorCode InitializeSingleGridDM(UserCtx *user, UserCtx *coarse_user)</div><div class="ttdoc">Creates the DMDA objects (da and fda) for a single UserCtx.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00107">grid.c:107</a></div></div>
<div class="ttc" id="alogging_8h_html_a672ff9c400e2307306b36415d4fefcb9"><div class="ttname"><a href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a></div><div class="ttdeci">#define LOG(scope, level, fmt,...)</div><div class="ttdoc">Logging macro for PETSc-based applications with scope control.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00091">logging.h:91</a></div></div>
<div class="ttc" id="alogging_8h_html_a9585f583c260f40a73f2490914edc689"><div class="ttname"><a href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a></div><div class="ttdeci">LogLevel get_log_level()</div><div class="ttdoc">Retrieves the current logging level from the environment variable LOG_LEVEL.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00049">logging.c:49</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a></div><div class="ttdeci">@ LOG_WARNING</div><div class="ttdoc">Non-critical issues that warrant attention.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00030">logging.h:30</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a03772da847da737415fd5a86a97147bd"><div class="ttname"><a href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">UserCtx::isc</a></div><div class="ttdeci">PetscInt isc</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3e8bcd710c619c329608b6f7da5f1ea1"><div class="ttname"><a href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">UserCtx::ksc</a></div><div class="ttdeci">PetscInt ksc</div><div class="ttdoc">Starting corner indices for the local subdomain.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3f5ec0e4536c9ccaa3d663f14d47f904"><div class="ttname"><a href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">UserCtx::KM</a></div><div class="ttdeci">PetscInt KM</div><div class="ttdoc">Global grid dimensions (number of cells in i,j,k).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a5fd8588302a68eca03d086e01e8972c1"><div class="ttname"><a href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">UserCtx::jsc</a></div><div class="ttdeci">PetscInt jsc</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aa55a2a246e904b3569075eb4de0092a6"><div class="ttname"><a href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">UserCtx::JM</a></div><div class="ttdeci">PetscInt JM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad1904cdee33ebeffba809c883f7e9641"><div class="ttname"><a href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">UserCtx::IM</a></div><div class="ttdeci">PetscInt IM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structMGCtx"><div class="ttname"><a href="variables__old_8h.html#structMGCtx">MGCtx</a></div><div class="ttdoc">Context for Multigrid operations.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00418">variables.h:418</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_aa0b95ab3ac28c8df985e38b888c9bb52_cgraph.svg" width="376" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8h_aa0b95ab3ac28c8df985e38b888c9bb52_icgraph.svg" width="471" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="grid_8h.html">grid.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
