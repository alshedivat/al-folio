<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pic_dev: Metric.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pic_dev<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Particle-in-Cell / CFD development codebase</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('Metric_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Metric.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;petsc.h&gt;</code><br />
<code>#include &quot;<a class="el" href="Metric_8h_source.html">Metric.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Metric.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="Metric_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeCellCentersAndSpacing&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeIFaceMetrics&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeJFaceMetrics&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeJFaceMetrics&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;MetricsDivergence&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4859ff8031c003e036eab9cf8fb351f6" id="r_a4859ff8031c003e036eab9cf8fb351f6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a4859ff8031c003e036eab9cf8fb351f6">MetricGetCellVertices</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***X, PetscInt i, PetscInt j, PetscInt k, <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> V[8])</td></tr>
<tr class="memdesc:a4859ff8031c003e036eab9cf8fb351f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract the eight vertex coordinates of the hexahedral cell (i,j,k).  <br /></td></tr>
<tr class="separator:a4859ff8031c003e036eab9cf8fb351f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a379d85074cc67dd1230cecc94b9169aa" id="r_a379d85074cc67dd1230cecc94b9169aa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a379d85074cc67dd1230cecc94b9169aa">TrilinearBlend</a> (const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> V[8], PetscReal xi, PetscReal eta, PetscReal zta, <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> *Xp)</td></tr>
<tr class="memdesc:a379d85074cc67dd1230cecc94b9169aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map logical coordinates to physical space using trilinear basis.  <br /></td></tr>
<tr class="separator:a379d85074cc67dd1230cecc94b9169aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0ba1966641e609476ac6fc3d5cdbbfc" id="r_af0ba1966641e609476ac6fc3d5cdbbfc"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#af0ba1966641e609476ac6fc3d5cdbbfc">MetricLogicalToPhysical</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***X, PetscInt i, PetscInt j, PetscInt k, PetscReal xi, PetscReal eta, PetscReal zta, <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> *Xp)</td></tr>
<tr class="memdesc:af0ba1966641e609476ac6fc3d5cdbbfc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public wrapper: map (cell index, ξ,η,ζ) to (x,y,z).  <br /></td></tr>
<tr class="separator:af0ba1966641e609476ac6fc3d5cdbbfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2045892adba1ae192c7f9840cc1bf732" id="r_a2045892adba1ae192c7f9840cc1bf732"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a2045892adba1ae192c7f9840cc1bf732">MetricJacobian</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***X, PetscInt i, PetscInt j, PetscInt k, PetscReal xi, PetscReal eta, PetscReal zta, PetscReal J[3][3], PetscReal *detJ)</td></tr>
<tr class="memdesc:a2045892adba1ae192c7f9840cc1bf732"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute Jacobian matrix and its determinant at (xi,eta,zta).  <br /></td></tr>
<tr class="separator:a2045892adba1ae192c7f9840cc1bf732"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe7cd3c05be46557a8c2ea579eda0baf" id="r_afe7cd3c05be46557a8c2ea579eda0baf"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#afe7cd3c05be46557a8c2ea579eda0baf">MetricVelocityContravariant</a> (const PetscReal J[3][3], PetscReal detJ, const PetscReal u[3], PetscReal uc[3])</td></tr>
<tr class="memdesc:afe7cd3c05be46557a8c2ea579eda0baf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert physical velocity (u,v,w) to contravariant components (u^xi, u^eta, u^zta).  <br /></td></tr>
<tr class="separator:afe7cd3c05be46557a8c2ea579eda0baf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a436bb94905ee06971f632571f5bc8cbb" id="r_a436bb94905ee06971f632571f5bc8cbb"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a436bb94905ee06971f632571f5bc8cbb">CheckAndFixGridOrientation</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a436bb94905ee06971f632571f5bc8cbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensure a <b>right-handed</b> metric basis (<code>Csi</code>, <code>Eta</code>, <code>Zet</code>) and a <b>positive Jacobian</b> (<code>Aj</code>) over the whole domain.  <br /></td></tr>
<tr class="separator:a436bb94905ee06971f632571f5bc8cbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f0dfb324211e230a387501f93cfd316" id="r_a6f0dfb324211e230a387501f93cfd316"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a6f0dfb324211e230a387501f93cfd316">ComputeFaceMetrics</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a6f0dfb324211e230a387501f93cfd316"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the primary face metric components (Csi, Eta, Zet), including boundary extrapolation, and stores them in the corresponding global Vec members of the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure (user-&gt;Csi, user-&gt;Eta, user-&gt;Zet).  <br /></td></tr>
<tr class="separator:a6f0dfb324211e230a387501f93cfd316"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92d28e2f14645b0eb563144f4ccf2b49" id="r_a92d28e2f14645b0eb563144f4ccf2b49"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a92d28e2f14645b0eb563144f4ccf2b49">ComputeCellCenteredJacobianInverse</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a92d28e2f14645b0eb563144f4ccf2b49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the cell-centered inverse Jacobian determinant (1/J), including boundary extrapolation, stores it in <code>user-&gt;Aj</code>, assembles <code>user-&gt;Aj</code>, and updates <code>user-&gt;lAj</code>.  <br /></td></tr>
<tr class="separator:a92d28e2f14645b0eb563144f4ccf2b49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46e70c0ae8f36f97321c5c892fc56be5" id="r_a46e70c0ae8f36f97321c5c892fc56be5"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a46e70c0ae8f36f97321c5c892fc56be5">ComputeCellCentersAndSpacing</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a46e70c0ae8f36f97321c5c892fc56be5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the physical location of cell centers and the spacing between them.  <br /></td></tr>
<tr class="separator:a46e70c0ae8f36f97321c5c892fc56be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af935307ea3e9727a63b6ef9a3932caa8" id="r_af935307ea3e9727a63b6ef9a3932caa8"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#af935307ea3e9727a63b6ef9a3932caa8">ComputeIFaceMetrics</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:af935307ea3e9727a63b6ef9a3932caa8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes metrics centered on constant-i faces (i-faces).  <br /></td></tr>
<tr class="separator:af935307ea3e9727a63b6ef9a3932caa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ecbe44ffb23d82193f9278ab61c1b47" id="r_a4ecbe44ffb23d82193f9278ab61c1b47"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a4ecbe44ffb23d82193f9278ab61c1b47">ComputeJFaceMetrics</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a4ecbe44ffb23d82193f9278ab61c1b47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes metrics centered on constant-j faces (j-faces).  <br /></td></tr>
<tr class="separator:a4ecbe44ffb23d82193f9278ab61c1b47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95e22e5238b2cd02b992366766730687" id="r_a95e22e5238b2cd02b992366766730687"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a95e22e5238b2cd02b992366766730687">ComputeKFaceMetrics</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a95e22e5238b2cd02b992366766730687"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes metrics centered on constant-k faces (k-faces).  <br /></td></tr>
<tr class="separator:a95e22e5238b2cd02b992366766730687"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a977092b5174c0b36bc8affc6d96537fc" id="r_a977092b5174c0b36bc8affc6d96537fc"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a977092b5174c0b36bc8affc6d96537fc">MetricsDivergence</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a977092b5174c0b36bc8affc6d96537fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a diagnostic check on the divergence of the face area metric vectors.  <br /></td></tr>
<tr class="separator:a977092b5174c0b36bc8affc6d96537fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d538200fed5b9ee9d1ef391bb61036c" id="r_a3d538200fed5b9ee9d1ef391bb61036c"><td class="memItemLeft" align="right" valign="top">static PetscInt&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a> (PetscInt i, PetscInt j, PetscInt k, <a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="separator:a3d538200fed5b9ee9d1ef391bb61036c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63e70e9aa6a59c320cb2b1af6bd0a7e6" id="r_a63e70e9aa6a59c320cb2b1af6bd0a7e6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a63e70e9aa6a59c320cb2b1af6bd0a7e6">ComputeMetricsDivergence</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a63e70e9aa6a59c320cb2b1af6bd0a7e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the divergence of the grid metrics and identifies the maximum value.  <br /></td></tr>
<tr class="separator:a63e70e9aa6a59c320cb2b1af6bd0a7e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a99180f2d9db426e1cf73771b795498" id="r_a2a99180f2d9db426e1cf73771b795498"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a2a99180f2d9db426e1cf73771b795498">ComputeMetricNorms</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a2a99180f2d9db426e1cf73771b795498"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the max-min values of the grid metrics.  <br /></td></tr>
<tr class="separator:a2a99180f2d9db426e1cf73771b795498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a063043da47b68702c78c7e0769325b36" id="r_a063043da47b68702c78c7e0769325b36"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Metric_8c.html#a063043da47b68702c78c7e0769325b36">CalculateAllGridMetrics</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:a063043da47b68702c78c7e0769325b36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the calculation of all grid metrics.  <br /></td></tr>
<tr class="separator:a063043da47b68702c78c7e0769325b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[1/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeCellCentersAndSpacing&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00630">630</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[2/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeIFaceMetrics&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00630">630</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[3/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeJFaceMetrics&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00630">630</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[4/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeJFaceMetrics&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00630">630</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[5/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;MetricsDivergence&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00630">630</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a063043da47b68702c78c7e0769325b36" name="a063043da47b68702c78c7e0769325b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a063043da47b68702c78c7e0769325b36">&#9670;&#160;</a></span>CalculateAllGridMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode CalculateAllGridMetrics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the calculation of all grid metrics. </p>
<p>This function iterates through every <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> in the multigrid and multi-block hierarchy. For each context, it calls a series of modern, modular helper functions to compute the face metrics (Csi, Eta, Zet), the cell-centered inverse Jacobian (Aj), and to validate the grid's orientation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, containing the configured <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l01639">1639</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1640</span>{</div>
<div class="line"><span class="lineno"> 1641</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1642</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserMG">UserMG</a>         *usermg = &amp;simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>;</div>
<div class="line"><span class="lineno"> 1643</span>    <a class="code hl_struct" href="variables__old_8h.html#structMGCtx">MGCtx</a>          *mgctx = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>;</div>
<div class="line"><span class="lineno"> 1644</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno"> 1645</span> </div>
<div class="line"><span class="lineno"> 1646</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1647</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Calculating grid metrics for all levels and blocks...\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1648</span> </div>
<div class="line"><span class="lineno"> 1649</span>    <span class="comment">// Loop through all levels and all blocks</span></div>
<div class="line"><span class="lineno"> 1650</span>    <span class="keywordflow">for</span> (PetscInt level = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> -1 ; level &gt;=0; level--) {</div>
<div class="line"><span class="lineno"> 1651</span>        <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno"> 1652</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user = &amp;mgctx[level].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno"> 1653</span>            <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Calculating metrics for level %d, block %d\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, level, bi);</div>
<div class="line"><span class="lineno"> 1654</span> </div>
<div class="line"><span class="lineno"> 1655</span>            <span class="comment">// Call the modern, modular helper functions for each UserCtx.</span></div>
<div class="line"><span class="lineno"> 1656</span>            <span class="comment">// These functions are self-contained and operate on the data within the provided context.</span></div>
<div class="line"><span class="lineno"> 1657</span>            ierr = <a class="code hl_function" href="Metric_8c.html#a6f0dfb324211e230a387501f93cfd316">ComputeFaceMetrics</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1658</span>            ierr = <a class="code hl_function" href="Metric_8c.html#a92d28e2f14645b0eb563144f4ccf2b49">ComputeCellCenteredJacobianInverse</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1659</span>        ierr = <a class="code hl_function" href="Metric_8c.html#a436bb94905ee06971f632571f5bc8cbb">CheckAndFixGridOrientation</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1660</span>        ierr = <a class="code hl_function" href="Metric_8c.html#a46e70c0ae8f36f97321c5c892fc56be5">ComputeCellCentersAndSpacing</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1661</span>            ierr = <a class="code hl_function" href="Metric_8c.html#af935307ea3e9727a63b6ef9a3932caa8">ComputeIFaceMetrics</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1662</span>            ierr = <a class="code hl_function" href="Metric_8c.html#a4ecbe44ffb23d82193f9278ab61c1b47">ComputeJFaceMetrics</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1663</span>            ierr = <a class="code hl_function" href="Metric_8c.html#a95e22e5238b2cd02b992366766730687">ComputeKFaceMetrics</a>(user); CHKERRQ(ierr); </div>
<div class="line"><span class="lineno"> 1664</span> </div>
<div class="line"><span class="lineno"> 1665</span>            <span class="comment">// Diagnostics</span></div>
<div class="line"><span class="lineno"> 1666</span>        ierr = <a class="code hl_function" href="Metric_8c.html#a2a99180f2d9db426e1cf73771b795498">ComputeMetricNorms</a>(user);</div>
<div class="line"><span class="lineno"> 1667</span>            <span class="keywordflow">if</span> (level == usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1) {</div>
<div class="line"><span class="lineno"> 1668</span>                ierr = <a class="code hl_function" href="Metric_8c.html#a63e70e9aa6a59c320cb2b1af6bd0a7e6">ComputeMetricsDivergence</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1669</span>            }</div>
<div class="line"><span class="lineno"> 1670</span>        }</div>
<div class="line"><span class="lineno"> 1671</span>    }</div>
<div class="line"><span class="lineno"> 1672</span> </div>
<div class="line"><span class="lineno"> 1673</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Grid metrics calculation complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1674</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1675</span>}</div>
<div class="ttc" id="aMetric_8c_html_a2a99180f2d9db426e1cf73771b795498"><div class="ttname"><a href="Metric_8c.html#a2a99180f2d9db426e1cf73771b795498">ComputeMetricNorms</a></div><div class="ttdeci">PetscErrorCode ComputeMetricNorms(UserCtx *user)</div><div class="ttdoc">Computes the max-min values of the grid metrics.</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l01506">Metric.c:1506</a></div></div>
<div class="ttc" id="aMetric_8c_html_a436bb94905ee06971f632571f5bc8cbb"><div class="ttname"><a href="Metric_8c.html#a436bb94905ee06971f632571f5bc8cbb">CheckAndFixGridOrientation</a></div><div class="ttdeci">PetscErrorCode CheckAndFixGridOrientation(UserCtx *user)</div><div class="ttdoc">Ensure a right-handed metric basis (Csi, Eta, Zet) and a positive Jacobian (Aj) over the whole domain...</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00195">Metric.c:195</a></div></div>
<div class="ttc" id="aMetric_8c_html_a46e70c0ae8f36f97321c5c892fc56be5"><div class="ttname"><a href="Metric_8c.html#a46e70c0ae8f36f97321c5c892fc56be5">ComputeCellCentersAndSpacing</a></div><div class="ttdeci">PetscErrorCode ComputeCellCentersAndSpacing(UserCtx *user)</div><div class="ttdoc">Computes the physical location of cell centers and the spacing between them.</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00644">Metric.c:644</a></div></div>
<div class="ttc" id="aMetric_8c_html_a4ecbe44ffb23d82193f9278ab61c1b47"><div class="ttname"><a href="Metric_8c.html#a4ecbe44ffb23d82193f9278ab61c1b47">ComputeJFaceMetrics</a></div><div class="ttdeci">PetscErrorCode ComputeJFaceMetrics(UserCtx *user)</div><div class="ttdoc">Computes metrics centered on constant-j faces (j-faces).</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00942">Metric.c:942</a></div></div>
<div class="ttc" id="aMetric_8c_html_a63e70e9aa6a59c320cb2b1af6bd0a7e6"><div class="ttname"><a href="Metric_8c.html#a63e70e9aa6a59c320cb2b1af6bd0a7e6">ComputeMetricsDivergence</a></div><div class="ttdeci">PetscErrorCode ComputeMetricsDivergence(UserCtx *user)</div><div class="ttdoc">Computes the divergence of the grid metrics and identifies the maximum value.</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l01416">Metric.c:1416</a></div></div>
<div class="ttc" id="aMetric_8c_html_a6f0dfb324211e230a387501f93cfd316"><div class="ttname"><a href="Metric_8c.html#a6f0dfb324211e230a387501f93cfd316">ComputeFaceMetrics</a></div><div class="ttdeci">PetscErrorCode ComputeFaceMetrics(UserCtx *user)</div><div class="ttdoc">Computes the primary face metric components (Csi, Eta, Zet), including boundary extrapolation,...</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00286">Metric.c:286</a></div></div>
<div class="ttc" id="aMetric_8c_html_a92d28e2f14645b0eb563144f4ccf2b49"><div class="ttname"><a href="Metric_8c.html#a92d28e2f14645b0eb563144f4ccf2b49">ComputeCellCenteredJacobianInverse</a></div><div class="ttdeci">PetscErrorCode ComputeCellCenteredJacobianInverse(UserCtx *user)</div><div class="ttdoc">Calculates the cell-centered inverse Jacobian determinant (1/J), including boundary extrapolation,...</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00491">Metric.c:491</a></div></div>
<div class="ttc" id="aMetric_8c_html_a95e22e5238b2cd02b992366766730687"><div class="ttname"><a href="Metric_8c.html#a95e22e5238b2cd02b992366766730687">ComputeKFaceMetrics</a></div><div class="ttdeci">PetscErrorCode ComputeKFaceMetrics(UserCtx *user)</div><div class="ttdoc">Computes metrics centered on constant-k faces (k-faces).</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l01145">Metric.c:1145</a></div></div>
<div class="ttc" id="aMetric_8c_html_af935307ea3e9727a63b6ef9a3932caa8"><div class="ttname"><a href="Metric_8c.html#af935307ea3e9727a63b6ef9a3932caa8">ComputeIFaceMetrics</a></div><div class="ttdeci">PetscErrorCode ComputeIFaceMetrics(UserCtx *user)</div><div class="ttdoc">Computes metrics centered on constant-i faces (i-faces).</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00739">Metric.c:739</a></div></div>
<div class="ttc" id="alogging_8h_html_a2ebe7667b52c478f7ff365f296d4c8ae"><div class="ttname"><a href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a></div><div class="ttdeci">#define LOG_ALLOW_SYNC(scope, level, fmt,...)</div><div class="ttdoc">----— DEBUG ---------------------------------------— #define LOG_ALLOW(scope, level,...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00274">logging.h:274</a></div></div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="alogging_8h_html_a3de33738fd3c7e77bffbcfaefc3e7645"><div class="ttname"><a href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a></div><div class="ttdeci">#define GLOBAL</div><div class="ttdoc">Scope for global logging across all processes.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00045">logging.h:45</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00207">logging.h:207</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_a19aa807b9181b13618527d6c4eb6fa89"><div class="ttname"><a href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">SimCtx::rank</a></div><div class="ttdeci">PetscMPIInt rank</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00477">variables.h:477</a></div></div>
<div class="ttc" id="avariables_8h_html_a22580e0e52ca8ddccc76d24c96f00e4a"><div class="ttname"><a href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">SimCtx::block_number</a></div><div class="ttdeci">PetscInt block_number</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00523">variables.h:523</a></div></div>
<div class="ttc" id="avariables_8h_html_a41a6127b3c012c516a7dcc56c3696a84"><div class="ttname"><a href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">SimCtx::usermg</a></div><div class="ttdeci">UserMG usermg</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00560">variables.h:560</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a10f4f7dc00a854759067cf96ab66485a"><div class="ttname"><a href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">UserMG::mgctx</a></div><div class="ttdeci">MGCtx * mgctx</div><div class="ttdoc">Array of multigrid contexts, one for each level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00429">variables.h:429</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4a7154d09d7dee5e3dd7f0323dfb4ff3"><div class="ttname"><a href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">MGCtx::user</a></div><div class="ttdeci">UserCtx * user</div><div class="ttdoc">Pointer to the main application context for this level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00419">variables.h:419</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aac8e0dd714804b073dbb32c0ad84b2eb"><div class="ttname"><a href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">UserMG::mglevels</a></div><div class="ttdeci">PetscInt mglevels</div><div class="ttdoc">Total number of multigrid levels.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00426">variables.h:426</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structMGCtx"><div class="ttname"><a href="variables__old_8h.html#structMGCtx">MGCtx</a></div><div class="ttdoc">Context for Multigrid operations.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00418">variables.h:418</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserCtx"><div class="ttname"><a href="variables__old_8h.html#structUserCtx">UserCtx</a></div><div class="ttdoc">User-defined context containing data specific to a single computational grid level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00582">variables.h:582</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserMG"><div class="ttname"><a href="variables__old_8h.html#structUserMG">UserMG</a></div><div class="ttdoc">User-level context for managing the entire multigrid hierarchy.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00425">variables.h:425</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a063043da47b68702c78c7e0769325b36_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a063043da47b68702c78c7e0769325b36_icgraph.svg" width="495" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a436bb94905ee06971f632571f5bc8cbb" name="a436bb94905ee06971f632571f5bc8cbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a436bb94905ee06971f632571f5bc8cbb">&#9670;&#160;</a></span>CheckAndFixGridOrientation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode CheckAndFixGridOrientation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ensure a <b>right-handed</b> metric basis (<code>Csi</code>, <code>Eta</code>, <code>Zet</code>) and a <b>positive Jacobian</b> (<code>Aj</code>) over the whole domain. </p>
<p>The metric-generation kernels are completely algebraic, so they will happily deliver a <em>left-handed</em> basis if the mesh file enumerates nodes in the opposite ζ-direction. <br  />
 This routine makes the orientation explicit and—if needed—repairs it <b>once per run</b>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Step   </th><th class="markdownTableHeadNone">Action    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Compute global <code>Aj_min</code>, <code>Aj_max</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"><b>Mixed signs</b> (<code>Aj_min &lt; 0 &amp;&amp; Aj_max &gt; 0</code>) &rarr; abort: the mesh is topologically inconsistent.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"><b>All negative</b> (<code>Aj_max &lt; 0</code>) &rarr; flip <br  />
<code>Csi</code>, <code>Eta</code>, <code>Zet</code>, <code>Aj</code> &amp; update local ghosts.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Store <code>user-&gt;orientation = ±1</code> so BC / IC routines can apply sign-aware logic if they care about inlet direction.   </td></tr>
</table>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Fully initialised <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> that already contains <br  />
 <code>Csi</code>, <code>Eta</code>, <code>Zet</code>, <code>Aj</code>, their <b>local</b> ghosts, and valid distributed DMs.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success or a PETSc error code on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Call <b>immediately after</b> <code><a class="el" href="Metric_8c.html#a92d28e2f14645b0eb563144f4ccf2b49" title="Calculates the cell-centered inverse Jacobian determinant (1/J), including boundary extrapolation,...">ComputeCellCenteredJacobianInverse()</a></code> and before any routine that differentiates or applies BCs.</dd></dl>
<dl class="section author"><dt>Author</dt><dd>vishal kandala </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00195">195</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  196</span>{</div>
<div class="line"><span class="lineno">  197</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  198</span>    PetscReal      aj_min, aj_max;</div>
<div class="line"><span class="lineno">  199</span>    PetscMPIInt    rank;</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  202</span> </div>
<div class="line"><span class="lineno">  203</span>    <span class="comment">/* ---------------- step 1: global extrema of Aj ---------------- */</span></div>
<div class="line"><span class="lineno">  204</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD,&amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>    ierr = VecMin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>, NULL, &amp;aj_min); CHKERRQ(ierr);  <span class="comment">/* already global */</span></div>
<div class="line"><span class="lineno">  207</span>    ierr = VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>, NULL, &amp;aj_max); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno">  210</span>        <span class="stringliteral">&quot;[orientation] Global Aj range: [%.3e , %.3e]\n&quot;</span>,</div>
<div class="line"><span class="lineno">  211</span>        (<span class="keywordtype">double</span>)aj_min, (<span class="keywordtype">double</span>)aj_max);</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>    <span class="comment">/* ---------------- step 2: detect malformed mesh ---------------- */</span></div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">if</span> (aj_min &lt; 0.0 &amp;&amp; aj_max &gt; 0.0)</div>
<div class="line"><span class="lineno">  215</span>        SETERRABORT(PETSC_COMM_WORLD, PETSC_ERR_USER,</div>
<div class="line"><span class="lineno">  216</span>            <span class="stringliteral">&quot;Mixed Jacobian signs detected – grid is topologically inconsistent.&quot;</span>);</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>    <span class="comment">/* Default: grid is right-handed unless proven otherwise */</span></div>
<div class="line"><span class="lineno">  219</span>    PetscInt orientation = +1;</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>    <span class="comment">/* ---------------- step 3: repair left-handed mesh -------------- */</span></div>
<div class="line"><span class="lineno">  222</span>    <span class="keywordflow">if</span> (aj_max &lt; 0.0) {                  <span class="comment">/* entire domain has Aj &lt; 0   */</span></div>
<div class="line"><span class="lineno">  223</span>        orientation = -1;</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span>        <span class="keywordflow">if</span> (!rank)</div>
<div class="line"><span class="lineno">  226</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno">  227</span>                <span class="stringliteral">&quot;[orientation] Detected left-handed grid – flipping metric vectors\n&quot;</span>);</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>        <span class="comment">/* Flip sign of *all* metric vectors and Aj                     */</span></div>
<div class="line"><span class="lineno">  230</span>        ierr = VecScale(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a439159b21d7cef43314ba3334fa8383d">Csi</a>, -1.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  231</span>        ierr = VecScale(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a8f4b905ecaadd9a0fe0b36faa1e3aa53">Eta</a>, -1.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  232</span>        ierr = VecScale(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a148acf527180f13125589c3fb8f4e816">Zet</a>, -1.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  233</span>        ierr = VecScale(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a> , -1.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>        <span class="comment">/* Local ghost regions now stale – refresh                      */</span></div>
<div class="line"><span class="lineno">  236</span>        ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Csi&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  237</span>        ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Eta&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  238</span>        ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Zet&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  239</span>        ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Aj&quot;</span>);  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  240</span> </div>
<div class="line"><span class="lineno">  241</span>        <span class="comment">/* Sanity print: Aj must be &gt; 0 now                             */</span></div>
<div class="line"><span class="lineno">  242</span>        ierr = VecMin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>, NULL, &amp;aj_min); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  243</span>        ierr = VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>, NULL, &amp;aj_max); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>        <span class="keywordflow">if</span> (aj_min &lt;= 0.0)</div>
<div class="line"><span class="lineno">  246</span>            SETERRABORT(PETSC_COMM_WORLD, PETSC_ERR_USER,</div>
<div class="line"><span class="lineno">  247</span>                <span class="stringliteral">&quot;Failed to flip grid orientation – Aj still non-positive.&quot;</span>);</div>
<div class="line"><span class="lineno">  248</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aj_min &amp;&amp; aj_max &gt; 0.0)</div>
<div class="line"><span class="lineno">  249</span>      orientation = +1;</div>
<div class="line"><span class="lineno">  250</span>    }</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>    <span class="comment">/* ---------------- step 4: store result in UserCtx -------------- */</span></div>
<div class="line"><span class="lineno">  253</span>    user-&gt;<a class="code hl_variable" href="variables__old_8h.html#accf2da0245f804c37780b4653a16f9f3">GridOrientation</a> = orientation;</div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">if</span> (!rank)</div>
<div class="line"><span class="lineno">  256</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno">  257</span>            <span class="stringliteral">&quot;[orientation] Grid confirmed %s-handed after flip (orientation=%+d)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  258</span>            (orientation&gt;0) ? <span class="stringliteral">&quot;right&quot;</span> : <span class="stringliteral">&quot;left&quot;</span>, orientation);</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  261</span>}</div>
<div class="ttc" id="asetup_8h_html_ad5f82951adcce74b3d37cb5880acf43a"><div class="ttname"><a href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a></div><div class="ttdeci">PetscErrorCode UpdateLocalGhosts(UserCtx *user, const char *fieldName)</div><div class="ttdoc">Updates the local vector (including ghost points) from its corresponding global vector.</div><div class="ttdef"><b>Definition</b> <a href="setup_8c_source.html#l00723">setup.c:723</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a04b7e7d757be63c56b7b26068f24dda6"><div class="ttname"><a href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">UserCtx::Aj</a></div><div class="ttdeci">Vec Aj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a148acf527180f13125589c3fb8f4e816"><div class="ttname"><a href="variables__old_8h.html#a148acf527180f13125589c3fb8f4e816">UserCtx::Zet</a></div><div class="ttdeci">Vec Zet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a439159b21d7cef43314ba3334fa8383d"><div class="ttname"><a href="variables__old_8h.html#a439159b21d7cef43314ba3334fa8383d">UserCtx::Csi</a></div><div class="ttdeci">Vec Csi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a8f4b905ecaadd9a0fe0b36faa1e3aa53"><div class="ttname"><a href="variables__old_8h.html#a8f4b905ecaadd9a0fe0b36faa1e3aa53">UserCtx::Eta</a></div><div class="ttdeci">Vec Eta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_accf2da0245f804c37780b4653a16f9f3"><div class="ttname"><a href="variables__old_8h.html#accf2da0245f804c37780b4653a16f9f3">UserCtx::GridOrientation</a></div><div class="ttdeci">PetscInt GridOrientation</div><div class="ttdoc">Integerer that determines Whether grid is right-handed (+1) or left-handed (-1) i....</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a436bb94905ee06971f632571f5bc8cbb_cgraph.svg" width="612" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a436bb94905ee06971f632571f5bc8cbb_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a92d28e2f14645b0eb563144f4ccf2b49" name="a92d28e2f14645b0eb563144f4ccf2b49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92d28e2f14645b0eb563144f4ccf2b49">&#9670;&#160;</a></span>ComputeCellCenteredJacobianInverse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeCellCenteredJacobianInverse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the cell-centered inverse Jacobian determinant (1/J), including boundary extrapolation, stores it in <code>user-&gt;Aj</code>, assembles <code>user-&gt;Aj</code>, and updates <code>user-&gt;lAj</code>. </p>
<p>Calculates the cell-centered inverse Jacobian determinant (1/J) for INTERIOR cells and stores it in <code>user-&gt;Aj</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00491">491</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  492</span>{</div>
<div class="line"><span class="lineno">  493</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  494</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  495</span>    PetscScalar  ***aj_arr;</div>
<div class="line"><span class="lineno">  496</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***nodal_coords_arr;</div>
<div class="line"><span class="lineno">  497</span>    Vec            localCoords_from_dm;</div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  500</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Starting calculation, extrapolation, and update for Aj.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>    <span class="comment">// --- 1. Get Nodal Coordinates and Output Array ---</span></div>
<div class="line"><span class="lineno">  503</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;localCoords_from_dm); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  504</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, localCoords_from_dm, &amp;nodal_coords_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  505</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  506</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>, &amp;aj_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>    <span class="comment">// Define owned node ranges (global indices)</span></div>
<div class="line"><span class="lineno">  509</span>    PetscInt xs = info.xs, xe = info.xs + info.xm;</div>
<div class="line"><span class="lineno">  510</span>    PetscInt ys = info.ys, ye = info.ys + info.ym;</div>
<div class="line"><span class="lineno">  511</span>    PetscInt zs = info.zs, ze = info.zs + info.zm;</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>    <span class="comment">// Global domain dimensions (total number of nodes)</span></div>
<div class="line"><span class="lineno">  514</span>    PetscInt mx = info.mx;</div>
<div class="line"><span class="lineno">  515</span>    PetscInt my = info.my;</div>
<div class="line"><span class="lineno">  516</span>    PetscInt mz = info.mz;</div>
<div class="line"><span class="lineno">  517</span> </div>
<div class="line"><span class="lineno">  518</span>    <span class="comment">// --- 2. Calculate Aj for INTERIOR Stencils ---</span></div>
<div class="line"><span class="lineno">  519</span>    </div>
<div class="line"><span class="lineno">  520</span>    PetscInt k_start_node = (zs == 0) ? zs + 1 : zs;</div>
<div class="line"><span class="lineno">  521</span>    PetscInt j_start_node = (ys == 0) ? ys + 1 : ys;</div>
<div class="line"><span class="lineno">  522</span>    PetscInt i_start_node = (xs == 0) ? xs + 1 : xs;</div>
<div class="line"><span class="lineno">  523</span> </div>
<div class="line"><span class="lineno">  524</span>    PetscInt k_end_node = (ze == mz) ? ze - 1 : ze;</div>
<div class="line"><span class="lineno">  525</span>    PetscInt j_end_node = (ye == my) ? ye - 1 : ye;</div>
<div class="line"><span class="lineno">  526</span>    PetscInt i_end_node = (xe == mx) ? xe - 1 : xe;</div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span>    <span class="keywordflow">for</span> (PetscInt k_node = k_start_node; k_node &lt; k_end_node; ++k_node) {</div>
<div class="line"><span class="lineno">  529</span>        <span class="keywordflow">for</span> (PetscInt j_node = j_start_node; j_node &lt; j_end_node; ++j_node) {</div>
<div class="line"><span class="lineno">  530</span>            <span class="keywordflow">for</span> (PetscInt i_node = i_start_node; i_node &lt; i_end_node; ++i_node) {</div>
<div class="line"><span class="lineno">  531</span>          </div>
<div class="line"><span class="lineno">  532</span>                PetscReal dx_dxi = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) - (nodal_coords_arr[k_node][j_node][i_node-1].x + nodal_coords_arr[k_node][j_node-1][i_node-1].x + nodal_coords_arr[k_node-1][j_node][i_node-1].x + nodal_coords_arr[k_node-1][j_node-1][i_node-1].x) );</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>        PetscReal dy_dxi = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) - (nodal_coords_arr[k_node][j_node][i_node-1].y + nodal_coords_arr[k_node][j_node-1][i_node-1].y + nodal_coords_arr[k_node-1][j_node][i_node-1].y + nodal_coords_arr[k_node-1][j_node-1][i_node-1].y) );</div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>        PetscReal dz_dxi = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) - (nodal_coords_arr[k_node][j_node][i_node-1].z + nodal_coords_arr[k_node][j_node-1][i_node-1].z + nodal_coords_arr[k_node-1][j_node][i_node-1].z + nodal_coords_arr[k_node-1][j_node-1][i_node-1].z) );</div>
<div class="line"><span class="lineno">  537</span> </div>
<div class="line"><span class="lineno">  538</span>        PetscReal dx_deta = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) - (nodal_coords_arr[k_node][j_node-1][i_node].x + nodal_coords_arr[k_node][j_node-1][i_node-1].x + nodal_coords_arr[k_node-1][j_node-1][i_node].x + nodal_coords_arr[k_node-1][j_node-1][i_node-1].x) );</div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>        PetscReal dy_deta = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) - (nodal_coords_arr[k_node][j_node-1][i_node].y + nodal_coords_arr[k_node][j_node-1][i_node-1].y + nodal_coords_arr[k_node-1][j_node-1][i_node].y + nodal_coords_arr[k_node-1][j_node-1][i_node-1].y) );</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>        PetscReal dz_deta = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) - (nodal_coords_arr[k_node][j_node-1][i_node].z + nodal_coords_arr[k_node][j_node-1][i_node-1].z + nodal_coords_arr[k_node-1][j_node-1][i_node].z + nodal_coords_arr[k_node-1][j_node-1][i_node-1].z) );</div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span>        PetscReal dx_dzeta = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) - (nodal_coords_arr[k_node-1][j_node][i_node].x + nodal_coords_arr[k_node-1][j_node-1][i_node].x + nodal_coords_arr[k_node-1][j_node][i_node-1].x + nodal_coords_arr[k_node-1][j_node-1][i_node-1].x) );</div>
<div class="line"><span class="lineno">  545</span> </div>
<div class="line"><span class="lineno">  546</span>        PetscReal dy_dzeta = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) - (nodal_coords_arr[k_node-1][j_node][i_node].y + nodal_coords_arr[k_node-1][j_node-1][i_node].y + nodal_coords_arr[k_node-1][j_node][i_node-1].y + nodal_coords_arr[k_node-1][j_node-1][i_node-1].y) );</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>        PetscReal dz_dzeta = 0.25 * ( (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) - (nodal_coords_arr[k_node-1][j_node][i_node].z + nodal_coords_arr[k_node-1][j_node-1][i_node].z + nodal_coords_arr[k_node-1][j_node][i_node-1].z + nodal_coords_arr[k_node-1][j_node-1][i_node-1].z) );</div>
<div class="line"><span class="lineno">  549</span> </div>
<div class="line"><span class="lineno">  550</span>        PetscReal jacobian_det = dx_dxi * (dy_deta * dz_dzeta - dz_deta * dy_dzeta) - dy_dxi * (dx_deta * dz_dzeta - dz_deta * dx_dzeta) + dz_dxi * (dx_deta * dy_dzeta - dy_deta * dx_dzeta);</div>
<div class="line"><span class="lineno">  551</span>                <span class="keywordflow">if</span> (PetscAbsReal(jacobian_det) &lt; 1.0e-18) { SETERRQ(PETSC_COMM_SELF, PETSC_ERR_FLOP_COUNT, <span class="stringliteral">&quot;Jacobian is near zero...&quot;</span>); }</div>
<div class="line"><span class="lineno">  552</span>                aj_arr[k_node][j_node][i_node] = 1.0 / jacobian_det;</div>
<div class="line"><span class="lineno">  553</span>            }</div>
<div class="line"><span class="lineno">  554</span>        }</div>
<div class="line"><span class="lineno">  555</span>    }</div>
<div class="line"><span class="lineno">  556</span> </div>
<div class="line"><span class="lineno">  557</span>    <span class="comment">// --- 4. Boundary Extrapolation for Aj ---</span></div>
<div class="line"><span class="lineno">  558</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Extrapolating boundary values for Aj. \n&quot;</span>);</div>
<div class="line"><span class="lineno">  559</span>    PetscInt i_bnd, j_bnd, k_bnd;</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    <span class="keywordflow">if</span> (xs == 0) {</div>
<div class="line"><span class="lineno">  562</span>        i_bnd = 0;</div>
<div class="line"><span class="lineno">  563</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  564</span>            <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  565</span>                <span class="keywordflow">if</span> (i_bnd + 1 &lt; mx) aj_arr[k_bnd][j_bnd][i_bnd] = aj_arr[k_bnd][j_bnd][i_bnd+1];</div>
<div class="line"><span class="lineno">  566</span>            }</div>
<div class="line"><span class="lineno">  567</span>        }</div>
<div class="line"><span class="lineno">  568</span>    }</div>
<div class="line"><span class="lineno">  569</span>    <span class="keywordflow">if</span> (xe == mx) {</div>
<div class="line"><span class="lineno">  570</span>        i_bnd = mx - 1;</div>
<div class="line"><span class="lineno">  571</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  572</span>            <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  573</span>                <span class="keywordflow">if</span> (i_bnd - 1 &gt;= 0) aj_arr[k_bnd][j_bnd][i_bnd] = aj_arr[k_bnd][j_bnd][i_bnd-1];</div>
<div class="line"><span class="lineno">  574</span>            }</div>
<div class="line"><span class="lineno">  575</span>        }</div>
<div class="line"><span class="lineno">  576</span>    }</div>
<div class="line"><span class="lineno">  577</span>    <span class="comment">// (Similar extrapolation blocks for Y and Z boundaries for aj_arr)</span></div>
<div class="line"><span class="lineno">  578</span>    <span class="keywordflow">if</span> (ys == 0) {</div>
<div class="line"><span class="lineno">  579</span>        j_bnd = 0;</div>
<div class="line"><span class="lineno">  580</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  581</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  582</span>                 <span class="keywordflow">if</span> (j_bnd + 1 &lt; my) aj_arr[k_bnd][j_bnd][i_bnd] = aj_arr[k_bnd][j_bnd+1][i_bnd];</div>
<div class="line"><span class="lineno">  583</span>            }</div>
<div class="line"><span class="lineno">  584</span>        }</div>
<div class="line"><span class="lineno">  585</span>    }</div>
<div class="line"><span class="lineno">  586</span>    <span class="keywordflow">if</span> (ye == my) {</div>
<div class="line"><span class="lineno">  587</span>        j_bnd = my - 1;</div>
<div class="line"><span class="lineno">  588</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  589</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  590</span>                 <span class="keywordflow">if</span> (j_bnd - 1 &gt;= 0) aj_arr[k_bnd][j_bnd][i_bnd] = aj_arr[k_bnd][j_bnd-1][i_bnd];</div>
<div class="line"><span class="lineno">  591</span>            }</div>
<div class="line"><span class="lineno">  592</span>        }</div>
<div class="line"><span class="lineno">  593</span>    }</div>
<div class="line"><span class="lineno">  594</span>    <span class="keywordflow">if</span> (zs == 0) {</div>
<div class="line"><span class="lineno">  595</span>        k_bnd = 0;</div>
<div class="line"><span class="lineno">  596</span>        <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  597</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  598</span>                <span class="keywordflow">if</span> (k_bnd + 1 &lt; mz) aj_arr[k_bnd][j_bnd][i_bnd] = aj_arr[k_bnd+1][j_bnd][i_bnd];</div>
<div class="line"><span class="lineno">  599</span>            }</div>
<div class="line"><span class="lineno">  600</span>        }</div>
<div class="line"><span class="lineno">  601</span>    }</div>
<div class="line"><span class="lineno">  602</span>    <span class="keywordflow">if</span> (ze == mz) {</div>
<div class="line"><span class="lineno">  603</span>        k_bnd = mz - 1;</div>
<div class="line"><span class="lineno">  604</span>        <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  605</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  606</span>                 <span class="keywordflow">if</span> (k_bnd - 1 &gt;= 0) aj_arr[k_bnd][j_bnd][i_bnd] = aj_arr[k_bnd-1][j_bnd][i_bnd];</div>
<div class="line"><span class="lineno">  607</span>            }</div>
<div class="line"><span class="lineno">  608</span>        }</div>
<div class="line"><span class="lineno">  609</span>    }</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>    <span class="comment">// --- 5. Restore arrays ---</span></div>
<div class="line"><span class="lineno">  612</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, localCoords_from_dm, &amp;nodal_coords_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  613</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>, &amp;aj_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>    <span class="comment">// --- 6. Assemble Global Vector ---</span></div>
<div class="line"><span class="lineno">  616</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Assembling global Aj.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  617</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  618</span>    ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a04b7e7d757be63c56b7b26068f24dda6">Aj</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  619</span> </div>
<div class="line"><span class="lineno">  620</span>    <span class="comment">// --- 7. Update Local Ghosted Version ---</span></div>
<div class="line"><span class="lineno">  621</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Updating local lAj.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  622</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Aj&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Completed calculation, extrapolation, and update for Aj.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  625</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  626</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a69966d928601d61d4f526636f84396c5"><div class="ttname"><a href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">UserCtx::fda</a></div><div class="ttdeci">DM fda</div><div class="ttdoc">DMDA for primary 3-component vector fields (e.g., Velocity).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdoc">DMDA for scalar fields (e.g., Pressure, Nvert).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structCmpnts"><div class="ttname"><a href="variables__old_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a92d28e2f14645b0eb563144f4ccf2b49_cgraph.svg" width="626" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a92d28e2f14645b0eb563144f4ccf2b49_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a46e70c0ae8f36f97321c5c892fc56be5" name="a46e70c0ae8f36f97321c5c892fc56be5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46e70c0ae8f36f97321c5c892fc56be5">&#9670;&#160;</a></span>ComputeCellCentersAndSpacing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeCellCentersAndSpacing </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the physical location of cell centers and the spacing between them. </p>
<p>This function calculates two key geometric properties from the nodal coordinates:</p><ol type="1">
<li><code>Cent</code>: A vector field storing the (x,y,z) coordinates of the center of each grid cell.</li>
<li><code>GridSpace</code>: A vector field storing the physical distance between adjacent cell centers in the i, j, and k computational directions.</li>
</ol>
<p>It is a direct adaptation of the corresponding logic from the legacy <code>FormMetrics</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific grid level. The function populates <code>user-&gt;Cent</code> and <code>user-&gt;GridSpace</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00644">644</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  645</span>{</div>
<div class="line"><span class="lineno">  646</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  647</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  648</span>    Vec            lCoords;</div>
<div class="line"><span class="lineno">  649</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coor;</div>
<div class="line"><span class="lineno">  650</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***cent, ***gs;</div>
<div class="line"><span class="lineno">  651</span>    PetscReal      xcp, ycp, zcp, xcm, ycm, zcm;</div>
<div class="line"><span class="lineno">  652</span> </div>
<div class="line"><span class="lineno">  653</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  654</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Rank %d: Computing cell centers and spacing for level %d block %d...\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  655</span> </div>
<div class="line"><span class="lineno">  656</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  657</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoords); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  658</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  659</span> </div>
<div class="line"><span class="lineno">  660</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad744b47ca3c5f3df2d1b737e432d6f07">Cent</a>, &amp;cent); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  661</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0a9771638133dcba2d6819c8ee4ea7b6">GridSpace</a>, &amp;gs); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  662</span>    </div>
<div class="line"><span class="lineno">  663</span>    <span class="comment">// Loop over the interior OWNED cells (stencil requires i-1, j-1, k-1)</span></div>
<div class="line"><span class="lineno">  664</span>    <span class="keywordflow">for</span> (PetscInt k=info.zs+1; k&lt;info.zs+info.zm; k++) {</div>
<div class="line"><span class="lineno">  665</span>        <span class="keywordflow">for</span> (PetscInt j=info.ys+1; j&lt;info.ys+info.ym; j++) {</div>
<div class="line"><span class="lineno">  666</span>            <span class="keywordflow">for</span> (PetscInt i=info.xs+1; i&lt;info.xs+info.xm; i++) {</div>
<div class="line"><span class="lineno">  667</span>                <span class="comment">// Calculate cell center as the average of its 8 corner nodes</span></div>
<div class="line"><span class="lineno">  668</span>                cent[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = 0.125 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  669</span>                cent[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = 0.125 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  670</span>                cent[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = 0.125 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>                <span class="comment">// Calculate Grid Spacing in i-direction (distance between i-face centers)</span></div>
<div class="line"><span class="lineno">  673</span>                xcp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  674</span>                ycp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  675</span>                zcp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  676</span>                xcm = 0.25 * (coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  677</span>                ycm = 0.25 * (coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  678</span>                zcm = 0.25 * (coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  679</span>                gs[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = PetscSqrtReal(PetscSqr(xcp-xcm) + PetscSqr(ycp-ycm) + PetscSqr(zcp-zcm));</div>
<div class="line"><span class="lineno">  680</span>       </div>
<div class="line"><span class="lineno">  681</span>                <span class="comment">// Calculate Grid Spacing in j-direction (distance between j-face centers)</span></div>
<div class="line"><span class="lineno">  682</span>                xcp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  683</span>                ycp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  684</span>                zcp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  685</span>                xcm = 0.25 * (coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  686</span>                ycm = 0.25 * (coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  687</span>                zcm = 0.25 * (coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  688</span>                gs[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = PetscSqrtReal(PetscSqr(xcp-xcm) + PetscSqr(ycp-ycm) + PetscSqr(zcp-zcm));</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>                <span class="comment">// Calculate Grid Spacing in k-direction (distance between k-face centers)</span></div>
<div class="line"><span class="lineno">  691</span>                xcp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  692</span>                ycp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  693</span>                zcp = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  694</span>                xcm = 0.25 * (coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  695</span>                ycm = 0.25 * (coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  696</span>                zcm = 0.25 * (coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  697</span>                gs[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = PetscSqrtReal(PetscSqr(xcp-xcm) + PetscSqr(ycp-ycm) + PetscSqr(zcp-zcm));</div>
<div class="line"><span class="lineno">  698</span>            }</div>
<div class="line"><span class="lineno">  699</span>        }</div>
<div class="line"><span class="lineno">  700</span>    }</div>
<div class="line"><span class="lineno">  701</span>    </div>
<div class="line"><span class="lineno">  702</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  703</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad744b47ca3c5f3df2d1b737e432d6f07">Cent</a>, &amp;cent); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  704</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0a9771638133dcba2d6819c8ee4ea7b6">GridSpace</a>, &amp;gs); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  705</span> </div>
<div class="line"><span class="lineno">  706</span>    <span class="comment">// Assemble and update ghost regions for the new data</span></div>
<div class="line"><span class="lineno">  707</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad744b47ca3c5f3df2d1b737e432d6f07">Cent</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad744b47ca3c5f3df2d1b737e432d6f07">Cent</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  708</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0a9771638133dcba2d6819c8ee4ea7b6">GridSpace</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0a9771638133dcba2d6819c8ee4ea7b6">GridSpace</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  709</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Cent&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  710</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;GridSpace&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  711</span> </div>
<div class="line"><span class="lineno">  712</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  713</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a0a9771638133dcba2d6819c8ee4ea7b6"><div class="ttname"><a href="variables__old_8h.html#a0a9771638133dcba2d6819c8ee4ea7b6">UserCtx::GridSpace</a></div><div class="ttdeci">Vec GridSpace</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a322702c716e6e140d71515d0b3e111b1"><div class="ttname"><a href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">UserCtx::simCtx</a></div><div class="ttdeci">SimCtx * simCtx</div><div class="ttdoc">Back-pointer to the master simulation context.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00585">variables.h:585</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4f7c5fd8843d026101b193e9236e1192"><div class="ttname"><a href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">UserCtx::_this</a></div><div class="ttdeci">PetscInt _this</div><div class="ttdoc">Legacy block index, for multi-block contexts.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a99a88d89d58073bd134175f62213c528"><div class="ttname"><a href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">UserCtx::thislevel</a></div><div class="ttdeci">PetscInt thislevel</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00641">variables.h:641</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad744b47ca3c5f3df2d1b737e432d6f07"><div class="ttname"><a href="variables__old_8h.html#ad744b47ca3c5f3df2d1b737e432d6f07">UserCtx::Cent</a></div><div class="ttdeci">Vec Cent</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a46e70c0ae8f36f97321c5c892fc56be5_cgraph.svg" width="638" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a46e70c0ae8f36f97321c5c892fc56be5_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a6f0dfb324211e230a387501f93cfd316" name="a6f0dfb324211e230a387501f93cfd316"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f0dfb324211e230a387501f93cfd316">&#9670;&#160;</a></span>ComputeFaceMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeFaceMetrics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the primary face metric components (Csi, Eta, Zet), including boundary extrapolation, and stores them in the corresponding global Vec members of the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure (user-&gt;Csi, user-&gt;Eta, user-&gt;Zet). </p>
<p>This is a self-contained routine that performs the following steps:</p><ol type="1">
<li>Obtains local ghosted nodal coordinates using DMGetCoordinatesLocal.</li>
<li>Calculates metrics for INTERIOR faces where finite difference stencils are valid.</li>
<li>EXTRAPOLATES metrics for faces on the physical domain boundaries by copying from the nearest computed interior face.</li>
<li>Assembles the global <code>user-&gt;Csi</code>, <code>user-&gt;Eta</code>, <code>user-&gt;Zet</code> Vecs.</li>
<li>Updates the local ghosted <code>user-&gt;lCsi</code>, <code>user-&gt;lEta</code>, <code>user-&gt;lZet</code> Vecs.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>This function is a complete "compute and make ready" unit for Csi, Eta, and Zet.</li>
<li>It's recommended to call <code>VecZeroEntries</code> on user-&gt;Csi, Eta, Zet before this if they might contain old data. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00286">286</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  287</span>{</div>
<div class="line"><span class="lineno">  288</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  289</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  290</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***csi_arr, ***eta_arr, ***zet_arr;</div>
<div class="line"><span class="lineno">  291</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***nodal_coords_arr;</div>
<div class="line"><span class="lineno">  292</span>    Vec            localCoords_from_dm;</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  295</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Starting calculation and update for Csi, Eta, Zet.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  296</span> </div>
<div class="line"><span class="lineno">  297</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>    <span class="comment">// --- 1. Get Nodal Physical Coordinates (Local Ghosted Array directly) ---</span></div>
<div class="line"><span class="lineno">  300</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;localCoords_from_dm); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  301</span>    <span class="keywordflow">if</span> (!localCoords_from_dm) SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;DMGetCoordinatesLocal failed to return a coordinate vector. \n&quot;</span>);</div>
<div class="line"><span class="lineno">  302</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, localCoords_from_dm, &amp;nodal_coords_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>    <span class="comment">// --- 2. Get arrays for output global Vecs from UserCtx ---</span></div>
<div class="line"><span class="lineno">  305</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a439159b21d7cef43314ba3334fa8383d">Csi</a>, &amp;csi_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  306</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a8f4b905ecaadd9a0fe0b36faa1e3aa53">Eta</a>, &amp;eta_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  307</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a148acf527180f13125589c3fb8f4e816">Zet</a>, &amp;zet_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>    <span class="comment">// Define owned node ranges (global indices)</span></div>
<div class="line"><span class="lineno">  310</span>    PetscInt xs = info.xs, xe = info.xs + info.xm;</div>
<div class="line"><span class="lineno">  311</span>    PetscInt ys = info.ys, ye = info.ys + info.ym;</div>
<div class="line"><span class="lineno">  312</span>    PetscInt zs = info.zs, ze = info.zs + info.zm;</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    <span class="comment">// Global domain dimensions (total number of nodes)</span></div>
<div class="line"><span class="lineno">  315</span>    PetscInt mx = info.mx;</div>
<div class="line"><span class="lineno">  316</span>    PetscInt my = info.my;</div>
<div class="line"><span class="lineno">  317</span>    PetscInt mz = info.mz;</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>    <span class="comment">// --- 3. Calculate Csi, Eta, Zet for INTERIOR Stencils ---</span></div>
<div class="line"><span class="lineno">  320</span>    <span class="comment">// Start loops from 1 if at global boundary 0 to ensure k_node-1 etc. are valid.</span></div>
<div class="line"><span class="lineno">  321</span>    PetscInt k_loop_start = (zs == 0) ? zs + 1 : zs;</div>
<div class="line"><span class="lineno">  322</span>    PetscInt j_loop_start = (ys == 0) ? ys + 1 : ys;</div>
<div class="line"><span class="lineno">  323</span>    PetscInt i_loop_start = (xs == 0) ? xs + 1 : xs;</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <span class="comment">// Calculate Csi</span></div>
<div class="line"><span class="lineno">  326</span>    <span class="keywordflow">for</span> (PetscInt k_node = k_loop_start; k_node &lt; ze; ++k_node) {</div>
<div class="line"><span class="lineno">  327</span>        <span class="keywordflow">for</span> (PetscInt j_node = j_loop_start; j_node &lt; ye; ++j_node) {</div>
<div class="line"><span class="lineno">  328</span>            <span class="keywordflow">for</span> (PetscInt i_node = xs; i_node &lt; xe; ++i_node) {</div>
<div class="line"><span class="lineno">  329</span>          </div>
<div class="line"><span class="lineno">  330</span>                PetscReal dx_deta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  331</span>                PetscReal dy_deta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  332</span>                PetscReal dz_deta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  333</span>                PetscReal dx_dzeta = 0.5 * (nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  334</span>                PetscReal dy_dzeta = 0.5 * (nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  335</span>                PetscReal dz_dzeta = 0.5 * (nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node-1][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  336</span> </div>
<div class="line"><span class="lineno">  337</span>        csi_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dy_deta * dz_dzeta - dz_deta * dy_dzeta;</div>
<div class="line"><span class="lineno">  338</span>                csi_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = dz_deta * dx_dzeta - dx_deta * dz_dzeta;</div>
<div class="line"><span class="lineno">  339</span>                csi_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dx_deta * dy_dzeta - dy_deta * dx_dzeta;</div>
<div class="line"><span class="lineno">  340</span>            }</div>
<div class="line"><span class="lineno">  341</span>        }</div>
<div class="line"><span class="lineno">  342</span>    }</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>    <span class="comment">// Calculate Eta</span></div>
<div class="line"><span class="lineno">  345</span>    <span class="keywordflow">for</span> (PetscInt k_node = k_loop_start; k_node &lt; ze; ++k_node) {</div>
<div class="line"><span class="lineno">  346</span>        <span class="keywordflow">for</span> (PetscInt j_node = ys; j_node &lt; ye; ++j_node) {</div>
<div class="line"><span class="lineno">  347</span>            <span class="keywordflow">for</span> (PetscInt i_node = i_loop_start; i_node &lt; xe; ++i_node) {</div>
<div class="line"><span class="lineno">  348</span>          </div>
<div class="line"><span class="lineno">  349</span>                PetscReal dx_dxi = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  350</span>                PetscReal dy_dxi = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  351</span>                PetscReal dz_dxi = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  352</span>                PetscReal dx_dzeta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  353</span>                PetscReal dy_dzeta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  354</span>                PetscReal dz_dzeta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node-1][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node-1][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  355</span> </div>
<div class="line"><span class="lineno">  356</span>        eta_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dy_dzeta * dz_dxi  - dz_dzeta * dy_dxi;</div>
<div class="line"><span class="lineno">  357</span>                eta_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = dz_dzeta * dx_dxi  - dx_dzeta * dz_dxi;</div>
<div class="line"><span class="lineno">  358</span>                eta_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dx_dzeta * dy_dxi  - dy_dzeta * dx_dxi;</div>
<div class="line"><span class="lineno">  359</span>            }</div>
<div class="line"><span class="lineno">  360</span>        }</div>
<div class="line"><span class="lineno">  361</span>    }</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>    <span class="comment">// Calculate Zet</span></div>
<div class="line"><span class="lineno">  364</span>    <span class="keywordflow">for</span> (PetscInt k_node = zs; k_node &lt; ze; ++k_node) {</div>
<div class="line"><span class="lineno">  365</span>        <span class="keywordflow">for</span> (PetscInt j_node = j_loop_start; j_node &lt; ye; ++j_node) {</div>
<div class="line"><span class="lineno">  366</span>            <span class="keywordflow">for</span> (PetscInt i_node = i_loop_start; i_node &lt; xe; ++i_node) {</div>
<div class="line"><span class="lineno">  367</span>          </div>
<div class="line"><span class="lineno">  368</span>                PetscReal dx_dxi = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  369</span>                PetscReal dy_dxi = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  370</span>                PetscReal dz_dxi = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  371</span>                PetscReal dx_deta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  372</span>                PetscReal dy_deta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  373</span>                PetscReal dz_deta = 0.5 * (nodal_coords_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + nodal_coords_arr[k_node][j_node][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node][j_node-1][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - nodal_coords_arr[k_node][j_node-1][i_node-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  374</span> </div>
<div class="line"><span class="lineno">  375</span>        zet_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dy_dxi * dz_deta - dz_dxi * dy_deta;</div>
<div class="line"><span class="lineno">  376</span>                zet_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = dz_dxi * dx_deta - dx_dxi * dz_deta;</div>
<div class="line"><span class="lineno">  377</span>                zet_arr[k_node][j_node][i_node].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dx_dxi * dy_deta - dy_dxi * dx_deta;</div>
<div class="line"><span class="lineno">  378</span>            }</div>
<div class="line"><span class="lineno">  379</span>        }</div>
<div class="line"><span class="lineno">  380</span>    }</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>    <span class="comment">// --- 4. Boundary Extrapolation ---</span></div>
<div class="line"><span class="lineno">  383</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Extrapolating boundary values for Csi, Eta, Zet.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  384</span>    PetscInt i_bnd, j_bnd, k_bnd;</div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>    <span class="keywordflow">if</span> (xs == 0) { <span class="comment">// If this rank owns the global i=0 boundary</span></div>
<div class="line"><span class="lineno">  387</span>        i_bnd = 0;</div>
<div class="line"><span class="lineno">  388</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  389</span>            <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  390</span>                <span class="keywordflow">if</span> (i_bnd + 1 &lt; mx) {</div>
<div class="line"><span class="lineno">  391</span>                    eta_arr[k_bnd][j_bnd][i_bnd] = eta_arr[k_bnd][j_bnd][i_bnd+1];</div>
<div class="line"><span class="lineno">  392</span>                    zet_arr[k_bnd][j_bnd][i_bnd] = zet_arr[k_bnd][j_bnd][i_bnd+1];</div>
<div class="line"><span class="lineno">  393</span>                }</div>
<div class="line"><span class="lineno">  394</span>            }</div>
<div class="line"><span class="lineno">  395</span>        }</div>
<div class="line"><span class="lineno">  396</span>    }</div>
<div class="line"><span class="lineno">  397</span>    <span class="keywordflow">if</span> (xe == mx) { <span class="comment">// If this rank owns the global i=mx-1 boundary</span></div>
<div class="line"><span class="lineno">  398</span>        i_bnd = mx - 1;</div>
<div class="line"><span class="lineno">  399</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  400</span>            <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  401</span>                <span class="keywordflow">if</span> (i_bnd - 1 &gt;= 0) {</div>
<div class="line"><span class="lineno">  402</span>                    eta_arr[k_bnd][j_bnd][i_bnd] = eta_arr[k_bnd][j_bnd][i_bnd-1];</div>
<div class="line"><span class="lineno">  403</span>                    zet_arr[k_bnd][j_bnd][i_bnd] = zet_arr[k_bnd][j_bnd][i_bnd-1];</div>
<div class="line"><span class="lineno">  404</span>                }</div>
<div class="line"><span class="lineno">  405</span>            }</div>
<div class="line"><span class="lineno">  406</span>        }</div>
<div class="line"><span class="lineno">  407</span>    }</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">if</span> (ys == 0) {</div>
<div class="line"><span class="lineno">  409</span>        j_bnd = 0;</div>
<div class="line"><span class="lineno">  410</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  411</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  412</span>                <span class="keywordflow">if</span> (j_bnd + 1 &lt; my) {</div>
<div class="line"><span class="lineno">  413</span>                    csi_arr[k_bnd][j_bnd][i_bnd] = csi_arr[k_bnd][j_bnd+1][i_bnd];</div>
<div class="line"><span class="lineno">  414</span>                    zet_arr[k_bnd][j_bnd][i_bnd] = zet_arr[k_bnd][j_bnd+1][i_bnd];</div>
<div class="line"><span class="lineno">  415</span>                }</div>
<div class="line"><span class="lineno">  416</span>            }</div>
<div class="line"><span class="lineno">  417</span>        }</div>
<div class="line"><span class="lineno">  418</span>    }</div>
<div class="line"><span class="lineno">  419</span>    <span class="keywordflow">if</span> (ye == my) {</div>
<div class="line"><span class="lineno">  420</span>        j_bnd = my - 1;</div>
<div class="line"><span class="lineno">  421</span>        <span class="keywordflow">for</span> (k_bnd = zs; k_bnd &lt; ze; ++k_bnd) {</div>
<div class="line"><span class="lineno">  422</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  423</span>                <span class="keywordflow">if</span> (j_bnd - 1 &gt;= 0) {</div>
<div class="line"><span class="lineno">  424</span>                    csi_arr[k_bnd][j_bnd][i_bnd] = csi_arr[k_bnd][j_bnd-1][i_bnd];</div>
<div class="line"><span class="lineno">  425</span>                    zet_arr[k_bnd][j_bnd][i_bnd] = zet_arr[k_bnd][j_bnd-1][i_bnd];</div>
<div class="line"><span class="lineno">  426</span>                }</div>
<div class="line"><span class="lineno">  427</span>            }</div>
<div class="line"><span class="lineno">  428</span>        }</div>
<div class="line"><span class="lineno">  429</span>    }</div>
<div class="line"><span class="lineno">  430</span>    <span class="keywordflow">if</span> (zs == 0) {</div>
<div class="line"><span class="lineno">  431</span>        k_bnd = 0;</div>
<div class="line"><span class="lineno">  432</span>        <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  433</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  434</span>                <span class="keywordflow">if</span> (k_bnd + 1 &lt; mz) {</div>
<div class="line"><span class="lineno">  435</span>                    csi_arr[k_bnd][j_bnd][i_bnd] = csi_arr[k_bnd+1][j_bnd][i_bnd];</div>
<div class="line"><span class="lineno">  436</span>                    eta_arr[k_bnd][j_bnd][i_bnd] = eta_arr[k_bnd+1][j_bnd][i_bnd];</div>
<div class="line"><span class="lineno">  437</span>                }</div>
<div class="line"><span class="lineno">  438</span>            }</div>
<div class="line"><span class="lineno">  439</span>        }</div>
<div class="line"><span class="lineno">  440</span>    }</div>
<div class="line"><span class="lineno">  441</span>    <span class="keywordflow">if</span> (ze == mz) {</div>
<div class="line"><span class="lineno">  442</span>        k_bnd = mz - 1;</div>
<div class="line"><span class="lineno">  443</span>        <span class="keywordflow">for</span> (j_bnd = ys; j_bnd &lt; ye; ++j_bnd) {</div>
<div class="line"><span class="lineno">  444</span>            <span class="keywordflow">for</span> (i_bnd = xs; i_bnd &lt; xe; ++i_bnd) {</div>
<div class="line"><span class="lineno">  445</span>                <span class="keywordflow">if</span> (k_bnd - 1 &gt;= 0) {</div>
<div class="line"><span class="lineno">  446</span>                    csi_arr[k_bnd][j_bnd][i_bnd] = csi_arr[k_bnd-1][j_bnd][i_bnd];</div>
<div class="line"><span class="lineno">  447</span>                    eta_arr[k_bnd][j_bnd][i_bnd] = eta_arr[k_bnd-1][j_bnd][i_bnd];</div>
<div class="line"><span class="lineno">  448</span>                }</div>
<div class="line"><span class="lineno">  449</span>            }</div>
<div class="line"><span class="lineno">  450</span>        }</div>
<div class="line"><span class="lineno">  451</span>    }</div>
<div class="line"><span class="lineno">  452</span> </div>
<div class="line"><span class="lineno">  453</span>    <span class="keywordflow">if</span> (info.xs==0 &amp;&amp; info.ys==0 &amp;&amp; info.zs==0) {</div>
<div class="line"><span class="lineno">  454</span>      PetscReal dot = zet_arr[0][0][0].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;  <span class="comment">/* dot with global +z */</span></div>
<div class="line"><span class="lineno">  455</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Zet(k=0)·ez = %.3f   (should be &gt;0 for right-handed grid)\n&quot;</span>, dot);</div>
<div class="line"><span class="lineno">  456</span>    }</div>
<div class="line"><span class="lineno">  457</span>    </div>
<div class="line"><span class="lineno">  458</span>    <span class="comment">// --- 5. Restore all arrays ---</span></div>
<div class="line"><span class="lineno">  459</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, localCoords_from_dm, &amp;nodal_coords_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  460</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a439159b21d7cef43314ba3334fa8383d">Csi</a>, &amp;csi_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  461</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a8f4b905ecaadd9a0fe0b36faa1e3aa53">Eta</a>, &amp;eta_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  462</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a148acf527180f13125589c3fb8f4e816">Zet</a>, &amp;zet_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>    <span class="comment">// --- 6. Assemble Global Vectors ---</span></div>
<div class="line"><span class="lineno">  465</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Assembling global Csi, Eta, Zet.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  466</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a439159b21d7cef43314ba3334fa8383d">Csi</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a439159b21d7cef43314ba3334fa8383d">Csi</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  467</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a8f4b905ecaadd9a0fe0b36faa1e3aa53">Eta</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a8f4b905ecaadd9a0fe0b36faa1e3aa53">Eta</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  468</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a148acf527180f13125589c3fb8f4e816">Zet</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a148acf527180f13125589c3fb8f4e816">Zet</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>    <span class="comment">// --- 7. Update Local Ghosted Versions ---</span></div>
<div class="line"><span class="lineno">  471</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Updating local lCsi, lEta, lZet.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  472</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Csi&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  473</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Eta&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  474</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Zet&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  475</span>    </div>
<div class="line"><span class="lineno">  476</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Completed calculation, extrapolation, and update for Csi, Eta, Zet.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  477</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  478</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a6f0dfb324211e230a387501f93cfd316_cgraph.svg" width="564" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a6f0dfb324211e230a387501f93cfd316_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="af935307ea3e9727a63b6ef9a3932caa8" name="af935307ea3e9727a63b6ef9a3932caa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af935307ea3e9727a63b6ef9a3932caa8">&#9670;&#160;</a></span>ComputeIFaceMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeIFaceMetrics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes metrics centered on constant-i faces (i-faces). </p>
<p>This function calculates the metric terms (<code>ICsi</code>, <code>IEta</code>, <code>IZet</code>) and the inverse Jacobian (<code>IAj</code>) located at the geometric center of each constant-i face. This is a critical step for staggered-grid finite difference schemes.</p>
<p>The process is a direct and faithful refactoring of the corresponding logic from the legacy <code>FormMetrics</code> function:</p><ol type="1">
<li>It first calculates the physical (x,y,z) coordinates of the center of each i-face and stores them in the <code>user-&gt;Centx</code> vector.</li>
<li>It then uses a boundary-aware, second-order finite difference stencil on the <code>Centx</code> field to compute the derivatives (e.g., d(x)/d(csi)).<ul>
<li>Central differences are used in the grid interior.</li>
<li>One-sided differences are used at the physical domain boundaries.</li>
</ul>
</li>
<li>Finally, these derivatives are used to compute the final metric terms and the inverse Jacobian, which are stored in their respective <code>Vec</code> objects.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific grid level. This function populates the <code>user-&gt;ICsi</code>, <code>user-&gt;IEta</code>, <code>user-&gt;IZet</code>, and <code>user-&gt;IAj</code> vectors. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00739">739</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  740</span>{</div>
<div class="line"><span class="lineno">  741</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  742</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  743</span>    Vec            lCoords;</div>
<div class="line"><span class="lineno">  744</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coor;</div>
<div class="line"><span class="lineno">  745</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***centx; <span class="comment">//***gs;</span></div>
<div class="line"><span class="lineno">  746</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***centx_const;</div>
<div class="line"><span class="lineno">  747</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***icsi, ***ieta, ***izet;</div>
<div class="line"><span class="lineno">  748</span>    PetscScalar  ***iaj;</div>
<div class="line"><span class="lineno">  749</span>    PetscReal      dxdc, dydc, dzdc, dxde, dyde, dzde, dxdz, dydz, dzdz;</div>
<div class="line"><span class="lineno">  750</span> </div>
<div class="line"><span class="lineno">  751</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  752</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Rank %d: Computing i-face metrics for level %d block %d...\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  753</span> </div>
<div class="line"><span class="lineno">  754</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  755</span>    PetscInt xs = info.xs, xe = info.xs + info.xm, mx = info.mx;</div>
<div class="line"><span class="lineno">  756</span>    PetscInt ys = info.ys, ye = info.ys + info.ym, my = info.my;</div>
<div class="line"><span class="lineno">  757</span>    PetscInt zs = info.zs, ze = info.zs + info.zm, mz = info.mz;</div>
<div class="line"><span class="lineno">  758</span>    PetscInt gxs = info.gxs, gxe = info.gxs + info.gxm;</div>
<div class="line"><span class="lineno">  759</span>    PetscInt gys = info.gys, gye = info.gys + info.gym;</div>
<div class="line"><span class="lineno">  760</span>    PetscInt gzs = info.gzs, gze = info.gzs + info.gzm;</div>
<div class="line"><span class="lineno">  761</span>    </div>
<div class="line"><span class="lineno">  762</span>    PetscInt lxs = xs; PetscInt lxe = xe;</div>
<div class="line"><span class="lineno">  763</span>    PetscInt lys = ys; PetscInt lye = ye;</div>
<div class="line"><span class="lineno">  764</span>    PetscInt lzs = zs; PetscInt lze = ze;</div>
<div class="line"><span class="lineno">  765</span> </div>
<div class="line"><span class="lineno">  766</span>    <span class="keywordflow">if</span> (xs==0) lxs = xs+1;</div>
<div class="line"><span class="lineno">  767</span>    <span class="keywordflow">if</span> (ys==0) lys = ys+1;</div>
<div class="line"><span class="lineno">  768</span>    <span class="keywordflow">if</span> (zs==0) lzs = zs+1;</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>    <span class="keywordflow">if</span> (xe==mx) lxe=xe-1;</div>
<div class="line"><span class="lineno">  771</span>    <span class="keywordflow">if</span> (ye==my) lye=ye-1;</div>
<div class="line"><span class="lineno">  772</span>    <span class="keywordflow">if</span> (ze==mz) lze=ze-1;</div>
<div class="line"><span class="lineno">  773</span> </div>
<div class="line"><span class="lineno">  774</span>    <span class="comment">// --- Part 1: Calculate the location of i-face centers (Centx) ---</span></div>
<div class="line"><span class="lineno">  775</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoords); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  776</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  777</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a77888fe1930df923549faaf5951455ba">Centx</a>, &amp;centx); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  778</span>    <span class="comment">//  ierr = DMDAVecGetArray(user-&gt;fda, user-&gt;lGridSpace,&amp;gs); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>    <span class="comment">// Loop over the ghosted region to calculate all local face centers</span></div>
<div class="line"><span class="lineno">  781</span>    <span class="keywordflow">for</span> (PetscInt k = gzs + 1; k &lt; gze; k++) {</div>
<div class="line"><span class="lineno">  782</span>        <span class="keywordflow">for</span> (PetscInt j = gys + 1; j &lt; gye; j++) {</div>
<div class="line"><span class="lineno">  783</span>            <span class="keywordflow">for</span> (PetscInt i = gxs; i &lt; gxe; i++) {</div>
<div class="line"><span class="lineno">  784</span>                centx[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  785</span>                centx[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  786</span>                centx[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  787</span>            }</div>
<div class="line"><span class="lineno">  788</span>        }</div>
<div class="line"><span class="lineno">  789</span>    }</div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  792</span><span class="comment">    if(xs==0){</span></div>
<div class="line"><span class="lineno">  793</span><span class="comment">      for(PetscInt k=gzs+1;k &lt; gze; k++){</span></div>
<div class="line"><span class="lineno">  794</span><span class="comment">    for(PetscInt j=gys+1;j &lt; gye; j++){</span></div>
<div class="line"><span class="lineno">  795</span><span class="comment">      PetscInt i=0; </span></div>
<div class="line"><span class="lineno">  796</span><span class="comment">      centx[k][j][i-1].x=centx[k][j][i].x-gs[k][j][i-2].x;</span></div>
<div class="line"><span class="lineno">  797</span><span class="comment">      centx[k][j][i-1].y=centx[k][j][i].y;</span></div>
<div class="line"><span class="lineno">  798</span><span class="comment">      centx[k][j][i-1].z=centx[k][j][i].z;</span></div>
<div class="line"><span class="lineno">  799</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  800</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno">  801</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  802</span><span class="comment">    if (xe==mx){</span></div>
<div class="line"><span class="lineno">  803</span><span class="comment">      for(PetscInt k=gzs+1; k&lt;gze; k++) {</span></div>
<div class="line"><span class="lineno">  804</span><span class="comment">    for (PetscInt j=gys+1; j&lt;gye;j++) {</span></div>
<div class="line"><span class="lineno">  805</span><span class="comment">      PetscInt i=mx-1; </span></div>
<div class="line"><span class="lineno">  806</span><span class="comment">      centx[k][j][i].x=centx[k][j][i-1].x+gs[k][j][i+2].x;</span></div>
<div class="line"><span class="lineno">  807</span><span class="comment">      centx[k][j][i].y=centx[k][j][i-1].y;</span></div>
<div class="line"><span class="lineno">  808</span><span class="comment">      centx[k][j][i].z=centx[k][j][i-1].z;</span></div>
<div class="line"><span class="lineno">  809</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  810</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno">  811</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  812</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  813</span>    </div>
<div class="line"><span class="lineno">  814</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  815</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a77888fe1930df923549faaf5951455ba">Centx</a>, &amp;centx); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  816</span>    <span class="comment">// ierr = DMDAVecRestoreArray(user-&gt;fda, user-&gt;lGridSpace,&amp;gs); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   i-face centers (Centx) calculated and ghosts updated.\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>);</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>    <span class="comment">// --- Part 2: Calculate metrics using face-centered coordinates ---</span></div>
<div class="line"><span class="lineno">  821</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a77888fe1930df923549faaf5951455ba">Centx</a>, &amp;centx_const); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  822</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9d9e92084d58808e9a52a80fa9d82092">ICsi</a>, &amp;icsi); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  823</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3bfdfbc3022c8bc7f58ec9113275586f">IEta</a>, &amp;ieta); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  824</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3791d5150655979c702ff538e0c2d0a5">IZet</a>, &amp;izet); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  825</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#abbf9f36d259bcdf12c831721e70390ee">IAj</a>, &amp;iaj); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span>    <span class="comment">// Loop over the OWNED region where we will store the final metrics</span></div>
<div class="line"><span class="lineno">  828</span>    <span class="keywordflow">for</span> (PetscInt k=lzs; k&lt;lze; k++) {</div>
<div class="line"><span class="lineno">  829</span>        <span class="keywordflow">for</span> (PetscInt j=lys; j&lt;lye; j++) {</div>
<div class="line"><span class="lineno">  830</span>            <span class="keywordflow">for</span> (PetscInt i=xs; i&lt;lxe; i++) {</div>
<div class="line"><span class="lineno">  831</span> </div>
<div class="line"><span class="lineno">  832</span>                <span class="comment">// --- Stencil Logic for d/dcsi (derivative in i-direction) ---</span></div>
<div class="line"><span class="lineno">  833</span>                <span class="keywordflow">if</span> (i == 0) { <span class="comment">// Forward difference at the domain&#39;s min-i boundary</span></div>
<div class="line"><span class="lineno">  834</span>                    dxdc = centx_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  835</span>                    dydc = centx_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  836</span>                    dzdc = centx_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  837</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == mx - 2) { <span class="comment">// Backward difference at the domain&#39;s max-i boundary</span></div>
<div class="line"><span class="lineno">  838</span>                    dxdc = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  839</span>                    dydc = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  840</span>                    dzdc = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  841</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference in the interior</span></div>
<div class="line"><span class="lineno">  842</span>                    dxdc = 0.5 * (centx_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  843</span>                    dydc = 0.5 * (centx_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  844</span>                    dzdc = 0.5 * (centx_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  845</span>                }</div>
<div class="line"><span class="lineno">  846</span> </div>
<div class="line"><span class="lineno">  847</span>                <span class="comment">// --- Stencil Logic for d/deta (derivative in j-direction) ---</span></div>
<div class="line"><span class="lineno">  848</span>                <span class="keywordflow">if</span> (j == 1) { <span class="comment">// Forward difference</span></div>
<div class="line"><span class="lineno">  849</span>                    dxde = centx_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  850</span>                    dyde = centx_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  851</span>                    dzde = centx_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  852</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j == my - 2) { <span class="comment">// Backward difference</span></div>
<div class="line"><span class="lineno">  853</span>                    dxde = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  854</span>                    dyde = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  855</span>                    dzde = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  856</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference</span></div>
<div class="line"><span class="lineno">  857</span>                    dxde = 0.5 * (centx_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  858</span>                    dyde = 0.5 * (centx_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  859</span>                    dzde = 0.5 * (centx_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  860</span>                }</div>
<div class="line"><span class="lineno">  861</span> </div>
<div class="line"><span class="lineno">  862</span>                <span class="comment">// --- Stencil Logic for d/dzeta (derivative in k-direction) ---</span></div>
<div class="line"><span class="lineno">  863</span>                <span class="keywordflow">if</span> (k == 1) { <span class="comment">// Forward difference</span></div>
<div class="line"><span class="lineno">  864</span>                    dxdz = centx_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  865</span>                    dydz = centx_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  866</span>                    dzdz = centx_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  867</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k == mz - 2) { <span class="comment">// Backward difference</span></div>
<div class="line"><span class="lineno">  868</span>                    dxdz = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  869</span>                    dydz = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  870</span>                    dzdz = centx_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  871</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference</span></div>
<div class="line"><span class="lineno">  872</span>                    dxdz = 0.5 * (centx_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centx_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  873</span>                    dydz = 0.5 * (centx_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centx_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  874</span>                    dzdz = 0.5 * (centx_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centx_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  875</span>                }</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span>                <span class="comment">// --- Metric calculations (identical to legacy FormMetrics) ---</span></div>
<div class="line"><span class="lineno">  878</span>                icsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dyde * dzdz - dzde * dydz;</div>
<div class="line"><span class="lineno">  879</span>                icsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxde * dzdz + dzde * dxdz;</div>
<div class="line"><span class="lineno">  880</span>                icsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxde * dydz - dyde * dxdz;</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span>                ieta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dydz * dzdc - dzdz * dydc;</div>
<div class="line"><span class="lineno">  883</span>                ieta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxdz * dzdc + dzdz * dxdc;</div>
<div class="line"><span class="lineno">  884</span>                ieta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxdz * dydc - dydz * dxdc;</div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>                izet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dydc * dzde - dzdc * dyde;</div>
<div class="line"><span class="lineno">  887</span>                izet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxdc * dzde + dzdc * dxde;</div>
<div class="line"><span class="lineno">  888</span>                izet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxdc * dyde - dydc * dxde;</div>
<div class="line"><span class="lineno">  889</span> </div>
<div class="line"><span class="lineno">  890</span>                iaj[k][j][i] = dxdc * icsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + dydc * icsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + dzdc * icsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  891</span>                <span class="keywordflow">if</span> (PetscAbsScalar(iaj[k][j][i]) &gt; 1e-12) {</div>
<div class="line"><span class="lineno">  892</span>                    iaj[k][j][i] = 1.0 / iaj[k][j][i];</div>
<div class="line"><span class="lineno">  893</span>                }</div>
<div class="line"><span class="lineno">  894</span>            }</div>
<div class="line"><span class="lineno">  895</span>        }</div>
<div class="line"><span class="lineno">  896</span>    }</div>
<div class="line"><span class="lineno">  897</span> </div>
<div class="line"><span class="lineno">  898</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a77888fe1930df923549faaf5951455ba">Centx</a>, &amp;centx_const); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  899</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9d9e92084d58808e9a52a80fa9d82092">ICsi</a>, &amp;icsi); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  900</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3bfdfbc3022c8bc7f58ec9113275586f">IEta</a>, &amp;ieta); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  901</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3791d5150655979c702ff538e0c2d0a5">IZet</a>, &amp;izet); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  902</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#abbf9f36d259bcdf12c831721e70390ee">IAj</a>, &amp;iaj); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  903</span>    </div>
<div class="line"><span class="lineno">  904</span>    <span class="comment">// --- Part 3: Assemble global vectors and update local ghosts ---</span></div>
<div class="line"><span class="lineno">  905</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9d9e92084d58808e9a52a80fa9d82092">ICsi</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9d9e92084d58808e9a52a80fa9d82092">ICsi</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  906</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3bfdfbc3022c8bc7f58ec9113275586f">IEta</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3bfdfbc3022c8bc7f58ec9113275586f">IEta</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  907</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3791d5150655979c702ff538e0c2d0a5">IZet</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3791d5150655979c702ff538e0c2d0a5">IZet</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  908</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#abbf9f36d259bcdf12c831721e70390ee">IAj</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#abbf9f36d259bcdf12c831721e70390ee">IAj</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  909</span> </div>
<div class="line"><span class="lineno">  910</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;ICsi&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  911</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;IEta&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  912</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;IZet&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  913</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;IAj&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  914</span> </div>
<div class="line"><span class="lineno">  915</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  916</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a3791d5150655979c702ff538e0c2d0a5"><div class="ttname"><a href="variables__old_8h.html#a3791d5150655979c702ff538e0c2d0a5">UserCtx::IZet</a></div><div class="ttdeci">Vec IZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3bfdfbc3022c8bc7f58ec9113275586f"><div class="ttname"><a href="variables__old_8h.html#a3bfdfbc3022c8bc7f58ec9113275586f">UserCtx::IEta</a></div><div class="ttdeci">Vec IEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a77888fe1930df923549faaf5951455ba"><div class="ttname"><a href="variables__old_8h.html#a77888fe1930df923549faaf5951455ba">UserCtx::Centx</a></div><div class="ttdeci">Vec Centx</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00626">variables.h:626</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9d9e92084d58808e9a52a80fa9d82092"><div class="ttname"><a href="variables__old_8h.html#a9d9e92084d58808e9a52a80fa9d82092">UserCtx::ICsi</a></div><div class="ttdeci">Vec ICsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_abbf9f36d259bcdf12c831721e70390ee"><div class="ttname"><a href="variables__old_8h.html#abbf9f36d259bcdf12c831721e70390ee">UserCtx::IAj</a></div><div class="ttdeci">Vec IAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_af935307ea3e9727a63b6ef9a3932caa8_cgraph.svg" width="568" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_af935307ea3e9727a63b6ef9a3932caa8_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4ecbe44ffb23d82193f9278ab61c1b47" name="a4ecbe44ffb23d82193f9278ab61c1b47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ecbe44ffb23d82193f9278ab61c1b47">&#9670;&#160;</a></span>ComputeJFaceMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeJFaceMetrics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes metrics centered on constant-j faces (j-faces). </p>
<p>This function calculates the metric terms (<code>JCsi</code>, <code>JEta</code>, <code>JZet</code>) and the inverse Jacobian (<code>JAj</code>) located at the geometric center of each constant-j face. This is a critical step for staggered-grid finite difference schemes.</p>
<p>The process is a direct and faithful refactoring of the corresponding logic from the legacy <code>FormMetrics</code> function:</p><ol type="1">
<li>It first calculates the physical (x,y,z) coordinates of the center of each i-face and stores them in the <code>user-&gt;Centy</code> vector.</li>
<li>It then uses a boundary-aware, second-order finite difference stencil on the <code>Centy</code> field to compute the derivatives (e.g., d(x)/d(csi)).<ul>
<li>Central differences are used in the grid interior.</li>
<li>One-sided differences are used at the physical domain boundaries.</li>
</ul>
</li>
<li>Finally, these derivatives are used to compute the final metric terms and the inverse Jacobian, which are stored in their respective <code>Vec</code> objects.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific grid level. This function populates the <code>user-&gt;JCsi</code>, <code>user-&gt;JEta</code>, <code>user-&gt;JZet</code>, and <code>user-&gt;JAj</code> vectors. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00942">942</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  943</span>{</div>
<div class="line"><span class="lineno">  944</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  945</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  946</span>    Vec            lCoords;</div>
<div class="line"><span class="lineno">  947</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coor;</div>
<div class="line"><span class="lineno">  948</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***centy; <span class="comment">//***gs;</span></div>
<div class="line"><span class="lineno">  949</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***centy_const;</div>
<div class="line"><span class="lineno">  950</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***jcsi, ***jeta, ***jzet;</div>
<div class="line"><span class="lineno">  951</span>    PetscScalar  ***jaj;</div>
<div class="line"><span class="lineno">  952</span>    PetscReal      dxdc, dydc, dzdc, dxde, dyde, dzde, dxdz, dydz, dzdz;</div>
<div class="line"><span class="lineno">  953</span> </div>
<div class="line"><span class="lineno">  954</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  955</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Rank %d: Computing j-face metrics for level %d block %d...\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  956</span> </div>
<div class="line"><span class="lineno">  957</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  958</span>    PetscInt xs = info.xs, xe = info.xs + info.xm, mx = info.mx;</div>
<div class="line"><span class="lineno">  959</span>    PetscInt ys = info.ys, ye = info.ys + info.ym, my = info.my;</div>
<div class="line"><span class="lineno">  960</span>    PetscInt zs = info.zs, ze = info.zs + info.zm, mz = info.mz;</div>
<div class="line"><span class="lineno">  961</span>    PetscInt gxs = info.gxs, gxe = info.gxs + info.gxm;</div>
<div class="line"><span class="lineno">  962</span>    PetscInt gys = info.gys, gye = info.gys + info.gym;</div>
<div class="line"><span class="lineno">  963</span>    PetscInt gzs = info.gzs, gze = info.gzs + info.gzm;</div>
<div class="line"><span class="lineno">  964</span>    </div>
<div class="line"><span class="lineno">  965</span>    PetscInt lxs = xs; PetscInt lxe = xe;</div>
<div class="line"><span class="lineno">  966</span>    PetscInt lys = ys; PetscInt lye = ye;</div>
<div class="line"><span class="lineno">  967</span>    PetscInt lzs = zs; PetscInt lze = ze;</div>
<div class="line"><span class="lineno">  968</span> </div>
<div class="line"><span class="lineno">  969</span>    <span class="keywordflow">if</span> (xs==0) lxs = xs+1;</div>
<div class="line"><span class="lineno">  970</span>    <span class="keywordflow">if</span> (ys==0) lys = ys+1;</div>
<div class="line"><span class="lineno">  971</span>    <span class="keywordflow">if</span> (zs==0) lzs = zs+1;</div>
<div class="line"><span class="lineno">  972</span> </div>
<div class="line"><span class="lineno">  973</span>    <span class="keywordflow">if</span> (xe==mx) lxe=xe-1;</div>
<div class="line"><span class="lineno">  974</span>    <span class="keywordflow">if</span> (ye==my) lye=ye-1;</div>
<div class="line"><span class="lineno">  975</span>    <span class="keywordflow">if</span> (ze==mz) lze=ze-1;</div>
<div class="line"><span class="lineno">  976</span> </div>
<div class="line"><span class="lineno">  977</span>    <span class="comment">// --- Part 1: Calculate the location of i-face centers (Centx) ---</span></div>
<div class="line"><span class="lineno">  978</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoords); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  979</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  980</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#addaea1781031d3f9ff945d87e8c5b728">Centy</a>, &amp;centy); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  981</span>    <span class="comment">//  ierr = DMDAVecGetArray(user-&gt;fda, user-&gt;lGridSpace,&amp;gs); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno">  982</span> </div>
<div class="line"><span class="lineno">  983</span>    <span class="comment">// Loop over the ghosted region to calculate all local face centers</span></div>
<div class="line"><span class="lineno">  984</span>    <span class="keywordflow">for</span> (PetscInt k = gzs + 1; k &lt; gze; k++) {</div>
<div class="line"><span class="lineno">  985</span>        <span class="keywordflow">for</span> (PetscInt j = gys; j &lt; gye; j++) {</div>
<div class="line"><span class="lineno">  986</span>            <span class="keywordflow">for</span> (PetscInt i = gxs + 1; i &lt; gxe; i++) {</div>
<div class="line"><span class="lineno">  987</span>                centy[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno">  988</span>                centy[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno">  989</span>                centy[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k-1][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  990</span>            }</div>
<div class="line"><span class="lineno">  991</span>        }</div>
<div class="line"><span class="lineno">  992</span>    }</div>
<div class="line"><span class="lineno">  993</span> </div>
<div class="line"><span class="lineno">  994</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  995</span><span class="comment">    if(ys==0){</span></div>
<div class="line"><span class="lineno">  996</span><span class="comment">      for(PetscInt k=gzs+1;k &lt; gze; k++){</span></div>
<div class="line"><span class="lineno">  997</span><span class="comment">    for(PetscInt i=gxs+1;j &lt; gxe; i++){</span></div>
<div class="line"><span class="lineno">  998</span><span class="comment">      PetscInt j=0; </span></div>
<div class="line"><span class="lineno">  999</span><span class="comment">      centy[k][j-1][i].x=centy[k][j][i].x;</span></div>
<div class="line"><span class="lineno"> 1000</span><span class="comment">      centy[k][j-1][i].y=centy[k][j][i].y-gs[k][j-2][i].y;</span></div>
<div class="line"><span class="lineno"> 1001</span><span class="comment">      centy[k][j-1][i].z=centy[k][j][i].z;</span></div>
<div class="line"><span class="lineno"> 1002</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1003</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno"> 1004</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1005</span><span class="comment">    if (ye==my){</span></div>
<div class="line"><span class="lineno"> 1006</span><span class="comment">      for(PetscInt k=gzs+1; k&lt;gze; k++) {</span></div>
<div class="line"><span class="lineno"> 1007</span><span class="comment">    for (PetscInt i=gxs+1; j&lt;gxe;i++) {</span></div>
<div class="line"><span class="lineno"> 1008</span><span class="comment">      PetscInt j=my-1; </span></div>
<div class="line"><span class="lineno"> 1009</span><span class="comment">      centy[k][j][i].x=centy[k][j-1][i].x</span></div>
<div class="line"><span class="lineno"> 1010</span><span class="comment">      centy[k][j][i].y=centy[k][j-1][i].y+gs[k][j+2][i].y;</span></div>
<div class="line"><span class="lineno"> 1011</span><span class="comment">      centy[k][j][i].z=centy[k][j-1][i].z;</span></div>
<div class="line"><span class="lineno"> 1012</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1013</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno"> 1014</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1015</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno"> 1016</span>    </div>
<div class="line"><span class="lineno"> 1017</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1018</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#addaea1781031d3f9ff945d87e8c5b728">Centy</a>, &amp;centy); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1019</span>    <span class="comment">// ierr = DMDAVecRestoreArray(user-&gt;fda, user-&gt;lGridSpace,&amp;gs); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno"> 1020</span> </div>
<div class="line"><span class="lineno"> 1021</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   j-face centers (Centx) calculated and ghosts updated.\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>);</div>
<div class="line"><span class="lineno"> 1022</span> </div>
<div class="line"><span class="lineno"> 1023</span>    <span class="comment">// --- Part 2: Calculate metrics using face-centered coordinates ---</span></div>
<div class="line"><span class="lineno"> 1024</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#addaea1781031d3f9ff945d87e8c5b728">Centy</a>, &amp;centy_const); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1025</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d160d8dbe2ebacbdf86c7c40edf6c68">JCsi</a>, &amp;jcsi); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1026</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a14137f3f169b2ebe384683ea9a8b7f6d">JEta</a>, &amp;jeta); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1027</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a733ad785db194e51ad86c1613844ba31">JZet</a>, &amp;jzet); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1028</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac07ad1cd425926ccddebaca19310d090">JAj</a>, &amp;jaj); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1029</span> </div>
<div class="line"><span class="lineno"> 1030</span>    <span class="comment">// Loop over the OWNED region where we will store the final metrics</span></div>
<div class="line"><span class="lineno"> 1031</span>    <span class="keywordflow">for</span> (PetscInt k=lzs; k&lt;lze; k++) {</div>
<div class="line"><span class="lineno"> 1032</span>        <span class="keywordflow">for</span> (PetscInt j=ys; j&lt;lye; j++) {</div>
<div class="line"><span class="lineno"> 1033</span>            <span class="keywordflow">for</span> (PetscInt i=lxs; i&lt;lxe; i++) {</div>
<div class="line"><span class="lineno"> 1034</span> </div>
<div class="line"><span class="lineno"> 1035</span>                <span class="comment">// --- Stencil Logic for d/dcsi (derivative in i-direction) ---</span></div>
<div class="line"><span class="lineno"> 1036</span>                <span class="keywordflow">if</span> (i == 1) { <span class="comment">// Forward difference at the domain&#39;s min-i boundary</span></div>
<div class="line"><span class="lineno"> 1037</span>                    dxdc = centy_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1038</span>                    dydc = centy_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1039</span>                    dzdc = centy_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1040</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == mx - 2) { <span class="comment">// Backward difference at the domain&#39;s max-i boundary</span></div>
<div class="line"><span class="lineno"> 1041</span>                    dxdc = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1042</span>                    dydc = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1043</span>                    dzdc = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1044</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference in the interior</span></div>
<div class="line"><span class="lineno"> 1045</span>                    dxdc = 0.5 * (centy_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1046</span>                    dydc = 0.5 * (centy_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1047</span>                    dzdc = 0.5 * (centy_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1048</span>                }</div>
<div class="line"><span class="lineno"> 1049</span> </div>
<div class="line"><span class="lineno"> 1050</span>                <span class="comment">// --- Stencil Logic for d/deta (derivative in j-direction) ---</span></div>
<div class="line"><span class="lineno"> 1051</span>                <span class="keywordflow">if</span> (j == 0) { <span class="comment">// Forward difference</span></div>
<div class="line"><span class="lineno"> 1052</span>                    dxde = centy_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1053</span>                    dyde = centy_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1054</span>                    dzde = centy_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1055</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j == my - 2) { <span class="comment">// Backward difference</span></div>
<div class="line"><span class="lineno"> 1056</span>                    dxde = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1057</span>                    dyde = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1058</span>                    dzde = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1059</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference</span></div>
<div class="line"><span class="lineno"> 1060</span>                    dxde = 0.5 * (centy_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1061</span>                    dyde = 0.5 * (centy_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1062</span>                    dzde = 0.5 * (centy_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1063</span>                }</div>
<div class="line"><span class="lineno"> 1064</span> </div>
<div class="line"><span class="lineno"> 1065</span>                <span class="comment">// --- Stencil Logic for d/dzeta (derivative in k-direction) ---</span></div>
<div class="line"><span class="lineno"> 1066</span>                <span class="keywordflow">if</span> (k == 1) { <span class="comment">// Forward difference</span></div>
<div class="line"><span class="lineno"> 1067</span>                    dxdz = centy_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1068</span>                    dydz = centy_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1069</span>                    dzdz = centy_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1070</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k == mz - 2) { <span class="comment">// Backward difference</span></div>
<div class="line"><span class="lineno"> 1071</span>                    dxdz = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1072</span>                    dydz = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1073</span>                    dzdz = centy_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1074</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference</span></div>
<div class="line"><span class="lineno"> 1075</span>                    dxdz = 0.5 * (centy_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centy_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1076</span>                    dydz = 0.5 * (centy_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centy_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1077</span>                    dzdz = 0.5 * (centy_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centy_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1078</span>                }</div>
<div class="line"><span class="lineno"> 1079</span> </div>
<div class="line"><span class="lineno"> 1080</span>                <span class="comment">// --- Metric calculations (identical to legacy FormMetrics) ---</span></div>
<div class="line"><span class="lineno"> 1081</span>                jcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dyde * dzdz - dzde * dydz;</div>
<div class="line"><span class="lineno"> 1082</span>                jcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxde * dzdz + dzde * dxdz;</div>
<div class="line"><span class="lineno"> 1083</span>                jcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxde * dydz - dyde * dxdz;</div>
<div class="line"><span class="lineno"> 1084</span> </div>
<div class="line"><span class="lineno"> 1085</span>                jeta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dydz * dzdc - dzdz * dydc;</div>
<div class="line"><span class="lineno"> 1086</span>                jeta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxdz * dzdc + dzdz * dxdc;</div>
<div class="line"><span class="lineno"> 1087</span>                jeta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxdz * dydc - dydz * dxdc;</div>
<div class="line"><span class="lineno"> 1088</span> </div>
<div class="line"><span class="lineno"> 1089</span>                jzet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dydc * dzde - dzdc * dyde;</div>
<div class="line"><span class="lineno"> 1090</span>                jzet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxdc * dzde + dzdc * dxde;</div>
<div class="line"><span class="lineno"> 1091</span>                jzet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxdc * dyde - dydc * dxde;</div>
<div class="line"><span class="lineno"> 1092</span> </div>
<div class="line"><span class="lineno"> 1093</span>                jaj[k][j][i] = dxdc * jcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + dydc * jcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + dzdc * jcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1094</span>                <span class="keywordflow">if</span> (PetscAbsScalar(jaj[k][j][i]) &gt; 1e-12) {</div>
<div class="line"><span class="lineno"> 1095</span>                    jaj[k][j][i] = 1.0 / jaj[k][j][i];</div>
<div class="line"><span class="lineno"> 1096</span>                }</div>
<div class="line"><span class="lineno"> 1097</span>            }</div>
<div class="line"><span class="lineno"> 1098</span>        }</div>
<div class="line"><span class="lineno"> 1099</span>    }</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#addaea1781031d3f9ff945d87e8c5b728">Centy</a>, &amp;centy_const); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1102</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d160d8dbe2ebacbdf86c7c40edf6c68">JCsi</a>, &amp;jcsi); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1103</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a14137f3f169b2ebe384683ea9a8b7f6d">JEta</a>, &amp;jeta); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1104</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a733ad785db194e51ad86c1613844ba31">JZet</a>, &amp;jzet); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1105</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac07ad1cd425926ccddebaca19310d090">JAj</a>, &amp;jaj); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1106</span>    </div>
<div class="line"><span class="lineno"> 1107</span>    <span class="comment">// --- Part 3: Assemble global vectors and update local ghosts ---</span></div>
<div class="line"><span class="lineno"> 1108</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d160d8dbe2ebacbdf86c7c40edf6c68">JCsi</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d160d8dbe2ebacbdf86c7c40edf6c68">JCsi</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1109</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a14137f3f169b2ebe384683ea9a8b7f6d">JEta</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a14137f3f169b2ebe384683ea9a8b7f6d">JEta</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1110</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a733ad785db194e51ad86c1613844ba31">JZet</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a733ad785db194e51ad86c1613844ba31">JZet</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1111</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac07ad1cd425926ccddebaca19310d090">JAj</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac07ad1cd425926ccddebaca19310d090">JAj</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1112</span> </div>
<div class="line"><span class="lineno"> 1113</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;JCsi&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1114</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;JEta&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1115</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;JZet&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1116</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;JAj&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1117</span> </div>
<div class="line"><span class="lineno"> 1118</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1119</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a0d160d8dbe2ebacbdf86c7c40edf6c68"><div class="ttname"><a href="variables__old_8h.html#a0d160d8dbe2ebacbdf86c7c40edf6c68">UserCtx::JCsi</a></div><div class="ttdeci">Vec JCsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a14137f3f169b2ebe384683ea9a8b7f6d"><div class="ttname"><a href="variables__old_8h.html#a14137f3f169b2ebe384683ea9a8b7f6d">UserCtx::JEta</a></div><div class="ttdeci">Vec JEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a733ad785db194e51ad86c1613844ba31"><div class="ttname"><a href="variables__old_8h.html#a733ad785db194e51ad86c1613844ba31">UserCtx::JZet</a></div><div class="ttdeci">Vec JZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac07ad1cd425926ccddebaca19310d090"><div class="ttname"><a href="variables__old_8h.html#ac07ad1cd425926ccddebaca19310d090">UserCtx::JAj</a></div><div class="ttdeci">Vec JAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_addaea1781031d3f9ff945d87e8c5b728"><div class="ttname"><a href="variables__old_8h.html#addaea1781031d3f9ff945d87e8c5b728">UserCtx::Centy</a></div><div class="ttdeci">Vec Centy</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00626">variables.h:626</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a4ecbe44ffb23d82193f9278ab61c1b47_cgraph.svg" width="568" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a4ecbe44ffb23d82193f9278ab61c1b47_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a95e22e5238b2cd02b992366766730687" name="a95e22e5238b2cd02b992366766730687"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95e22e5238b2cd02b992366766730687">&#9670;&#160;</a></span>ComputeKFaceMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeKFaceMetrics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes metrics centered on constant-k faces (k-faces). </p>
<p>This function calculates the metric terms (<code>KCsi</code>, <code>KEta</code>, <code>KZet</code>) and the inverse Jacobian (<code>KAj</code>) located at the geometric center of each constant-k face. This is a critical step for staggered-grid finite difference schemes.</p>
<p>The process is a direct and faithful refactoring of the corresponding logic from the legacy <code>FormMetrics</code> function:</p><ol type="1">
<li>It first calculates the physical (x,y,z) coordinates of the center of each i-face and stores them in the <code>user-&gt;Centz</code> vector.</li>
<li>It then uses a boundary-aware, second-order finite difference stencil on the <code>Centz</code> field to compute the derivatives (e.g., d(x)/d(csi)).<ul>
<li>Central differences are used in the grid interior.</li>
<li>One-sided differences are used at the physical domain boundaries.</li>
</ul>
</li>
<li>Finally, these derivatives are used to compute the final metric terms and the inverse Jacobian, which are stored in their respective <code>Vec</code> objects.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific grid level. This function populates the <code>user-&gt;KCsi</code>, <code>user-&gt;KEta</code>, <code>user-&gt;KZet</code>, and <code>user-&gt;KAj</code> vectors. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l01145">1145</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1146</span>{</div>
<div class="line"><span class="lineno"> 1147</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1148</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno"> 1149</span>    Vec            lCoords;</div>
<div class="line"><span class="lineno"> 1150</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coor;</div>
<div class="line"><span class="lineno"> 1151</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***centz; <span class="comment">//***gs;</span></div>
<div class="line"><span class="lineno"> 1152</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***centz_const;</div>
<div class="line"><span class="lineno"> 1153</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***kcsi, ***keta, ***kzet;</div>
<div class="line"><span class="lineno"> 1154</span>    PetscScalar  ***kaj;</div>
<div class="line"><span class="lineno"> 1155</span>    PetscReal      dxdc, dydc, dzdc, dxde, dyde, dzde, dxdz, dydz, dzdz;</div>
<div class="line"><span class="lineno"> 1156</span> </div>
<div class="line"><span class="lineno"> 1157</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1158</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Rank %d: Computing k-face metrics for level %d block %d...\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno"> 1159</span> </div>
<div class="line"><span class="lineno"> 1160</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1161</span>    PetscInt xs = info.xs, xe = info.xs + info.xm, mx = info.mx;</div>
<div class="line"><span class="lineno"> 1162</span>    PetscInt ys = info.ys, ye = info.ys + info.ym, my = info.my;</div>
<div class="line"><span class="lineno"> 1163</span>    PetscInt zs = info.zs, ze = info.zs + info.zm, mz = info.mz;</div>
<div class="line"><span class="lineno"> 1164</span>    PetscInt gxs = info.gxs, gxe = info.gxs + info.gxm;</div>
<div class="line"><span class="lineno"> 1165</span>    PetscInt gys = info.gys, gye = info.gys + info.gym;</div>
<div class="line"><span class="lineno"> 1166</span>    PetscInt gzs = info.gzs, gze = info.gzs + info.gzm;</div>
<div class="line"><span class="lineno"> 1167</span>    </div>
<div class="line"><span class="lineno"> 1168</span>    PetscInt lxs = xs; PetscInt lxe = xe;</div>
<div class="line"><span class="lineno"> 1169</span>    PetscInt lys = ys; PetscInt lye = ye;</div>
<div class="line"><span class="lineno"> 1170</span>    PetscInt lzs = zs; PetscInt lze = ze;</div>
<div class="line"><span class="lineno"> 1171</span> </div>
<div class="line"><span class="lineno"> 1172</span>    <span class="keywordflow">if</span> (xs==0) lxs = xs+1;</div>
<div class="line"><span class="lineno"> 1173</span>    <span class="keywordflow">if</span> (ys==0) lys = ys+1;</div>
<div class="line"><span class="lineno"> 1174</span>    <span class="keywordflow">if</span> (zs==0) lzs = zs+1;</div>
<div class="line"><span class="lineno"> 1175</span> </div>
<div class="line"><span class="lineno"> 1176</span>    <span class="keywordflow">if</span> (xe==mx) lxe=xe-1;</div>
<div class="line"><span class="lineno"> 1177</span>    <span class="keywordflow">if</span> (ye==my) lye=ye-1;</div>
<div class="line"><span class="lineno"> 1178</span>    <span class="keywordflow">if</span> (ze==mz) lze=ze-1;</div>
<div class="line"><span class="lineno"> 1179</span> </div>
<div class="line"><span class="lineno"> 1180</span>    <span class="comment">// --- Part 1: Calculate the location of i-face centers (Centx) ---</span></div>
<div class="line"><span class="lineno"> 1181</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoords); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1182</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1183</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3998b7b5dad8340caf395c5da62230b7">Centz</a>, &amp;centz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1184</span>    <span class="comment">//  ierr = DMDAVecGetArray(user-&gt;fda, user-&gt;lGridSpace,&amp;gs); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno"> 1185</span> </div>
<div class="line"><span class="lineno"> 1186</span>    <span class="comment">// Loop over the ghosted region to calculate all local face centers</span></div>
<div class="line"><span class="lineno"> 1187</span>    <span class="keywordflow">for</span> (PetscInt k = gzs; k &lt; gze; k++) {</div>
<div class="line"><span class="lineno"> 1188</span>        <span class="keywordflow">for</span> (PetscInt j = gys; j &lt; gye; j++) {</div>
<div class="line"><span class="lineno"> 1189</span>            <span class="keywordflow">for</span> (PetscInt i = gxs + 1; i &lt; gxe; i++) {</div>
<div class="line"><span class="lineno"> 1190</span>                centz[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1191</span>                centz[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1192</span>                centz[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = 0.25 * (coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + coor[k][j-1][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1193</span>            }</div>
<div class="line"><span class="lineno"> 1194</span>        }</div>
<div class="line"><span class="lineno"> 1195</span>    }</div>
<div class="line"><span class="lineno"> 1196</span> </div>
<div class="line"><span class="lineno"> 1197</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 1198</span><span class="comment">    if(zs==0){</span></div>
<div class="line"><span class="lineno"> 1199</span><span class="comment">      for(PetscInt j=gys+1;j &lt; gye; j++){</span></div>
<div class="line"><span class="lineno"> 1200</span><span class="comment">    for(PetscInt i=gxs+1;j &lt; gxe; i++){</span></div>
<div class="line"><span class="lineno"> 1201</span><span class="comment">      PetscInt k=0; </span></div>
<div class="line"><span class="lineno"> 1202</span><span class="comment">      centz[k-1][j][i].x=centz[k][j][i].x;</span></div>
<div class="line"><span class="lineno"> 1203</span><span class="comment">      centz[k-1][j][i].y=centz[k][j][i].y;</span></div>
<div class="line"><span class="lineno"> 1204</span><span class="comment">      centz[k-1][j][i].z=centz[k][j][i].z-gs[k-2][j][i].z;</span></div>
<div class="line"><span class="lineno"> 1205</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1206</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno"> 1207</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1208</span><span class="comment">    if (ze==mz){</span></div>
<div class="line"><span class="lineno"> 1209</span><span class="comment">      for(PetscInt j=gys+1; j&lt;gye; j++) {</span></div>
<div class="line"><span class="lineno"> 1210</span><span class="comment">    for (PetscInt i=gxs+1; j&lt;gxe;i++) {</span></div>
<div class="line"><span class="lineno"> 1211</span><span class="comment">      PetscInt k=mz-1; </span></div>
<div class="line"><span class="lineno"> 1212</span><span class="comment">      centy[k][j][i].x=centy[k-1][j][i].x</span></div>
<div class="line"><span class="lineno"> 1213</span><span class="comment">      centy[k][j][i].y=centy[k-1][j][i].y;</span></div>
<div class="line"><span class="lineno"> 1214</span><span class="comment">      centz[k][j][i].z=centz[k-1][j][i].z+gs[k+2][j][1].z;</span></div>
<div class="line"><span class="lineno"> 1215</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1216</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno"> 1217</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1218</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno"> 1219</span>    </div>
<div class="line"><span class="lineno"> 1220</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoords, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1221</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3998b7b5dad8340caf395c5da62230b7">Centz</a>, &amp;centz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1222</span>    <span class="comment">// ierr = DMDAVecRestoreArray(user-&gt;fda, user-&gt;lGridSpace,&amp;gs); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno"> 1223</span> </div>
<div class="line"><span class="lineno"> 1224</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   k-face centers (Centx) calculated and ghosts updated.\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>);</div>
<div class="line"><span class="lineno"> 1225</span> </div>
<div class="line"><span class="lineno"> 1226</span>    <span class="comment">// --- Part 2: Calculate metrics using face-centered coordinates ---</span></div>
<div class="line"><span class="lineno"> 1227</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3998b7b5dad8340caf395c5da62230b7">Centz</a>, &amp;centz_const); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1228</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ada60dbb4f918fda297a992a4228b1166">KCsi</a>, &amp;kcsi); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1229</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac29b95b05aa4bc3539389113c408d19e">KEta</a>, &amp;keta); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1230</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad6b708fb886f2f7b49f28d4466af5fa0">KZet</a>, &amp;kzet); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1231</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d51f086ccdc81656ddea875d523173e">KAj</a>, &amp;kaj); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1232</span> </div>
<div class="line"><span class="lineno"> 1233</span>    <span class="comment">// Loop over the OWNED region where we will store the final metrics</span></div>
<div class="line"><span class="lineno"> 1234</span>    <span class="keywordflow">for</span> (PetscInt k=zs; k&lt;lze; k++) {</div>
<div class="line"><span class="lineno"> 1235</span>        <span class="keywordflow">for</span> (PetscInt j=lys; j&lt;lye; j++) {</div>
<div class="line"><span class="lineno"> 1236</span>            <span class="keywordflow">for</span> (PetscInt i=lxs; i&lt;lxe; i++) {</div>
<div class="line"><span class="lineno"> 1237</span> </div>
<div class="line"><span class="lineno"> 1238</span>                <span class="comment">// --- Stencil Logic for d/dcsi (derivative in i-direction) ---</span></div>
<div class="line"><span class="lineno"> 1239</span>                <span class="keywordflow">if</span> (i == 1) { <span class="comment">// Forward difference at the domain&#39;s min-i boundary</span></div>
<div class="line"><span class="lineno"> 1240</span>                    dxdc = centz_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1241</span>                    dydc = centz_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1242</span>                    dzdc = centz_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1243</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == mx - 2) { <span class="comment">// Backward difference at the domain&#39;s max-i boundary</span></div>
<div class="line"><span class="lineno"> 1244</span>                    dxdc = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1245</span>                    dydc = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1246</span>                    dzdc = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1247</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference in the interior</span></div>
<div class="line"><span class="lineno"> 1248</span>                    dxdc = 0.5 * (centz_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1249</span>                    dydc = 0.5 * (centz_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1250</span>                    dzdc = 0.5 * (centz_const[k][j][i+1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1251</span>                }</div>
<div class="line"><span class="lineno"> 1252</span> </div>
<div class="line"><span class="lineno"> 1253</span>                <span class="comment">// --- Stencil Logic for d/deta (derivative in j-direction) ---</span></div>
<div class="line"><span class="lineno"> 1254</span>                <span class="keywordflow">if</span> (j == 1) { <span class="comment">// Forward difference</span></div>
<div class="line"><span class="lineno"> 1255</span>                    dxde = centz_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1256</span>                    dyde = centz_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1257</span>                    dzde = centz_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1258</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j == my - 2) { <span class="comment">// Backward difference</span></div>
<div class="line"><span class="lineno"> 1259</span>                    dxde = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1260</span>                    dyde = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1261</span>                    dzde = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1262</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference</span></div>
<div class="line"><span class="lineno"> 1263</span>                    dxde = 0.5 * (centz_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1264</span>                    dyde = 0.5 * (centz_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1265</span>                    dzde = 0.5 * (centz_const[k][j+1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1266</span>                }</div>
<div class="line"><span class="lineno"> 1267</span> </div>
<div class="line"><span class="lineno"> 1268</span>                <span class="comment">// --- Stencil Logic for d/dzeta (derivative in k-direction) ---</span></div>
<div class="line"><span class="lineno"> 1269</span>                <span class="keywordflow">if</span> (k == 0) { <span class="comment">// Forward difference</span></div>
<div class="line"><span class="lineno"> 1270</span>                    dxdz = centz_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1271</span>                    dydz = centz_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1272</span>                    dzdz = centz_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1273</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k == mz - 2) { <span class="comment">// Backward difference</span></div>
<div class="line"><span class="lineno"> 1274</span>                    dxdz = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno"> 1275</span>                    dydz = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno"> 1276</span>                    dzdz = centz_const[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1277</span>                } <span class="keywordflow">else</span> { <span class="comment">// Central difference</span></div>
<div class="line"><span class="lineno"> 1278</span>                    dxdz = 0.5 * (centz_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - centz_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1279</span>                    dydz = 0.5 * (centz_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - centz_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1280</span>                    dzdz = 0.5 * (centz_const[k+1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - centz_const[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1281</span>                }</div>
<div class="line"><span class="lineno"> 1282</span> </div>
<div class="line"><span class="lineno"> 1283</span>                <span class="comment">// --- Metric calculations (identical to legacy FormMetrics) ---</span></div>
<div class="line"><span class="lineno"> 1284</span>                kcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dyde * dzdz - dzde * dydz;</div>
<div class="line"><span class="lineno"> 1285</span>                kcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxde * dzdz + dzde * dxdz;</div>
<div class="line"><span class="lineno"> 1286</span>                kcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxde * dydz - dyde * dxdz;</div>
<div class="line"><span class="lineno"> 1287</span> </div>
<div class="line"><span class="lineno"> 1288</span>                keta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dydz * dzdc - dzdz * dydc;</div>
<div class="line"><span class="lineno"> 1289</span>                keta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxdz * dzdc + dzdz * dxdc;</div>
<div class="line"><span class="lineno"> 1290</span>                keta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxdz * dydc - dydz * dxdc;</div>
<div class="line"><span class="lineno"> 1291</span> </div>
<div class="line"><span class="lineno"> 1292</span>                kzet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = dydc * dzde - dzdc * dyde;</div>
<div class="line"><span class="lineno"> 1293</span>                kzet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = -dxdc * dzde + dzdc * dxde;</div>
<div class="line"><span class="lineno"> 1294</span>                kzet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = dxdc * dyde - dydc * dxde;</div>
<div class="line"><span class="lineno"> 1295</span> </div>
<div class="line"><span class="lineno"> 1296</span>                kaj[k][j][i] = dxdc * kcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + dydc * kcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + dzdc * kcsi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno"> 1297</span>                <span class="keywordflow">if</span> (PetscAbsScalar(kaj[k][j][i]) &gt; 1e-12) {</div>
<div class="line"><span class="lineno"> 1298</span>                    kaj[k][j][i] = 1.0 / kaj[k][j][i];</div>
<div class="line"><span class="lineno"> 1299</span>                }</div>
<div class="line"><span class="lineno"> 1300</span>            }</div>
<div class="line"><span class="lineno"> 1301</span>        }</div>
<div class="line"><span class="lineno"> 1302</span>    }</div>
<div class="line"><span class="lineno"> 1303</span> </div>
<div class="line"><span class="lineno"> 1304</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3998b7b5dad8340caf395c5da62230b7">Centz</a>, &amp;centz_const); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1305</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ada60dbb4f918fda297a992a4228b1166">KCsi</a>, &amp;kcsi); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1306</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac29b95b05aa4bc3539389113c408d19e">KEta</a>, &amp;keta); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1307</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad6b708fb886f2f7b49f28d4466af5fa0">KZet</a>, &amp;kzet); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1308</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d51f086ccdc81656ddea875d523173e">KAj</a>, &amp;kaj); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1309</span>    </div>
<div class="line"><span class="lineno"> 1310</span>    <span class="comment">// --- Part 3: Assemble global vectors and update local ghosts ---</span></div>
<div class="line"><span class="lineno"> 1311</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ada60dbb4f918fda297a992a4228b1166">KCsi</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ada60dbb4f918fda297a992a4228b1166">KCsi</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1312</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac29b95b05aa4bc3539389113c408d19e">KEta</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac29b95b05aa4bc3539389113c408d19e">KEta</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1313</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad6b708fb886f2f7b49f28d4466af5fa0">KZet</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad6b708fb886f2f7b49f28d4466af5fa0">KZet</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1314</span>    ierr = VecAssemblyBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d51f086ccdc81656ddea875d523173e">KAj</a>); CHKERRQ(ierr); ierr = VecAssemblyEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0d51f086ccdc81656ddea875d523173e">KAj</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1315</span> </div>
<div class="line"><span class="lineno"> 1316</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;KCsi&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1317</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;KEta&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1318</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;KZet&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1319</span>    ierr = <a class="code hl_function" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;KAj&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1320</span> </div>
<div class="line"><span class="lineno"> 1321</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1322</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a0d51f086ccdc81656ddea875d523173e"><div class="ttname"><a href="variables__old_8h.html#a0d51f086ccdc81656ddea875d523173e">UserCtx::KAj</a></div><div class="ttdeci">Vec KAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3998b7b5dad8340caf395c5da62230b7"><div class="ttname"><a href="variables__old_8h.html#a3998b7b5dad8340caf395c5da62230b7">UserCtx::Centz</a></div><div class="ttdeci">Vec Centz</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00626">variables.h:626</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac29b95b05aa4bc3539389113c408d19e"><div class="ttname"><a href="variables__old_8h.html#ac29b95b05aa4bc3539389113c408d19e">UserCtx::KEta</a></div><div class="ttdeci">Vec KEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad6b708fb886f2f7b49f28d4466af5fa0"><div class="ttname"><a href="variables__old_8h.html#ad6b708fb886f2f7b49f28d4466af5fa0">UserCtx::KZet</a></div><div class="ttdeci">Vec KZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ada60dbb4f918fda297a992a4228b1166"><div class="ttname"><a href="variables__old_8h.html#ada60dbb4f918fda297a992a4228b1166">UserCtx::KCsi</a></div><div class="ttdeci">Vec KCsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a95e22e5238b2cd02b992366766730687_cgraph.svg" width="572" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a95e22e5238b2cd02b992366766730687_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2a99180f2d9db426e1cf73771b795498" name="a2a99180f2d9db426e1cf73771b795498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a99180f2d9db426e1cf73771b795498">&#9670;&#160;</a></span>ComputeMetricNorms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeMetricNorms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the max-min values of the grid metrics. </p>
<p>This function serves as a diagnostic tool to assess the quality of the grid metrics. It calculates the bounds of the face metrics (Csi, Eta, Zet).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>, containing all necessary grid data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l01506">1506</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1507</span>{</div>
<div class="line"><span class="lineno"> 1508</span>  </div>
<div class="line"><span class="lineno"> 1509</span>  DMDALocalInfo info = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acd99423029a666652ee1f5bf573619bc">info</a>;</div>
<div class="line"><span class="lineno"> 1510</span>  PetscInt      xs = info.xs, xe = info.xs + info.xm;</div>
<div class="line"><span class="lineno"> 1511</span>  PetscInt      ys = info.ys, ye = info.ys + info.ym;</div>
<div class="line"><span class="lineno"> 1512</span>  PetscInt      zs = info.zs, ze = info.zs + info.zm;</div>
<div class="line"><span class="lineno"> 1513</span>  PetscInt      i, j, k;</div>
<div class="line"><span class="lineno"> 1514</span>  </div>
<div class="line"><span class="lineno"> 1515</span>  PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1516</span> </div>
<div class="line"><span class="lineno"> 1517</span>  PetscReal CsiMax, EtaMax, ZetMax;</div>
<div class="line"><span class="lineno"> 1518</span>  PetscReal ICsiMax, IEtaMax, IZetMax;</div>
<div class="line"><span class="lineno"> 1519</span>  PetscReal JCsiMax, JEtaMax, JZetMax;</div>
<div class="line"><span class="lineno"> 1520</span>  PetscReal KCsiMax, KEtaMax, KZetMax;</div>
<div class="line"><span class="lineno"> 1521</span>  PetscReal AjMax, IAjMax, JAjMax, KAjMax;</div>
<div class="line"><span class="lineno"> 1522</span> </div>
<div class="line"><span class="lineno"> 1523</span>  PetscInt CsiMaxArg, EtaMaxArg, ZetMaxArg;</div>
<div class="line"><span class="lineno"> 1524</span>  PetscInt ICsiMaxArg, IEtaMaxArg, IZetMaxArg;</div>
<div class="line"><span class="lineno"> 1525</span>  PetscInt JCsiMaxArg, JEtaMaxArg, JZetMaxArg;</div>
<div class="line"><span class="lineno"> 1526</span>  PetscInt KCsiMaxArg, KEtaMaxArg, KZetMaxArg;</div>
<div class="line"><span class="lineno"> 1527</span>  PetscInt AjMaxArg, IAjMaxArg, JAjMaxArg, KAjMaxArg;  </div>
<div class="line"><span class="lineno"> 1528</span> </div>
<div class="line"><span class="lineno"> 1529</span>  <span class="comment">// Max Values</span></div>
<div class="line"><span class="lineno"> 1530</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>,&amp;CsiMaxArg,&amp;CsiMax);</div>
<div class="line"><span class="lineno"> 1531</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>,&amp;EtaMaxArg,&amp;EtaMax);</div>
<div class="line"><span class="lineno"> 1532</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>,&amp;ZetMaxArg,&amp;ZetMax);</div>
<div class="line"><span class="lineno"> 1533</span> </div>
<div class="line"><span class="lineno"> 1534</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acbf784310453bd7aec02838cdef24a66">lICsi</a>,&amp;ICsiMaxArg,&amp;ICsiMax);</div>
<div class="line"><span class="lineno"> 1535</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a2276cb159119246bfadea1c234dee31b">lIEta</a>,&amp;IEtaMaxArg,&amp;IEtaMax);</div>
<div class="line"><span class="lineno"> 1536</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a2db602ea5fce7cec91f19f507f922a74">lIZet</a>,&amp;IZetMaxArg,&amp;IZetMax);</div>
<div class="line"><span class="lineno"> 1537</span> </div>
<div class="line"><span class="lineno"> 1538</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a63b70d5ad8338013a2888928d4106f63">lJCsi</a>,&amp;JCsiMaxArg,&amp;JCsiMax);</div>
<div class="line"><span class="lineno"> 1539</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a96938d329a797441f228ecddd8e8e607">lJEta</a>,&amp;JEtaMaxArg,&amp;JEtaMax);</div>
<div class="line"><span class="lineno"> 1540</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ab7a460d0a7eaa2d76d0b6267310c3184">lJZet</a>,&amp;JZetMaxArg,&amp;JZetMax);</div>
<div class="line"><span class="lineno"> 1541</span> </div>
<div class="line"><span class="lineno"> 1542</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa0f10efbfba88094aa07cee1cdb0baff">lKCsi</a>,&amp;KCsiMaxArg,&amp;KCsiMax);</div>
<div class="line"><span class="lineno"> 1543</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a508de73c1c5929cbee04a94091f2799e">lKEta</a>,&amp;KEtaMaxArg,&amp;KEtaMax);</div>
<div class="line"><span class="lineno"> 1544</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a8e6283b2989fae5d0a235baa570e929f">lKZet</a>,&amp;KZetMaxArg,&amp;KZetMax);</div>
<div class="line"><span class="lineno"> 1545</span> </div>
<div class="line"><span class="lineno"> 1546</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>,&amp;AjMaxArg,&amp;AjMax);</div>
<div class="line"><span class="lineno"> 1547</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4d561e219e8bc40951d121cce66d93ce">lIAj</a>,&amp;IAjMaxArg,&amp;IAjMax);</div>
<div class="line"><span class="lineno"> 1548</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae8527c7cba1c5764994053481722eb01">lJAj</a>,&amp;JAjMaxArg,&amp;JAjMax);</div>
<div class="line"><span class="lineno"> 1549</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aee8a3f32f3bdc0dda2f862651708c0f4">lKAj</a>,&amp;KAjMaxArg,&amp;KAjMax);</div>
<div class="line"><span class="lineno"> 1550</span> </div>
<div class="line"><span class="lineno"> 1551</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>,&amp;AjMaxArg,&amp;AjMax);</div>
<div class="line"><span class="lineno"> 1552</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4d561e219e8bc40951d121cce66d93ce">lIAj</a>,&amp;IAjMaxArg,&amp;IAjMax);</div>
<div class="line"><span class="lineno"> 1553</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae8527c7cba1c5764994053481722eb01">lJAj</a>,&amp;JAjMaxArg,&amp;JAjMax);</div>
<div class="line"><span class="lineno"> 1554</span>  VecMax(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aee8a3f32f3bdc0dda2f862651708c0f4">lKAj</a>,&amp;KAjMaxArg,&amp;KAjMax);</div>
<div class="line"><span class="lineno"> 1555</span> </div>
<div class="line"><span class="lineno"> 1556</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot; Metric Norms for MG level %d .\n&quot;</span>,user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>);</div>
<div class="line"><span class="lineno"> 1557</span>  </div>
<div class="line"><span class="lineno"> 1558</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Max Metric Values are: CsiMax = %le, EtaMax = %le, ZetMax = %le.\n&quot;</span>,CsiMax,EtaMax,ZetMax);</div>
<div class="line"><span class="lineno"> 1559</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Max Metric Values are: ICsiMax = %le, IEtaMax = %le, IZetMax = %le.\n&quot;</span>,ICsiMax,IEtaMax,IZetMax);</div>
<div class="line"><span class="lineno"> 1560</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Max Metric Values are: JCsiMax = %le, JEtaMax = %le, JZetMax = %le.\n&quot;</span>,JCsiMax,JEtaMax,JZetMax);</div>
<div class="line"><span class="lineno"> 1561</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Max Metric Values are: KCsiMax = %le, KEtaMax = %le, KZetMax = %le.\n&quot;</span>,KCsiMax,KEtaMax,KZetMax);</div>
<div class="line"><span class="lineno"> 1562</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Max Volumes(Inverse) are: Aj = %le, IAj = %le, JAj = %le, KAj = %le.\n&quot;</span>,AjMax,IAjMax,JAjMax,KAjMax);</div>
<div class="line"><span class="lineno"> 1563</span> </div>
<div class="line"><span class="lineno"> 1564</span>  <span class="keywordflow">for</span> (k=zs; k&lt;ze; k++) {</div>
<div class="line"><span class="lineno"> 1565</span>    <span class="keywordflow">for</span> (j=ys; j&lt;ye; j++) {</div>
<div class="line"><span class="lineno"> 1566</span>      <span class="keywordflow">for</span> (i=xs; i&lt;xe; i++) {</div>
<div class="line"><span class="lineno"> 1567</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == CsiMaxArg) {</div>
<div class="line"><span class="lineno"> 1568</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max Csi = %le is at [%d][%d][%d] \n&quot;</span>, CsiMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1569</span>    }</div>
<div class="line"><span class="lineno"> 1570</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == EtaMaxArg) {</div>
<div class="line"><span class="lineno"> 1571</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max Eta = %le is at [%d][%d][%d] \n&quot;</span>, EtaMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1572</span>    }</div>
<div class="line"><span class="lineno"> 1573</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == ZetMaxArg) {</div>
<div class="line"><span class="lineno"> 1574</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max Zet = %le is at [%d][%d][%d] \n&quot;</span>, ZetMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1575</span>    }</div>
<div class="line"><span class="lineno"> 1576</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == ICsiMaxArg) {</div>
<div class="line"><span class="lineno"> 1577</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max ICsi = %le is at [%d][%d][%d] \n&quot;</span>, ICsiMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1578</span>    }</div>
<div class="line"><span class="lineno"> 1579</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == IEtaMaxArg) {</div>
<div class="line"><span class="lineno"> 1580</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max IEta = %le is at [%d][%d][%d] \n&quot;</span>, IEtaMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1581</span>    }</div>
<div class="line"><span class="lineno"> 1582</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == IZetMaxArg) {</div>
<div class="line"><span class="lineno"> 1583</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max IZet = %le is at [%d][%d][%d] \n&quot;</span>, IZetMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1584</span>    }</div>
<div class="line"><span class="lineno"> 1585</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == JCsiMaxArg) {</div>
<div class="line"><span class="lineno"> 1586</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max JCsi = %le is at [%d][%d][%d] \n&quot;</span>, JCsiMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1587</span>    }</div>
<div class="line"><span class="lineno"> 1588</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == JEtaMaxArg) {</div>
<div class="line"><span class="lineno"> 1589</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max JEta = %le is at [%d][%d][%d] \n&quot;</span>, JEtaMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1590</span>    }</div>
<div class="line"><span class="lineno"> 1591</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == JZetMaxArg) {</div>
<div class="line"><span class="lineno"> 1592</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max JZet = %le is at [%d][%d][%d] \n&quot;</span>, JZetMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1593</span>    }</div>
<div class="line"><span class="lineno"> 1594</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == KCsiMaxArg) {</div>
<div class="line"><span class="lineno"> 1595</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max KCsi = %le is at [%d][%d][%d] \n&quot;</span>, KCsiMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1596</span>    }</div>
<div class="line"><span class="lineno"> 1597</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == KEtaMaxArg) {</div>
<div class="line"><span class="lineno"> 1598</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max KEta = %le is at [%d][%d][%d] \n&quot;</span>, KEtaMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1599</span>    }</div>
<div class="line"><span class="lineno"> 1600</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == KZetMaxArg) {</div>
<div class="line"><span class="lineno"> 1601</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max KZet = %le is at [%d][%d][%d] \n&quot;</span>, KZetMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1602</span>    }</div>
<div class="line"><span class="lineno"> 1603</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == AjMaxArg) {</div>
<div class="line"><span class="lineno"> 1604</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max Aj = %le is at [%d][%d][%d] \n&quot;</span>, AjMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1605</span>    }</div>
<div class="line"><span class="lineno"> 1606</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == IAjMaxArg) {</div>
<div class="line"><span class="lineno"> 1607</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max IAj = %le is at [%d][%d][%d] \n&quot;</span>, IAjMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1608</span>    }</div>
<div class="line"><span class="lineno"> 1609</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == JAjMaxArg) {</div>
<div class="line"><span class="lineno"> 1610</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max JAj = %le is at [%d][%d][%d] \n&quot;</span>, JAjMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1611</span>    }</div>
<div class="line"><span class="lineno"> 1612</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == KAjMaxArg) {</div>
<div class="line"><span class="lineno"> 1613</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Max KAj = %le is at [%d][%d][%d] \n&quot;</span>, KAjMax,k,j,i);</div>
<div class="line"><span class="lineno"> 1614</span>    }</div>
<div class="line"><span class="lineno"> 1615</span>      }</div>
<div class="line"><span class="lineno"> 1616</span>    }</div>
<div class="line"><span class="lineno"> 1617</span>  }</div>
<div class="line"><span class="lineno"> 1618</span> </div>
<div class="line"><span class="lineno"> 1619</span>  <span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 1620</span><span class="comment">  VecView(user-&gt;lCsi,PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno"> 1621</span><span class="comment">  VecView(user-&gt;lEta,PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno"> 1622</span><span class="comment">  VecView(user-&gt;lZet,PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno"> 1623</span><span class="comment">  */</span></div>
<div class="line"><span class="lineno"> 1624</span>  </div>
<div class="line"><span class="lineno"> 1625</span>  PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1626</span>}</div>
<div class="ttc" id="aMetric_8c_html_a3d538200fed5b9ee9d1ef391bb61036c"><div class="ttname"><a href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a></div><div class="ttdeci">static PetscInt Gidx(PetscInt i, PetscInt j, PetscInt k, UserCtx *user)</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l01387">Metric.c:1387</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a2276cb159119246bfadea1c234dee31b"><div class="ttname"><a href="variables__old_8h.html#a2276cb159119246bfadea1c234dee31b">UserCtx::lIEta</a></div><div class="ttdeci">Vec lIEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a2db602ea5fce7cec91f19f507f922a74"><div class="ttname"><a href="variables__old_8h.html#a2db602ea5fce7cec91f19f507f922a74">UserCtx::lIZet</a></div><div class="ttdeci">Vec lIZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a414751d7a391a78834cdce87b52a066f"><div class="ttname"><a href="variables__old_8h.html#a414751d7a391a78834cdce87b52a066f">UserCtx::lZet</a></div><div class="ttdeci">Vec lZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4d561e219e8bc40951d121cce66d93ce"><div class="ttname"><a href="variables__old_8h.html#a4d561e219e8bc40951d121cce66d93ce">UserCtx::lIAj</a></div><div class="ttdeci">Vec lIAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a508de73c1c5929cbee04a94091f2799e"><div class="ttname"><a href="variables__old_8h.html#a508de73c1c5929cbee04a94091f2799e">UserCtx::lKEta</a></div><div class="ttdeci">Vec lKEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a63b70d5ad8338013a2888928d4106f63"><div class="ttname"><a href="variables__old_8h.html#a63b70d5ad8338013a2888928d4106f63">UserCtx::lJCsi</a></div><div class="ttdeci">Vec lJCsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a8e6283b2989fae5d0a235baa570e929f"><div class="ttname"><a href="variables__old_8h.html#a8e6283b2989fae5d0a235baa570e929f">UserCtx::lKZet</a></div><div class="ttdeci">Vec lKZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a96938d329a797441f228ecddd8e8e607"><div class="ttname"><a href="variables__old_8h.html#a96938d329a797441f228ecddd8e8e607">UserCtx::lJEta</a></div><div class="ttdeci">Vec lJEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9693ebf5c9ea601d5ebaf6d24cc60721"><div class="ttname"><a href="variables__old_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">UserCtx::lCsi</a></div><div class="ttdeci">Vec lCsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aa0f10efbfba88094aa07cee1cdb0baff"><div class="ttname"><a href="variables__old_8h.html#aa0f10efbfba88094aa07cee1cdb0baff">UserCtx::lKCsi</a></div><div class="ttdeci">Vec lKCsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ab7a460d0a7eaa2d76d0b6267310c3184"><div class="ttname"><a href="variables__old_8h.html#ab7a460d0a7eaa2d76d0b6267310c3184">UserCtx::lJZet</a></div><div class="ttdeci">Vec lJZet</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_acb5123619f6844033498dbbd1f46b8d0"><div class="ttname"><a href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">UserCtx::lAj</a></div><div class="ttdeci">Vec lAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_acbf784310453bd7aec02838cdef24a66"><div class="ttname"><a href="variables__old_8h.html#acbf784310453bd7aec02838cdef24a66">UserCtx::lICsi</a></div><div class="ttdeci">Vec lICsi</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00627">variables.h:627</a></div></div>
<div class="ttc" id="avariables__old_8h_html_acd99423029a666652ee1f5bf573619bc"><div class="ttname"><a href="variables__old_8h.html#acd99423029a666652ee1f5bf573619bc">UserCtx::info</a></div><div class="ttdeci">DMDALocalInfo info</div><div class="ttdoc">Cached local grid info for the current rank.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00589">variables.h:589</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad4296b10d8eb7b065165582f5cc85897"><div class="ttname"><a href="variables__old_8h.html#ad4296b10d8eb7b065165582f5cc85897">UserCtx::lEta</a></div><div class="ttdeci">Vec lEta</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00625">variables.h:625</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ae8527c7cba1c5764994053481722eb01"><div class="ttname"><a href="variables__old_8h.html#ae8527c7cba1c5764994053481722eb01">UserCtx::lJAj</a></div><div class="ttdeci">Vec lJAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00628">variables.h:628</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aee8a3f32f3bdc0dda2f862651708c0f4"><div class="ttname"><a href="variables__old_8h.html#aee8a3f32f3bdc0dda2f862651708c0f4">UserCtx::lKAj</a></div><div class="ttdeci">Vec lKAj</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00629">variables.h:629</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a2a99180f2d9db426e1cf73771b795498_cgraph.svg" width="276" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a2a99180f2d9db426e1cf73771b795498_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a63e70e9aa6a59c320cb2b1af6bd0a7e6" name="a63e70e9aa6a59c320cb2b1af6bd0a7e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63e70e9aa6a59c320cb2b1af6bd0a7e6">&#9670;&#160;</a></span>ComputeMetricsDivergence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeMetricsDivergence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the divergence of the grid metrics and identifies the maximum value. </p>
<p>Performs a diagnostic check on the divergence of the face area metric vectors.</p>
<p>This function serves as a diagnostic tool to assess the quality of the grid metrics. It calculates the divergence of the face metrics (Csi, Eta, Zet) and scales it by the inverse of the cell Jacobian. The maximum divergence value is then located, and its grid coordinates are printed to the console, helping to pinpoint areas of potential grid quality issues.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>, containing all necessary grid data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l01416">1416</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1417</span>{</div>
<div class="line"><span class="lineno"> 1418</span>  DM            da = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, fda = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>;</div>
<div class="line"><span class="lineno"> 1419</span>  DMDALocalInfo info = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acd99423029a666652ee1f5bf573619bc">info</a>;</div>
<div class="line"><span class="lineno"> 1420</span>  PetscInt      xs = info.xs, xe = info.xs + info.xm;</div>
<div class="line"><span class="lineno"> 1421</span>  PetscInt      ys = info.ys, ye = info.ys + info.ym;</div>
<div class="line"><span class="lineno"> 1422</span>  PetscInt      zs = info.zs, ze = info.zs + info.zm;</div>
<div class="line"><span class="lineno"> 1423</span>  PetscInt      mx = info.mx, my = info.my, mz = info.mz;</div>
<div class="line"><span class="lineno"> 1424</span>  PetscInt      lxs, lys, lzs, lxe, lye, lze;</div>
<div class="line"><span class="lineno"> 1425</span>  PetscInt      i, j, k;</div>
<div class="line"><span class="lineno"> 1426</span>  Vec           Div;</div>
<div class="line"><span class="lineno"> 1427</span>  PetscReal     ***div, ***aj;</div>
<div class="line"><span class="lineno"> 1428</span>  <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>        ***csi, ***eta, ***zet;</div>
<div class="line"><span class="lineno"> 1429</span>  PetscReal     maxdiv;</div>
<div class="line"><span class="lineno"> 1430</span> </div>
<div class="line"><span class="lineno"> 1431</span>  PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1432</span> </div>
<div class="line"><span class="lineno"> 1433</span>  lxs = xs; lxe = xe;</div>
<div class="line"><span class="lineno"> 1434</span>  lys = ys; lye = ye;</div>
<div class="line"><span class="lineno"> 1435</span>  lzs = zs; lze = ze;</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>  <span class="keywordflow">if</span> (xs == 0) lxs = xs + 1;</div>
<div class="line"><span class="lineno"> 1438</span>  <span class="keywordflow">if</span> (ys == 0) lys = ys + 1;</div>
<div class="line"><span class="lineno"> 1439</span>  <span class="keywordflow">if</span> (zs == 0) lzs = zs + 1;</div>
<div class="line"><span class="lineno"> 1440</span> </div>
<div class="line"><span class="lineno"> 1441</span>  <span class="keywordflow">if</span> (xe == mx) lxe = xe - 1;</div>
<div class="line"><span class="lineno"> 1442</span>  <span class="keywordflow">if</span> (ye == my) lye = ye - 1;</div>
<div class="line"><span class="lineno"> 1443</span>  <span class="keywordflow">if</span> (ze == mz) lze = ze - 1;</div>
<div class="line"><span class="lineno"> 1444</span> </div>
<div class="line"><span class="lineno"> 1445</span>  DMDAVecGetArray(fda, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>, &amp;csi);</div>
<div class="line"><span class="lineno"> 1446</span>  DMDAVecGetArray(fda, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>, &amp;eta);</div>
<div class="line"><span class="lineno"> 1447</span>  DMDAVecGetArray(fda, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>, &amp;zet);</div>
<div class="line"><span class="lineno"> 1448</span>  DMDAVecGetArray(da, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>, &amp;aj);</div>
<div class="line"><span class="lineno"> 1449</span> </div>
<div class="line"><span class="lineno"> 1450</span>  VecDuplicate(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5a73aa2bc6be44bc1ff8847cf0a1b6af">P</a>, &amp;Div);</div>
<div class="line"><span class="lineno"> 1451</span>  VecSet(Div, 0.);</div>
<div class="line"><span class="lineno"> 1452</span>  DMDAVecGetArray(da, Div, &amp;div);</div>
<div class="line"><span class="lineno"> 1453</span> </div>
<div class="line"><span class="lineno"> 1454</span>  <span class="keywordflow">for</span> (k = lzs; k &lt; lze; k++) {</div>
<div class="line"><span class="lineno"> 1455</span>    <span class="keywordflow">for</span> (j = lys; j &lt; lye; j++) {</div>
<div class="line"><span class="lineno"> 1456</span>      <span class="keywordflow">for</span> (i = lxs; i &lt; lxe; i++) {</div>
<div class="line"><span class="lineno"> 1457</span>        PetscReal divergence = (csi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - csi[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> +</div>
<div class="line"><span class="lineno"> 1458</span>                                eta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - eta[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> +</div>
<div class="line"><span class="lineno"> 1459</span>                                zet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - zet[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> +</div>
<div class="line"><span class="lineno"> 1460</span>                                csi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - csi[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> +</div>
<div class="line"><span class="lineno"> 1461</span>                                eta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - eta[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> +</div>
<div class="line"><span class="lineno"> 1462</span>                                zet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - zet[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> +</div>
<div class="line"><span class="lineno"> 1463</span>                                csi[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - csi[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> +</div>
<div class="line"><span class="lineno"> 1464</span>                                eta[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - eta[k][j-1][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> +</div>
<div class="line"><span class="lineno"> 1465</span>                                zet[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - zet[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) * aj[k][j][i];</div>
<div class="line"><span class="lineno"> 1466</span>        div[k][j][i] = fabs(divergence);</div>
<div class="line"><span class="lineno"> 1467</span>      }</div>
<div class="line"><span class="lineno"> 1468</span>    }</div>
<div class="line"><span class="lineno"> 1469</span>  }</div>
<div class="line"><span class="lineno"> 1470</span> </div>
<div class="line"><span class="lineno"> 1471</span>  DMDAVecRestoreArray(da, Div, &amp;div);</div>
<div class="line"><span class="lineno"> 1472</span> </div>
<div class="line"><span class="lineno"> 1473</span>  PetscReal MaxFlatIndex;</div>
<div class="line"><span class="lineno"> 1474</span>  VecMax(Div, &amp;MaxFlatIndex, &amp;maxdiv);</div>
<div class="line"><span class="lineno"> 1475</span>  <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Maximum Metric Divergence is %e at flat index %d.\n&quot;</span>,maxdiv,MaxFlatIndex);</div>
<div class="line"><span class="lineno"> 1476</span> </div>
<div class="line"><span class="lineno"> 1477</span>  <span class="keywordflow">for</span> (k=zs; k&lt;ze; k++) {</div>
<div class="line"><span class="lineno"> 1478</span>    <span class="keywordflow">for</span> (j=ys; j&lt;ye; j++) {</div>
<div class="line"><span class="lineno"> 1479</span>      <span class="keywordflow">for</span> (i=xs; i&lt;xe; i++) {</div>
<div class="line"><span class="lineno"> 1480</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="Metric_8c.html#a3d538200fed5b9ee9d1ef391bb61036c">Gidx</a>(i,j,k,user) == MaxFlatIndex) {</div>
<div class="line"><span class="lineno"> 1481</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;The Maximum Metric Divergence(%e) is at location [%d][%d][%d]. \n&quot;</span>, maxdiv,k,j,i);</div>
<div class="line"><span class="lineno"> 1482</span>    }</div>
<div class="line"><span class="lineno"> 1483</span>      }</div>
<div class="line"><span class="lineno"> 1484</span>    }</div>
<div class="line"><span class="lineno"> 1485</span>  }</div>
<div class="line"><span class="lineno"> 1486</span> </div>
<div class="line"><span class="lineno"> 1487</span>  </div>
<div class="line"><span class="lineno"> 1488</span>  DMDAVecRestoreArray(fda, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>, &amp;csi);</div>
<div class="line"><span class="lineno"> 1489</span>  DMDAVecRestoreArray(fda, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>, &amp;eta);</div>
<div class="line"><span class="lineno"> 1490</span>  DMDAVecRestoreArray(fda, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>, &amp;zet);</div>
<div class="line"><span class="lineno"> 1491</span>  DMDAVecRestoreArray(da, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>, &amp;aj);</div>
<div class="line"><span class="lineno"> 1492</span>  VecDestroy(&amp;Div);</div>
<div class="line"><span class="lineno"> 1493</span> </div>
<div class="line"><span class="lineno"> 1494</span>  PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1495</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a5a73aa2bc6be44bc1ff8847cf0a1b6af"><div class="ttname"><a href="variables__old_8h.html#a5a73aa2bc6be44bc1ff8847cf0a1b6af">UserCtx::P</a></div><div class="ttdeci">Vec P</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00609">variables.h:609</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a63e70e9aa6a59c320cb2b1af6bd0a7e6_cgraph.svg" width="314" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a63e70e9aa6a59c320cb2b1af6bd0a7e6_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a3d538200fed5b9ee9d1ef391bb61036c" name="a3d538200fed5b9ee9d1ef391bb61036c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d538200fed5b9ee9d1ef391bb61036c">&#9670;&#160;</a></span>Gidx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscInt Gidx </td>
          <td>(</td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l01387">1387</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1389</span>{</div>
<div class="line"><span class="lineno"> 1390</span>  PetscInt nidx;</div>
<div class="line"><span class="lineno"> 1391</span>  DMDALocalInfo info = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acd99423029a666652ee1f5bf573619bc">info</a>;</div>
<div class="line"><span class="lineno"> 1392</span> </div>
<div class="line"><span class="lineno"> 1393</span>  PetscInt  mx = info.mx, my = info.my;</div>
<div class="line"><span class="lineno"> 1394</span>  </div>
<div class="line"><span class="lineno"> 1395</span>  AO ao;</div>
<div class="line"><span class="lineno"> 1396</span>  DMDAGetAO(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;ao);</div>
<div class="line"><span class="lineno"> 1397</span>  nidx=i+j*mx+k*mx*my;</div>
<div class="line"><span class="lineno"> 1398</span>  </div>
<div class="line"><span class="lineno"> 1399</span>  AOApplicationToPetsc(ao,1,&amp;nidx);</div>
<div class="line"><span class="lineno"> 1400</span>  </div>
<div class="line"><span class="lineno"> 1401</span>  <span class="keywordflow">return</span> (nidx);</div>
<div class="line"><span class="lineno"> 1402</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a3d538200fed5b9ee9d1ef391bb61036c_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4859ff8031c003e036eab9cf8fb351f6" name="a4859ff8031c003e036eab9cf8fb351f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4859ff8031c003e036eab9cf8fb351f6">&#9670;&#160;</a></span>MetricGetCellVertices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode MetricGetCellVertices </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>V</em>[8]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extract the eight vertex coordinates of the hexahedral cell (i,j,k). </p>
<p>Vertices are returned in the standard trilinear ordering: bit 0 → x-corner, bit 1 → y-corner, bit 2 → z-corner. (000 = origin of the cell, 111 = far corner.) </p>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00024">24</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   28</span>{</div>
<div class="line"><span class="lineno">   29</span>  PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">   30</span>  <span class="keywordflow">for</span> (PetscInt c = 0; c &lt; 8; ++c) {</div>
<div class="line"><span class="lineno">   31</span>    PetscInt ii = i + ((c &amp; 1) ? 1 : 0);</div>
<div class="line"><span class="lineno">   32</span>    PetscInt jj = j + ((c &amp; 2) ? 1 : 0);</div>
<div class="line"><span class="lineno">   33</span>    PetscInt kk = k + ((c &amp; 4) ? 1 : 0);</div>
<div class="line"><span class="lineno">   34</span>    <a class="code hl_define" href="logging_8h.html#a1543cd95db1569c7d901fd4b9a3a43d7">LOG_LOOP_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,i+j+k,10,<span class="stringliteral">&quot; ii: %d,jj:%d,kk:%d - Retrieved.\n&quot;</span>,ii,jj,kk);</div>
<div class="line"><span class="lineno">   35</span>    V[c] = X[kk][jj][ii];</div>
<div class="line"><span class="lineno">   36</span>  }</div>
<div class="line"><span class="lineno">   37</span>  PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">   38</span>}</div>
<div class="ttc" id="alogging_8h_html_a1543cd95db1569c7d901fd4b9a3a43d7"><div class="ttname"><a href="logging_8h.html#a1543cd95db1569c7d901fd4b9a3a43d7">LOG_LOOP_ALLOW</a></div><div class="ttdeci">#define LOG_LOOP_ALLOW(scope, level, iterVar, interval, fmt,...)</div><div class="ttdoc">Logs a message inside a loop, but only every interval iterations.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00319">logging.h:319</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a4859ff8031c003e036eab9cf8fb351f6_icgraph.svg" width="100%" height="391"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2045892adba1ae192c7f9840cc1bf732" name="a2045892adba1ae192c7f9840cc1bf732"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2045892adba1ae192c7f9840cc1bf732">&#9670;&#160;</a></span>MetricJacobian()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode MetricJacobian </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>xi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>eta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>zta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>J</em>[3][3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>detJ</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute Jacobian matrix and its determinant at (xi,eta,zta). </p>
<pre class="fragment">   J = [ x_ξ  x_η  x_ζ ]
       [ y_ξ  y_η  y_ζ ]
       [ z_ξ  z_η  z_ζ ]
</pre><p> This is handy for converting physical velocities (u,v,w) into contravariant components and for volume weighting. </p>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00093">93</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   98</span>{</div>
<div class="line"><span class="lineno">   99</span>  PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  100</span>  <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> V[8];</div>
<div class="line"><span class="lineno">  101</span>  PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  102</span>  ierr = <a class="code hl_function" href="Metric_8c.html#a4859ff8031c003e036eab9cf8fb351f6">MetricGetCellVertices</a>(user,X,i,j,k,V); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>  <span class="comment">/* derivatives of trilinear shape functions */</span></div>
<div class="line"><span class="lineno">  105</span>  PetscReal dN_dXi[8], dN_dEta[8], dN_dZta[8];</div>
<div class="line"><span class="lineno">  106</span>  <span class="keywordflow">for</span> (PetscInt c=0;c&lt;8;++c) {</div>
<div class="line"><span class="lineno">  107</span>    PetscReal sx = (c &amp; 1) ?  1.0 : -1.0;</div>
<div class="line"><span class="lineno">  108</span>    PetscReal sy = (c &amp; 2) ?  1.0 : -1.0;</div>
<div class="line"><span class="lineno">  109</span>    PetscReal sz = (c &amp; 4) ?  1.0 : -1.0;</div>
<div class="line"><span class="lineno">  110</span>    dN_dXi [c] = 0.125 * sx * ( (c&amp;2?eta:1-eta) ) * ( (c&amp;4?zta:1-zta) );</div>
<div class="line"><span class="lineno">  111</span>    dN_dEta[c] = 0.125 * sy * ( (c&amp;1?xi :1-xi ) ) * ( (c&amp;4?zta:1-zta) );</div>
<div class="line"><span class="lineno">  112</span>    dN_dZta[c] = 0.125 * sz * ( (c&amp;1?xi :1-xi ) ) * ( (c&amp;2?eta:1-eta) );</div>
<div class="line"><span class="lineno">  113</span>  }</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>  <span class="comment">/* assemble Jacobian */</span></div>
<div class="line"><span class="lineno">  116</span>  PetscReal x_xi=0,y_xi=0,z_xi=0,</div>
<div class="line"><span class="lineno">  117</span>            x_eta=0,y_eta=0,z_eta=0,</div>
<div class="line"><span class="lineno">  118</span>            x_zta=0,y_zta=0,z_zta=0;</div>
<div class="line"><span class="lineno">  119</span>  <span class="keywordflow">for</span> (PetscInt c=0;c&lt;8;++c) {</div>
<div class="line"><span class="lineno">  120</span>    x_xi  += dN_dXi [c]*V[c].x;  y_xi  += dN_dXi [c]*V[c].y;  z_xi  += dN_dXi [c]*V[c].z;</div>
<div class="line"><span class="lineno">  121</span>    x_eta += dN_dEta[c]*V[c].x;  y_eta += dN_dEta[c]*V[c].y;  z_eta += dN_dEta[c]*V[c].z;</div>
<div class="line"><span class="lineno">  122</span>    x_zta += dN_dZta[c]*V[c].x;  y_zta += dN_dZta[c]*V[c].y;  z_zta += dN_dZta[c]*V[c].z;</div>
<div class="line"><span class="lineno">  123</span>  }</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>  J[0][0]=x_xi;  J[0][1]=x_eta;  J[0][2]=x_zta;</div>
<div class="line"><span class="lineno">  126</span>  J[1][0]=y_xi;  J[1][1]=y_eta;  J[1][2]=y_zta;</div>
<div class="line"><span class="lineno">  127</span>  J[2][0]=z_xi;  J[2][1]=z_eta;  J[2][2]=z_zta;</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>  <span class="keywordflow">if</span> (detJ) {</div>
<div class="line"><span class="lineno">  130</span>    *detJ = x_xi*(y_eta*z_zta - y_zta*z_eta)</div>
<div class="line"><span class="lineno">  131</span>          - x_eta*(y_xi*z_zta - y_zta*z_xi)</div>
<div class="line"><span class="lineno">  132</span>          + x_zta*(y_xi*z_eta - y_eta*z_xi);</div>
<div class="line"><span class="lineno">  133</span>  }</div>
<div class="line"><span class="lineno">  134</span>  PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  135</span>}</div>
<div class="ttc" id="aMetric_8c_html_a4859ff8031c003e036eab9cf8fb351f6"><div class="ttname"><a href="Metric_8c.html#a4859ff8031c003e036eab9cf8fb351f6">MetricGetCellVertices</a></div><div class="ttdeci">PetscErrorCode MetricGetCellVertices(UserCtx *user, const Cmpnts ***X, PetscInt i, PetscInt j, PetscInt k, Cmpnts V[8])</div><div class="ttdoc">Extract the eight vertex coordinates of the hexahedral cell (i,j,k).</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00024">Metric.c:24</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_a2045892adba1ae192c7f9840cc1bf732_cgraph.svg" width="340" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af0ba1966641e609476ac6fc3d5cdbbfc" name="af0ba1966641e609476ac6fc3d5cdbbfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0ba1966641e609476ac6fc3d5cdbbfc">&#9670;&#160;</a></span>MetricLogicalToPhysical()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode MetricLogicalToPhysical </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>xi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>eta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>zta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> *&#160;</td>
          <td class="paramname"><em>Xp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Public wrapper: map (cell index, ξ,η,ζ) to (x,y,z). </p>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00068">68</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   73</span>{</div>
<div class="line"><span class="lineno">   74</span>  PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">   75</span>  <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> V[8];</div>
<div class="line"><span class="lineno">   76</span>  PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">   77</span>  ierr = <a class="code hl_function" href="Metric_8c.html#a4859ff8031c003e036eab9cf8fb351f6">MetricGetCellVertices</a>(user,X,i,j,k,V); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   78</span>  <a class="code hl_function" href="Metric_8c.html#a379d85074cc67dd1230cecc94b9169aa">TrilinearBlend</a>(V,xi,eta,zta,Xp);</div>
<div class="line"><span class="lineno">   79</span>  PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">   80</span>}</div>
<div class="ttc" id="aMetric_8c_html_a379d85074cc67dd1230cecc94b9169aa"><div class="ttname"><a href="Metric_8c.html#a379d85074cc67dd1230cecc94b9169aa">TrilinearBlend</a></div><div class="ttdeci">static void TrilinearBlend(const Cmpnts V[8], PetscReal xi, PetscReal eta, PetscReal zta, Cmpnts *Xp)</div><div class="ttdoc">Map logical coordinates to physical space using trilinear basis.</div><div class="ttdef"><b>Definition</b> <a href="Metric_8c_source.html#l00048">Metric.c:48</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Metric_8c_af0ba1966641e609476ac6fc3d5cdbbfc_cgraph.svg" width="399" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_af0ba1966641e609476ac6fc3d5cdbbfc_icgraph.svg" width="100%" height="381"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a977092b5174c0b36bc8affc6d96537fc" name="a977092b5174c0b36bc8affc6d96537fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a977092b5174c0b36bc8affc6d96537fc">&#9670;&#160;</a></span>MetricsDivergence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode MetricsDivergence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a diagnostic check on the divergence of the face area metric vectors. </p>
<p>For a closed cell, the sum of the face area vectors should be zero (Gauss's divergence theorem). This function computes a measure of this divergence and reports the maximum value over the domain. A small value indicates a well-formed grid. This is a direct adaptation of the legacy function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific grid level (typically the finest). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l01337">1337</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1338</span>{</div>
<div class="line"><span class="lineno"> 1339</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1340</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno"> 1341</span>    Vec            Div;</div>
<div class="line"><span class="lineno"> 1342</span>    PetscReal    ***div_arr;</div>
<div class="line"><span class="lineno"> 1343</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***csi_arr, ***eta_arr, ***zet_arr;</div>
<div class="line"><span class="lineno"> 1344</span>    <span class="keyword">const</span> PetscScalar ***aj_arr;</div>
<div class="line"><span class="lineno"> 1345</span>    PetscReal      maxdiv;</div>
<div class="line"><span class="lineno"> 1346</span>    PetscInt       max_idx;</div>
<div class="line"><span class="lineno"> 1347</span> </div>
<div class="line"><span class="lineno"> 1348</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1349</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Rank %d: Performing metric divergence check for level %d block %d...\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno"> 1350</span> </div>
<div class="line"><span class="lineno"> 1351</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1352</span> </div>
<div class="line"><span class="lineno"> 1353</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>, &amp;csi_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1354</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>, &amp;eta_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1355</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>, &amp;zet_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1356</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>, &amp;aj_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1357</span>    </div>
<div class="line"><span class="lineno"> 1358</span>    ierr = VecDuplicate(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5a73aa2bc6be44bc1ff8847cf0a1b6af">P</a>, &amp;Div); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1359</span>    ierr = VecSet(Div, 0.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1360</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, Div, &amp;div_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1361</span>    </div>
<div class="line"><span class="lineno"> 1362</span>    <span class="comment">// Loop over the interior OWNED cells</span></div>
<div class="line"><span class="lineno"> 1363</span>    <span class="keywordflow">for</span> (PetscInt k=info.xs+1; k&lt;info.xs+info.xm; k++) {</div>
<div class="line"><span class="lineno"> 1364</span>        <span class="keywordflow">for</span> (PetscInt j=info.ys+1; j&lt;info.ys+info.ym; j++) {</div>
<div class="line"><span class="lineno"> 1365</span>            <span class="keywordflow">for</span> (PetscInt i=info.xs+1; i&lt;info.xs+info.xm; i++) {</div>
<div class="line"><span class="lineno"> 1366</span>                PetscReal div_x = (csi_arr[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - csi_arr[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) + (eta_arr[k][j][i].x - eta_arr[k][j-1][i].x) + (zet_arr[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - zet_arr[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><span class="lineno"> 1367</span>                PetscReal div_y = (csi_arr[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - csi_arr[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) + (eta_arr[k][j][i].y - eta_arr[k][j-1][i].y) + (zet_arr[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - zet_arr[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><span class="lineno"> 1368</span>                PetscReal div_z = (csi_arr[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - csi_arr[k][j][i-1].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) + (eta_arr[k][j][i].z - eta_arr[k][j-1][i].z) + (zet_arr[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - zet_arr[k-1][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1369</span>                div_arr[k][j][i] = PetscAbsScalar((div_x + div_y + div_z) * aj_arr[k][j][i]);</div>
<div class="line"><span class="lineno"> 1370</span>            }</div>
<div class="line"><span class="lineno"> 1371</span>        }</div>
<div class="line"><span class="lineno"> 1372</span>    }</div>
<div class="line"><span class="lineno"> 1373</span> </div>
<div class="line"><span class="lineno"> 1374</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, Div, &amp;div_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1375</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>, &amp;csi_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1376</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>, &amp;eta_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1377</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>, &amp;zet_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1378</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>, &amp;aj_arr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1379</span>    </div>
<div class="line"><span class="lineno"> 1380</span>    ierr = VecMax(Div, &amp;max_idx, &amp;maxdiv); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1381</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Maximum metric divergence: %e\n&quot;</span>, maxdiv);</div>
<div class="line"><span class="lineno"> 1382</span> </div>
<div class="line"><span class="lineno"> 1383</span>    ierr = VecDestroy(&amp;Div); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1384</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1385</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="afe7cd3c05be46557a8c2ea579eda0baf" name="afe7cd3c05be46557a8c2ea579eda0baf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe7cd3c05be46557a8c2ea579eda0baf">&#9670;&#160;</a></span>MetricVelocityContravariant()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode MetricVelocityContravariant </td>
          <td>(</td>
          <td class="paramtype">const PetscReal&#160;</td>
          <td class="paramname"><em>J</em>[3][3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>detJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscReal&#160;</td>
          <td class="paramname"><em>u</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>uc</em>[3]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert physical velocity (u,v,w) to contravariant components (u^xi, u^eta, u^zta). </p>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00141">141</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  143</span>{</div>
<div class="line"><span class="lineno">  144</span>  PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  145</span>  <span class="comment">/* contravariant basis vectors (row of adjugate(J)) divided by detJ */</span></div>
<div class="line"><span class="lineno">  146</span>  PetscReal gxi[3]  = {  J[1][1]*J[2][2]-J[1][2]*J[2][1],</div>
<div class="line"><span class="lineno">  147</span>                        -J[0][1]*J[2][2]+J[0][2]*J[2][1],</div>
<div class="line"><span class="lineno">  148</span>                         J[0][1]*J[1][2]-J[0][2]*J[1][1] };</div>
<div class="line"><span class="lineno">  149</span>  PetscReal geta[3] = { -J[1][0]*J[2][2]+J[1][2]*J[2][0],</div>
<div class="line"><span class="lineno">  150</span>                         J[0][0]*J[2][2]-J[0][2]*J[2][0],</div>
<div class="line"><span class="lineno">  151</span>                        -J[0][0]*J[1][2]+J[0][2]*J[1][0] };</div>
<div class="line"><span class="lineno">  152</span>  PetscReal gzta[3] = {  J[1][0]*J[2][1]-J[1][1]*J[2][0],</div>
<div class="line"><span class="lineno">  153</span>                        -J[0][0]*J[2][1]+J[0][1]*J[2][0],</div>
<div class="line"><span class="lineno">  154</span>                         J[0][0]*J[1][1]-J[0][1]*J[1][0] };</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>  PetscReal invDet = 1.0 / detJ;</div>
<div class="line"><span class="lineno">  157</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=0; d&lt;3; ++d) { gxi[d]  *= invDet; geta[d] *= invDet; gzta[d] *= invDet; }</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>  uc[0] = gxi [0]*u[0] + gxi [1]*u[1] + gxi [2]*u[2];</div>
<div class="line"><span class="lineno">  160</span>  uc[1] = geta[0]*u[0] + geta[1]*u[1] + geta[2]*u[2];</div>
<div class="line"><span class="lineno">  161</span>  uc[2] = gzta[0]*u[0] + gzta[1]*u[1] + gzta[2]*u[2];</div>
<div class="line"><span class="lineno">  162</span>  PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  163</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a379d85074cc67dd1230cecc94b9169aa" name="a379d85074cc67dd1230cecc94b9169aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a379d85074cc67dd1230cecc94b9169aa">&#9670;&#160;</a></span>TrilinearBlend()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void TrilinearBlend </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a>&#160;</td>
          <td class="paramname"><em>V</em>[8], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>xi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>eta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>zta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structCmpnts">Cmpnts</a> *&#160;</td>
          <td class="paramname"><em>Xp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Map logical coordinates to physical space using trilinear basis. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">V</td><td>Array of the eight vertex coordinates (MetricGetCellVertices). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xi,eta,zta</td><td>Logical coordinates in [0,1]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Xp</td><td>Physical coordinate. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="Metric_8c_source.html#l00048">48</a> of file <a class="el" href="Metric_8c_source.html">Metric.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   51</span>{</div>
<div class="line"><span class="lineno">   52</span>  PetscReal x=0,y=0,z=0;</div>
<div class="line"><span class="lineno">   53</span>  <span class="keywordflow">for</span> (PetscInt c=0;c&lt;8;++c) {</div>
<div class="line"><span class="lineno">   54</span>    PetscReal N = ((c&amp;1)?xi : 1.0-xi ) *</div>
<div class="line"><span class="lineno">   55</span>                  ((c&amp;2)?eta: 1.0-eta) *</div>
<div class="line"><span class="lineno">   56</span>                  ((c&amp;4)?zta: 1.0-zta);</div>
<div class="line"><span class="lineno">   57</span>    x += N * V[c].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">   58</span>    y += N * V[c].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">   59</span>    z += N * V[c].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">   60</span>  }</div>
<div class="line"><span class="lineno">   61</span>  Xp-&gt;<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = x; Xp-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = y; Xp-&gt;<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = z;</div>
<div class="line"><span class="lineno">   62</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="Metric_8c_a379d85074cc67dd1230cecc94b9169aa_icgraph.svg" width="100%" height="381"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="Metric_8c.html">Metric.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
