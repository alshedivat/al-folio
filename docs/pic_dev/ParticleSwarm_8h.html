<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PICurv: ParticleSwarm.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PICurv<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">A Parallel Particle-In-Cell Solver for Curvilinear LES</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ParticleSwarm_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ParticleSwarm.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> Motion and migration related functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;petsc.h&gt;</code><br />
<code>#include &lt;petscdmswarm.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="variables_8h_source.html">variables.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logging_8h_source.html">logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="walkingsearch_8h_source.html">walkingsearch.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Metric_8h_source.html">Metric.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="io_8h_source.html">io.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ParticleSwarm.h:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h__dep__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="ParticleSwarm_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a063f4fd13a24b248fabd0268c49fd38c" id="r_a063f4fd13a24b248fabd0268c49fd38c"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a063f4fd13a24b248fabd0268c49fd38c">CreateParticleSwarm</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, PetscInt numParticles, PetscInt *particlesPerProcess, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *bboxlist)</td></tr>
<tr class="memdesc:a063f4fd13a24b248fabd0268c49fd38c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates and initializes a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> Swarm.  <br /></td></tr>
<tr class="separator:a063f4fd13a24b248fabd0268c49fd38c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3566e0b51587686bc6c1366a67c44af" id="r_ac3566e0b51587686bc6c1366a67c44af"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#ac3566e0b51587686bc6c1366a67c44af">InitializeSwarm</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:ac3566e0b51587686bc6c1366a67c44af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the DMSwarm object within the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure.  <br /></td></tr>
<tr class="separator:ac3566e0b51587686bc6c1366a67c44af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeae3fd559e91d7379302acb6ccd13011" id="r_aeae3fd559e91d7379302acb6ccd13011"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#aeae3fd559e91d7379302acb6ccd13011">RegisterParticleFields</a> (DM swarm)</td></tr>
<tr class="memdesc:aeae3fd559e91d7379302acb6ccd13011"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers necessary particle fields within the DMSwarm.  <br /></td></tr>
<tr class="separator:aeae3fd559e91d7379302acb6ccd13011"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26fa0cca0aa8b05f2705cdd0e7d37658" id="r_a26fa0cca0aa8b05f2705cdd0e7d37658"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a26fa0cca0aa8b05f2705cdd0e7d37658">InitializeRandomGenerators</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, PetscRandom *randx, PetscRandom *randy, PetscRandom *randz)</td></tr>
<tr class="memdesc:a26fa0cca0aa8b05f2705cdd0e7d37658"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes random number generators for assigning particle properties.  <br /></td></tr>
<tr class="separator:a26fa0cca0aa8b05f2705cdd0e7d37658"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab723e91906e01ec26aab97de6623000c" id="r_ab723e91906e01ec26aab97de6623000c"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#ab723e91906e01ec26aab97de6623000c">InitializeLogicalSpaceRNGs</a> (PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k)</td></tr>
<tr class="memdesc:ab723e91906e01ec26aab97de6623000c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes random number generators for logical space operations [0.0, 1.0).  <br /></td></tr>
<tr class="separator:ab723e91906e01ec26aab97de6623000c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b3080ee0e5c8e0175ac594a2c497b5" id="r_af2b3080ee0e5c8e0175ac594a2c497b5"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#af2b3080ee0e5c8e0175ac594a2c497b5">AssignInitialPropertiesToSwarm</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, PetscInt particlesPerProcess, PetscRandom *rand_phys_x, PetscRandom *rand_phys_y, PetscRandom *rand_phys_z, PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *bboxlist)</td></tr>
<tr class="memdesc:af2b3080ee0e5c8e0175ac594a2c497b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes all particle properties in the swarm.  <br /></td></tr>
<tr class="separator:af2b3080ee0e5c8e0175ac594a2c497b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cc0975a3eec2e2f817d0e3a09040620" id="r_a1cc0975a3eec2e2f817d0e3a09040620"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a1cc0975a3eec2e2f817d0e3a09040620">DistributeParticles</a> (PetscInt numParticles, PetscMPIInt rank, PetscMPIInt size, PetscInt *particlesPerProcess, PetscInt *remainder)</td></tr>
<tr class="memdesc:a1cc0975a3eec2e2f817d0e3a09040620"><td class="mdescLeft">&#160;</td><td class="mdescRight">Distributes particles evenly across MPI processes, handling any remainders.  <br /></td></tr>
<tr class="separator:a1cc0975a3eec2e2f817d0e3a09040620"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a075e674353bc5b06344aa4c17063babf" id="r_a075e674353bc5b06344aa4c17063babf"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a075e674353bc5b06344aa4c17063babf">FinalizeSwarmSetup</a> (PetscRandom *randx, PetscRandom *randy, PetscRandom *randz, PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k)</td></tr>
<tr class="memdesc:a075e674353bc5b06344aa4c17063babf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finalizes the swarm setup by destroying random generators and logging completion.  <br /></td></tr>
<tr class="separator:a075e674353bc5b06344aa4c17063babf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa353055e357151aab1542bbad367c657" id="r_aa353055e357151aab1542bbad367c657"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#aa353055e357151aab1542bbad367c657">UnpackSwarmFields</a> (PetscInt i, const PetscInt64 *PIDs, const PetscReal *weights, const PetscReal *positions, const PetscInt *cellIndices, PetscReal *velocities, PetscInt *LocStatus, <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle)</td></tr>
<tr class="memdesc:aa353055e357151aab1542bbad367c657"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct with data from DMSwarm fields.  <br /></td></tr>
<tr class="separator:aa353055e357151aab1542bbad367c657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac52b9e4afa9d1f2ba3bf59dc45b610d1" id="r_ac52b9e4afa9d1f2ba3bf59dc45b610d1"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#ac52b9e4afa9d1f2ba3bf59dc45b610d1">UpdateSwarmFields</a> (PetscInt i, const <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle, PetscReal *weights, PetscInt *cellIndices, PetscInt *status_field)</td></tr>
<tr class="memdesc:ac52b9e4afa9d1f2ba3bf59dc45b610d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates DMSwarm fields with data from a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct.  <br /></td></tr>
<tr class="separator:ac52b9e4afa9d1f2ba3bf59dc45b610d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a412856be59df7252e66bcbdd13cf1718" id="r_a412856be59df7252e66bcbdd13cf1718"><td class="memItemLeft" align="right" valign="top">PetscBool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a412856be59df7252e66bcbdd13cf1718">IsParticleInsideBoundingBox</a> (const <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *bbox, const <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle)</td></tr>
<tr class="memdesc:a412856be59df7252e66bcbdd13cf1718"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if a particle's location is within a specified bounding box.  <br /></td></tr>
<tr class="separator:a412856be59df7252e66bcbdd13cf1718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0001e483238e2b600cb9aa23a6e5338c" id="r_a0001e483238e2b600cb9aa23a6e5338c"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a0001e483238e2b600cb9aa23a6e5338c">UpdateParticleWeights</a> (PetscReal *d, <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *particle)</td></tr>
<tr class="memdesc:a0001e483238e2b600cb9aa23a6e5338c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates a particle's interpolation weights based on distances to cell faces.  <br /></td></tr>
<tr class="separator:a0001e483238e2b600cb9aa23a6e5338c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5488e87ab4fa163467b3db9ce10233a5" id="r_a5488e87ab4fa163467b3db9ce10233a5"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#a5488e87ab4fa163467b3db9ce10233a5">PrepareLoadedSwarmForRelocation</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a5488e87ab4fa163467b3db9ce10233a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the location-dependent state of a loaded swarm to force relocation.  <br /></td></tr>
<tr class="separator:a5488e87ab4fa163467b3db9ce10233a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada215a5db25227a8fd2cd2596e7d3e57" id="r_ada215a5db25227a8fd2cd2596e7d3e57"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ParticleSwarm_8h.html#ada215a5db25227a8fd2cd2596e7d3e57">InitializeParticleSwarm</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:ada215a5db25227a8fd2cd2596e7d3e57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform particle swarm initialization, particle-grid interaction, and related operations.  <br /></td></tr>
<tr class="separator:ada215a5db25227a8fd2cd2596e7d3e57"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> Motion and migration related functions. </p>
<p>Header file for <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> Swarm management functions.</p>
<p>This file contains declarations of functions responsible for moving and migrating particle swarms within a simulation using PETSc's DMSwarm.</p>
<p>This file contains declarations of functions responsible for creating, managing, initializing, migrating, and printing particle swarms within a simulation using PETSc's DMSwarm. </p>

<p class="definition">Definition in file <a class="el" href="ParticleSwarm_8h_source.html">ParticleSwarm.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af2b3080ee0e5c8e0175ac594a2c497b5" name="af2b3080ee0e5c8e0175ac594a2c497b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2b3080ee0e5c8e0175ac594a2c497b5">&#9670;&#160;</a></span>AssignInitialPropertiesToSwarm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode AssignInitialPropertiesToSwarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>particlesPerProcess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_phys_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_phys_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_phys_z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *&#160;</td>
          <td class="paramname"><em>bboxlist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes all particle properties in the swarm. </p>
<p>This function orchestrates the initialization of particle properties. It first determines the inlet face if surface initialization (Mode 0) is selected by parsing "bcs.dat". Then, it initializes basic particle properties (physical position, <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> ID, and placeholder <a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a> IDs) by calling <code>InitializeParticleBasicProperties</code>. This call uses the provided <code>rand_logic_i/j/k</code> RNGs, which must be pre-initialized for [0,1). The <code>rand_phys_x/y/z</code> RNGs (physically bounded) are passed but may not be used by <code>InitializeParticleBasicProperties</code> for position setting if all initialization paths use logical-to-physical mapping. Finally, it calls helper functions to initialize other registered swarm fields like "velocity", "weight", and "P" (pressure) to default values.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code> structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particlesPerProcess</td><td>Number of particles assigned to this MPI process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_phys_x</td><td>RNG for physical x-coordinates (from <code>InitializeRandomGenerators</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_phys_y</td><td>RNG for physical y-coordinates (from <code>InitializeRandomGenerators</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_phys_z</td><td>RNG for physical z-coordinates (from <code>InitializeRandomGenerators</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_i</td><td>RNG for i-logical dimension tasks [0,1) (from <code>InitializeLogicalSpaceRNGs</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_j</td><td>RNG for j-logical dimension tasks [0,1) (from <code>InitializeLogicalSpaceRNGs</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_k</td><td>RNG for k-logical dimension tasks [0,1) (from <code>InitializeLogicalSpaceRNGs</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bboxlist</td><td>Array of <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structures (potentially unused by IPBP).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<p>This function orchestrates the initialization of particle properties. It first determines the inlet face if surface initialization (Mode 0) is selected by parsing "bcs.dat". Then, it initializes basic particle properties (physical position, <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> ID, and placeholder <a class="el" href="variables__old_8h.html#structCell" title="Defines the vertices of a single hexahedral grid cell.">Cell</a> IDs) by calling <code>InitializeParticleBasicProperties</code>. This call uses the provided <code>rand_logic_i/j/k</code> RNGs, which must be pre-initialized for [0,1). The <code>rand_phys_x/y/z</code> RNGs (physically bounded) are passed but may not be used by <code>InitializeParticleBasicProperties</code> for position setting if all initialization paths use logical-to-physical mapping. Finally, it calls helper functions to initialize other registered swarm fields like "velocity", "weight", and "Psi" (scalar) to default values.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code> structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particlesPerProcess</td><td>Number of particles assigned to this MPI process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_phys_x</td><td>RNG for physical x-coordinates (from <code>InitializeRandomGenerators</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_phys_y</td><td>RNG for physical y-coordinates (from <code>InitializeRandomGenerators</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_phys_z</td><td>RNG for physical z-coordinates (from <code>InitializeRandomGenerators</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_i</td><td>RNG for i-logical dimension tasks [0,1) (from <code>InitializeLogicalSpaceRNGs</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_j</td><td>RNG for j-logical dimension tasks [0,1) (from <code>InitializeLogicalSpaceRNGs</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_k</td><td>RNG for k-logical dimension tasks [0,1) (from <code>InitializeLogicalSpaceRNGs</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bboxlist</td><td>Array of <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structures (potentially unused by IPBP).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00606">606</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  615</span>{</div>
<div class="line"><span class="lineno">  616</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  617</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  618</span> </div>
<div class="line"><span class="lineno">  619</span>    <a class="code hl_struct" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><span class="lineno">  620</span>    </div>
<div class="line"><span class="lineno">  621</span>    <span class="comment">// --- 0. Input Validation ---</span></div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordflow">if</span> (!user || !bboxlist || !rand_logic_i || !rand_logic_j || !rand_logic_k || !rand_phys_x || !rand_phys_y || !rand_phys_z) {</div>
<div class="line"><span class="lineno">  623</span>        <span class="comment">// Check all RNGs now as they are passed in</span></div>
<div class="line"><span class="lineno">  624</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Null user, bboxlist, or RNG pointer.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  625</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Null input detected.&quot;</span>);</div>
<div class="line"><span class="lineno">  626</span>    }</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Initializing swarm with %d particles per process. Mode: %d.\n&quot;</span>,</div>
<div class="line"><span class="lineno">  629</span>              particlesPerProcess, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#ae3ce8967b15c2e6be9e829b745da4090">ParticleInitialization</a>);</div>
<div class="line"><span class="lineno">  630</span> </div>
<div class="line"><span class="lineno">  631</span>    <span class="comment">// --- 1. Parse BCS File for Inlet Information (if Mode 0) ---</span></div>
<div class="line"><span class="lineno">  632</span>    <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#ae3ce8967b15c2e6be9e829b745da4090">ParticleInitialization</a> == 0) {</div>
<div class="line"><span class="lineno">  633</span>      <span class="keywordflow">if</span>(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1300c167a3006a58c71fe8759ebf5ef1">inletFaceDefined</a> == PETSC_FALSE){</div>
<div class="line"><span class="lineno">  634</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - ParticleInitialization Mode 0 (Surface Init) selected, but no INLET face was identified from bcs.dat. Cannot proceed.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  635</span>        SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;ParticleInitialization Mode 0 requires an INLET face to be defined in bcs.dat.&quot;</span>);</div>
<div class="line"><span class="lineno">  636</span>      }<span class="keywordflow">else</span>{</div>
<div class="line"><span class="lineno">  637</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - After ParseBCSFileForInlet, identifiedInletBCFace = %d\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a27bce072860da2f1a8a54d94b2b9497f">identifiedInletBCFace</a>);</div>
<div class="line"><span class="lineno">  638</span>      }</div>
<div class="line"><span class="lineno">  639</span>    }</div>
<div class="line"><span class="lineno">  640</span> </div>
<div class="line"><span class="lineno">  641</span>    <span class="comment">// --- 2. Initialize Basic Particle Properties (Position, PID, Cell IDs placeholder) ---</span></div>
<div class="line"><span class="lineno">  642</span>    <span class="comment">// The rand_logic_i/j/k are now passed directly.</span></div>
<div class="line"><span class="lineno">  643</span>    <span class="comment">// The rand_phys_x/y/z are passed but InitializeParticleBasicProperties (refactored version)</span></div>
<div class="line"><span class="lineno">  644</span>    <span class="comment">// will not use them for setting positions if all its paths use logical-to-physical mapping.</span></div>
<div class="line"><span class="lineno">  645</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Calling InitializeParticleBasicProperties.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  646</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a95efc9f04a0187f2a1d920952bd610e0">InitializeParticleBasicProperties</a>(user, particlesPerProcess,</div>
<div class="line"><span class="lineno">  647</span>                                             rand_logic_i, rand_logic_j, rand_logic_k,</div>
<div class="line"><span class="lineno">  648</span>                                             bboxlist); <span class="comment">// bboxlist passed along</span></div>
<div class="line"><span class="lineno">  649</span>    CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  650</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Successfully initialized basic particle properties.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  651</span> </div>
<div class="line"><span class="lineno">  652</span>    <span class="comment">// Note: The logical RNGs (rand_logic_i/j/k) are NOT destroyed here.</span></div>
<div class="line"><span class="lineno">  653</span>    <span class="comment">// They were created externally (e.g., by InitializeLogicalSpaceRNGs) and</span></div>
<div class="line"><span class="lineno">  654</span>    <span class="comment">// should be destroyed externally (e.g., in FinalizeSwarmSetup).</span></div>
<div class="line"><span class="lineno">  655</span>    <span class="comment">// Same for rand_phys_x/y/z.</span></div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>    <span class="comment">// --- 3. Initialize Other Swarm Fields (Velocity, Weight, Pressure, etc.) ---</span></div>
<div class="line"><span class="lineno">  658</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Initializing &#39;velocity&#39; field.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  659</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a38c3c55ea49021ac59eea87b61e942d1">AssignInitialFieldToSwarm</a>(user, <span class="stringliteral">&quot;velocity&quot;</span>, 3); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  660</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - &#39;velocity&#39; field initialization complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  661</span> </div>
<div class="line"><span class="lineno">  662</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Initializing &#39;weight&#39; field.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  663</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a38c3c55ea49021ac59eea87b61e942d1">AssignInitialFieldToSwarm</a>(user, <span class="stringliteral">&quot;weight&quot;</span>, 3); CHKERRQ(ierr); <span class="comment">// Assuming weight is vec3</span></div>
<div class="line"><span class="lineno">  664</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - &#39;weight&#39; field initialization complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  665</span> </div>
<div class="line"><span class="lineno">  666</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Initializing &#39;P&#39; (Pressure) field.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  667</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a38c3c55ea49021ac59eea87b61e942d1">AssignInitialFieldToSwarm</a>(user, <span class="stringliteral">&quot;Psi&quot;</span>, 1); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  668</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - &#39;P&#39; field initialization complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  669</span>    </div>
<div class="line"><span class="lineno">  670</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;AssignInitialPropertiesToSwarm - Successfully completed all swarm property initialization.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  673</span>}</div>
<div class="ttc" id="aParticleSwarm_8c_html_a38c3c55ea49021ac59eea87b61e942d1"><div class="ttname"><a href="ParticleSwarm_8c.html#a38c3c55ea49021ac59eea87b61e942d1">AssignInitialFieldToSwarm</a></div><div class="ttdeci">static PetscErrorCode AssignInitialFieldToSwarm(UserCtx *user, const char *fieldName, PetscInt fieldDim)</div><div class="ttdoc">Initializes a generic swarm field with point-level updates.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00544">ParticleSwarm.c:544</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_a95efc9f04a0187f2a1d920952bd610e0"><div class="ttname"><a href="ParticleSwarm_8c.html#a95efc9f04a0187f2a1d920952bd610e0">InitializeParticleBasicProperties</a></div><div class="ttdeci">static PetscErrorCode InitializeParticleBasicProperties(UserCtx *user, PetscInt particlesPerProcess, PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k, BoundingBox *bboxlist)</div><div class="ttdoc">Initializes basic properties for particles on the local process.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00341">ParticleSwarm.c:341</a></div></div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="alogging_8h_html_a3de33738fd3c7e77bffbcfaefc3e7645"><div class="ttname"><a href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a></div><div class="ttdeci">#define GLOBAL</div><div class="ttdoc">Scope for global logging across all processes.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00045">logging.h:45</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00207">logging.h:207</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a></div><div class="ttdeci">@ LOG_ERROR</div><div class="ttdoc">Critical errors that may halt the program.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_ae3ce8967b15c2e6be9e829b745da4090"><div class="ttname"><a href="variables_8h.html#ae3ce8967b15c2e6be9e829b745da4090">SimCtx::ParticleInitialization</a></div><div class="ttdeci">PetscInt ParticleInitialization</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00550">variables.h:550</a></div></div>
<div class="ttc" id="avariables_8h_html_structSimCtx"><div class="ttname"><a href="variables_8h.html#structSimCtx">SimCtx</a></div><div class="ttdoc">The master context for the entire simulation.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00474">variables.h:474</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a1300c167a3006a58c71fe8759ebf5ef1"><div class="ttname"><a href="variables__old_8h.html#a1300c167a3006a58c71fe8759ebf5ef1">UserCtx::inletFaceDefined</a></div><div class="ttdeci">PetscBool inletFaceDefined</div><div class="ttdoc">Legacy flag for particle system compatibility.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00601">variables.h:601</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a27bce072860da2f1a8a54d94b2b9497f"><div class="ttname"><a href="variables__old_8h.html#a27bce072860da2f1a8a54d94b2b9497f">UserCtx::identifiedInletBCFace</a></div><div class="ttdeci">BCFace identifiedInletBCFace</div><div class="ttdoc">Legacy field for particle system compatibility.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00602">variables.h:602</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a322702c716e6e140d71515d0b3e111b1"><div class="ttname"><a href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">UserCtx::simCtx</a></div><div class="ttdeci">SimCtx * simCtx</div><div class="ttdoc">Back-pointer to the master simulation context.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00585">variables.h:585</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_af2b3080ee0e5c8e0175ac594a2c497b5_cgraph.svg" width="100%" height="505"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_af2b3080ee0e5c8e0175ac594a2c497b5_icgraph.svg" width="515" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a063f4fd13a24b248fabd0268c49fd38c" name="a063f4fd13a24b248fabd0268c49fd38c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a063f4fd13a24b248fabd0268c49fd38c">&#9670;&#160;</a></span>CreateParticleSwarm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode CreateParticleSwarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>numParticles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>particlesPerProcess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *&#160;</td>
          <td class="paramname"><em>bboxlist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates and initializes a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> Swarm. </p>
<p>This function sets up a DMSwarm within the provided <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure, initializes particle fields, and distributes particles across MPI processes. It ensures that the number of particles is evenly divided among the available MPI ranks. If the total number of particles isn't divisible by the number of processes, the remainder is distributed to the first few ranks.</p>
<p>Additionally, it now takes a 'bboxlist' array as an input parameter and passes it on to AssignInitialProperties(), enabling particle initialization at the midpoint of each rank's bounding box if ParticleInitialization is set to 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure containing the simulation context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numParticles</td><td>Total number of particles to create across all MPI processes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bboxlist</td><td>Pointer to an array of <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structures, one per rank.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Ensure that <code>numParticles</code> is a positive integer.</li>
<li>The <code>control.dat</code> file should contain necessary PETSc options.</li>
<li><p class="startli">The <code>bboxlist</code> array should be properly populated before calling this function.</p>
<p class="startli">This function sets up a DMSwarm within the provided <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure, initializes particle fields, and distributes particles across MPI processes. It ensures that the number of particles is evenly divided among the available MPI ranks. If the total number of particles isn't divisible by the number of processes, the remainder is distributed to the first few ranks.</p>
</li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure containing the simulation context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numParticles</td><td>Total number of particles to create across all MPI processes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bboxlist</td><td>Pointer to an array of <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structures, one per rank.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particlesPerProcess</td><td><br  />
 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Ensure that <code>numParticles</code> is a positive integer.</li>
<li>The <code>control.dat</code> file should contain necessary PETSc options.</li>
<li>The <code>bboxlist</code> array should be properly populated before calling this function. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00764">764</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  764</span>                                                                                                                               {</div>
<div class="line"><span class="lineno">  765</span>    PetscErrorCode ierr;                      <span class="comment">// PETSc error handling variable</span></div>
<div class="line"><span class="lineno">  766</span>    PetscMPIInt rank, size;                   <span class="comment">// Variables to store MPI rank and size</span></div>
<div class="line"><span class="lineno">  767</span>    PetscInt remainder = 0;                   <span class="comment">// Remainder of particles after division</span></div>
<div class="line"><span class="lineno">  768</span>    </div>
<div class="line"><span class="lineno">  769</span>    <span class="comment">// Validate input parameters</span></div>
<div class="line"><span class="lineno">  770</span>    <span class="keywordflow">if</span> (numParticles &lt;= 0) {</div>
<div class="line"><span class="lineno">  771</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;CreateParticleSwarm - Number of particles must be positive. Given: %d\n&quot;</span>, numParticles);</div>
<div class="line"><span class="lineno">  772</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_OUTOFRANGE;</div>
<div class="line"><span class="lineno">  773</span>    }</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>    <span class="comment">// Insert PETSc options from &quot;control.dat&quot; into the PETSc options database</span></div>
<div class="line"><span class="lineno">  776</span>    <span class="comment">//  ierr = PetscOptionsInsertFile(PETSC_COMM_WORLD, NULL, &quot;control.dat&quot;, PETSC_TRUE); CHKERRQ(ierr);</span></div>
<div class="line"><span class="lineno">  777</span>    <span class="comment">// LOG_ALLOW(LOCAL,LOG_DEBUG,&quot;CreateParticleSwarm - Inserted options from control.dat\n&quot;);</span></div>
<div class="line"><span class="lineno">  778</span>    </div>
<div class="line"><span class="lineno">  779</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;CreateParticleSwarm - Domain dimensions: Min_X=%.2f, Max_X=%.2f,Min_Y=%.2f, Max_Y=%.2f,Min_Z=%.2f, Max_Z=%.2f \n&quot;</span>, </div>
<div class="line"><span class="lineno">  780</span>           user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3c5226c112cabe2fc24230877bf7cc3c">Min_X</a>,user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac3ea6849d6d1556f240ace7a6d9a3347">Max_X</a>,user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac6633daab270004cd266f6e6ac05f588">Min_Y</a>,user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a60bfc6b6d761a90da39b0f053bebcb31">Max_Y</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aaeef1864bb110c26e4b30a9e2c8c116d">Min_Z</a>,user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecbc2de7a281e906efe25a773b76866c">Max_Z</a>);</div>
<div class="line"><span class="lineno">  781</span>    </div>
<div class="line"><span class="lineno">  782</span>    <span class="comment">// Retrieve MPI rank and size</span></div>
<div class="line"><span class="lineno">  783</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  784</span>    ierr = MPI_Comm_size(PETSC_COMM_WORLD, &amp;size); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  785</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;CreateParticleSwarm - Rank %d out of %d processes.\n&quot;</span>, rank, size);</div>
<div class="line"><span class="lineno">  786</span> </div>
<div class="line"><span class="lineno">  787</span>    <span class="comment">// Distribute particles among MPI processes</span></div>
<div class="line"><span class="lineno">  788</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1cc0975a3eec2e2f817d0e3a09040620">DistributeParticles</a>(numParticles, rank, size, particlesPerProcess, &amp;remainder); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  789</span> </div>
<div class="line"><span class="lineno">  790</span>    <span class="comment">// Initialize the DMSwarm - creates the swarm, sets the type and dimension</span></div>
<div class="line"><span class="lineno">  791</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#ac3566e0b51587686bc6c1366a67c44af">InitializeSwarm</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  792</span> </div>
<div class="line"><span class="lineno">  793</span>    <span class="keywordflow">if</span> (user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>) {</div>
<div class="line"><span class="lineno">  794</span>      ierr = DMSwarmSetCellDM(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  795</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;CreateParticleSwarm - Associated DMSwarm with Cell DM (user-&gt;da).\n&quot;</span>);</div>
<div class="line"><span class="lineno">  796</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  797</span>      <span class="comment">// If user-&gt;da is essential for your simulation logic with particles, this should be a fatal error.</span></div>
<div class="line"><span class="lineno">  798</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;CreateParticleSwarm - user-&gt;da (Cell DM for Swarm) is NULL. Cell-based swarm operations might fail.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  799</span>      <span class="comment">// SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONGSTATE, &quot;CreateParticleSwarm - user-&gt;da (Cell DM) is NULL but required.&quot;);</span></div>
<div class="line"><span class="lineno">  800</span>    }</div>
<div class="line"><span class="lineno">  801</span>    </div>
<div class="line"><span class="lineno">  802</span>    <span class="comment">// Register particle fields (position, velocity, CellID, weight, etc.)</span></div>
<div class="line"><span class="lineno">  803</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#aeae3fd559e91d7379302acb6ccd13011">RegisterParticleFields</a>(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span>    <span class="comment">// Set the local number of particles for this rank and additional buffer for particle migration</span></div>
<div class="line"><span class="lineno">  806</span>    ierr = DMSwarmSetLocalSizes(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, *particlesPerProcess, numParticles); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  807</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;CreateParticleSwarm - Set local swarm size: %d particles.\n&quot;</span>, *particlesPerProcess);</div>
<div class="line"><span class="lineno">  808</span> </div>
<div class="line"><span class="lineno">  809</span>    <span class="comment">// Optionally, LOG_ALLOW detailed DM info in debug mode</span></div>
<div class="line"><span class="lineno">  810</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>() == <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a> &amp;&amp; <a class="code hl_function" href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a>(__func__)) {</div>
<div class="line"><span class="lineno">  811</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;CreateParticleSwarm - Viewing DMSwarm:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  812</span>        ierr = DMView(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, PETSC_VIEWER_STDOUT_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  813</span>    }</div>
<div class="line"><span class="lineno">  814</span> </div>
<div class="line"><span class="lineno">  815</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;CreateParticleSwarm - Particle swarm creation and initialization complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  816</span> </div>
<div class="line"><span class="lineno">  817</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  818</span>}</div>
<div class="ttc" id="aParticleSwarm_8c_html_a1cc0975a3eec2e2f817d0e3a09040620"><div class="ttname"><a href="ParticleSwarm_8c.html#a1cc0975a3eec2e2f817d0e3a09040620">DistributeParticles</a></div><div class="ttdeci">PetscErrorCode DistributeParticles(PetscInt numParticles, PetscMPIInt rank, PetscMPIInt size, PetscInt *particlesPerProcess, PetscInt *remainder)</div><div class="ttdoc">Distributes particles evenly across MPI processes, handling any remainders.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00689">ParticleSwarm.c:689</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_ac3566e0b51587686bc6c1366a67c44af"><div class="ttname"><a href="ParticleSwarm_8c.html#ac3566e0b51587686bc6c1366a67c44af">InitializeSwarm</a></div><div class="ttdeci">PetscErrorCode InitializeSwarm(UserCtx *user)</div><div class="ttdoc">Initializes the DMSwarm object within the UserCtx structure.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00015">ParticleSwarm.c:15</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_aeae3fd559e91d7379302acb6ccd13011"><div class="ttname"><a href="ParticleSwarm_8c.html#aeae3fd559e91d7379302acb6ccd13011">RegisterParticleFields</a></div><div class="ttdeci">PetscErrorCode RegisterParticleFields(DM swarm)</div><div class="ttdoc">Registers necessary particle fields within the DMSwarm.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00064">ParticleSwarm.c:64</a></div></div>
<div class="ttc" id="alogging_8h_html_a2358badbcda33fc9d80ebd6a59d2a2cd"><div class="ttname"><a href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a></div><div class="ttdeci">PetscBool is_function_allowed(const char *functionName)</div><div class="ttdoc">Checks if a given function is in the allow-list.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00159">logging.c:159</a></div></div>
<div class="ttc" id="alogging_8h_html_a2ebe7667b52c478f7ff365f296d4c8ae"><div class="ttname"><a href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a></div><div class="ttdeci">#define LOG_ALLOW_SYNC(scope, level, fmt,...)</div><div class="ttdoc">----— DEBUG ---------------------------------------— #define LOG_ALLOW(scope, level,...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00274">logging.h:274</a></div></div>
<div class="ttc" id="alogging_8h_html_a9585f583c260f40a73f2490914edc689"><div class="ttname"><a href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a></div><div class="ttdeci">LogLevel get_log_level()</div><div class="ttdoc">Retrieves the current logging level from the environment variable LOG_LEVEL.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00049">logging.c:49</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a></div><div class="ttdeci">@ LOG_WARNING</div><div class="ttdoc">Non-critical issues that warrant attention.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00030">logging.h:30</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a1675749ea3b2429f00405a1ee3203d18"><div class="ttname"><a href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">UserCtx::swarm</a></div><div class="ttdeci">DM swarm</div><div class="ttdoc">DMSwarm object for particle data.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00647">variables.h:647</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3c5226c112cabe2fc24230877bf7cc3c"><div class="ttname"><a href="variables__old_8h.html#a3c5226c112cabe2fc24230877bf7cc3c">UserCtx::Min_X</a></div><div class="ttdeci">PetscReal Min_X</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a60bfc6b6d761a90da39b0f053bebcb31"><div class="ttname"><a href="variables__old_8h.html#a60bfc6b6d761a90da39b0f053bebcb31">UserCtx::Max_Y</a></div><div class="ttdeci">PetscReal Max_Y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aaeef1864bb110c26e4b30a9e2c8c116d"><div class="ttname"><a href="variables__old_8h.html#aaeef1864bb110c26e4b30a9e2c8c116d">UserCtx::Min_Z</a></div><div class="ttdeci">PetscReal Min_Z</div><div class="ttdoc">Physical minimum bounds of the grid.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac3ea6849d6d1556f240ace7a6d9a3347"><div class="ttname"><a href="variables__old_8h.html#ac3ea6849d6d1556f240ace7a6d9a3347">UserCtx::Max_X</a></div><div class="ttdeci">PetscReal Max_X</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac6633daab270004cd266f6e6ac05f588"><div class="ttname"><a href="variables__old_8h.html#ac6633daab270004cd266f6e6ac05f588">UserCtx::Min_Y</a></div><div class="ttdeci">PetscReal Min_Y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aecbc2de7a281e906efe25a773b76866c"><div class="ttname"><a href="variables__old_8h.html#aecbc2de7a281e906efe25a773b76866c">UserCtx::Max_Z</a></div><div class="ttdeci">PetscReal Max_Z</div><div class="ttdoc">Physical maximum bounds of the grid.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdoc">DMDA for scalar fields (e.g., Pressure, Nvert).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a063f4fd13a24b248fabd0268c49fd38c_cgraph.svg" width="580" height="234"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a063f4fd13a24b248fabd0268c49fd38c_icgraph.svg" width="491" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1cc0975a3eec2e2f817d0e3a09040620" name="a1cc0975a3eec2e2f817d0e3a09040620"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cc0975a3eec2e2f817d0e3a09040620">&#9670;&#160;</a></span>DistributeParticles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode DistributeParticles </td>
          <td>(</td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>numParticles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscMPIInt&#160;</td>
          <td class="paramname"><em>rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscMPIInt&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>particlesPerProcess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>remainder</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Distributes particles evenly across MPI processes, handling any remainders. </p>
<p>This function calculates the number of particles each MPI process should handle, distributing the remainder particles to the first few ranks if necessary.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">numParticles</td><td>Total number of particles to create across all MPI processes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rank</td><td>MPI rank of the current process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Total number of MPI processes. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">particlesPerProcess</td><td>Number of particles assigned to the current MPI process. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">remainder</td><td>Remainder particles when dividing numParticles by size.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00689">689</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  689</span>                                                                                                                                                  {</div>
<div class="line"><span class="lineno">  690</span> </div>
<div class="line"><span class="lineno">  691</span>    <span class="comment">// Calculate the base number of particles per process</span></div>
<div class="line"><span class="lineno">  692</span>    *particlesPerProcess = numParticles / size;</div>
<div class="line"><span class="lineno">  693</span>    *remainder = numParticles % size;</div>
<div class="line"><span class="lineno">  694</span> </div>
<div class="line"><span class="lineno">  695</span>    <span class="comment">// Distribute the remainder particles to the first &#39;remainder&#39; ranks</span></div>
<div class="line"><span class="lineno">  696</span>    <span class="keywordflow">if</span> (rank &lt; *remainder) {</div>
<div class="line"><span class="lineno">  697</span>        *particlesPerProcess += 1;</div>
<div class="line"><span class="lineno">  698</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;DistributeParticles - Rank %d receives an extra particle. Total: %d\n&quot;</span>, rank, *particlesPerProcess);</div>
<div class="line"><span class="lineno">  699</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  700</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;DistributeParticles - Rank %d receives %d particles.\n&quot;</span>, rank, *particlesPerProcess);</div>
<div class="line"><span class="lineno">  701</span>    }</div>
<div class="line"><span class="lineno">  702</span> </div>
<div class="line"><span class="lineno">  703</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  704</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a1cc0975a3eec2e2f817d0e3a09040620_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a075e674353bc5b06344aa4c17063babf" name="a075e674353bc5b06344aa4c17063babf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a075e674353bc5b06344aa4c17063babf">&#9670;&#160;</a></span>FinalizeSwarmSetup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode FinalizeSwarmSetup </td>
          <td>(</td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>randx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>randy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>randz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finalizes the swarm setup by destroying random generators and logging completion. </p>
<p>This function cleans up resources by destroying random number generators and LOG_ALLOWs the completion of swarm setup.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">randx</td><td>Random number generator for the x-coordinate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">randy</td><td>Random number generator for the y-coordinate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">randz</td><td>Random number generator for the z-coordinate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_i</td><td>Random number generator for the xi-coordinate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_j</td><td>Random number generator for the eta-coordinate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rand_logic_k</td><td>Random number generator for the zeta-coordinate.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00720">720</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  720</span>                                                                                                                                                                               {</div>
<div class="line"><span class="lineno">  721</span>    PetscErrorCode ierr;  <span class="comment">// Error code for PETSc functions</span></div>
<div class="line"><span class="lineno">  722</span>    PetscInt  ParticleInitialization; </div>
<div class="line"><span class="lineno">  723</span> </div>
<div class="line"><span class="lineno">  724</span>    ierr = PetscOptionsGetInt(NULL, NULL, <span class="stringliteral">&quot;-pinit&quot;</span>, &amp;ParticleInitialization, NULL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <span class="comment">// Destroy random number generators to free resources</span></div>
<div class="line"><span class="lineno">  727</span>    <span class="comment">// Physical space</span></div>
<div class="line"><span class="lineno">  728</span>    ierr = PetscRandomDestroy(randx); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  729</span>    ierr = PetscRandomDestroy(randy); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  730</span>    ierr = PetscRandomDestroy(randz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  731</span> </div>
<div class="line"><span class="lineno">  732</span>    <span class="comment">// Logical space</span></div>
<div class="line"><span class="lineno">  733</span>    ierr = PetscRandomDestroy(rand_logic_i); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  734</span>    ierr = PetscRandomDestroy(rand_logic_j); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  735</span>    ierr = PetscRandomDestroy(rand_logic_k); CHKERRQ(ierr);      </div>
<div class="line"><span class="lineno">  736</span>      </div>
<div class="line"><span class="lineno">  737</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;FinalizeSwarmSetup - Destroyed all random number generators.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  738</span> </div>
<div class="line"><span class="lineno">  739</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  740</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a075e674353bc5b06344aa4c17063babf_icgraph.svg" width="487" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab723e91906e01ec26aab97de6623000c" name="ab723e91906e01ec26aab97de6623000c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab723e91906e01ec26aab97de6623000c">&#9670;&#160;</a></span>InitializeLogicalSpaceRNGs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeLogicalSpaceRNGs </td>
          <td>(</td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>rand_logic_k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes random number generators for logical space operations [0.0, 1.0). </p>
<p>This function creates and configures three separate PETSc random number generators, one for each logical dimension (i, j, k or xi, eta, zeta equivalent). Each RNG is configured to produce uniformly distributed real numbers in the interval [0.0, 1.0). These are typically used for selecting owned cells or generating intra-cell logical coordinates.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rand_logic_i</td><td>Pointer to store the RNG for the i-logical dimension. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rand_logic_j</td><td>Pointer to store the RNG for the j-logical dimension. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rand_logic_k</td><td>Pointer to store the RNG for the k-logical dimension.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00158">158</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  158</span>                                                                                                                           {</div>
<div class="line"><span class="lineno">  159</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  160</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  161</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="comment">// --- RNG for i-logical dimension ---</span></div>
<div class="line"><span class="lineno">  166</span>    ierr = PetscRandomCreate(PETSC_COMM_SELF, rand_logic_i); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  167</span>    ierr = PetscRandomSetType((*rand_logic_i), PETSCRAND48); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  168</span>    ierr = PetscRandomSetInterval(*rand_logic_i, 0.0, 1.0); CHKERRQ(ierr); <span class="comment">// Key change: [0,1)</span></div>
<div class="line"><span class="lineno">  169</span>    ierr = PetscRandomSetSeed(*rand_logic_i, rank + 202401); CHKERRQ(ierr); <span class="comment">// Unique seed</span></div>
<div class="line"><span class="lineno">  170</span>    ierr = PetscRandomSeed(*rand_logic_i); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  171</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeLogicalSpaceRNGs - Initialized RNG for i-logical dimension [0,1).\n&quot;</span>);</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>    <span class="comment">// --- RNG for j-logical dimension ---</span></div>
<div class="line"><span class="lineno">  174</span>    ierr = PetscRandomCreate(PETSC_COMM_SELF, rand_logic_j); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  175</span>    ierr = PetscRandomSetType((*rand_logic_j), PETSCRAND48); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  176</span>    ierr = PetscRandomSetInterval(*rand_logic_j, 0.0, 1.0); CHKERRQ(ierr); <span class="comment">// Key change: [0,1)</span></div>
<div class="line"><span class="lineno">  177</span>    ierr = PetscRandomSetSeed(*rand_logic_j, rank + 202402); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  178</span>    ierr = PetscRandomSeed(*rand_logic_j); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  179</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeLogicalSpaceRNGs - Initialized RNG for j-logical dimension [0,1).\n&quot;</span>);</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>    <span class="comment">// --- RNG for k-logical dimension ---</span></div>
<div class="line"><span class="lineno">  182</span>    ierr = PetscRandomCreate(PETSC_COMM_SELF, rand_logic_k); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  183</span>    ierr = PetscRandomSetType((*rand_logic_k), PETSCRAND48); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  184</span>    ierr = PetscRandomSetInterval(*rand_logic_k, 0.0, 1.0); CHKERRQ(ierr); <span class="comment">// Key change: [0,1)</span></div>
<div class="line"><span class="lineno">  185</span>    ierr = PetscRandomSetSeed(*rand_logic_k, rank + 202403); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  186</span>    ierr = PetscRandomSeed(*rand_logic_k); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  187</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeLogicalSpaceRNGs - Initialized RNG for k-logical dimension [0,1).\n&quot;</span>);</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  190</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_ab723e91906e01ec26aab97de6623000c_icgraph.svg" width="100%" height="374"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ada215a5db25227a8fd2cd2596e7d3e57" name="ada215a5db25227a8fd2cd2596e7d3e57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada215a5db25227a8fd2cd2596e7d3e57">&#9670;&#160;</a></span>InitializeParticleSwarm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeParticleSwarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform particle swarm initialization, particle-grid interaction, and related operations. </p>
<p>This function handles the following tasks:</p><ol type="1">
<li>Initializes the particle swarm using the provided bounding box list (bboxlist) to determine initial placement if ParticleInitialization is 0.</li>
<li>Locates particles within the computational grid.</li>
<li>Updates particle positions based on grid interactions (if such logic exists elsewhere in the code).</li>
<li>Interpolates particle velocities from grid points using trilinear interpolation.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure containing grid and particle swarm information. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">np</td><td>Number of particles to initialize in the swarm. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bboxlist</td><td>Pointer to an array of <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structures, one per MPI rank.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Ensure that <code>np</code> (number of particles) is positive.</li>
<li>The <code>bboxlist</code> array must be correctly computed and passed in before calling this function.</li>
<li>If ParticleInitialization == 0, particles will be placed at the midpoint of the local bounding box. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l01174">1174</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1175</span> {</div>
<div class="line"><span class="lineno"> 1176</span> </div>
<div class="line"><span class="lineno"> 1177</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1178</span>    PetscInt particlesPerProcess = 0;         <span class="comment">// Number of particles assigned to the local MPI process.</span></div>
<div class="line"><span class="lineno"> 1179</span>    PetscRandom randx,randy,randz;     <span class="comment">// Random number generators[x,y,z]. (used if ParticleInitialization==1).</span></div>
<div class="line"><span class="lineno"> 1180</span>    PetscRandom rand_logic_i, rand_logic_j,rand_logic_k; <span class="comment">// RNGs for Logical space.</span></div>
<div class="line"><span class="lineno"> 1181</span>    PetscInt    start_step = 0;</div>
<div class="line"><span class="lineno"> 1182</span>    PetscInt    np = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a5eedf611da6dd4f59cc65753b777b957">np</a>;</div>
<div class="line"><span class="lineno"> 1183</span>    <a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>    *bboxlist = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a8c248c162038dffe12e38228bcd06644">bboxlist</a>;</div>
<div class="line"><span class="lineno"> 1184</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>;</div>
<div class="line"><span class="lineno"> 1185</span>    </div>
<div class="line"><span class="lineno"> 1186</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Starting particle swarm Initialization with %d particles.\n&quot;</span>, np);</div>
<div class="line"><span class="lineno"> 1187</span>      </div>
<div class="line"><span class="lineno"> 1188</span>    <span class="comment">// Step 1: Create and initialize the particle swarm</span></div>
<div class="line"><span class="lineno"> 1189</span>    <span class="comment">// Here we pass in the bboxlist, which will be used by CreateParticleSwarm() and subsequently</span></div>
<div class="line"><span class="lineno"> 1190</span>    <span class="comment">// by AssignInitialProperties() to position particles if ParticleInitialization == 0.</span></div>
<div class="line"><span class="lineno"> 1191</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Creating particle swarm.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1192</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a063f4fd13a24b248fabd0268c49fd38c">CreateParticleSwarm</a>(user, np, &amp;particlesPerProcess,bboxlist); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1193</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Particle swarm created successfully.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1194</span> </div>
<div class="line"><span class="lineno"> 1195</span>    ierr = PetscOptionsGetInt(NULL, NULL, <span class="stringliteral">&quot;-rstart&quot;</span>, &amp;start_step, NULL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1196</span> </div>
<div class="line"><span class="lineno"> 1197</span>    <span class="keywordflow">if</span>(start_step == 0){</div>
<div class="line"><span class="lineno"> 1198</span>    </div>
<div class="line"><span class="lineno"> 1199</span>      <span class="comment">// Create the RNGs</span></div>
<div class="line"><span class="lineno"> 1200</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Initializing physical space RNGs.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1201</span>      ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a26fa0cca0aa8b05f2705cdd0e7d37658">InitializeRandomGenerators</a>(user, &amp;randx, &amp;randy, &amp;randz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1202</span>    </div>
<div class="line"><span class="lineno"> 1203</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Initializing logical space RNGs [0,1).\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1204</span>      ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#ab723e91906e01ec26aab97de6623000c">InitializeLogicalSpaceRNGs</a>(&amp;rand_logic_i, &amp;rand_logic_j, &amp;rand_logic_k); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1205</span>      <span class="comment">// Assign initial properties to particles</span></div>
<div class="line"><span class="lineno"> 1206</span>      <span class="comment">// The bboxlist array is passed here so that if ParticleInitialization == 0,</span></div>
<div class="line"><span class="lineno"> 1207</span>      <span class="comment">// particles can be placed at the midpoint of the local bounding box corresponding to this rank.</span></div>
<div class="line"><span class="lineno"> 1208</span>      ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#af2b3080ee0e5c8e0175ac594a2c497b5">AssignInitialPropertiesToSwarm</a>(user, particlesPerProcess, &amp;randx, &amp;randy, &amp;randz, &amp;rand_logic_i,&amp;rand_logic_j,&amp;rand_logic_k,bboxlist); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1209</span>      <span class="comment">// Finalize swarm setup by destroying RNGs if ParticleInitialization == 1</span></div>
<div class="line"><span class="lineno"> 1210</span>      ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a075e674353bc5b06344aa4c17063babf">FinalizeSwarmSetup</a>(&amp;randx, &amp;randy, &amp;randz, &amp;rand_logic_i, &amp;rand_logic_j, &amp;rand_logic_k); CHKERRQ(ierr);  </div>
<div class="line"><span class="lineno"> 1211</span> </div>
<div class="line"><span class="lineno"> 1212</span>      <span class="comment">// Ensure all ranks complete before proceeding</span></div>
<div class="line"><span class="lineno"> 1213</span>      <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot; Particles generated &amp; initialized.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1214</span>    }</div>
<div class="line"><span class="lineno"> 1215</span>    </div>
<div class="line"><span class="lineno"> 1216</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start_step &gt; 0){</div>
<div class="line"><span class="lineno"> 1217</span> </div>
<div class="line"><span class="lineno"> 1218</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot; Particle Swarm status being set at restart [Step %d].\n&quot;</span>,start_step);</div>
<div class="line"><span class="lineno"> 1219</span>      </div>
<div class="line"><span class="lineno"> 1220</span>      ierr = <a class="code hl_function" href="ParticleMotion_8h.html#ae0c7489fc52fda6c92cd1f22c3f50c38">PreCheckAndResizeSwarm</a>(user,start_step,<span class="stringliteral">&quot;dat&quot;</span>);</div>
<div class="line"><span class="lineno"> 1221</span> </div>
<div class="line"><span class="lineno"> 1222</span>      <span class="comment">// --- Read Particle Data (EVERY timestep) ---</span></div>
<div class="line"><span class="lineno"> 1223</span>      <span class="comment">// ReadAllSwarmFields should read position and velocity for timestep &#39;ti&#39;</span></div>
<div class="line"><span class="lineno"> 1224</span>      </div>
<div class="line"><span class="lineno"> 1225</span>      ierr = <a class="code hl_function" href="io_8h.html#a64286adf953993b2a0c5c3fbee40d5a2">ReadAllSwarmFields</a>(user, start_step);</div>
<div class="line"><span class="lineno"> 1226</span>      <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno"> 1227</span>    <span class="comment">// Check if the error was specifically a file open error (missing file)</span></div>
<div class="line"><span class="lineno"> 1228</span>    <span class="keywordflow">if</span> (ierr == PETSC_ERR_FILE_OPEN) {</div>
<div class="line"><span class="lineno"> 1229</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing particle data file(s) for timestep %d. Skipping VTK output for this step.\n&quot;</span>,(PetscInt)user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#ac9684d6e871566d55c997416270b5b99">step</a> );</div>
<div class="line"><span class="lineno"> 1230</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1231</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to read swarm fields for timestep %d (Error code: %d). Skipping VTK output for this step.\n&quot;</span>,(PetscInt)user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#ac9684d6e871566d55c997416270b5b99">step</a>  , ierr);</div>
<div class="line"><span class="lineno"> 1232</span>       }</div>
<div class="line"><span class="lineno"> 1233</span>      }</div>
<div class="line"><span class="lineno"> 1234</span> </div>
<div class="line"><span class="lineno"> 1235</span>      <span class="comment">// Ensure  all the swarm fields not read from file are initialized.</span></div>
<div class="line"><span class="lineno"> 1236</span>      ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a5488e87ab4fa163467b3db9ce10233a5">PrepareLoadedSwarmForRelocation</a>(user);</div>
<div class="line"><span class="lineno"> 1237</span>      </div>
<div class="line"><span class="lineno"> 1238</span>      <span class="comment">// Ensure all ranks complete before proceeding</span></div>
<div class="line"><span class="lineno"> 1239</span>      <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot; Particles generated &amp; initialized.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1240</span>      </div>
<div class="line"><span class="lineno"> 1241</span>      </div>
<div class="line"><span class="lineno"> 1242</span>    }</div>
<div class="line"><span class="lineno"> 1243</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1244</span> }</div>
<div class="ttc" id="aParticleMotion_8h_html_ae0c7489fc52fda6c92cd1f22c3f50c38"><div class="ttname"><a href="ParticleMotion_8h.html#ae0c7489fc52fda6c92cd1f22c3f50c38">PreCheckAndResizeSwarm</a></div><div class="ttdeci">PetscErrorCode PreCheckAndResizeSwarm(UserCtx *user, PetscInt ti, const char *ext)</div><div class="ttdoc">Checks particle count in the reference file and resizes the swarm if needed.</div><div class="ttdef"><b>Definition</b> <a href="ParticleMotion_8c_source.html#l01170">ParticleMotion.c:1170</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_a063f4fd13a24b248fabd0268c49fd38c"><div class="ttname"><a href="ParticleSwarm_8c.html#a063f4fd13a24b248fabd0268c49fd38c">CreateParticleSwarm</a></div><div class="ttdeci">PetscErrorCode CreateParticleSwarm(UserCtx *user, PetscInt numParticles, PetscInt *particlesPerProcess, BoundingBox *bboxlist)</div><div class="ttdoc">Creates and initializes a Particle Swarm.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00764">ParticleSwarm.c:764</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_a075e674353bc5b06344aa4c17063babf"><div class="ttname"><a href="ParticleSwarm_8c.html#a075e674353bc5b06344aa4c17063babf">FinalizeSwarmSetup</a></div><div class="ttdeci">PetscErrorCode FinalizeSwarmSetup(PetscRandom *randx, PetscRandom *randy, PetscRandom *randz, PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k)</div><div class="ttdoc">Finalizes the swarm setup by destroying random generators and logging completion.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00720">ParticleSwarm.c:720</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_a26fa0cca0aa8b05f2705cdd0e7d37658"><div class="ttname"><a href="ParticleSwarm_8c.html#a26fa0cca0aa8b05f2705cdd0e7d37658">InitializeRandomGenerators</a></div><div class="ttdeci">PetscErrorCode InitializeRandomGenerators(UserCtx *user, PetscRandom *randx, PetscRandom *randy, PetscRandom *randz)</div><div class="ttdoc">Initializes random number generators for assigning particle properties.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00112">ParticleSwarm.c:112</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_a5488e87ab4fa163467b3db9ce10233a5"><div class="ttname"><a href="ParticleSwarm_8c.html#a5488e87ab4fa163467b3db9ce10233a5">PrepareLoadedSwarmForRelocation</a></div><div class="ttdeci">PetscErrorCode PrepareLoadedSwarmForRelocation(UserCtx *user)</div><div class="ttdoc">Resets the location-dependent state of a loaded swarm to force relocation.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l01078">ParticleSwarm.c:1078</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_ab723e91906e01ec26aab97de6623000c"><div class="ttname"><a href="ParticleSwarm_8c.html#ab723e91906e01ec26aab97de6623000c">InitializeLogicalSpaceRNGs</a></div><div class="ttdeci">PetscErrorCode InitializeLogicalSpaceRNGs(PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k)</div><div class="ttdoc">Initializes random number generators for logical space operations [0.0, 1.0).</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00158">ParticleSwarm.c:158</a></div></div>
<div class="ttc" id="aParticleSwarm_8c_html_af2b3080ee0e5c8e0175ac594a2c497b5"><div class="ttname"><a href="ParticleSwarm_8c.html#af2b3080ee0e5c8e0175ac594a2c497b5">AssignInitialPropertiesToSwarm</a></div><div class="ttdeci">PetscErrorCode AssignInitialPropertiesToSwarm(UserCtx *user, PetscInt particlesPerProcess, PetscRandom *rand_phys_x, PetscRandom *rand_phys_y, PetscRandom *rand_phys_z, PetscRandom *rand_logic_i, PetscRandom *rand_logic_j, PetscRandom *rand_logic_k, BoundingBox *bboxlist)</div><div class="ttdoc">Initializes all particle properties in the swarm.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00606">ParticleSwarm.c:606</a></div></div>
<div class="ttc" id="aio_8h_html_a64286adf953993b2a0c5c3fbee40d5a2"><div class="ttname"><a href="io_8h.html#a64286adf953993b2a0c5c3fbee40d5a2">ReadAllSwarmFields</a></div><div class="ttdeci">PetscErrorCode ReadAllSwarmFields(UserCtx *user, PetscInt ti)</div><div class="ttdoc">Reads multiple fields (positions, velocity, CellID, and weight) into a DMSwarm.</div><div class="ttdef"><b>Definition</b> <a href="io_8c_source.html#l02318">io.c:2318</a></div></div>
<div class="ttc" id="avariables_8h_html_a41a6127b3c012c516a7dcc56c3696a84"><div class="ttname"><a href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">SimCtx::usermg</a></div><div class="ttdeci">UserMG usermg</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00560">variables.h:560</a></div></div>
<div class="ttc" id="avariables_8h_html_a5eedf611da6dd4f59cc65753b777b957"><div class="ttname"><a href="variables_8h.html#a5eedf611da6dd4f59cc65753b777b957">SimCtx::np</a></div><div class="ttdeci">PetscInt np</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00546">variables.h:546</a></div></div>
<div class="ttc" id="avariables_8h_html_a8c248c162038dffe12e38228bcd06644"><div class="ttname"><a href="variables_8h.html#a8c248c162038dffe12e38228bcd06644">SimCtx::bboxlist</a></div><div class="ttdeci">BoundingBox * bboxlist</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00549">variables.h:549</a></div></div>
<div class="ttc" id="avariables_8h_html_ac9684d6e871566d55c997416270b5b99"><div class="ttname"><a href="variables_8h.html#ac9684d6e871566d55c997416270b5b99">SimCtx::step</a></div><div class="ttdeci">PetscInt step</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00482">variables.h:482</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a10f4f7dc00a854759067cf96ab66485a"><div class="ttname"><a href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">UserMG::mgctx</a></div><div class="ttdeci">MGCtx * mgctx</div><div class="ttdoc">Array of multigrid contexts, one for each level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00429">variables.h:429</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4a7154d09d7dee5e3dd7f0323dfb4ff3"><div class="ttname"><a href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">MGCtx::user</a></div><div class="ttdeci">UserCtx * user</div><div class="ttdoc">Pointer to the main application context for this level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00419">variables.h:419</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aac8e0dd714804b073dbb32c0ad84b2eb"><div class="ttname"><a href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">UserMG::mglevels</a></div><div class="ttdeci">PetscInt mglevels</div><div class="ttdoc">Total number of multigrid levels.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00426">variables.h:426</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structBoundingBox"><div class="ttname"><a href="variables__old_8h.html#structBoundingBox">BoundingBox</a></div><div class="ttdoc">Defines a 3D axis-aligned bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00154">variables.h:154</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserCtx"><div class="ttname"><a href="variables__old_8h.html#structUserCtx">UserCtx</a></div><div class="ttdoc">User-defined context containing data specific to a single computational grid level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00582">variables.h:582</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_ada215a5db25227a8fd2cd2596e7d3e57_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_ada215a5db25227a8fd2cd2596e7d3e57_icgraph.svg" width="284" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a26fa0cca0aa8b05f2705cdd0e7d37658" name="a26fa0cca0aa8b05f2705cdd0e7d37658"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26fa0cca0aa8b05f2705cdd0e7d37658">&#9670;&#160;</a></span>InitializeRandomGenerators()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeRandomGenerators </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>randx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>randy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscRandom *&#160;</td>
          <td class="paramname"><em>randz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes random number generators for assigning particle properties. </p>
<p>This function creates and configures separate PETSc random number generators for the x, y, and z coordinates.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure containing simulation context. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">randx</td><td>Pointer to store the RNG for the x-coordinate. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">randy</td><td>Pointer to store the RNG for the y-coordinate. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">randz</td><td>Pointer to store the RNG for the z-coordinate.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00112">112</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  112</span>                                                                                                                     {</div>
<div class="line"><span class="lineno">  113</span>    PetscErrorCode ierr;  <span class="comment">// Error code for PETSc functions</span></div>
<div class="line"><span class="lineno">  114</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  115</span>    MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank);</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    <span class="comment">// Initialize RNG for x-coordinate</span></div>
<div class="line"><span class="lineno">  118</span>    ierr = PetscRandomCreate(PETSC_COMM_SELF, randx); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  119</span>    ierr = PetscRandomSetType((*randx), PETSCRAND48); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  120</span>    ierr = PetscRandomSetInterval(*randx, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a>.<a class="code hl_variable" href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">min_coords</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a>.<a class="code hl_variable" href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">max_coords</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  121</span>    ierr = PetscRandomSetSeed(*randx, rank + 12345); CHKERRQ(ierr);  <span class="comment">// Unique seed per rank</span></div>
<div class="line"><span class="lineno">  122</span>    ierr = PetscRandomSeed(*randx); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  123</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeRandomGenerators - Initialized RNG for X-axis.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>    <span class="comment">// Initialize RNG for y-coordinate</span></div>
<div class="line"><span class="lineno">  126</span>    ierr = PetscRandomCreate(PETSC_COMM_SELF, randy); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  127</span>    ierr = PetscRandomSetType((*randy), PETSCRAND48); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  128</span>    ierr = PetscRandomSetInterval(*randy, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a>.<a class="code hl_variable" href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">min_coords</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a>.<a class="code hl_variable" href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">max_coords</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  129</span>    ierr = PetscRandomSetSeed(*randy, rank + 67890); CHKERRQ(ierr);  <span class="comment">// Unique seed per rank</span></div>
<div class="line"><span class="lineno">  130</span>    ierr = PetscRandomSeed(*randy); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  131</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeRandomGenerators - Initialized RNG for Y-axis.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>    <span class="comment">// Initialize RNG for z-coordinate</span></div>
<div class="line"><span class="lineno">  134</span>    ierr = PetscRandomCreate(PETSC_COMM_SELF, randz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  135</span>    ierr = PetscRandomSetType((*randz), PETSCRAND48); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  136</span>    ierr = PetscRandomSetInterval(*randz, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a>.<a class="code hl_variable" href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">min_coords</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a>.<a class="code hl_variable" href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">max_coords</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  137</span>    ierr = PetscRandomSetSeed(*randz, rank + 54321); CHKERRQ(ierr);  <span class="comment">// Unique seed per rank</span></div>
<div class="line"><span class="lineno">  138</span>    ierr = PetscRandomSeed(*randz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  139</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;InitializeRandomGenerators - Initialized RNG for Z-axis.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  140</span> </div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  142</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a4d66dc20efb64cf45770997139fae524"><div class="ttname"><a href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">BoundingBox::max_coords</a></div><div class="ttdeci">Cmpnts max_coords</div><div class="ttdoc">Maximum x, y, z coordinates of the bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00156">variables.h:156</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a6b5da58d79c9c0ed6e9368c9677d5260"><div class="ttname"><a href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">BoundingBox::min_coords</a></div><div class="ttdeci">Cmpnts min_coords</div><div class="ttdoc">Minimum x, y, z coordinates of the bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00155">variables.h:155</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ae85e7171c483d180ffe8759fd13b4312"><div class="ttname"><a href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">UserCtx::bbox</a></div><div class="ttdeci">BoundingBox bbox</div><div class="ttdoc">Bounding box for the local processor's grid domain.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00593">variables.h:593</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a26fa0cca0aa8b05f2705cdd0e7d37658_icgraph.svg" width="536" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac3566e0b51587686bc6c1366a67c44af" name="ac3566e0b51587686bc6c1366a67c44af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3566e0b51587686bc6c1366a67c44af">&#9670;&#160;</a></span>InitializeSwarm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeSwarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the DMSwarm object within the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure. </p>
<p>This function creates the DMSwarm, sets its type and dimension, and configures basic swarm properties.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure containing simulation context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00015">15</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   15</span>                                              {</div>
<div class="line"><span class="lineno">   16</span>    PetscErrorCode ierr;  <span class="comment">// Error code for PETSc functions</span></div>
<div class="line"><span class="lineno">   17</span> </div>
<div class="line"><span class="lineno">   18</span>    <span class="comment">// Create the DMSwarm object for particle management</span></div>
<div class="line"><span class="lineno">   19</span>    ierr = DMCreate(PETSC_COMM_WORLD, &amp;user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   20</span>    ierr = DMSetType(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, DMSWARM); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   21</span>    ierr = DMSetDimension(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, 3); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   22</span>    ierr = DMSwarmSetType(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, DMSWARM_BASIC); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   23</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;InitializeSwarm - DMSwarm created and configured.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   24</span> </div>
<div class="line"><span class="lineno">   25</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   26</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_ac3566e0b51587686bc6c1366a67c44af_icgraph.svg" width="662" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a412856be59df7252e66bcbdd13cf1718" name="a412856be59df7252e66bcbdd13cf1718"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a412856be59df7252e66bcbdd13cf1718">&#9670;&#160;</a></span>IsParticleInsideBoundingBox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscBool IsParticleInsideBoundingBox </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *&#160;</td>
          <td class="paramname"><em>bbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if a particle's location is within a specified bounding box. </p>
<p>This function determines whether the given particle's location lies inside the provided bounding box. It performs an axis-aligned bounding box (AABB) check by comparing the particle's coordinates to the minimum and maximum coordinates of the bounding box in each dimension (x, y, z).</p>
<p>Logging statements are included to provide detailed information about the function's execution.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bbox</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structure containing minimum and maximum coordinates. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure containing the particle's location and identifier.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscBool Returns <code>PETSC_TRUE</code> if the particle is inside the bounding box, <code>PETSC_FALSE</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The function assumes that the <code>bbox</code> and <code>particle</code> pointers are valid and non-NULL.</li>
<li>The function includes logging statements that start with the function name.</li>
<li>Be cautious when logging in performance-critical code sections, especially if the function is called frequently.</li>
</ul>
</dd></dl>
<p>This function determines whether the given particle's location lies inside the provided bounding box. It performs an axis-aligned bounding box (AABB) check by comparing the particle's coordinates to the minimum and maximum coordinates of the bounding box in each dimension (x, y, z).</p>
<p>logging statements are included to provide detailed information about the function's execution.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bbox</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structure containing minimum and maximum coordinates. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure containing the particle's location and identifier.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscBool Returns <code>PETSC_TRUE</code> if the particle is inside the bounding box, <code>PETSC_FALSE</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The function assumes that the <code>bbox</code> and <code>particle</code> pointers are valid and non-NULL.</li>
<li>The function includes logging statements that start with the function name.</li>
<li>The <code>LOG_ALLOW_SCOPE</code> variable is used to distinguish between <code>GLOBAL</code> and <code>LOCAL</code> LOG_ALLOW outputs.</li>
<li>Be cautious when logging in performance-critical code sections, especially if the function is called frequently. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00964">964</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  965</span>{</div>
<div class="line"><span class="lineno">  966</span>    <span class="comment">// Function name for logging purposes</span></div>
<div class="line"><span class="lineno">  967</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *funcName = <span class="stringliteral">&quot;IsParticleInsideBoundingBox&quot;</span>;</div>
<div class="line"><span class="lineno">  968</span> </div>
<div class="line"><span class="lineno">  969</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno">  970</span>    <span class="keywordflow">if</span> (!bbox) {</div>
<div class="line"><span class="lineno">  971</span>        <span class="comment">// LOG_ALLOW error message and return PETSC_FALSE</span></div>
<div class="line"><span class="lineno">  972</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;%s: Error - &#39;bbox&#39; pointer is NULL.&quot;</span>, funcName);</div>
<div class="line"><span class="lineno">  973</span>        <span class="keywordflow">return</span> PETSC_FALSE;</div>
<div class="line"><span class="lineno">  974</span>    }</div>
<div class="line"><span class="lineno">  975</span>    <span class="keywordflow">if</span> (!particle) {</div>
<div class="line"><span class="lineno">  976</span>      <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>,<span class="stringliteral">&quot;%s: Error - &#39;particle&#39; pointer is NULL.&quot;</span>, funcName);</div>
<div class="line"><span class="lineno">  977</span>        <span class="keywordflow">return</span> PETSC_FALSE;</div>
<div class="line"><span class="lineno">  978</span>    }</div>
<div class="line"><span class="lineno">  979</span> </div>
<div class="line"><span class="lineno">  980</span>    <span class="comment">// Extract particle location and bounding box coordinates</span></div>
<div class="line"><span class="lineno">  981</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> loc = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>;</div>
<div class="line"><span class="lineno">  982</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> min_coords = bbox-&gt;<a class="code hl_variable" href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">min_coords</a>;</div>
<div class="line"><span class="lineno">  983</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> max_coords = bbox-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">max_coords</a>;</div>
<div class="line"><span class="lineno">  984</span> </div>
<div class="line"><span class="lineno">  985</span>    <span class="comment">// LOG_ALLOW the particle location and bounding box coordinates for debugging</span></div>
<div class="line"><span class="lineno">  986</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s: Particle PID %ld location: (%.6f, %.6f, %.6f).\n&quot;</span>, funcName, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>, loc.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, loc.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, loc.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  987</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s: BoundingBox min_coords: (%.6f, %.6f, %.6f), max_coords: (%.6f, %.6f, %.6f).\n&quot;</span>,</div>
<div class="line"><span class="lineno">  988</span>        funcName, min_coords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, min_coords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, min_coords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, max_coords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, max_coords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, max_coords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  989</span> </div>
<div class="line"><span class="lineno">  990</span>    <span class="comment">// Check if the particle&#39;s location is within the bounding box</span></div>
<div class="line"><span class="lineno">  991</span>    <span class="keywordflow">if</span> ((loc.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &gt;= min_coords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &amp;&amp; loc.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &lt;= max_coords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) &amp;&amp;</div>
<div class="line"><span class="lineno">  992</span>        (loc.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &gt;= min_coords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &amp;&amp; loc.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &lt;= max_coords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) &amp;&amp;</div>
<div class="line"><span class="lineno">  993</span>        (loc.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &gt;= min_coords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &amp;&amp; loc.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &lt;= max_coords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>)) {</div>
<div class="line"><span class="lineno">  994</span>        <span class="comment">// Particle is inside the bounding box</span></div>
<div class="line"><span class="lineno">  995</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s: Particle PID %ld is inside the bounding box.\n&quot;</span>, funcName, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>);</div>
<div class="line"><span class="lineno">  996</span>        <span class="keywordflow">return</span> PETSC_TRUE;</div>
<div class="line"><span class="lineno">  997</span>    }</div>
<div class="line"><span class="lineno">  998</span> </div>
<div class="line"><span class="lineno">  999</span>    <span class="comment">// Particle is outside the bounding box</span></div>
<div class="line"><span class="lineno"> 1000</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;%s: Particle PID %ld is outside the bounding box.\n&quot;</span>, funcName, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>);</div>
<div class="line"><span class="lineno"> 1001</span>    <span class="keywordflow">return</span> PETSC_FALSE;</div>
<div class="line"><span class="lineno"> 1002</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a71cca12cd9fb0796634a7076eeb9b50b"><div class="ttname"><a href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">Particle::loc</a></div><div class="ttdeci">Cmpnts loc</div><div class="ttdoc">Physical location (x,y,z) of the particle.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00168">variables.h:168</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aecd4cd7f1da07e3f3d6e1fb6cf71a44b"><div class="ttname"><a href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">Particle::PID</a></div><div class="ttdeci">PetscInt64 PID</div><div class="ttdoc">Unique Particle ID.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00166">variables.h:166</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structCmpnts"><div class="ttname"><a href="variables__old_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5488e87ab4fa163467b3db9ce10233a5" name="a5488e87ab4fa163467b3db9ce10233a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5488e87ab4fa163467b3db9ce10233a5">&#9670;&#160;</a></span>PrepareLoadedSwarmForRelocation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PrepareLoadedSwarmForRelocation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets the location-dependent state of a loaded swarm to force relocation. </p>
<p>This function is a critical part of the simulation restart procedure. It must be called immediately after <code>ReadAllSwarmFields</code> has populated a swarm from restart files. Its purpose is to invalidate the "location" state of the loaded particles, ensuring that the <code>LocateAllParticlesInGrid_TEST</code> orchestrator performs a fresh, comprehensive search for every particle based on its loaded position.</p>
<p>It does this by performing two actions on every locally-owned particle:</p><ol type="1">
<li>It resets the <code>DMSwarm_CellID</code> field to a sentinel value of <code>(-1, -1, -1)</code>. This invalidates any cell index that might have been loaded or defaulted to 0.</li>
<li>It sets the <code>DMSwarm_location_status</code> field to <code>NEEDS_LOCATION</code>.</li>
</ol>
<p>This guarantees that the location logic will not mistakenly use a stale cell index from a previous run and will instead use the robust "Guess -&gt; Verify" strategy appropriate for particles with unknown locations.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure which contains the <code>DMSwarm</code> object that has just been loaded with data from restart files. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a non-zero PETSc error code if field access fails. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l01078">1078</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1079</span>{</div>
<div class="line"><span class="lineno"> 1080</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1081</span>    DM             swarm;</div>
<div class="line"><span class="lineno"> 1082</span>    PetscInt       n_local;</div>
<div class="line"><span class="lineno"> 1083</span>    PetscInt      *cell_p;    <span class="comment">// Pointer to the raw data for the CellID field</span></div>
<div class="line"><span class="lineno"> 1084</span>    PetscInt      *status_p;  <span class="comment">// Pointer to the raw data for the location_status field</span></div>
<div class="line"><span class="lineno"> 1085</span>    PetscInt64    *PIDs;      <span class="comment">// Pointer to the raw data for the Particle ID field.</span></div>
<div class="line"><span class="lineno"> 1086</span>    PetscMPIInt   rank,size;</div>
<div class="line"><span class="lineno"> 1087</span> </div>
<div class="line"><span class="lineno"> 1088</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno"> 1089</span> </div>
<div class="line"><span class="lineno"> 1090</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD,&amp;rank);  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1091</span>    ierr = MPI_Comm_size(PETSC_COMM_WORLD,&amp;size);  CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1092</span> </div>
<div class="line"><span class="lineno"> 1093</span>    <a class="code hl_struct" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><span class="lineno"> 1094</span>    </div>
<div class="line"><span class="lineno"> 1095</span>    <span class="comment">// --- 1. Input Validation and Setup ---</span></div>
<div class="line"><span class="lineno"> 1096</span>    <span class="keywordflow">if</span> (!user || !user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>) {</div>
<div class="line"><span class="lineno"> 1097</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;UserCtx or its DMSwarm is NULL in PrepareLoadedSwarmForRelocation.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1098</span>    }</div>
<div class="line"><span class="lineno"> 1099</span>    swarm = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>;</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>    <span class="comment">// Get the number of particles on this MPI rank.</span></div>
<div class="line"><span class="lineno"> 1102</span>    ierr = DMSwarmGetLocalSize(swarm, &amp;n_local); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1103</span> </div>
<div class="line"><span class="lineno"> 1104</span>    <span class="comment">// If there are no local particles, there is nothing to do.</span></div>
<div class="line"><span class="lineno"> 1105</span>    <span class="keywordflow">if</span> (n_local == 0) {</div>
<div class="line"><span class="lineno"> 1106</span>        PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1107</span>    }</div>
<div class="line"><span class="lineno"> 1108</span> </div>
<div class="line"><span class="lineno"> 1109</span>    </div>
<div class="line"><span class="lineno"> 1110</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Preparing %d loaded particles for relocation by resetting their CellID and Status.\n&quot;</span>, n_local);</div>
<div class="line"><span class="lineno"> 1111</span> </div>
<div class="line"><span class="lineno"> 1112</span>    <span class="comment">// --- 2. Get Writable Access to Swarm Fields ---</span></div>
<div class="line"><span class="lineno"> 1113</span>    <span class="comment">// This provides direct pointers to the underlying data arrays for the fields.</span></div>
<div class="line"><span class="lineno"> 1114</span>    ierr = DMSwarmGetField(swarm, <span class="stringliteral">&quot;DMSwarm_CellID&quot;</span>,          NULL, NULL, (<span class="keywordtype">void</span>**)&amp;cell_p);   CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1115</span>    ierr = DMSwarmGetField(swarm, <span class="stringliteral">&quot;DMSwarm_location_status&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;status_p); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1116</span>    ierr = DMSwarmGetField(swarm, <span class="stringliteral">&quot;DMSwarm_pid&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;PIDs); CHKERRQ(ierr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1117</span> </div>
<div class="line"><span class="lineno"> 1118</span>    <span class="comment">// --- 3. Determine Starting Global PID for this Rank ---</span></div>
<div class="line"><span class="lineno"> 1119</span>    PetscInt particles_per_rank_ideal = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a5eedf611da6dd4f59cc65753b777b957">np</a> / size; <span class="comment">// Assumes user-&gt;size is PETSC_COMM_WORLD size</span></div>
<div class="line"><span class="lineno"> 1120</span>    PetscInt remainder_particles = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a5eedf611da6dd4f59cc65753b777b957">np</a> % size;</div>
<div class="line"><span class="lineno"> 1121</span>    PetscInt base_pid_for_rank = rank * particles_per_rank_ideal + PetscMin(rank, remainder_particles);</div>
<div class="line"><span class="lineno"> 1122</span>    <span class="comment">// This calculation must match how particlesPerProcess was determined (e.g., in DistributeParticles).</span></div>
<div class="line"><span class="lineno"> 1123</span>    </div>
<div class="line"><span class="lineno"> 1124</span>    <span class="comment">// --- 4. Loop Through All Local Particles and Reset State ---</span></div>
<div class="line"><span class="lineno"> 1125</span>    <span class="keywordflow">for</span> (PetscInt p = 0; p &lt; n_local; ++p) {</div>
<div class="line"><span class="lineno"> 1126</span> </div>
<div class="line"><span class="lineno"> 1127</span>        </div>
<div class="line"><span class="lineno"> 1128</span>        <span class="comment">// Reset the 3 components of the cell index vector.</span></div>
<div class="line"><span class="lineno"> 1129</span>        cell_p[3*p + 0] = -1;</div>
<div class="line"><span class="lineno"> 1130</span>        cell_p[3*p + 1] = -1;</div>
<div class="line"><span class="lineno"> 1131</span>        cell_p[3*p + 2] = -1;</div>
<div class="line"><span class="lineno"> 1132</span> </div>
<div class="line"><span class="lineno"> 1133</span>        <span class="comment">// Reset the status to ensure it will be processed by the location algorithm.</span></div>
<div class="line"><span class="lineno"> 1134</span>        status_p[p] = (<a class="code hl_enumeration" href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a>)<a class="code hl_enumvalue" href="variables_8h.html#a347829443e8a679209e21f7f04f51581af096820742c38363e9d6c33e7c932780">UNINITIALIZED</a>;</div>
<div class="line"><span class="lineno"> 1135</span> </div>
<div class="line"><span class="lineno"> 1136</span>    <span class="comment">//set the PID for each particle</span></div>
<div class="line"><span class="lineno"> 1137</span>    PIDs[p] =  (PetscInt64)base_pid_for_rank + p;</div>
<div class="line"><span class="lineno"> 1138</span>    }</div>
<div class="line"><span class="lineno"> 1139</span> </div>
<div class="line"><span class="lineno"> 1140</span>    <span class="comment">// --- 4. Restore Fields ---</span></div>
<div class="line"><span class="lineno"> 1141</span>    <span class="comment">// This returns control of the data arrays back to the DMSwarm. It is a mandatory</span></div>
<div class="line"><span class="lineno"> 1142</span>    <span class="comment">// step to ensure data consistency and prevent memory issues.</span></div>
<div class="line"><span class="lineno"> 1143</span>    ierr = DMSwarmRestoreField(swarm, <span class="stringliteral">&quot;DMSwarm_CellID&quot;</span>,          NULL, NULL, (<span class="keywordtype">void</span>**)&amp;cell_p);   CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1144</span>    ierr = DMSwarmRestoreField(swarm, <span class="stringliteral">&quot;DMSwarm_location_status&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;status_p); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1145</span>    ierr = DMSwarmRestoreField(swarm, <span class="stringliteral">&quot;DMSwarm_pid&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;PIDs); CHKERRQ(ierr); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno"> 1146</span> </div>
<div class="line"><span class="lineno"> 1147</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Successfully reset location state for all loaded particles.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1148</span> </div>
<div class="line"><span class="lineno"> 1149</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno"> 1150</span>}</div>
<div class="ttc" id="avariables_8h_html_a347829443e8a679209e21f7f04f51581"><div class="ttname"><a href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a></div><div class="ttdeci">ParticleLocationStatus</div><div class="ttdoc">Defines the state of a particle with respect to its location and migration status during the iterativ...</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00135">variables.h:135</a></div></div>
<div class="ttc" id="avariables_8h_html_a347829443e8a679209e21f7f04f51581af096820742c38363e9d6c33e7c932780"><div class="ttname"><a href="variables_8h.html#a347829443e8a679209e21f7f04f51581af096820742c38363e9d6c33e7c932780">UNINITIALIZED</a></div><div class="ttdeci">@ UNINITIALIZED</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00141">variables.h:140</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a5488e87ab4fa163467b3db9ce10233a5_icgraph.svg" width="586" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aeae3fd559e91d7379302acb6ccd13011" name="aeae3fd559e91d7379302acb6ccd13011"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeae3fd559e91d7379302acb6ccd13011">&#9670;&#160;</a></span>RegisterParticleFields()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode RegisterParticleFields </td>
          <td>(</td>
          <td class="paramtype">DM&#160;</td>
          <td class="paramname"><em>swarm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers necessary particle fields within the DMSwarm. </p>
<p>This function registers fields such as position, velocity, CellID, and weight for each particle.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">swarm</td><td>The DMSwarm object managing the particle swarm.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00064">64</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   65</span>{</div>
<div class="line"><span class="lineno">   66</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">   67</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">   68</span>    </div>
<div class="line"><span class="lineno">   69</span>    <span class="comment">// Register each field using the helper function</span></div>
<div class="line"><span class="lineno">   70</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm, <span class="stringliteral">&quot;position&quot;</span>, 3 ,PETSC_REAL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   71</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Registered field &#39;position&#39;.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   72</span>    </div>
<div class="line"><span class="lineno">   73</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm, <span class="stringliteral">&quot;velocity&quot;</span>, 3, PETSC_REAL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   74</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Registered field &#39;velocity&#39;.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   75</span>    </div>
<div class="line"><span class="lineno">   76</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm, <span class="stringliteral">&quot;DMSwarm_CellID&quot;</span>, 3, PETSC_INT); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   77</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Registered field &#39;DMSwarm_CellID&#39;.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   78</span>    </div>
<div class="line"><span class="lineno">   79</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm, <span class="stringliteral">&quot;weight&quot;</span>, 3,PETSC_REAL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   80</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Registered field &#39;weight&#39;.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm,<span class="stringliteral">&quot;Psi&quot;</span>, 1,PETSC_REAL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   83</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Registered field &#39;P&#39; - Pressure.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>    ierr = <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm,<span class="stringliteral">&quot;pos_phy&quot;</span>, 3,PETSC_REAL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   87</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Registered field &#39;pos_phy&#39; - Physical Position.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>    ierr =  <a class="code hl_function" href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a>(swarm,<span class="stringliteral">&quot;DMSwarm_location_status&quot;</span>,1,PETSC_INT);CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   90</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Registered field &#39;DMSwarm_location_status&#39; - Status of Location of Particle(located,lost etc).\n&quot;</span>);</div>
<div class="line"><span class="lineno">   91</span>    </div>
<div class="line"><span class="lineno">   92</span>    <span class="comment">// Finalize the field registration after all fields have been added</span></div>
<div class="line"><span class="lineno">   93</span>    ierr = DMSwarmFinalizeFieldRegister(swarm); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   94</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;RegisterParticleFields - Finalized field registration.\n&quot;</span>);</div>
<div class="line"><span class="lineno">   95</span>    </div>
<div class="line"><span class="lineno">   96</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">   97</span>}</div>
<div class="ttc" id="aParticleSwarm_8c_html_a1b5741b17ffa7a57d8c1f6636e956d08"><div class="ttname"><a href="ParticleSwarm_8c.html#a1b5741b17ffa7a57d8c1f6636e956d08">RegisterSwarmField</a></div><div class="ttdeci">static PetscErrorCode RegisterSwarmField(DM swarm, const char *fieldName, PetscInt fieldDim, PetscDataType dtype)</div><div class="ttdoc">Registers a swarm field without finalizing registration.</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00041">ParticleSwarm.c:41</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_aeae3fd559e91d7379302acb6ccd13011_cgraph.svg" width="374" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_aeae3fd559e91d7379302acb6ccd13011_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aa353055e357151aab1542bbad367c657" name="aa353055e357151aab1542bbad367c657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa353055e357151aab1542bbad367c657">&#9670;&#160;</a></span>UnpackSwarmFields()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode UnpackSwarmFields </td>
          <td>(</td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscInt64 *&#160;</td>
          <td class="paramname"><em>PIDs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscReal *&#160;</td>
          <td class="paramname"><em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscReal *&#160;</td>
          <td class="paramname"><em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PetscInt *&#160;</td>
          <td class="paramname"><em>cellIndices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>velocities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>LocStatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct with data from DMSwarm fields. </p>
<p>This helper function populates a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure using data retrieved from DMSwarm fields.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>Index of the particle in the DMSwarm. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PIDs</td><td>Pointer to the array of particle IDs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">weights</td><td>Pointer to the array of particle weights. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">positions</td><td>Pointer to the array of particle positions. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cellIndices</td><td>Pointer to the array of particle cell indices. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">velocities</td><td>Pointer to the array of particle velocities. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">LocStatus</td><td>Pointer to the array of cell location status indicators. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct to initialize.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00837">837</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  839</span>                                                                               {</div>
<div class="line"><span class="lineno">  840</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  841</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  842</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD,&amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  845</span>    </div>
<div class="line"><span class="lineno">  846</span>    <span class="keywordflow">if</span> (particle == NULL) {</div>
<div class="line"><span class="lineno">  847</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;Output Particle pointer is NULL. \n&quot;</span>);</div>
<div class="line"><span class="lineno">  848</span>    }</div>
<div class="line"><span class="lineno">  849</span>    </div>
<div class="line"><span class="lineno">  850</span>    <span class="comment">// logging the start of particle initialization</span></div>
<div class="line"><span class="lineno">  851</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;[Rank %d]Unpacking Particle [%d] with PID: %ld.\n&quot;</span>,rank, i, PIDs[i]);</div>
<div class="line"><span class="lineno">  852</span>    </div>
<div class="line"><span class="lineno">  853</span>    <span class="comment">// Initialize PID</span></div>
<div class="line"><span class="lineno">  854</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a> = PIDs[i];</div>
<div class="line"><span class="lineno">  855</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d]Particle [%d] PID set to: %ld.\n&quot;</span>, rank,i, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecd4cd7f1da07e3f3d6e1fb6cf71a44b">PID</a>);</div>
<div class="line"><span class="lineno">  856</span>    </div>
<div class="line"><span class="lineno">  857</span>    <span class="comment">// Initialize weights</span></div>
<div class="line"><span class="lineno">  858</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = weights[3 * i];</div>
<div class="line"><span class="lineno">  859</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = weights[3 * i + 1];</div>
<div class="line"><span class="lineno">  860</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = weights[3 * i + 2];</div>
<div class="line"><span class="lineno">  861</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d]Particle [%d] weights set to: (%.6f, %.6f, %.6f).\n&quot;</span>, </div>
<div class="line"><span class="lineno">  862</span>          rank,i, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  863</span>    </div>
<div class="line"><span class="lineno">  864</span>    <span class="comment">// Initialize locations</span></div>
<div class="line"><span class="lineno">  865</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = positions[3 * i];</div>
<div class="line"><span class="lineno">  866</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = positions[3 * i + 1];</div>
<div class="line"><span class="lineno">  867</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = positions[3 * i + 2];</div>
<div class="line"><span class="lineno">  868</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d]Particle [%d] location set to: (%.6f, %.6f, %.6f).\n&quot;</span>, </div>
<div class="line"><span class="lineno">  869</span>          rank,i, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a71cca12cd9fb0796634a7076eeb9b50b">loc</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  870</span>    </div>
<div class="line"><span class="lineno">  871</span>    <span class="comment">// Initialize velocities (assuming default zero; modify if necessary)</span></div>
<div class="line"><span class="lineno">  872</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">vel</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = velocities[3 * i];</div>
<div class="line"><span class="lineno">  873</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">vel</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = velocities[3 * i + 1];</div>
<div class="line"><span class="lineno">  874</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">vel</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = velocities[3 * i + 2];</div>
<div class="line"><span class="lineno">  875</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;[Rank %d]Particle [%d] velocities unpacked to: [%.6f,%.6f,%.6f].\n&quot;</span>,rank, i,particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">vel</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>,particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">vel</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>,particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">vel</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  876</span>    </div>
<div class="line"><span class="lineno">  877</span>    <span class="comment">// Initialize cell indices</span></div>
<div class="line"><span class="lineno">  878</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0] = cellIndices[3 * i];</div>
<div class="line"><span class="lineno">  879</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1] = cellIndices[3 * i + 1];</div>
<div class="line"><span class="lineno">  880</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2] = cellIndices[3 * i + 2];</div>
<div class="line"><span class="lineno">  881</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;[Rank %d]Particle [%d] cell indices set to: [%d, %d, %d].\n&quot;</span>,rank,i, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1], particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2]);</div>
<div class="line"><span class="lineno">  882</span> </div>
<div class="line"><span class="lineno">  883</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a88a45e3c57c861d03160f28aaa786414">location_status</a> = (<a class="code hl_enumeration" href="variables_8h.html#a347829443e8a679209e21f7f04f51581">ParticleLocationStatus</a>)LocStatus[i];</div>
<div class="line"><span class="lineno">  884</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d]Particle [%d] Status set to: %d.\n&quot;</span>,rank, i, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a88a45e3c57c861d03160f28aaa786414">location_status</a>);</div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>    <span class="comment">// The destination_rank is only set by the location search, not read from the swarm,</span></div>
<div class="line"><span class="lineno">  887</span>    <span class="comment">// so we initialize it to a known invalid state.</span></div>
<div class="line"><span class="lineno">  888</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a76cdf3edbcd6aa56f5a2ba8645e999ea">destination_rank</a> = MPI_PROC_NULL;</div>
<div class="line"><span class="lineno">  889</span>    </div>
<div class="line"><span class="lineno">  890</span>    <span class="comment">// logging the completion of particle initialization</span></div>
<div class="line"><span class="lineno">  891</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;[Rank %d]Completed initialization of Particle [%d]. \n&quot;</span>, rank,i);</div>
<div class="line"><span class="lineno">  892</span>    </div>
<div class="line"><span class="lineno">  893</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  894</span>}</div>
<div class="ttc" id="avariables__old_8h_html_a0dedc7a71f2bf127463d9bfd4ed41103"><div class="ttname"><a href="variables__old_8h.html#a0dedc7a71f2bf127463d9bfd4ed41103">Particle::vel</a></div><div class="ttdeci">Cmpnts vel</div><div class="ttdoc">Physical velocity (vx,vy,vz) of the particle.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00169">variables.h:169</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a76cdf3edbcd6aa56f5a2ba8645e999ea"><div class="ttname"><a href="variables__old_8h.html#a76cdf3edbcd6aa56f5a2ba8645e999ea">Particle::destination_rank</a></div><div class="ttdeci">PetscMPIInt destination_rank</div><div class="ttdoc">Target rank for migration (only valid if status MIGRATING_OUT)</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00172">variables.h:172</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a88a45e3c57c861d03160f28aaa786414"><div class="ttname"><a href="variables__old_8h.html#a88a45e3c57c861d03160f28aaa786414">Particle::location_status</a></div><div class="ttdeci">ParticleLocationStatus location_status</div><div class="ttdoc">Current state in the location/migration process.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00171">variables.h:171</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a90250e79337972756b8ce1daae2321f9"><div class="ttname"><a href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">Particle::cell</a></div><div class="ttdeci">PetscInt cell[3]</div><div class="ttdoc">Computational indices (i, j, k) of the cell containing the particle.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00167">variables.h:167</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad3cf9af789ad3875d496c48112ade0ec"><div class="ttname"><a href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">Particle::weights</a></div><div class="ttdeci">Cmpnts weights</div><div class="ttdoc">Interpolation weights within its host cell.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00170">variables.h:170</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_aa353055e357151aab1542bbad367c657_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a0001e483238e2b600cb9aa23a6e5338c" name="a0001e483238e2b600cb9aa23a6e5338c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0001e483238e2b600cb9aa23a6e5338c">&#9670;&#160;</a></span>UpdateParticleWeights()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode UpdateParticleWeights </td>
          <td>(</td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates a particle's interpolation weights based on distances to cell faces. </p>
<p>This function computes interpolation weights using distances to the six cell faces (<code>d</code>) and updates the <code>weight</code> field of the provided particle.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>Pointer to an array of distances to the six cell faces. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> structure whose weights are to be updated.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, or a non-zero error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l01015">1015</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1015</span>                                                                       {</div>
<div class="line"><span class="lineno"> 1016</span> </div>
<div class="line"><span class="lineno"> 1017</span>    <span class="comment">// Validate input pointers</span></div>
<div class="line"><span class="lineno"> 1018</span>    <span class="keywordflow">if</span> (!d || !particle) {</div>
<div class="line"><span class="lineno"> 1019</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL,</div>
<div class="line"><span class="lineno"> 1020</span>                <span class="stringliteral">&quot;UpdateParticleWeights - Null pointer argument (d or particle).&quot;</span>);</div>
<div class="line"><span class="lineno"> 1021</span>    }</div>
<div class="line"><span class="lineno"> 1022</span> </div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>    <span class="comment">// Validate distances</span></div>
<div class="line"><span class="lineno"> 1025</span>    <span class="keywordflow">for</span> (PetscInt i = <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>; i &lt; <a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a>; i++) {</div>
<div class="line"><span class="lineno"> 1026</span>        <span class="keywordflow">if</span> (d[i] &lt;= <a class="code hl_define" href="ParticleSwarm_8c.html#a3b8cd77851de92f44b3821c6d15fb725">INTERPOLATION_DISTANCE_TOLERANCE</a>) {</div>
<div class="line"><span class="lineno"> 1027</span>            <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>,</div>
<div class="line"><span class="lineno"> 1028</span>                <span class="stringliteral">&quot;UpdateParticleWeights - face distance d[%d] = %f &lt;= %f; &quot;</span></div>
<div class="line"><span class="lineno"> 1029</span>                <span class="stringliteral">&quot;clamping to 1e-14 to avoid zero/negative.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1030</span>                i, (<span class="keywordtype">double</span>)d[i], <a class="code hl_define" href="ParticleSwarm_8c.html#a3b8cd77851de92f44b3821c6d15fb725">INTERPOLATION_DISTANCE_TOLERANCE</a>);</div>
<div class="line"><span class="lineno"> 1031</span>            d[i] = <a class="code hl_define" href="ParticleSwarm_8c.html#a3b8cd77851de92f44b3821c6d15fb725">INTERPOLATION_DISTANCE_TOLERANCE</a>;</div>
<div class="line"><span class="lineno"> 1032</span>        }</div>
<div class="line"><span class="lineno"> 1033</span>    }</div>
<div class="line"><span class="lineno"> 1034</span> </div>
<div class="line"><span class="lineno"> 1035</span>    <span class="comment">// LOG_ALLOW the input distances</span></div>
<div class="line"><span class="lineno"> 1036</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><span class="lineno"> 1037</span>        <span class="stringliteral">&quot;UpdateParticleWeights - Calculating weights with distances: &quot;</span></div>
<div class="line"><span class="lineno"> 1038</span>        <span class="stringliteral">&quot;[LEFT=%f, RIGHT=%f, BOTTOM=%f, TOP=%f, FRONT=%f, BACK=%f].\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1039</span>        d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>], d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a>], d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>], d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a>], d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a>], d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>]);</div>
<div class="line"><span class="lineno"> 1040</span> </div>
<div class="line"><span class="lineno"> 1041</span>    <span class="comment">// Compute and update the particle&#39;s weights</span></div>
<div class="line"><span class="lineno"> 1042</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>] / (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a>] + d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a>]);</div>
<div class="line"><span class="lineno"> 1043</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>] / (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a>] + d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a>]);</div>
<div class="line"><span class="lineno"> 1044</span>    particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>] / (d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a>] + d[<a class="code hl_enumvalue" href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a>]);</div>
<div class="line"><span class="lineno"> 1045</span> </div>
<div class="line"><span class="lineno"> 1046</span>    <span class="comment">// LOG_ALLOW the updated weights</span></div>
<div class="line"><span class="lineno"> 1047</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><span class="lineno"> 1048</span>        <span class="stringliteral">&quot;UpdateParticleWeights - Updated particle weights: x=%f, y=%f, z=%f.\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1049</span>        particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno"> 1050</span> </div>
<div class="line"><span class="lineno"> 1051</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1052</span>}</div>
<div class="ttc" id="aParticleSwarm_8c_html_a3b8cd77851de92f44b3821c6d15fb725"><div class="ttname"><a href="ParticleSwarm_8c.html#a3b8cd77851de92f44b3821c6d15fb725">INTERPOLATION_DISTANCE_TOLERANCE</a></div><div class="ttdeci">#define INTERPOLATION_DISTANCE_TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="ParticleSwarm_8c_source.html#l00005">ParticleSwarm.c:5</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa0ad44897a70fba309c24a5b6007de3e3">TOP</a></div><div class="ttdeci">@ TOP</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa76bd5ec6ea9d8a1b582d8d5e43102a02">FRONT</a></div><div class="ttdeci">@ FRONT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fa8c371f4e766fb2c49c219bbc88989461">BOTTOM</a></div><div class="ttdeci">@ BOTTOM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fac921ff2cfc571c1d19b0485d7f6926ee">BACK</a></div><div class="ttdeci">@ BACK</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294fadb45120aafd37a973140edee24708065">LEFT</a></div><div class="ttdeci">@ LEFT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faea9f55d94d5c6f9337119ed01805d36f">NUM_FACES</a></div><div class="ttdeci">@ NUM_FACES</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00146">variables.h:145</a></div></div>
<div class="ttc" id="avariables_8h_html_ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38"><div class="ttname"><a href="variables_8h.html#ad3fc1d97a3c41ea9d58d0ab14f75294faec8379af7490bb9eaaf579cf17876f38">RIGHT</a></div><div class="ttdeci">@ RIGHT</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00145">variables.h:145</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_a0001e483238e2b600cb9aa23a6e5338c_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ac52b9e4afa9d1f2ba3bf59dc45b610d1" name="ac52b9e4afa9d1f2ba3bf59dc45b610d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac52b9e4afa9d1f2ba3bf59dc45b610d1">&#9670;&#160;</a></span>UpdateSwarmFields()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode UpdateSwarmFields </td>
          <td>(</td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="variables__old_8h.html#structParticle">Particle</a> *&#160;</td>
          <td class="paramname"><em>particle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>cellIndices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt *&#160;</td>
          <td class="paramname"><em>status_field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates DMSwarm fields with data from a <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct. </p>
<p>This helper function writes back the modified <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> data to the corresponding DMSwarm fields.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>Index of the particle in the DMSwarm. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">particle</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structParticle" title="Defines a particle&#39;s core properties for Lagrangian tracking.">Particle</a> struct containing updated data. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">weights</td><td>Pointer to the array of particle weights. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cellIndices</td><td>Pointer to the array of particle cell indices. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">LocStatus</td><td>Pointer to the array of cell location status indicators.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ParticleSwarm_8c_source.html#l00909">909</a> of file <a class="el" href="ParticleSwarm_8c_source.html">ParticleSwarm.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  910</span>                                                                                    {</div>
<div class="line"><span class="lineno">  911</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  912</span>    </div>
<div class="line"><span class="lineno">  913</span>    <span class="keywordflow">if</span> (particle == NULL) {</div>
<div class="line"><span class="lineno">  914</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;Input Particle pointer is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  915</span>    }</div>
<div class="line"><span class="lineno">  916</span>    </div>
<div class="line"><span class="lineno">  917</span>    <span class="comment">// logging the start of swarm fields update</span></div>
<div class="line"><span class="lineno">  918</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Updating DMSwarm fields for Particle [%d].\n&quot;</span>, i);</div>
<div class="line"><span class="lineno">  919</span>    </div>
<div class="line"><span class="lineno">  920</span>    <span class="comment">// Update weights</span></div>
<div class="line"><span class="lineno">  921</span>    weights[3 * i]     = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  922</span>    weights[3 * i + 1] = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  923</span>    weights[3 * i + 2] = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad3cf9af789ad3875d496c48112ade0ec">weights</a>.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  924</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;Updated weights for Particle [%d]: (%.6f, %.6f, %.6f).\n&quot;</span>, </div>
<div class="line"><span class="lineno">  925</span>        i, weights[3 * i], weights[3 * i + 1], weights[3 * i + 2]);</div>
<div class="line"><span class="lineno">  926</span>    </div>
<div class="line"><span class="lineno">  927</span>    <span class="comment">// Update cell indices</span></div>
<div class="line"><span class="lineno">  928</span>    cellIndices[3 * i]     = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[0];</div>
<div class="line"><span class="lineno">  929</span>    cellIndices[3 * i + 1] = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[1];</div>
<div class="line"><span class="lineno">  930</span>    cellIndices[3 * i + 2] = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a90250e79337972756b8ce1daae2321f9">cell</a>[2];</div>
<div class="line"><span class="lineno">  931</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Updated cell indices for Particle [%d]: [%d, %d, %d].\n&quot;</span>, </div>
<div class="line"><span class="lineno">  932</span>        i, cellIndices[3 * i], cellIndices[3 * i + 1], cellIndices[3 * i + 2]);</div>
<div class="line"><span class="lineno">  933</span> </div>
<div class="line"><span class="lineno">  934</span>    status_field[i] = particle-&gt;<a class="code hl_variable" href="variables__old_8h.html#a88a45e3c57c861d03160f28aaa786414">location_status</a>;</div>
<div class="line"><span class="lineno">  935</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Updated location status for Particle [%d]: [%d].\n&quot;</span>, </div>
<div class="line"><span class="lineno">  936</span>        i, status_field[i]);</div>
<div class="line"><span class="lineno">  937</span>    </div>
<div class="line"><span class="lineno">  938</span>    <span class="comment">// logging the completion of swarm fields update</span></div>
<div class="line"><span class="lineno">  939</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;Completed updating DMSwarm fields for Particle [%d].\n&quot;</span>, i);</div>
<div class="line"><span class="lineno">  940</span>    </div>
<div class="line"><span class="lineno">  941</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  942</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ParticleSwarm_8h_ac52b9e4afa9d1f2ba3bf59dc45b610d1_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="ParticleSwarm_8h.html">ParticleSwarm.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
