<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pic_dev: grid.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pic_dev<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Particle-in-Cell / CFD development codebase</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('grid_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">grid.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="grid_8h_source.html">grid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logging_8h_source.html">logging.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for grid.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="grid_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0fecd69049f6a1716f0f0b8fd5a88c68" id="r_a0fecd69049f6a1716f0f0b8fd5a88c68"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>&#160;&#160;&#160;1e-6</td></tr>
<tr class="separator:a0fecd69049f6a1716f0f0b8fd5a88c68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InitializeSingleGridDM&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InitializeAllGridDMs&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;AssignAllGridCoordinates&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;SetFinestLevelCoordinates&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;GenerateAndSetCoordinates&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ReadAndSetCoordinates&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5" id="r_ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;RestrictCoordinates&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a526448d3a1e34b608f7167a59f1d7e04" id="r_a526448d3a1e34b608f7167a59f1d7e04"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a526448d3a1e34b608f7167a59f1d7e04">ParseAndSetGridInputs</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a526448d3a1e34b608f7167a59f1d7e04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the grid source and calls the appropriate parsing routine.  <br /></td></tr>
<tr class="separator:a526448d3a1e34b608f7167a59f1d7e04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f0887f08166a2a8d01411f39fa1a40" id="r_a04f0887f08166a2a8d01411f39fa1a40"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a04f0887f08166a2a8d01411f39fa1a40">DefineAllGridDimensions</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:a04f0887f08166a2a8d01411f39fa1a40"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the parsing and setting of grid dimensions for all blocks.  <br /></td></tr>
<tr class="separator:a04f0887f08166a2a8d01411f39fa1a40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7de9f73019e4a260a2edd616dcd40a6b" id="r_a7de9f73019e4a260a2edd616dcd40a6b"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *coarse_user)</td></tr>
<tr class="memdesc:a7de9f73019e4a260a2edd616dcd40a6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the DMDA objects (da and fda) for a single <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>.  <br /></td></tr>
<tr class="separator:a7de9f73019e4a260a2edd616dcd40a6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0b95ab3ac28c8df985e38b888c9bb52" id="r_aa0b95ab3ac28c8df985e38b888c9bb52"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#aa0b95ab3ac28c8df985e38b888c9bb52">InitializeAllGridDMs</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:aa0b95ab3ac28c8df985e38b888c9bb52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the creation of DMDA objects for every block and multigrid level.  <br /></td></tr>
<tr class="separator:aa0b95ab3ac28c8df985e38b888c9bb52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb950cd51656702b75ea84d6477d0d97" id="r_acb950cd51656702b75ea84d6477d0d97"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#acb950cd51656702b75ea84d6477d0d97">SetFinestLevelCoordinates</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:acb950cd51656702b75ea84d6477d0d97"><td class="mdescLeft">&#160;</td><td class="mdescRight">A router that populates the coordinates for a single finest-level DMDA.  <br /></td></tr>
<tr class="separator:acb950cd51656702b75ea84d6477d0d97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac44553fe1434663c5211cc6ac32ef004" id="r_ac44553fe1434663c5211cc6ac32ef004"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ac44553fe1434663c5211cc6ac32ef004">GenerateAndSetCoordinates</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:ac44553fe1434663c5211cc6ac32ef004"><td class="mdescLeft">&#160;</td><td class="mdescRight">Programmatically generates and sets grid coordinates based on user parameters.  <br /></td></tr>
<tr class="separator:ac44553fe1434663c5211cc6ac32ef004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac693c757c4fd3cb75e6e06e05e25d775" id="r_ac693c757c4fd3cb75e6e06e05e25d775"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ac693c757c4fd3cb75e6e06e05e25d775">ReadAndSetCoordinates</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, FILE *fd)</td></tr>
<tr class="memdesc:ac693c757c4fd3cb75e6e06e05e25d775"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads physical coordinates from a file and populates the DMDA for a specific block.  <br /></td></tr>
<tr class="separator:ac693c757c4fd3cb75e6e06e05e25d775"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b5fe86ae6791885769361fca4ad6b2f" id="r_a5b5fe86ae6791885769361fca4ad6b2f"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a5b5fe86ae6791885769361fca4ad6b2f">RestrictCoordinates</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *coarse_user, <a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *fine_user)</td></tr>
<tr class="memdesc:a5b5fe86ae6791885769361fca4ad6b2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Populates coarse grid coordinates by restricting from a fine grid.  <br /></td></tr>
<tr class="separator:a5b5fe86ae6791885769361fca4ad6b2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2aef4bb6fc2d2223a52ff6a45c7c600" id="r_ab2aef4bb6fc2d2223a52ff6a45c7c600"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ab2aef4bb6fc2d2223a52ff6a45c7c600">AssignAllGridCoordinates</a> (<a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx)</td></tr>
<tr class="memdesc:ab2aef4bb6fc2d2223a52ff6a45c7c600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the assignment of physical coordinates to all DMDA objects.  <br /></td></tr>
<tr class="separator:ab2aef4bb6fc2d2223a52ff6a45c7c600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54a2529affe522c9e29161aef1ca3847" id="r_a54a2529affe522c9e29161aef1ca3847"><td class="memItemLeft" align="right" valign="top">static PetscReal&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a54a2529affe522c9e29161aef1ca3847">ComputeStretchedCoord</a> (PetscInt i, PetscInt N, PetscReal L, PetscReal r)</td></tr>
<tr class="memdesc:a54a2529affe522c9e29161aef1ca3847"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes a stretched coordinate along one dimension.  <br /></td></tr>
<tr class="separator:a54a2529affe522c9e29161aef1ca3847"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0c39bc7c78a15bedf9f1415ab1dded4" id="r_ae0c39bc7c78a15bedf9f1415ab1dded4"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#ae0c39bc7c78a15bedf9f1415ab1dded4">ComputeLocalBoundingBox</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *localBBox)</td></tr>
<tr class="memdesc:ae0c39bc7c78a15bedf9f1415ab1dded4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the local bounding box of the grid on the current process.  <br /></td></tr>
<tr class="separator:ae0c39bc7c78a15bedf9f1415ab1dded4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afac52c252de784d5bcd7fe7a2e642982" id="r_afac52c252de784d5bcd7fe7a2e642982"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#afac52c252de784d5bcd7fe7a2e642982">GatherAllBoundingBoxes</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **allBBoxes)</td></tr>
<tr class="memdesc:afac52c252de784d5bcd7fe7a2e642982"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gathers local bounding boxes from all MPI processes to rank 0.  <br /></td></tr>
<tr class="separator:afac52c252de784d5bcd7fe7a2e642982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a325b9d5da4b9b2c79d278fb848215632" id="r_a325b9d5da4b9b2c79d278fb848215632"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="grid_8c.html#a325b9d5da4b9b2c79d278fb848215632">BroadcastAllBoundingBoxes</a> (<a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user, <a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **bboxlist)</td></tr>
<tr class="memdesc:a325b9d5da4b9b2c79d278fb848215632"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts the bounding box list from rank 0 to all ranks.  <br /></td></tr>
<tr class="separator:a325b9d5da4b9b2c79d278fb848215632"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[1/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;InitializeSingleGridDM&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[2/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;InitializeAllGridDMs&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[3/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;AssignAllGridCoordinates&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[4/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;SetFinestLevelCoordinates&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[5/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;GenerateAndSetCoordinates&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[6/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ReadAndSetCoordinates&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5" name="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&#160;</a></span>__FUNCT__ <span class="overload">[7/7]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;RestrictCoordinates&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00090">90</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<a id="a0fecd69049f6a1716f0f0b8fd5a88c68" name="a0fecd69049f6a1716f0f0b8fd5a88c68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fecd69049f6a1716f0f0b8fd5a88c68">&#9670;&#160;</a></span>BBOX_TOLERANCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BBOX_TOLERANCE&#160;&#160;&#160;1e-6</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00006">6</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab2aef4bb6fc2d2223a52ff6a45c7c600" name="ab2aef4bb6fc2d2223a52ff6a45c7c600"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2aef4bb6fc2d2223a52ff6a45c7c600">&#9670;&#160;</a></span>AssignAllGridCoordinates()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode AssignAllGridCoordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the assignment of physical coordinates to all DMDA objects. </p>
<p>This function manages the entire process of populating the coordinate vectors for every DMDA across all multigrid levels and blocks. It follows a two-part strategy that is essential for multigrid methods:</p>
<ol type="1">
<li><b>Populate Finest Level:</b> It first loops through each block and calls a helper (<code>SetFinestLevelCoordinates</code>) to set the physical coordinates for the highest-resolution grid (the finest multigrid level).</li>
<li><b>Restrict to Coarser Levels:</b> It then iterates downwards from the finest level, calling a helper (<code>RestrictCoordinates</code>) to copy the coordinate values from the fine grid nodes to their corresponding parent nodes on the coarser grids. This ensures all levels represent the exact same geometry.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, containing the configured <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00317">317</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  318</span>{</div>
<div class="line"><span class="lineno">  319</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  320</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserMG">UserMG</a>         *usermg = &amp;simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>;</div>
<div class="line"><span class="lineno">  321</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  324</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Assigning physical coordinates to all grid DMs...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  325</span> </div>
<div class="line"><span class="lineno">  326</span>    <span class="comment">// --- Part 1: Populate the Finest Grid Level ---</span></div>
<div class="line"><span class="lineno">  327</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Setting coordinates for the finest grid level (%d)...\n&quot;</span>, usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1);</div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  329</span>        <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *fine_user = &amp;usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  330</span>        ierr = <a class="code hl_function" href="grid_8c.html#acb950cd51656702b75ea84d6477d0d97">SetFinestLevelCoordinates</a>(fine_user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  331</span>    }</div>
<div class="line"><span class="lineno">  332</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Finest level coordinates have been set for all blocks.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>    <span class="comment">// --- Part 2: Restrict Coordinates to Coarser Levels ---</span></div>
<div class="line"><span class="lineno">  336</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Restricting coordinates to coarser grid levels...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  337</span>    <span class="keywordflow">for</span> (PetscInt level = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 2; level &gt;= 0; level--) {</div>
<div class="line"><span class="lineno">  338</span>        <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  339</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *coarse_user = &amp;usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[level].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  340</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *fine_user   = &amp;usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[level + 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  341</span>            ierr = <a class="code hl_function" href="grid_8c.html#a5b5fe86ae6791885769361fca4ad6b2f">RestrictCoordinates</a>(coarse_user, fine_user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  342</span>        }</div>
<div class="line"><span class="lineno">  343</span>    }</div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Physical coordinates assigned to all grid levels and blocks.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  346</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  347</span>}</div>
<div class="ttc" id="agrid_8c_html_a5b5fe86ae6791885769361fca4ad6b2f"><div class="ttname"><a href="grid_8c.html#a5b5fe86ae6791885769361fca4ad6b2f">RestrictCoordinates</a></div><div class="ttdeci">static PetscErrorCode RestrictCoordinates(UserCtx *coarse_user, UserCtx *fine_user)</div><div class="ttdoc">Populates coarse grid coordinates by restricting from a fine grid.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00617">grid.c:617</a></div></div>
<div class="ttc" id="agrid_8c_html_acb950cd51656702b75ea84d6477d0d97"><div class="ttname"><a href="grid_8c.html#acb950cd51656702b75ea84d6477d0d97">SetFinestLevelCoordinates</a></div><div class="ttdeci">static PetscErrorCode SetFinestLevelCoordinates(UserCtx *user)</div><div class="ttdoc">A router that populates the coordinates for a single finest-level DMDA.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00367">grid.c:367</a></div></div>
<div class="ttc" id="alogging_8h_html_a3de33738fd3c7e77bffbcfaefc3e7645"><div class="ttname"><a href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a></div><div class="ttdeci">#define GLOBAL</div><div class="ttdoc">Scope for global logging across all processes.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00045">logging.h:45</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00207">logging.h:207</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_a22580e0e52ca8ddccc76d24c96f00e4a"><div class="ttname"><a href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">SimCtx::block_number</a></div><div class="ttdeci">PetscInt block_number</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00523">variables.h:523</a></div></div>
<div class="ttc" id="avariables_8h_html_a41a6127b3c012c516a7dcc56c3696a84"><div class="ttname"><a href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">SimCtx::usermg</a></div><div class="ttdeci">UserMG usermg</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00560">variables.h:560</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a10f4f7dc00a854759067cf96ab66485a"><div class="ttname"><a href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">UserMG::mgctx</a></div><div class="ttdeci">MGCtx * mgctx</div><div class="ttdoc">Array of multigrid contexts, one for each level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00429">variables.h:429</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4a7154d09d7dee5e3dd7f0323dfb4ff3"><div class="ttname"><a href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">MGCtx::user</a></div><div class="ttdeci">UserCtx * user</div><div class="ttdoc">Pointer to the main application context for this level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00419">variables.h:419</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aac8e0dd714804b073dbb32c0ad84b2eb"><div class="ttname"><a href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">UserMG::mglevels</a></div><div class="ttdeci">PetscInt mglevels</div><div class="ttdoc">Total number of multigrid levels.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00426">variables.h:426</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserCtx"><div class="ttname"><a href="variables__old_8h.html#structUserCtx">UserCtx</a></div><div class="ttdoc">User-defined context containing data specific to a single computational grid level.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00582">variables.h:582</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structUserMG"><div class="ttname"><a href="variables__old_8h.html#structUserMG">UserMG</a></div><div class="ttdoc">User-level context for managing the entire multigrid hierarchy.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00425">variables.h:425</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_ab2aef4bb6fc2d2223a52ff6a45c7c600_cgraph.svg" width="100%" height="382"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_ab2aef4bb6fc2d2223a52ff6a45c7c600_icgraph.svg" width="507" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a325b9d5da4b9b2c79d278fb848215632" name="a325b9d5da4b9b2c79d278fb848215632"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a325b9d5da4b9b2c79d278fb848215632">&#9670;&#160;</a></span>BroadcastAllBoundingBoxes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode BroadcastAllBoundingBoxes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **&#160;</td>
          <td class="paramname"><em>bboxlist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcasts the bounding box list from rank 0 to all ranks. </p>
<p>Broadcasts the bounding box information collected on rank 0 to all other ranks.</p>
<p>After GatherAllBoundingBoxes, rank 0 has an array of <code>size</code> boxes. This routine makes sure every rank ends up with its own malloc’d copy.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> (unused here, but kept for signature). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bboxlist</td><td>On entry: rank 0’s array; on exit: every rank’s array. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l01037">1037</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1038</span>{</div>
<div class="line"><span class="lineno"> 1039</span>  PetscErrorCode ierr;</div>
<div class="line"><span class="lineno"> 1040</span>  PetscMPIInt    rank, size;</div>
<div class="line"><span class="lineno"> 1041</span> </div>
<div class="line"><span class="lineno"> 1042</span>  <span class="keywordflow">if</span> (!bboxlist) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL,</div>
<div class="line"><span class="lineno"> 1043</span>                          <span class="stringliteral">&quot;BroadcastAllBoundingBoxes: NULL pointer&quot;</span>);</div>
<div class="line"><span class="lineno"> 1044</span> </div>
<div class="line"><span class="lineno"> 1045</span>  ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1046</span>  ierr = MPI_Comm_size(PETSC_COMM_WORLD, &amp;size); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1047</span> </div>
<div class="line"><span class="lineno"> 1048</span>  <span class="comment">/* Non-root ranks must allocate before the Bcast */</span></div>
<div class="line"><span class="lineno"> 1049</span>  <span class="keywordflow">if</span> (rank != 0) {</div>
<div class="line"><span class="lineno"> 1050</span>    *bboxlist = (<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>));</div>
<div class="line"><span class="lineno"> 1051</span>    <span class="keywordflow">if</span> (!*bboxlist) SETERRABORT(PETSC_COMM_WORLD, PETSC_ERR_MEM,</div>
<div class="line"><span class="lineno"> 1052</span>                                <span class="stringliteral">&quot;BroadcastAllBoundingBoxes: malloc failed&quot;</span>);</div>
<div class="line"><span class="lineno"> 1053</span>  }</div>
<div class="line"><span class="lineno"> 1054</span> </div>
<div class="line"><span class="lineno"> 1055</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1056</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno"> 1057</span>    <span class="stringliteral">&quot;Rank %d: about to MPI_Bcast(%d boxes)\n&quot;</span>, rank, size);</div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>  <span class="comment">/* Collective: every rank must call */</span></div>
<div class="line"><span class="lineno"> 1060</span>  ierr = MPI_Bcast(*bboxlist, size * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>), MPI_BYTE,</div>
<div class="line"><span class="lineno"> 1061</span>                   0, PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1062</span>  CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1063</span> </div>
<div class="line"><span class="lineno"> 1064</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1065</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno"> 1066</span>    <span class="stringliteral">&quot;Rank %d: completed MPI_Bcast(%d boxes)\n&quot;</span>, rank, size);</div>
<div class="line"><span class="lineno"> 1067</span> </div>
<div class="line"><span class="lineno"> 1068</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1069</span>}</div>
<div class="ttc" id="alogging_8h_html_a2ebe7667b52c478f7ff365f296d4c8ae"><div class="ttname"><a href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a></div><div class="ttdeci">#define LOG_ALLOW_SYNC(scope, level, fmt,...)</div><div class="ttdoc">----— DEBUG ---------------------------------------— #define LOG_ALLOW(scope, level,...</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00274">logging.h:274</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structBoundingBox"><div class="ttname"><a href="variables__old_8h.html#structBoundingBox">BoundingBox</a></div><div class="ttdoc">Defines a 3D axis-aligned bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00154">variables.h:154</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_a325b9d5da4b9b2c79d278fb848215632_icgraph.svg" width="534" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae0c39bc7c78a15bedf9f1415ab1dded4" name="ae0c39bc7c78a15bedf9f1415ab1dded4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0c39bc7c78a15bedf9f1415ab1dded4">&#9670;&#160;</a></span>ComputeLocalBoundingBox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeLocalBoundingBox </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> *&#160;</td>
          <td class="paramname"><em>localBBox</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the local bounding box of the grid on the current process. </p>
<p>This function calculates the minimum and maximum coordinates (x, y, z) of the local grid points owned by the current MPI process. It iterates over the local portion of the grid, examines each grid point's coordinates, and updates the minimum and maximum values accordingly.</p>
<p>The computed bounding box is stored in the provided <code>localBBox</code> structure, and the <code>user-&gt;bbox</code> field is also updated with this bounding box for consistency within the user context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. This context must be properly initialized before calling this function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">localBBox</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> structure where the computed local bounding box will be stored. The structure should be allocated by the caller.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00702">702</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  703</span>{</div>
<div class="line"><span class="lineno">  704</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  705</span>    PetscInt i, j, k;</div>
<div class="line"><span class="lineno">  706</span>    PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  707</span>    PetscInt xs, ys, zs, xe, ye, ze;</div>
<div class="line"><span class="lineno">  708</span>    DMDALocalInfo info;</div>
<div class="line"><span class="lineno">  709</span>    Vec coordinates;</div>
<div class="line"><span class="lineno">  710</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***coordArray;</div>
<div class="line"><span class="lineno">  711</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> minCoords, maxCoords;</div>
<div class="line"><span class="lineno">  712</span> </div>
<div class="line"><span class="lineno">  713</span>    <span class="comment">// Start of function execution</span></div>
<div class="line"><span class="lineno">  714</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Entering the function.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  715</span> </div>
<div class="line"><span class="lineno">  716</span>    <span class="comment">// Validate input Pointers</span></div>
<div class="line"><span class="lineno">  717</span>    <span class="keywordflow">if</span> (!user) {</div>
<div class="line"><span class="lineno">  718</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Input &#39;user&#39; Pointer is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  719</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_NULL;</div>
<div class="line"><span class="lineno">  720</span>    }</div>
<div class="line"><span class="lineno">  721</span>    <span class="keywordflow">if</span> (!localBBox) {</div>
<div class="line"><span class="lineno">  722</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Output &#39;localBBox&#39; Pointer is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  723</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_NULL;</div>
<div class="line"><span class="lineno">  724</span>    }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <span class="comment">// Get MPI rank</span></div>
<div class="line"><span class="lineno">  727</span>    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>    <span class="comment">// Get the local coordinates vector from the DMDA</span></div>
<div class="line"><span class="lineno">  730</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;coordinates);</div>
<div class="line"><span class="lineno">  731</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  732</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error getting local coordinates vector.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  733</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  734</span>    }</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>    <span class="keywordflow">if</span> (!coordinates) {</div>
<div class="line"><span class="lineno">  737</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Coordinates vector is NULL.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  738</span>        <span class="keywordflow">return</span> PETSC_ERR_ARG_NULL;</div>
<div class="line"><span class="lineno">  739</span>    }</div>
<div class="line"><span class="lineno">  740</span> </div>
<div class="line"><span class="lineno">  741</span>    <span class="comment">// Access the coordinate array for reading</span></div>
<div class="line"><span class="lineno">  742</span>    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, coordinates, &amp;coordArray);</div>
<div class="line"><span class="lineno">  743</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  744</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error accessing coordinate array.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  745</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  746</span>    }</div>
<div class="line"><span class="lineno">  747</span> </div>
<div class="line"><span class="lineno">  748</span>    <span class="comment">// Get the local grid information (indices and sizes)</span></div>
<div class="line"><span class="lineno">  749</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info);</div>
<div class="line"><span class="lineno">  750</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  751</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error getting DMDA local info.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  752</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  753</span>    }</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>    </div>
<div class="line"><span class="lineno">  756</span>    xs = info.gxs; xe = xs + info.gxm;</div>
<div class="line"><span class="lineno">  757</span>    ys = info.gys; ye = ys + info.gym;</div>
<div class="line"><span class="lineno">  758</span>    zs = info.gzs; ze = zs + info.gzm;</div>
<div class="line"><span class="lineno">  759</span>    </div>
<div class="line"><span class="lineno">  760</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  761</span><span class="comment">    xs = info.xs; xe = xs + info.xm;</span></div>
<div class="line"><span class="lineno">  762</span><span class="comment">    ys = info.ys; ye = ys + info.ym;</span></div>
<div class="line"><span class="lineno">  763</span><span class="comment">    zs = info.zs; ze = zs + info.zm;</span></div>
<div class="line"><span class="lineno">  764</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  765</span>    </div>
<div class="line"><span class="lineno">  766</span>    <span class="comment">// Initialize min and max coordinates with extreme values</span></div>
<div class="line"><span class="lineno">  767</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = PETSC_MAX_REAL;</div>
<div class="line"><span class="lineno">  768</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = PETSC_MIN_REAL;</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d] Grid indices (Including Ghosts): xs=%d, xe=%d, ys=%d, ye=%d, zs=%d, ze=%d.\n&quot;</span>,rank, xs, xe, ys, ye, zs, ze);</div>
<div class="line"><span class="lineno">  771</span> </div>
<div class="line"><span class="lineno">  772</span>    <span class="comment">// Iterate over the local grid to find min and max coordinates</span></div>
<div class="line"><span class="lineno">  773</span>    <span class="keywordflow">for</span> (k = zs; k &lt; ze; k++) {</div>
<div class="line"><span class="lineno">  774</span>        <span class="keywordflow">for</span> (j = ys; j &lt; ye; j++) {</div>
<div class="line"><span class="lineno">  775</span>            <span class="keywordflow">for</span> (i = xs; i &lt; xe; i++) {</div>
<div class="line"><span class="lineno">  776</span>                <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> coord = coordArray[k][j][i];</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>                <span class="comment">// Update min and max coordinates</span></div>
<div class="line"><span class="lineno">  779</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &lt; minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  780</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &lt; minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  781</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &lt; minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  782</span> </div>
<div class="line"><span class="lineno">  783</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> &gt; maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><span class="lineno">  784</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> &gt; maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><span class="lineno">  785</span>                <span class="keywordflow">if</span> (coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> &gt; maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = coord.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><span class="lineno">  786</span>            }</div>
<div class="line"><span class="lineno">  787</span>        }</div>
<div class="line"><span class="lineno">  788</span>    }</div>
<div class="line"><span class="lineno">  789</span> </div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span>    <span class="comment">// Add tolerance to bboxes.</span></div>
<div class="line"><span class="lineno">  792</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> =  minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  793</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> =  minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  794</span>    minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> =  minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  795</span> </div>
<div class="line"><span class="lineno">  796</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> =  maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  797</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> =  maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  798</span>    maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> =  maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + <a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>;</div>
<div class="line"><span class="lineno">  799</span> </div>
<div class="line"><span class="lineno">  800</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot; Tolerance added to the limits: %.8e .\n&quot;</span>,(PetscReal)<a class="code hl_define" href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a>);</div>
<div class="line"><span class="lineno">  801</span>       </div>
<div class="line"><span class="lineno">  802</span>    <span class="comment">// Log the computed min and max coordinates</span></div>
<div class="line"><span class="lineno">  803</span>     <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,<span class="stringliteral">&quot;[Rank %d]minCoords=(%.6f, %.6f, %.6f), maxCoords=(%.6f, %.6f, %.6f).\n&quot;</span>,rank,minCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, minCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, minCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, maxCoords.<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, maxCoords.<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span>    </div>
<div class="line"><span class="lineno">  807</span>    <span class="comment">// Restore the coordinate array</span></div>
<div class="line"><span class="lineno">  808</span>    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, coordinates, &amp;coordArray);</div>
<div class="line"><span class="lineno">  809</span>    <span class="keywordflow">if</span> (ierr) {</div>
<div class="line"><span class="lineno">  810</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;Error restoring coordinate array.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  811</span>        <span class="keywordflow">return</span> ierr;</div>
<div class="line"><span class="lineno">  812</span>    }</div>
<div class="line"><span class="lineno">  813</span> </div>
<div class="line"><span class="lineno">  814</span>    <span class="comment">// Set the local bounding box</span></div>
<div class="line"><span class="lineno">  815</span>    localBBox-&gt;<a class="code hl_variable" href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">min_coords</a> = minCoords;</div>
<div class="line"><span class="lineno">  816</span>    localBBox-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">max_coords</a> = maxCoords;</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>    <span class="comment">// Update the bounding box inside the UserCtx for consistency</span></div>
<div class="line"><span class="lineno">  819</span>    user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">bbox</a> = *localBBox;</div>
<div class="line"><span class="lineno">  820</span> </div>
<div class="line"><span class="lineno">  821</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Exiting the function successfully.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  822</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  823</span>}</div>
<div class="ttc" id="agrid_8c_html_a0fecd69049f6a1716f0f0b8fd5a88c68"><div class="ttname"><a href="grid_8c.html#a0fecd69049f6a1716f0f0b8fd5a88c68">BBOX_TOLERANCE</a></div><div class="ttdeci">#define BBOX_TOLERANCE</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00006">grid.c:6</a></div></div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a></div><div class="ttdeci">@ LOG_ERROR</div><div class="ttdoc">Critical errors that may halt the program.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4d66dc20efb64cf45770997139fae524"><div class="ttname"><a href="variables__old_8h.html#a4d66dc20efb64cf45770997139fae524">BoundingBox::max_coords</a></div><div class="ttdeci">Cmpnts max_coords</div><div class="ttdoc">Maximum x, y, z coordinates of the bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00156">variables.h:156</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a69966d928601d61d4f526636f84396c5"><div class="ttname"><a href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">UserCtx::fda</a></div><div class="ttdeci">DM fda</div><div class="ttdoc">DMDA for primary 3-component vector fields (e.g., Velocity).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a6b5da58d79c9c0ed6e9368c9677d5260"><div class="ttname"><a href="variables__old_8h.html#a6b5da58d79c9c0ed6e9368c9677d5260">BoundingBox::min_coords</a></div><div class="ttdeci">Cmpnts min_coords</div><div class="ttdoc">Minimum x, y, z coordinates of the bounding box.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00155">variables.h:155</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ae85e7171c483d180ffe8759fd13b4312"><div class="ttname"><a href="variables__old_8h.html#ae85e7171c483d180ffe8759fd13b4312">UserCtx::bbox</a></div><div class="ttdeci">BoundingBox bbox</div><div class="ttdoc">Bounding box for the local processor's grid domain.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00593">variables.h:593</a></div></div>
<div class="ttc" id="avariables__old_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdoc">DMDA for scalar fields (e.g., Pressure, Nvert).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00588">variables.h:588</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structCmpnts"><div class="ttname"><a href="variables__old_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_ae0c39bc7c78a15bedf9f1415ab1dded4_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a54a2529affe522c9e29161aef1ca3847" name="a54a2529affe522c9e29161aef1ca3847"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54a2529affe522c9e29161aef1ca3847">&#9670;&#160;</a></span>ComputeStretchedCoord()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscReal ComputeStretchedCoord </td>
          <td>(</td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Computes a stretched coordinate along one dimension. </p>
<p>This function computes a coordinate based on a geometric stretching ratio. If the ratio (r) is 1.0, a uniform distribution is used: x(i) = L * (i/N)</p>
<p>If r != 1.0, a geometric stretching is applied: x(i) = L * [ (r^(i/N) - 1 ) / (r - 1) ]</p>
<p>Here:</p><ul>
<li>i : The current index along the dimension.</li>
<li>N : The total number of divisions along that dimension.</li>
<li>L : The length of the domain along that dimension.</li>
<li>r : The stretching ratio. r &gt; 1.0 stretches the grid in a geometric fashion increasing spacing away from the start, whereas 0 &lt; r &lt; 1.0 would cluster points near the start.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>Current index (0 &lt;= i &lt;= N). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">N</td><td>Number of segments along the dimension. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L</td><td>Total length of the domain. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">r</td><td>Stretching ratio.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscReal The computed coordinate at index i.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function does not return a PetscErrorCode because it does not allocate memory or call PETSc routines that can fail. It is just a helper calculation function. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00453">453</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  454</span>{</div>
<div class="line"><span class="lineno">  455</span>    <span class="keywordflow">if</span> (N &lt;=1) <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><span class="lineno">  456</span>    PetscReal fraction = (PetscReal)i / ((PetscReal)N - 1.0);</div>
<div class="line"><span class="lineno">  457</span>    <span class="keywordflow">if</span> (PetscAbsReal(r - 1.0) &lt; 1.0e-9) { <span class="comment">// Use a tolerance for float comparison</span></div>
<div class="line"><span class="lineno">  458</span>        <span class="keywordflow">return</span> L * fraction;</div>
<div class="line"><span class="lineno">  459</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  460</span>        <span class="keywordflow">return</span> L * (PetscPowReal(r, fraction) - 1.0) / (r - 1.0);</div>
<div class="line"><span class="lineno">  461</span>    }</div>
<div class="line"><span class="lineno">  462</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_a54a2529affe522c9e29161aef1ca3847_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a04f0887f08166a2a8d01411f39fa1a40" name="a04f0887f08166a2a8d01411f39fa1a40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04f0887f08166a2a8d01411f39fa1a40">&#9670;&#160;</a></span>DefineAllGridDimensions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode DefineAllGridDimensions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the parsing and setting of grid dimensions for all blocks. </p>
<p>This function serves as the high-level entry point for defining the geometric properties of each grid block in the simulation. It iterates through every block defined by <code>simCtx-&gt;block_number</code>.</p>
<p>For each block, it performs two key actions:</p><ol type="1">
<li>It explicitly sets the block's index (<code>_this</code>) in the corresponding <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code> struct for the finest multigrid level. This makes the context "self-aware".</li>
<li>It calls a helper function (<code>ParseAndSetGridInputs</code>) to handle the detailed work of parsing options or files to populate the rest of the geometric properties for that specific block (e.g., <code>IM</code>, <code>Min_X</code>, <code>rx</code>).</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, which contains the number of blocks and the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy to be configured. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00057">57</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   58</span>{</div>
<div class="line"><span class="lineno">   59</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">   60</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno">   61</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a>        *fine_users;</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> == 0) {</div>
<div class="line"><span class="lineno">   66</span>        SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;MG levels not set. Cannot get finest_users.&quot;</span>);</div>
<div class="line"><span class="lineno">   67</span>    }</div>
<div class="line"><span class="lineno">   68</span>    <span class="comment">// Get the UserCtx array for the finest grid level</span></div>
<div class="line"><span class="lineno">   69</span>    fine_users = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>[simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>.<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>;</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Defining grid dimensions for %d blocks...\n&quot;</span>, nblk);</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    <span class="comment">// Loop over each block to configure its grid dimensions and geometry.</span></div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">   75</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: --- Configuring Geometry for Block %d ---\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, bi);</div>
<div class="line"><span class="lineno">   76</span> </div>
<div class="line"><span class="lineno">   77</span>        <span class="comment">// Before calling any helpers, set the block index in the context.</span></div>
<div class="line"><span class="lineno">   78</span>        <span class="comment">// This makes the UserCtx self-aware of which block it represents.</span></div>
<div class="line"><span class="lineno">   79</span>        fine_users[bi].<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a> = bi;</div>
<div class="line"><span class="lineno">   80</span> </div>
<div class="line"><span class="lineno">   81</span>        <span class="comment">// Call the helper function for this specific block. It can now derive</span></div>
<div class="line"><span class="lineno">   82</span>        <span class="comment">// all necessary information from the UserCtx pointer it receives.</span></div>
<div class="line"><span class="lineno">   83</span>        ierr = <a class="code hl_function" href="grid_8c.html#a526448d3a1e34b608f7167a59f1d7e04">ParseAndSetGridInputs</a>(&amp;fine_users[bi]); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   84</span>    }</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">   87</span>}</div>
<div class="ttc" id="agrid_8c_html_a526448d3a1e34b608f7167a59f1d7e04"><div class="ttname"><a href="grid_8c.html#a526448d3a1e34b608f7167a59f1d7e04">ParseAndSetGridInputs</a></div><div class="ttdeci">static PetscErrorCode ParseAndSetGridInputs(UserCtx *user)</div><div class="ttdoc">Determines the grid source and calls the appropriate parsing routine.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00020">grid.c:20</a></div></div>
<div class="ttc" id="avariables_8h_html_a19aa807b9181b13618527d6c4eb6fa89"><div class="ttname"><a href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">SimCtx::rank</a></div><div class="ttdeci">PetscMPIInt rank</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00477">variables.h:477</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a4f7c5fd8843d026101b193e9236e1192"><div class="ttname"><a href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">UserCtx::_this</a></div><div class="ttdeci">PetscInt _this</div><div class="ttdoc">Legacy block index, for multi-block contexts.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_a04f0887f08166a2a8d01411f39fa1a40_cgraph.svg" width="658" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_a04f0887f08166a2a8d01411f39fa1a40_icgraph.svg" width="506" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="afac52c252de784d5bcd7fe7a2e642982" name="afac52c252de784d5bcd7fe7a2e642982"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afac52c252de784d5bcd7fe7a2e642982">&#9670;&#160;</a></span>GatherAllBoundingBoxes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode GatherAllBoundingBoxes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structBoundingBox">BoundingBox</a> **&#160;</td>
          <td class="paramname"><em>allBBoxes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gathers local bounding boxes from all MPI processes to rank 0. </p>
<p>This function first computes the local bounding box on each process by calling <code>ComputeLocalBoundingBox</code>. It then uses an MPI gather operation to collect all local bounding boxes on the root process (rank 0). On rank 0, it allocates an array of <code><a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a></code> structures to hold the gathered data and returns it via the <code>allBBoxes</code> Pointer. On other ranks, <code>allBBoxes</code> is set to <code>NULL</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the user-defined context containing grid information. This context must be properly initialized before calling this function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">allBBoxes</td><td>Pointer to a Pointer where the array of gathered bounding boxes will be stored on rank 0. On rank 0, this will point to the allocated array; on other ranks, it will be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns <code>0</code> on success, non-zero on failure.</dd></dl>
<p>Broadcasts the bounding box information collected on rank 0 to all other ranks.</p>
<p>This function assumes that <code><a class="el" href="grid_8c.html#afac52c252de784d5bcd7fe7a2e642982" title="Gathers local bounding boxes from all MPI processes to rank 0.">GatherAllBoundingBoxes()</a></code> was previously called, so <code>bboxlist</code> is allocated and populated on rank 0. All other ranks will allocate memory for <code>bboxlist</code>, and this function will use MPI_Bcast to distribute the bounding box data to them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to the <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> structure. (Currently unused in this function, but kept for consistency.) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bboxlist</td><td>Pointer to the array of BoundingBoxes. On rank 0, this should point to a valid array of size 'size' (where size is the number of MPI ranks). On non-root ranks, this function will allocate memory for <code>bboxlist</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on MPI or PETSc-related errors.</dd></dl>
<p>Gathers local bounding boxes from all MPI processes to rank 0.</p>
<p>Each rank computes its local bounding box, then all ranks participate in an MPI_Gather to send their <a class="el" href="variables__old_8h.html#structBoundingBox" title="Defines a 3D axis-aligned bounding box.">BoundingBox</a> to rank 0. Rank 0 allocates the result array and returns it via allBBoxes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>Pointer to <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> (must be non-NULL). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">allBBoxes</td><td>On rank 0, receives malloc’d array of size <code>size</code>. On other ranks, set to NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00978">978</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  979</span>{</div>
<div class="line"><span class="lineno">  980</span>  PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  981</span>  PetscMPIInt    rank, size;</div>
<div class="line"><span class="lineno">  982</span>  <a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>    *bboxArray = NULL;</div>
<div class="line"><span class="lineno">  983</span>  <a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>     localBBox;</div>
<div class="line"><span class="lineno">  984</span> </div>
<div class="line"><span class="lineno">  985</span>  <span class="comment">/* Validate */</span></div>
<div class="line"><span class="lineno">  986</span>  <span class="keywordflow">if</span> (!user || !allBBoxes) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL,</div>
<div class="line"><span class="lineno">  987</span>                                    <span class="stringliteral">&quot;GatherAllBoundingBoxes: NULL pointer&quot;</span>);</div>
<div class="line"><span class="lineno">  988</span> </div>
<div class="line"><span class="lineno">  989</span>  ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno">  990</span>  ierr = MPI_Comm_size(PETSC_COMM_WORLD, &amp;size); CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno">  991</span> </div>
<div class="line"><span class="lineno">  992</span>  <span class="comment">/* Compute local bbox */</span></div>
<div class="line"><span class="lineno">  993</span>  ierr = <a class="code hl_function" href="grid_8c.html#ae0c39bc7c78a15bedf9f1415ab1dded4">ComputeLocalBoundingBox</a>(user, &amp;localBBox); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>  <span class="comment">/* Ensure everyone is synchronized before the gather */</span></div>
<div class="line"><span class="lineno">  996</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno">  997</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno">  998</span>    <span class="stringliteral">&quot;Rank %d: about to MPI_Gather(localBBox)\n&quot;</span>, rank);</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span>  <span class="comment">/* Allocate on root */</span></div>
<div class="line"><span class="lineno"> 1001</span>  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line"><span class="lineno"> 1002</span>    bboxArray = (<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>*)malloc(size * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>));</div>
<div class="line"><span class="lineno"> 1003</span>    <span class="keywordflow">if</span> (!bboxArray) SETERRABORT(PETSC_COMM_WORLD, PETSC_ERR_MEM,</div>
<div class="line"><span class="lineno"> 1004</span>                                <span class="stringliteral">&quot;GatherAllBoundingBoxes: malloc failed&quot;</span>);</div>
<div class="line"><span class="lineno"> 1005</span>  }</div>
<div class="line"><span class="lineno"> 1006</span> </div>
<div class="line"><span class="lineno"> 1007</span>  <span class="comment">/* Collective: every rank must call */</span></div>
<div class="line"><span class="lineno"> 1008</span>  ierr = MPI_Gather(&amp;localBBox, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>), MPI_BYTE,</div>
<div class="line"><span class="lineno"> 1009</span>                    bboxArray, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="variables__old_8h.html#structBoundingBox">BoundingBox</a>), MPI_BYTE,</div>
<div class="line"><span class="lineno"> 1010</span>                    0, PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1011</span>  CHKERRMPI(ierr);</div>
<div class="line"><span class="lineno"> 1012</span> </div>
<div class="line"><span class="lineno"> 1013</span>  MPI_Barrier(PETSC_COMM_WORLD);</div>
<div class="line"><span class="lineno"> 1014</span>  <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><span class="lineno"> 1015</span>    <span class="stringliteral">&quot;Rank %d: completed MPI_Gather(localBBox)\n&quot;</span>, rank);</div>
<div class="line"><span class="lineno"> 1016</span> </div>
<div class="line"><span class="lineno"> 1017</span>  <span class="comment">/* Return result */</span></div>
<div class="line"><span class="lineno"> 1018</span>  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line"><span class="lineno"> 1019</span>    *allBBoxes = bboxArray;</div>
<div class="line"><span class="lineno"> 1020</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1021</span>    *allBBoxes = NULL;</div>
<div class="line"><span class="lineno"> 1022</span>  }</div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1025</span>}</div>
<div class="ttc" id="agrid_8c_html_ae0c39bc7c78a15bedf9f1415ab1dded4"><div class="ttname"><a href="grid_8c.html#ae0c39bc7c78a15bedf9f1415ab1dded4">ComputeLocalBoundingBox</a></div><div class="ttdeci">PetscErrorCode ComputeLocalBoundingBox(UserCtx *user, BoundingBox *localBBox)</div><div class="ttdoc">Computes the local bounding box of the grid on the current process.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00702">grid.c:702</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_afac52c252de784d5bcd7fe7a2e642982_cgraph.svg" width="443" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_afac52c252de784d5bcd7fe7a2e642982_icgraph.svg" width="512" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac44553fe1434663c5211cc6ac32ef004" name="ac44553fe1434663c5211cc6ac32ef004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac44553fe1434663c5211cc6ac32ef004">&#9670;&#160;</a></span>GenerateAndSetCoordinates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode GenerateAndSetCoordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Programmatically generates and sets grid coordinates based on user parameters. </p>
<p>This function populates the local coordinate vector of the provided <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code> using the geometric properties (<code>Min_X</code>, <code>Max_X</code>, <code>rx</code>, etc.) that were parsed from command-line options. It supports non-linear grid stretching.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00476">476</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  477</span>{</div>
<div class="line"><span class="lineno">  478</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  479</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  480</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***coor;</div>
<div class="line"><span class="lineno">  481</span>    Vec            lCoor;</div>
<div class="line"><span class="lineno">  482</span>    </div>
<div class="line"><span class="lineno">  483</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  484</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   Generating coordinates for block %d...\n&quot;</span>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  485</span>    </div>
<div class="line"><span class="lineno">  486</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  487</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  488</span>    ierr = VecSet(lCoor, 0.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  489</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoor, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  490</span>    </div>
<div class="line"><span class="lineno">  491</span>    PetscReal Lx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac3ea6849d6d1556f240ace7a6d9a3347">Max_X</a> - user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3c5226c112cabe2fc24230877bf7cc3c">Min_X</a>;</div>
<div class="line"><span class="lineno">  492</span>    PetscReal Ly = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a60bfc6b6d761a90da39b0f053bebcb31">Max_Y</a> - user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac6633daab270004cd266f6e6ac05f588">Min_Y</a>;</div>
<div class="line"><span class="lineno">  493</span>    PetscReal Lz = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aecbc2de7a281e906efe25a773b76866c">Max_Z</a> - user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aaeef1864bb110c26e4b30a9e2c8c116d">Min_Z</a>;</div>
<div class="line"><span class="lineno">  494</span> </div>
<div class="line"><span class="lineno">  495</span>    <span class="comment">// Loop over the local nodes, including ghost nodes, owned by this process.</span></div>
<div class="line"><span class="lineno">  496</span>    <span class="keywordflow">for</span> (PetscInt k = info.zs; k &lt; info.zs + info.zm; k++) {</div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordflow">for</span> (PetscInt j = info.ys; j &lt; info.ys + info.ym; j++) {</div>
<div class="line"><span class="lineno">  498</span>            <span class="keywordflow">for</span> (PetscInt i = info.xs; i &lt; info.xs + info.xm; i++) {</div>
<div class="line"><span class="lineno">  499</span>          <span class="keywordflow">if</span>(k&lt;user-&gt;KM &amp;&amp; j&lt;user-&gt;JM &amp;&amp; i &lt; user-&gt;IM){</div>
<div class="line"><span class="lineno">  500</span>                coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3c5226c112cabe2fc24230877bf7cc3c">Min_X</a> + <a class="code hl_function" href="grid_8c.html#a54a2529affe522c9e29161aef1ca3847">ComputeStretchedCoord</a>(i, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>, Lx, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ade80a8abea8047bfe4b83bd9363df589">rx</a>);</div>
<div class="line"><span class="lineno">  501</span>                coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ac6633daab270004cd266f6e6ac05f588">Min_Y</a> + <a class="code hl_function" href="grid_8c.html#a54a2529affe522c9e29161aef1ca3847">ComputeStretchedCoord</a>(j, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>, Ly, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a540dc135c4299ebf7fcbb33ecd8ca096">ry</a>);</div>
<div class="line"><span class="lineno">  502</span>                coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aaeef1864bb110c26e4b30a9e2c8c116d">Min_Z</a> + <a class="code hl_function" href="grid_8c.html#a54a2529affe522c9e29161aef1ca3847">ComputeStretchedCoord</a>(k, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>, Lz, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a94c6d4cf5f0820de35ff6ee1909fd0d6">rz</a>);</div>
<div class="line"><span class="lineno">  503</span>          }</div>
<div class="line"><span class="lineno">  504</span>        }  </div>
<div class="line"><span class="lineno">  505</span>        }</div>
<div class="line"><span class="lineno">  506</span>    }</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoor, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  509</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  510</span>}</div>
<div class="ttc" id="agrid_8c_html_a54a2529affe522c9e29161aef1ca3847"><div class="ttname"><a href="grid_8c.html#a54a2529affe522c9e29161aef1ca3847">ComputeStretchedCoord</a></div><div class="ttdeci">static PetscReal ComputeStretchedCoord(PetscInt i, PetscInt N, PetscReal L, PetscReal r)</div><div class="ttdoc">Computes a stretched coordinate along one dimension.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00453">grid.c:453</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a322702c716e6e140d71515d0b3e111b1"><div class="ttname"><a href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">UserCtx::simCtx</a></div><div class="ttdeci">SimCtx * simCtx</div><div class="ttdoc">Back-pointer to the master simulation context.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00585">variables.h:585</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3c5226c112cabe2fc24230877bf7cc3c"><div class="ttname"><a href="variables__old_8h.html#a3c5226c112cabe2fc24230877bf7cc3c">UserCtx::Min_X</a></div><div class="ttdeci">PetscReal Min_X</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3f5ec0e4536c9ccaa3d663f14d47f904"><div class="ttname"><a href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">UserCtx::KM</a></div><div class="ttdeci">PetscInt KM</div><div class="ttdoc">Global grid dimensions (number of cells in i,j,k).</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a540dc135c4299ebf7fcbb33ecd8ca096"><div class="ttname"><a href="variables__old_8h.html#a540dc135c4299ebf7fcbb33ecd8ca096">UserCtx::ry</a></div><div class="ttdeci">PetscReal ry</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00596">variables.h:596</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a60bfc6b6d761a90da39b0f053bebcb31"><div class="ttname"><a href="variables__old_8h.html#a60bfc6b6d761a90da39b0f053bebcb31">UserCtx::Max_Y</a></div><div class="ttdeci">PetscReal Max_Y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a94c6d4cf5f0820de35ff6ee1909fd0d6"><div class="ttname"><a href="variables__old_8h.html#a94c6d4cf5f0820de35ff6ee1909fd0d6">UserCtx::rz</a></div><div class="ttdeci">PetscReal rz</div><div class="ttdoc">Grid stretching ratios.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00596">variables.h:596</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aa55a2a246e904b3569075eb4de0092a6"><div class="ttname"><a href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">UserCtx::JM</a></div><div class="ttdeci">PetscInt JM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aaeef1864bb110c26e4b30a9e2c8c116d"><div class="ttname"><a href="variables__old_8h.html#aaeef1864bb110c26e4b30a9e2c8c116d">UserCtx::Min_Z</a></div><div class="ttdeci">PetscReal Min_Z</div><div class="ttdoc">Physical minimum bounds of the grid.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac3ea6849d6d1556f240ace7a6d9a3347"><div class="ttname"><a href="variables__old_8h.html#ac3ea6849d6d1556f240ace7a6d9a3347">UserCtx::Max_X</a></div><div class="ttdeci">PetscReal Max_X</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ac6633daab270004cd266f6e6ac05f588"><div class="ttname"><a href="variables__old_8h.html#ac6633daab270004cd266f6e6ac05f588">UserCtx::Min_Y</a></div><div class="ttdeci">PetscReal Min_Y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ad1904cdee33ebeffba809c883f7e9641"><div class="ttname"><a href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">UserCtx::IM</a></div><div class="ttdeci">PetscInt IM</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00591">variables.h:591</a></div></div>
<div class="ttc" id="avariables__old_8h_html_ade80a8abea8047bfe4b83bd9363df589"><div class="ttname"><a href="variables__old_8h.html#ade80a8abea8047bfe4b83bd9363df589">UserCtx::rx</a></div><div class="ttdeci">PetscReal rx</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00596">variables.h:596</a></div></div>
<div class="ttc" id="avariables__old_8h_html_aecbc2de7a281e906efe25a773b76866c"><div class="ttname"><a href="variables__old_8h.html#aecbc2de7a281e906efe25a773b76866c">UserCtx::Max_Z</a></div><div class="ttdeci">PetscReal Max_Z</div><div class="ttdoc">Physical maximum bounds of the grid.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00592">variables.h:592</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_ac44553fe1434663c5211cc6ac32ef004_cgraph.svg" width="447" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_ac44553fe1434663c5211cc6ac32ef004_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aa0b95ab3ac28c8df985e38b888c9bb52" name="aa0b95ab3ac28c8df985e38b888c9bb52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0b95ab3ac28c8df985e38b888c9bb52">&#9670;&#160;</a></span>InitializeAllGridDMs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InitializeAllGridDMs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structSimCtx">SimCtx</a> *&#160;</td>
          <td class="paramname"><em>simCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the creation of DMDA objects for every block and multigrid level. </p>
<p>This function systematically builds the entire DMDA hierarchy. It first calculates the dimensions (IM, JM, KM) for all coarse grids based on the finest grid's dimensions and the semi-coarsening flags. It then iterates from the coarsest to the finest level, calling a powerful helper function (<code>InitializeSingleGridDM</code>) to create the DMs for each block, ensuring that finer grids are properly aligned with their coarser parents for multigrid efficiency.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">simCtx</td><td>The master <a class="el" href="variables_8h.html#structSimCtx" title="The master context for the entire simulation.">SimCtx</a>, containing the configured <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> hierarchy. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00230">230</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  231</span>{</div>
<div class="line"><span class="lineno">  232</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  233</span>    <a class="code hl_struct" href="variables__old_8h.html#structUserMG">UserMG</a>         *usermg = &amp;simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a41a6127b3c012c516a7dcc56c3696a84">usermg</a>;</div>
<div class="line"><span class="lineno">  234</span>    <a class="code hl_struct" href="variables__old_8h.html#structMGCtx">MGCtx</a>          *mgctx = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#a10f4f7dc00a854759067cf96ab66485a">mgctx</a>;</div>
<div class="line"><span class="lineno">  235</span>    PetscInt       nblk = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a>;</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  238</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Creating DMDA objects for all levels and blocks...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>    <span class="comment">// --- Part 1: Calculate Coarse Grid Dimensions &amp; VALIDATE ---</span></div>
<div class="line"><span class="lineno">  241</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Calculating and validating coarse grid dimensions...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  242</span>    <span class="keywordflow">for</span> (PetscInt level = usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 2; level &gt;= 0; level--) {</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  244</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user_coarse = &amp;mgctx[level].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  245</span>            <a class="code hl_struct" href="variables__old_8h.html#structUserCtx">UserCtx</a> *user_fine   = &amp;mgctx[level + 1].<a class="code hl_variable" href="variables__old_8h.html#a4a7154d09d7dee5e3dd7f0323dfb4ff3">user</a>[bi];</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span>            user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> = user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a> ? user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> : (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1) / 2;</div>
<div class="line"><span class="lineno">  248</span>            user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> = user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a> ? user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> : (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1) / 2;</div>
<div class="line"><span class="lineno">  249</span>            user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> = user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a> ? user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> : (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1) / 2;</div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>            <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Block %d, Level %d dims calculated: %d x %d x %d\n&quot;</span>,</div>
<div class="line"><span class="lineno">  252</span>                      simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, bi, level, user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>, user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>, user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>            <span class="comment">// Validation check from legacy MGDACreate to ensure coarsening is possible</span></div>
<div class="line"><span class="lineno">  255</span>            PetscInt check_i = user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> * (2 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a>) - (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a>);</div>
<div class="line"><span class="lineno">  256</span>            PetscInt check_j = user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> * (2 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a>) - (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a>);</div>
<div class="line"><span class="lineno">  257</span>            PetscInt check_k = user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> * (2 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a>) - (user_fine-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1 - user_coarse-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a>);</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>            <span class="keywordflow">if</span> (check_i + check_j + check_k != 0) {</div>
<div class="line"><span class="lineno">  260</span>          <span class="comment">//      SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONG,</span></div>
<div class="line"><span class="lineno">  261</span>          <span class="comment">//           &quot;Grid at level %d, block %d cannot be coarsened from %dx%dx%d to %dx%dx%d with the given semi-coarsening flags. Check grid dimensions.&quot;,</span></div>
<div class="line"><span class="lineno">  262</span>              <span class="comment">//          level, bi, user_fine-&gt;IM, user_fine-&gt;JM, user_fine-&gt;KM, user_coarse-&gt;IM, user_coarse-&gt;JM, user_coarse-&gt;KM);</span></div>
<div class="line"><span class="lineno">  263</span>          <a class="code hl_define" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>,<span class="stringliteral">&quot;WARNING: Grid at level %d, block %d can&#39;t be consistently coarsened further.\n&quot;</span>, level, bi);</div>
<div class="line"><span class="lineno">  264</span>            }</div>
<div class="line"><span class="lineno">  265</span>        }</div>
<div class="line"><span class="lineno">  266</span>    }</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>    <span class="comment">// --- Part 2: Create DMs from Coarse to Fine for each Block ---</span></div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">for</span> (PetscInt bi = 0; bi &lt; nblk; bi++) {</div>
<div class="line"><span class="lineno">  270</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;--- Creating DMs for Block %d ---\n&quot;</span>, bi);</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>        <span class="comment">// Create the coarsest level DM first (passing NULL for the coarse_user)</span></div>
<div class="line"><span class="lineno">  273</span>        ierr = <a class="code hl_function" href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a>(&amp;mgctx[0].user[bi], NULL); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>        <span class="comment">// Create finer level DMs, passing the next-coarser context for alignment</span></div>
<div class="line"><span class="lineno">  276</span>        <span class="keywordflow">for</span> (PetscInt level = 1; level &lt; usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a>; level++) {</div>
<div class="line"><span class="lineno">  277</span>            ierr = <a class="code hl_function" href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a>(&amp;mgctx[level].user[bi], &amp;mgctx[level-1].user[bi]); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  278</span>        }</div>
<div class="line"><span class="lineno">  279</span>    }</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="comment">// --- Optional: View the finest DM for debugging verification ---</span></div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>() &gt;= <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>) {</div>
<div class="line"><span class="lineno">  283</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;--- Viewing Finest DMDA (Level %d, Block 0) ---\n&quot;</span>, usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1);</div>
<div class="line"><span class="lineno">  284</span>        ierr = DMView(mgctx[usermg-&gt;<a class="code hl_variable" href="variables__old_8h.html#aac8e0dd714804b073dbb32c0ad84b2eb">mglevels</a> - 1].user[0].da, PETSC_VIEWER_STDOUT_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  285</span>    }</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;DMDA object creation complete.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  288</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  289</span>}</div>
<div class="ttc" id="agrid_8c_html_a7de9f73019e4a260a2edd616dcd40a6b"><div class="ttname"><a href="grid_8c.html#a7de9f73019e4a260a2edd616dcd40a6b">InitializeSingleGridDM</a></div><div class="ttdeci">static PetscErrorCode InitializeSingleGridDM(UserCtx *user, UserCtx *coarse_user)</div><div class="ttdoc">Creates the DMDA objects (da and fda) for a single UserCtx.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00107">grid.c:107</a></div></div>
<div class="ttc" id="alogging_8h_html_a672ff9c400e2307306b36415d4fefcb9"><div class="ttname"><a href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a></div><div class="ttdeci">#define LOG(scope, level, fmt,...)</div><div class="ttdoc">Logging macro for PETSc-based applications with scope control.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00091">logging.h:91</a></div></div>
<div class="ttc" id="alogging_8h_html_a9585f583c260f40a73f2490914edc689"><div class="ttname"><a href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a></div><div class="ttdeci">LogLevel get_log_level()</div><div class="ttdoc">Retrieves the current logging level from the environment variable LOG_LEVEL.</div><div class="ttdef"><b>Definition</b> <a href="logging_8c_source.html#l00049">logging.c:49</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a></div><div class="ttdeci">@ LOG_WARNING</div><div class="ttdoc">Non-critical issues that warrant attention.</div><div class="ttdef"><b>Definition</b> <a href="logging_8h_source.html#l00030">logging.h:30</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a03772da847da737415fd5a86a97147bd"><div class="ttname"><a href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">UserCtx::isc</a></div><div class="ttdeci">PetscInt isc</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a3e8bcd710c619c329608b6f7da5f1ea1"><div class="ttname"><a href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">UserCtx::ksc</a></div><div class="ttdeci">PetscInt ksc</div><div class="ttdoc">Starting corner indices for the local subdomain.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a5fd8588302a68eca03d086e01e8972c1"><div class="ttname"><a href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">UserCtx::jsc</a></div><div class="ttdeci">PetscInt jsc</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00595">variables.h:595</a></div></div>
<div class="ttc" id="avariables__old_8h_html_structMGCtx"><div class="ttname"><a href="variables__old_8h.html#structMGCtx">MGCtx</a></div><div class="ttdoc">Context for Multigrid operations.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00418">variables.h:418</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_aa0b95ab3ac28c8df985e38b888c9bb52_cgraph.svg" width="376" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_aa0b95ab3ac28c8df985e38b888c9bb52_icgraph.svg" width="471" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7de9f73019e4a260a2edd616dcd40a6b" name="a7de9f73019e4a260a2edd616dcd40a6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7de9f73019e4a260a2edd616dcd40a6b">&#9670;&#160;</a></span>InitializeSingleGridDM()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode InitializeSingleGridDM </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>coarse_user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates the DMDA objects (da and fda) for a single <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>. </p>
<p>This function is a direct adaptation of the core logic in <code>MGDACreate</code>. It creates the scalar (<code>da</code>) and vector (<code>fda</code>) DMs for a single grid level.</p>
<p>If a <code>coarse_user</code> context is provided, it performs the critical processor alignment calculation from the legacy code. This ensures the new (fine) DM aligns with the coarse DM for multigrid efficiency. If <code>coarse_user</code> is NULL, it creates the DM with a default PETSc decomposition, intended for the coarsest grid level.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for which the DMs will be created. Its IM, JM, KM fields must be pre-populated. </td></tr>
    <tr><td class="paramname">coarse_user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> of the next-coarser grid level, or NULL if <code>user</code> is the coarsest level. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00107">107</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  108</span>{</div>
<div class="line"><span class="lineno">  109</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  110</span>    <a class="code hl_struct" href="variables_8h.html#structSimCtx">SimCtx</a> *simCtx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>    DMBoundaryType xperiod = (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#ac6c6cfb6059e67c1f8ad3c1bbe7f7889">i_periodic</a>) ? DM_BOUNDARY_PERIODIC : DM_BOUNDARY_NONE;</div>
<div class="line"><span class="lineno">  113</span>    DMBoundaryType yperiod = (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#afd3cbef00a91e3115e40ccd7b0a8cfbb">j_periodic</a>) ? DM_BOUNDARY_PERIODIC : DM_BOUNDARY_NONE;</div>
<div class="line"><span class="lineno">  114</span>    DMBoundaryType zperiod = (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a57873ffd9532be40cdf7aa76955b5d61">k_periodic</a>) ? DM_BOUNDARY_PERIODIC : DM_BOUNDARY_NONE;</div>
<div class="line"><span class="lineno">  115</span>    PetscInt stencil_width = 2; <span class="comment">// Stencil width is 2 in the legacy code</span></div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    PetscInt *lx = NULL, *ly = NULL, *lz = NULL;</div>
<div class="line"><span class="lineno">  118</span>    PetscInt m, n, p;</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>    <span class="keywordflow">if</span> (coarse_user) {</div>
<div class="line"><span class="lineno">  123</span>        <span class="comment">// --- This is a FINE grid; it must be aligned with the COARSE grid ---</span></div>
<div class="line"><span class="lineno">  124</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: [Aligning DM] for block %d level %d (size %dx%dx%d) with level %d\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>, coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>);</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>        DMDAGetInfo(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, NULL, NULL, NULL, NULL, &amp;m, &amp;n, &amp;p, NULL, NULL, NULL, NULL, NULL, NULL);</div>
<div class="line"><span class="lineno">  127</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   Coarse grid processor decomposition is %d x %d x %d\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, m, n, p);</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>        <span class="comment">// This is the core logic from MGDACreate to ensure processor alignment.</span></div>
<div class="line"><span class="lineno">  130</span>        PetscInt *lx_contrib, *ly_contrib, *lz_contrib;</div>
<div class="line"><span class="lineno">  131</span>        ierr = PetscMalloc3(m, &amp;lx_contrib, n, &amp;ly_contrib, p, &amp;lz_contrib); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  132</span>        ierr = PetscMemzero(lx_contrib, m * <span class="keyword">sizeof</span>(PetscInt)); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  133</span>        ierr = PetscMemzero(ly_contrib, n * <span class="keyword">sizeof</span>(PetscInt)); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  134</span>        ierr = PetscMemzero(lz_contrib, p * <span class="keyword">sizeof</span>(PetscInt)); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>        DMDALocalInfo info;</div>
<div class="line"><span class="lineno">  137</span>        DMDAGetLocalInfo(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info);</div>
<div class="line"><span class="lineno">  138</span>        PetscInt xs = info.xs, xe = info.xs + info.xm, mx = info.mx;</div>
<div class="line"><span class="lineno">  139</span>        PetscInt ys = info.ys, ye = info.ys + info.ym, my = info.my;</div>
<div class="line"><span class="lineno">  140</span>        PetscInt zs = info.zs, ze = info.zs + info.zm, mz = info.mz;</div>
<div class="line"><span class="lineno">  141</span>        </div>
<div class="line"><span class="lineno">  142</span>        PetscMPIInt rank;</div>
<div class="line"><span class="lineno">  143</span>        ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  144</span>        PetscInt proc_i = rank % m;</div>
<div class="line"><span class="lineno">  145</span>        PetscInt proc_j = (rank / m) % n;</div>
<div class="line"><span class="lineno">  146</span>        PetscInt proc_k = rank / (m * n);</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>        <span class="comment">// --- X-Direction Logic (Identical to MGDACreate) ---</span></div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">if</span> (user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a>) lx_contrib[proc_i] = (xe - xs);</div>
<div class="line"><span class="lineno">  150</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  151</span>            <span class="keywordflow">if</span> (m == 1) lx_contrib[0] = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1;</div>
<div class="line"><span class="lineno">  152</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xs == 0) lx_contrib[0] = 2 * xe - 1;</div>
<div class="line"><span class="lineno">  153</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xe == mx) lx_contrib[proc_i] = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1 - (2 * xs - 1);</div>
<div class="line"><span class="lineno">  154</span>            <span class="keywordflow">else</span> lx_contrib[proc_i] = (xe - xs) * 2;</div>
<div class="line"><span class="lineno">  155</span>        }</div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>        <span class="comment">// --- Y-Direction Logic (Identical to MGDACreate) ---</span></div>
<div class="line"><span class="lineno">  158</span>        <span class="keywordflow">if</span> (user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a>) ly_contrib[proc_j] = (ye - ys);</div>
<div class="line"><span class="lineno">  159</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  160</span>            <span class="keywordflow">if</span> (n == 1) ly_contrib[0] = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1;</div>
<div class="line"><span class="lineno">  161</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ys == 0) ly_contrib[0] = 2 * ye - 1;</div>
<div class="line"><span class="lineno">  162</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ye == my) ly_contrib[proc_j] = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1 - (2 * ys - 1);</div>
<div class="line"><span class="lineno">  163</span>            <span class="keywordflow">else</span> ly_contrib[proc_j] = (ye - ys) * 2;</div>
<div class="line"><span class="lineno">  164</span>        }</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>        <span class="comment">// --- Z-Direction Logic (Identical to MGDACreate) ---</span></div>
<div class="line"><span class="lineno">  167</span>        <span class="keywordflow">if</span> (user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a>) lz_contrib[proc_k] = (ze - zs);</div>
<div class="line"><span class="lineno">  168</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  169</span>            <span class="keywordflow">if</span> (p == 1) lz_contrib[0] = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1;</div>
<div class="line"><span class="lineno">  170</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (zs == 0) lz_contrib[0] = 2 * ze - 1;</div>
<div class="line"><span class="lineno">  171</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ze == mz) lz_contrib[proc_k] = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1 - (2 * zs - 1);</div>
<div class="line"><span class="lineno">  172</span>            <span class="keywordflow">else</span> lz_contrib[proc_k] = (ze - zs) * 2;</div>
<div class="line"><span class="lineno">  173</span>        }</div>
<div class="line"><span class="lineno">  174</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   Calculated this rank&#39;s node contribution to fine grid: lx=%d, ly=%d, lz=%d\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, lx_contrib[proc_i], ly_contrib[proc_j], lz_contrib[proc_k]);</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>        <span class="comment">// Allocate the final distribution arrays and Allreduce to get the global distribution</span></div>
<div class="line"><span class="lineno">  177</span>        ierr = PetscMalloc3(m, &amp;lx, n, &amp;ly, p, &amp;lz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  178</span>        ierr = MPI_Allreduce(lx_contrib, lx, m, MPIU_INT, MPI_MAX, PETSC_COMM_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  179</span>        ierr = MPI_Allreduce(ly_contrib, ly, n, MPIU_INT, MPI_MAX, PETSC_COMM_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  180</span>        ierr = MPI_Allreduce(lz_contrib, lz, p, MPIU_INT, MPI_MAX, PETSC_COMM_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  181</span>        </div>
<div class="line"><span class="lineno">  182</span>        ierr = PetscFree3(lx_contrib, ly_contrib, lz_contrib); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  185</span>        <span class="comment">// --- CASE 2: This is the COARSEST grid; use default or user-specified decomposition ---</span></div>
<div class="line"><span class="lineno">  186</span>        <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Creating coarsest DM for block %d level %d (size %dx%dx%d)\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>);</div>
<div class="line"><span class="lineno">  187</span>        m = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#ac014127a43e8978a157a8a42c2f0538d">da_procs_x</a>;</div>
<div class="line"><span class="lineno">  188</span>        n = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a44230884a9901af3992a1faf2eebdfb1">da_procs_y</a>;</div>
<div class="line"><span class="lineno">  189</span>        p = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a281d10df99cab1a563bb65203f3bd823">da_procs_z</a>;</div>
<div class="line"><span class="lineno">  190</span>        <span class="comment">// lx, ly, lz are NULL, so DMDACreate3d will use the m,n,p values.</span></div>
<div class="line"><span class="lineno">  191</span>    }</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>    <span class="comment">// --- Create the DMDA for the current UserCtx ---</span></div>
<div class="line"><span class="lineno">  194</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   Calling DMDACreate3d...\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>);</div>
<div class="line"><span class="lineno">  195</span>    ierr = DMDACreate3d(PETSC_COMM_WORLD, xperiod, yperiod, zperiod, DMDA_STENCIL_BOX,</div>
<div class="line"><span class="lineno">  196</span>                          user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + 1, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a> + 1, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a> + 1,</div>
<div class="line"><span class="lineno">  197</span>                          m, n, p,</div>
<div class="line"><span class="lineno">  198</span>                          1, stencil_width, lx, ly, lz, &amp;user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  199</span>    </div>
<div class="line"><span class="lineno">  200</span>    <span class="keywordflow">if</span> (coarse_user) {</div>
<div class="line"><span class="lineno">  201</span>        ierr = PetscFree3(lx, ly, lz); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  202</span>    }</div>
<div class="line"><span class="lineno">  203</span>    </div>
<div class="line"><span class="lineno">  204</span>    <span class="comment">// --- Standard DM setup applicable to all levels ---</span></div>
<div class="line"><span class="lineno">  205</span>    ierr = DMSetUp(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  206</span>    ierr = DMGetCoordinateDM(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  207</span>    ierr = DMDASetUniformCoordinates(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  208</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;user-&gt;<a class="code hl_variable" href="variables__old_8h.html#acd99423029a666652ee1f5bf573619bc">info</a>); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  209</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   DM creation for block %d level %d complete.\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>);</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  212</span>}</div>
<div class="ttc" id="avariables_8h_html_a281d10df99cab1a563bb65203f3bd823"><div class="ttname"><a href="variables_8h.html#a281d10df99cab1a563bb65203f3bd823">SimCtx::da_procs_z</a></div><div class="ttdeci">PetscInt da_procs_z</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00529">variables.h:529</a></div></div>
<div class="ttc" id="avariables_8h_html_a44230884a9901af3992a1faf2eebdfb1"><div class="ttname"><a href="variables_8h.html#a44230884a9901af3992a1faf2eebdfb1">SimCtx::da_procs_y</a></div><div class="ttdeci">PetscInt da_procs_y</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00529">variables.h:529</a></div></div>
<div class="ttc" id="avariables_8h_html_a57873ffd9532be40cdf7aa76955b5d61"><div class="ttname"><a href="variables_8h.html#a57873ffd9532be40cdf7aa76955b5d61">SimCtx::k_periodic</a></div><div class="ttdeci">PetscInt k_periodic</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00524">variables.h:524</a></div></div>
<div class="ttc" id="avariables_8h_html_ac014127a43e8978a157a8a42c2f0538d"><div class="ttname"><a href="variables_8h.html#ac014127a43e8978a157a8a42c2f0538d">SimCtx::da_procs_x</a></div><div class="ttdeci">PetscInt da_procs_x</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00529">variables.h:529</a></div></div>
<div class="ttc" id="avariables_8h_html_ac6c6cfb6059e67c1f8ad3c1bbe7f7889"><div class="ttname"><a href="variables_8h.html#ac6c6cfb6059e67c1f8ad3c1bbe7f7889">SimCtx::i_periodic</a></div><div class="ttdeci">PetscInt i_periodic</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00524">variables.h:524</a></div></div>
<div class="ttc" id="avariables_8h_html_afd3cbef00a91e3115e40ccd7b0a8cfbb"><div class="ttname"><a href="variables_8h.html#afd3cbef00a91e3115e40ccd7b0a8cfbb">SimCtx::j_periodic</a></div><div class="ttdeci">PetscInt j_periodic</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00524">variables.h:524</a></div></div>
<div class="ttc" id="avariables_8h_html_structSimCtx"><div class="ttname"><a href="variables_8h.html#structSimCtx">SimCtx</a></div><div class="ttdoc">The master context for the entire simulation.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00474">variables.h:474</a></div></div>
<div class="ttc" id="avariables__old_8h_html_a99a88d89d58073bd134175f62213c528"><div class="ttname"><a href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">UserCtx::thislevel</a></div><div class="ttdeci">PetscInt thislevel</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00641">variables.h:641</a></div></div>
<div class="ttc" id="avariables__old_8h_html_acd99423029a666652ee1f5bf573619bc"><div class="ttname"><a href="variables__old_8h.html#acd99423029a666652ee1f5bf573619bc">UserCtx::info</a></div><div class="ttdeci">DMDALocalInfo info</div><div class="ttdoc">Cached local grid info for the current rank.</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00589">variables.h:589</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_a7de9f73019e4a260a2edd616dcd40a6b_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a526448d3a1e34b608f7167a59f1d7e04" name="a526448d3a1e34b608f7167a59f1d7e04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a526448d3a1e34b608f7167a59f1d7e04">&#9670;&#160;</a></span>ParseAndSetGridInputs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode ParseAndSetGridInputs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines the grid source and calls the appropriate parsing routine. </p>
<p>This function acts as a router. It checks the global <code>simCtx-&gt;generate_grid</code> flag (accessed via the <code>user-&gt;simCtx</code> back-pointer) to decide whether to call the parser for a programmatically generated grid or for a grid defined in a file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>Pointer to the <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code> for a specific block. The function will populate the geometric fields within this struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00020">20</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   21</span>{</div>
<div class="line"><span class="lineno">   22</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">   23</span>    <a class="code hl_struct" href="variables_8h.html#structSimCtx">SimCtx</a>         *simCtx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>; <span class="comment">// Get the global context via the back-pointer</span></div>
<div class="line"><span class="lineno">   24</span> </div>
<div class="line"><span class="lineno">   25</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>    <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a98a90e3a55a0a0da6e392f44ebf50dad">generate_grid</a>) {</div>
<div class="line"><span class="lineno">   28</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Block %d is programmatically generated. Calling generation parser.\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">   29</span>        ierr = <a class="code hl_function" href="io_8h.html#a7dd125436244f23eba5c6b06fdd35031">ReadGridGenerationInputs</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   30</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   31</span>        <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Block %d is file-based. Calling file parser.\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">   32</span>        ierr = <a class="code hl_function" href="io_8h.html#a1454fbb30915c3284cbf5ecb100351d1">ReadGridFile</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">   33</span>    }</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">   36</span>}</div>
<div class="ttc" id="aio_8h_html_a1454fbb30915c3284cbf5ecb100351d1"><div class="ttname"><a href="io_8h.html#a1454fbb30915c3284cbf5ecb100351d1">ReadGridFile</a></div><div class="ttdeci">PetscErrorCode ReadGridFile(UserCtx *user)</div><div class="ttdoc">Sets grid dimensions from a file for a SINGLE block using a one-time read cache.</div><div class="ttdef"><b>Definition</b> <a href="io_8c_source.html#l00145">io.c:145</a></div></div>
<div class="ttc" id="aio_8h_html_a7dd125436244f23eba5c6b06fdd35031"><div class="ttname"><a href="io_8h.html#a7dd125436244f23eba5c6b06fdd35031">ReadGridGenerationInputs</a></div><div class="ttdeci">PetscErrorCode ReadGridGenerationInputs(UserCtx *user)</div><div class="ttdoc">Parses command-line options for a programmatically generated grid for a SINGLE block.</div><div class="ttdef"><b>Definition</b> <a href="io_8c_source.html#l00047">io.c:47</a></div></div>
<div class="ttc" id="avariables_8h_html_a98a90e3a55a0a0da6e392f44ebf50dad"><div class="ttname"><a href="variables_8h.html#a98a90e3a55a0a0da6e392f44ebf50dad">SimCtx::generate_grid</a></div><div class="ttdeci">PetscBool generate_grid</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00525">variables.h:525</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="grid_8c_a526448d3a1e34b608f7167a59f1d7e04_cgraph.svg" width="424" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_a526448d3a1e34b608f7167a59f1d7e04_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ac693c757c4fd3cb75e6e06e05e25d775" name="ac693c757c4fd3cb75e6e06e05e25d775"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac693c757c4fd3cb75e6e06e05e25d775">&#9670;&#160;</a></span>ReadAndSetCoordinates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode ReadAndSetCoordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads physical coordinates from a file and populates the DMDA for a specific block. </p>
<p>This function handles the collective read of an interleaved (X Y Z per line) multi-block grid file. It assumes the file header (nblk, dimensions) has already been processed by ReadGridFile.</p>
<p>The process is robust for parallel execution:</p><ol type="1">
<li>Rank 0 opens the grid file.</li>
<li>It intelligently skips past the header section and the coordinate data for all blocks <em>preceding</em> the current block being processed (<code>user-&gt;_this</code>).</li>
<li>It then reads the entire coordinate data for the <em>current</em> block into a single contiguous buffer <code>gc</code>.</li>
<li>This global buffer <code>gc</code> is broadcast to all other MPI ranks.</li>
<li>Each rank then loops through its local (owned + ghost) node indices, calculates the corresponding index in the global <code>gc</code> array, and copies the (x,y,z) coordinates into its local PETSc coordinate vector.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific block. Its <code>_this</code> field must be set, and its IM, JM, KM fields must be correctly pre-populated. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00535">535</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  536</span>{</div>
<div class="line"><span class="lineno">  537</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  538</span>    <a class="code hl_struct" href="variables_8h.html#structSimCtx">SimCtx</a>         *simCtx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><span class="lineno">  539</span>    PetscMPIInt    rank = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>;</div>
<div class="line"><span class="lineno">  540</span>    PetscInt       block_index = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>;</div>
<div class="line"><span class="lineno">  541</span>    PetscInt       IM = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>, JM = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>, KM = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>;</div>
<div class="line"><span class="lineno">  542</span>    DMDALocalInfo  info;</div>
<div class="line"><span class="lineno">  543</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***coor;</div>
<div class="line"><span class="lineno">  544</span>    Vec            lCoor;</div>
<div class="line"><span class="lineno">  545</span>    PetscReal      *gc = NULL; <span class="comment">// Global coordinate buffer, allocated on all ranks</span></div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  548</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Reading interleaved coordinates from file for block %d...\n&quot;</span>,</div>
<div class="line"><span class="lineno">  549</span>              simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, block_index);</div>
<div class="line"><span class="lineno">  550</span> </div>
<div class="line"><span class="lineno">  551</span>    <span class="comment">// 1. Allocate the buffer on ALL ranks to receive the broadcast data.</span></div>
<div class="line"><span class="lineno">  552</span>    <span class="comment">// PetscInt n_nodes = (IM + 1) * (JM + 1) * (KM + 1);</span></div>
<div class="line"><span class="lineno">  553</span>    PetscInt n_nodes = (IM) * (JM) * (KM);</div>
<div class="line"><span class="lineno">  554</span>    ierr = PetscMalloc1(3 * n_nodes, &amp;gc); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>    <span class="comment">// 2. Only Rank 0 opens the file and reads the data.</span></div>
<div class="line"><span class="lineno">  557</span>    <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line"><span class="lineno">  558</span>        <span class="keywordflow">if</span> (!fd) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_FILE_OPEN, <span class="stringliteral">&quot;Recieved a NULL file handle.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  559</span>                </div>
<div class="line"><span class="lineno">  560</span>        <span class="comment">// Read the coordinate data for the CURRENT block.</span></div>
<div class="line"><span class="lineno">  561</span>        <span class="keywordflow">for</span> (PetscInt k = 0; k &lt; KM; k++) {</div>
<div class="line"><span class="lineno">  562</span>            <span class="keywordflow">for</span> (PetscInt j = 0; j &lt; JM; j++) {</div>
<div class="line"><span class="lineno">  563</span>                <span class="keywordflow">for</span> (PetscInt i = 0; i &lt; IM; i++) {</div>
<div class="line"><span class="lineno">  564</span>                    PetscInt base_index = 3 * ((k * (JM) + j) * (IM) + i);</div>
<div class="line"><span class="lineno">  565</span>                    <span class="keywordflow">if</span> (fscanf(fd, <span class="stringliteral">&quot;%le %le %le\n&quot;</span>, &amp;gc[base_index], &amp;gc[base_index + 1], &amp;gc[base_index + 2]) != 3) {</div>
<div class="line"><span class="lineno">  566</span>                        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_FILE_READ, <span class="stringliteral">&quot;Error reading coordinates for node (i,j,k)=(%d,%d,%d) in block %d&quot;</span>, i, j, k, block_index);</div>
<div class="line"><span class="lineno">  567</span>                    }</div>
<div class="line"><span class="lineno">  568</span>                }</div>
<div class="line"><span class="lineno">  569</span>            }</div>
<div class="line"><span class="lineno">  570</span>        }</div>
<div class="line"><span class="lineno">  571</span>        </div>
<div class="line"><span class="lineno">  572</span>    }</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>    <span class="comment">// 3. Broadcast the coordinate block for the current block to all other processes.</span></div>
<div class="line"><span class="lineno">  575</span>    ierr = MPI_Bcast(gc, 3 * n_nodes, MPIU_REAL, 0, PETSC_COMM_WORLD); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  576</span>    </div>
<div class="line"><span class="lineno">  577</span>    <span class="comment">// 4. Each rank populates its local portion of the coordinate vector.</span></div>
<div class="line"><span class="lineno">  578</span>    ierr = DMDAGetLocalInfo(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  579</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  580</span>    ierr = DMDAVecGetArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoor, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>    <span class="keywordflow">for</span> (PetscInt k = info.zs; k &lt; info.zs + info.zm; k++) {</div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordflow">for</span> (PetscInt j = info.ys; j &lt; info.ys + info.ym; j++) {</div>
<div class="line"><span class="lineno">  584</span>            <span class="keywordflow">for</span> (PetscInt i = info.xs; i &lt; info.xs + info.xm; i++) {</div>
<div class="line"><span class="lineno">  585</span>          <span class="keywordflow">if</span>(k&lt; KM &amp;&amp; j &lt; JM &amp;&amp; i &lt; IM){</div>
<div class="line"><span class="lineno">  586</span>                <span class="comment">//PetscInt base_idx = 3 * ((k * (JM + 1) + j) * (IM + 1) + i);</span></div>
<div class="line"><span class="lineno">  587</span>        PetscInt base_idx = 3 * ((k * (JM) + j) * (IM) + i);</div>
<div class="line"><span class="lineno">  588</span>        coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = gc[base_idx];</div>
<div class="line"><span class="lineno">  589</span>                coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = gc[base_idx + 1];</div>
<div class="line"><span class="lineno">  590</span>                coor[k][j][i].<a class="code hl_variable" href="variables__old_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = gc[base_idx + 2];</div>
<div class="line"><span class="lineno">  591</span>          }</div>
<div class="line"><span class="lineno">  592</span>        }</div>
<div class="line"><span class="lineno">  593</span>        }</div>
<div class="line"><span class="lineno">  594</span>    }</div>
<div class="line"><span class="lineno">  595</span>    </div>
<div class="line"><span class="lineno">  596</span>    <span class="comment">// 5. Clean up and restore.</span></div>
<div class="line"><span class="lineno">  597</span>    ierr = DMDAVecRestoreArray(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoor, &amp;coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  598</span>    ierr = PetscFree(gc); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  599</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  600</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_ac693c757c4fd3cb75e6e06e05e25d775_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a5b5fe86ae6791885769361fca4ad6b2f" name="a5b5fe86ae6791885769361fca4ad6b2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b5fe86ae6791885769361fca4ad6b2f">&#9670;&#160;</a></span>RestrictCoordinates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode RestrictCoordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>coarse_user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>fine_user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Populates coarse grid coordinates by restricting from a fine grid. </p>
<p>This function is a direct adaptation of the coordinate restriction loop from the legacy <code>MG_Initial</code> function. It ensures that the physical location of a coarse grid node is identical to its corresponding parent node on the fine grid. The mapping from coarse to fine index (<code>i</code> -&gt; <code>ih</code>) is determined by the semi-coarsening flags (<code>isc</code>, <code>jsc</code>, <code>ksc</code>) stored in the <code><a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">coarse_user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for the coarse grid (destination). </td></tr>
    <tr><td class="paramname">fine_user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for the fine grid (source). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00617">617</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  618</span>{</div>
<div class="line"><span class="lineno">  619</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  620</span>    Vec            c_lCoor, f_lCoor; <span class="comment">// Coarse and Fine local coordinate vectors</span></div>
<div class="line"><span class="lineno">  621</span>    <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a>       ***c_coor;</div>
<div class="line"><span class="lineno">  622</span>    <span class="keyword">const</span> <a class="code hl_struct" href="variables__old_8h.html#structCmpnts">Cmpnts</a> ***f_coor; <span class="comment">// Use const for read-only access</span></div>
<div class="line"><span class="lineno">  623</span>    DMDALocalInfo  c_info;</div>
<div class="line"><span class="lineno">  624</span>    PetscInt       ih, jh, kh; <span class="comment">// Fine-grid indices corresponding to coarse-grid i,j,k</span></div>
<div class="line"><span class="lineno">  625</span> </div>
<div class="line"><span class="lineno">  626</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  627</span>    <a class="code hl_define" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Restricting coords from level %d to level %d for block %d\n&quot;</span>,</div>
<div class="line"><span class="lineno">  628</span>                   fine_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, fine_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a99a88d89d58073bd134175f62213c528">thislevel</a>, coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  629</span> </div>
<div class="line"><span class="lineno">  630</span>    ierr = DMDAGetLocalInfo(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;c_info); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  631</span> </div>
<div class="line"><span class="lineno">  632</span>    ierr = DMGetCoordinatesLocal(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;c_lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  633</span>    ierr = DMGetCoordinatesLocal(fine_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;f_lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  634</span>    </div>
<div class="line"><span class="lineno">  635</span>    ierr = DMDAVecGetArray(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, c_lCoor, &amp;c_coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  636</span>    ierr = DMDAVecGetArrayRead(fine_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, f_lCoor, &amp;f_coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>    <span class="comment">// Get the local owned range of the coarse grid.</span></div>
<div class="line"><span class="lineno">  639</span>    PetscInt xs = c_info.xs, xe = c_info.xs + c_info.xm;</div>
<div class="line"><span class="lineno">  640</span>    PetscInt ys = c_info.ys, ye = c_info.ys + c_info.ym;</div>
<div class="line"><span class="lineno">  641</span>    PetscInt zs = c_info.zs, ze = c_info.zs + c_info.zm;</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>    <span class="comment">// Get the global dimensions of the coarse grid.</span></div>
<div class="line"><span class="lineno">  644</span>    PetscInt mx = c_info.mx, my = c_info.my, mz = c_info.mz;</div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  646</span>    <span class="comment">// If this process owns the maximum boundary node, contract the loop by one</span></div>
<div class="line"><span class="lineno">  647</span>    <span class="comment">// to prevent the index doubling `2*i` from going out of bounds.</span></div>
<div class="line"><span class="lineno">  648</span>    <span class="keywordflow">if</span> (xe == mx) xe--;</div>
<div class="line"><span class="lineno">  649</span>    <span class="keywordflow">if</span> (ye == my) ye--;</div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordflow">if</span> (ze == mz) ze--;</div>
<div class="line"><span class="lineno">  651</span>    </div>
<div class="line"><span class="lineno">  652</span>    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt; ze; k++) {</div>
<div class="line"><span class="lineno">  653</span>        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt; ye; j++) {</div>
<div class="line"><span class="lineno">  654</span>            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt; xe; i++) {</div>
<div class="line"><span class="lineno">  655</span>                <span class="comment">// Determine the corresponding parent node index on the FINE grid,</span></div>
<div class="line"><span class="lineno">  656</span>                <span class="comment">// respecting the semi-coarsening flags of the FINE grid&#39;s UserCtx.</span></div>
<div class="line"><span class="lineno">  657</span>                ih = coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a03772da847da737415fd5a86a97147bd">isc</a> ? i : 2 * i;</div>
<div class="line"><span class="lineno">  658</span>                jh = coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a5fd8588302a68eca03d086e01e8972c1">jsc</a> ? j : 2 * j;</div>
<div class="line"><span class="lineno">  659</span>        kh = coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a3e8bcd710c619c329608b6f7da5f1ea1">ksc</a> ? k : 2 * k;</div>
<div class="line"><span class="lineno">  660</span> </div>
<div class="line"><span class="lineno">  661</span>        <span class="comment">//  LOG_ALLOW(GLOBAL,LOG_DEBUG,&quot; [kh][ih][jh] = %d,%d,%d  - k,j,i = %d,%d,%d.\n&quot;,kh,jh,ih,k,j,i);</span></div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>                c_coor[k][j][i] = f_coor[kh][jh][ih];</div>
<div class="line"><span class="lineno">  664</span>            }</div>
<div class="line"><span class="lineno">  665</span>        }</div>
<div class="line"><span class="lineno">  666</span>    }</div>
<div class="line"><span class="lineno">  667</span> </div>
<div class="line"><span class="lineno">  668</span>    ierr = DMDAVecRestoreArray(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, c_lCoor, &amp;c_coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  669</span>    ierr = DMDAVecRestoreArrayRead(fine_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, f_lCoor, &amp;f_coor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  670</span> </div>
<div class="line"><span class="lineno">  671</span>    <span class="comment">// After populating the local portion, scatter to update ghost regions.</span></div>
<div class="line"><span class="lineno">  672</span>    Vec c_gCoor;</div>
<div class="line"><span class="lineno">  673</span>    ierr = DMGetCoordinates(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;c_gCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  674</span>    ierr = DMLocalToGlobalBegin(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, c_lCoor, INSERT_VALUES, c_gCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  675</span>    ierr = DMLocalToGlobalEnd(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, c_lCoor, INSERT_VALUES, c_gCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  676</span>    ierr = DMGlobalToLocalBegin(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, c_gCoor, INSERT_VALUES, c_lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  677</span>    ierr = DMGlobalToLocalEnd(coarse_user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, c_gCoor, INSERT_VALUES, c_lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  680</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_a5b5fe86ae6791885769361fca4ad6b2f_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="acb950cd51656702b75ea84d6477d0d97" name="acb950cd51656702b75ea84d6477d0d97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb950cd51656702b75ea84d6477d0d97">&#9670;&#160;</a></span>SetFinestLevelCoordinates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode SetFinestLevelCoordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables__old_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A router that populates the coordinates for a single finest-level DMDA. </p>
<p>This function orchestrates the coordinate setting for one block. It checks the global <code>generate_grid</code> flag and calls the appropriate helper for either programmatic generation or reading from a file.</p>
<p>After the local coordinate vector is populated by a helper, this function performs the necessary DMLocalToGlobal and DMGlobalToLocal scatters to ensure that the ghost node coordinate values are correctly communicated and updated across all MPI ranks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables__old_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> for a specific block on the finest level. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, or a PETSc error code on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid_8c_source.html#l00367">367</a> of file <a class="el" href="grid_8c_source.html">grid.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  368</span>{</div>
<div class="line"><span class="lineno">  369</span>    PetscErrorCode ierr;</div>
<div class="line"><span class="lineno">  370</span>    <a class="code hl_struct" href="variables_8h.html#structSimCtx">SimCtx</a>         *simCtx = user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span>    PetscFunctionBeginUser;</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Setting finest level coordinates for block %d...\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span>    <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a98a90e3a55a0a0da6e392f44ebf50dad">generate_grid</a>) {</div>
<div class="line"><span class="lineno">  377</span>        ierr = <a class="code hl_function" href="grid_8c.html#ac44553fe1434663c5211cc6ac32ef004">GenerateAndSetCoordinates</a>(user); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  378</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>      FILE *grid_file_handle = NULL;</div>
<div class="line"><span class="lineno">  381</span>      <span class="comment">// Only Rank 0 opens the file.</span></div>
<div class="line"><span class="lineno">  382</span>      <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a> == 0) {</div>
<div class="line"><span class="lineno">  383</span>    grid_file_handle = fopen(simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a7947f7b4cd08e551b6d2a79c8b513d9c">grid_file</a>, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordflow">if</span> (!grid_file_handle) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_FILE_OPEN, <span class="stringliteral">&quot;Cannot open file: %s&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a7947f7b4cd08e551b6d2a79c8b513d9c">grid_file</a>);</div>
<div class="line"><span class="lineno">  385</span>        </div>
<div class="line"><span class="lineno">  386</span>    <span class="comment">// Now, on Rank 0, we skip the entire header section once.</span></div>
<div class="line"><span class="lineno">  387</span>    <span class="comment">// This is the logic from your modern code&#39;s AssignGridCoordinates.</span></div>
<div class="line"><span class="lineno">  388</span>    PetscInt headerLines = simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a22580e0e52ca8ddccc76d24c96f00e4a">block_number</a> + 2; <span class="comment">// 1 for nblk, plus one for each block&#39;s dims</span></div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordtype">char</span> dummy_buffer[2048];</div>
<div class="line"><span class="lineno">  390</span>    <span class="keywordflow">for</span> (PetscInt s = 0; s &lt; headerLines; ++s) {</div>
<div class="line"><span class="lineno">  391</span>      <span class="keywordflow">if</span> (!fgets(dummy_buffer, <span class="keyword">sizeof</span>(dummy_buffer), grid_file_handle)) {</div>
<div class="line"><span class="lineno">  392</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_FILE_READ, <span class="stringliteral">&quot;Unexpected EOF while skipping grid header&quot;</span>);</div>
<div class="line"><span class="lineno">  393</span>      }</div>
<div class="line"><span class="lineno">  394</span>    }</div>
<div class="line"><span class="lineno">  395</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank 0: Skipped %d header lines, now at coordinate data.\n&quot;</span>, headerLines);</div>
<div class="line"><span class="lineno">  396</span>      }</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>      <span class="comment">// We now call the coordinate reader, passing the file handle.</span></div>
<div class="line"><span class="lineno">  399</span>      <span class="comment">// It&#39;s responsible for reading its block&#39;s data and broadcasting.</span></div>
<div class="line"><span class="lineno">  400</span>      ierr = <a class="code hl_function" href="grid_8c.html#ac693c757c4fd3cb75e6e06e05e25d775">ReadAndSetCoordinates</a>(user, grid_file_handle); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  401</span>        </div>
<div class="line"><span class="lineno">  402</span>      <span class="comment">// Only Rank 0, which opened the file, should close it.</span></div>
<div class="line"><span class="lineno">  403</span>      <span class="keywordflow">if</span> (simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a> == 0) {</div>
<div class="line"><span class="lineno">  404</span>    fclose(grid_file_handle);</div>
<div class="line"><span class="lineno">  405</span>      }</div>
<div class="line"><span class="lineno">  406</span>    }</div>
<div class="line"><span class="lineno">  407</span>    </div>
<div class="line"><span class="lineno">  408</span>    <span class="comment">// After populating the local coordinate vector, we must perform a</span></div>
<div class="line"><span class="lineno">  409</span>    <span class="comment">// Local-to-Global and then Global-to-Local scatter to correctly</span></div>
<div class="line"><span class="lineno">  410</span>    <span class="comment">// populate the ghost node coordinates across process boundaries.</span></div>
<div class="line"><span class="lineno">  411</span>    Vec gCoor, lCoor;</div>
<div class="line"><span class="lineno">  412</span>    ierr = DMGetCoordinates(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;gCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  413</span>    ierr = DMGetCoordinatesLocal(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  414</span>    </div>
<div class="line"><span class="lineno">  415</span>    <a class="code hl_define" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code hl_define" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code hl_enumvalue" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d:   Scattering coordinates to update ghost nodes for block %d...\n&quot;</span>, simCtx-&gt;<a class="code hl_variable" href="variables_8h.html#a19aa807b9181b13618527d6c4eb6fa89">rank</a>, user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a4f7c5fd8843d026101b193e9236e1192">_this</a>);</div>
<div class="line"><span class="lineno">  416</span>    ierr = DMLocalToGlobalBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoor, INSERT_VALUES, gCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  417</span>    ierr = DMLocalToGlobalEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, lCoor, INSERT_VALUES, gCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  418</span>    </div>
<div class="line"><span class="lineno">  419</span>    ierr = DMGlobalToLocalBegin(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, gCoor, INSERT_VALUES, lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  420</span>    ierr = DMGlobalToLocalEnd(user-&gt;<a class="code hl_variable" href="variables__old_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, gCoor, INSERT_VALUES, lCoor); CHKERRQ(ierr);</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>    PetscFunctionReturn(0);</div>
<div class="line"><span class="lineno">  423</span>}</div>
<div class="ttc" id="agrid_8c_html_ac44553fe1434663c5211cc6ac32ef004"><div class="ttname"><a href="grid_8c.html#ac44553fe1434663c5211cc6ac32ef004">GenerateAndSetCoordinates</a></div><div class="ttdeci">static PetscErrorCode GenerateAndSetCoordinates(UserCtx *user)</div><div class="ttdoc">Programmatically generates and sets grid coordinates based on user parameters.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00476">grid.c:476</a></div></div>
<div class="ttc" id="agrid_8c_html_ac693c757c4fd3cb75e6e06e05e25d775"><div class="ttname"><a href="grid_8c.html#ac693c757c4fd3cb75e6e06e05e25d775">ReadAndSetCoordinates</a></div><div class="ttdeci">static PetscErrorCode ReadAndSetCoordinates(UserCtx *user, FILE *fd)</div><div class="ttdoc">Reads physical coordinates from a file and populates the DMDA for a specific block.</div><div class="ttdef"><b>Definition</b> <a href="grid_8c_source.html#l00535">grid.c:535</a></div></div>
<div class="ttc" id="avariables_8h_html_a7947f7b4cd08e551b6d2a79c8b513d9c"><div class="ttname"><a href="variables_8h.html#a7947f7b4cd08e551b6d2a79c8b513d9c">SimCtx::grid_file</a></div><div class="ttdeci">char grid_file[PETSC_MAX_PATH_LEN]</div><div class="ttdef"><b>Definition</b> <a href="variables_8h_source.html#l00528">variables.h:528</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_acb950cd51656702b75ea84d6477d0d97_cgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="grid_8c_acb950cd51656702b75ea84d6477d0d97_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="grid_8c.html">grid.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
