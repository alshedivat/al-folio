---
layout: post
title:  GSoC Coding Phase - Part 4
date: 2019-08-18 08:00:00
description:
tags: gsoc tensorflow
categories: gsoc
thumbnail: assets/img/swiftplot.png
---

<p>Hey everyone!</p><p>It’s been a long time since I last posted. Since then I’ve passed the second evaluation, and am pretty close to the end of this years’s GSoC. The final evaluation period starts tomorrow.</p><p>This post will be a very brief account of the developments since the last time, and the future plans.</p><p>The first topic to address is how we plan to handle data other than Float. After some discussion it was decided that using Generics would be a good option. I wrote a FloatConvertible protocol, and wrote Float and Double extensions conforming to it. The protocol is as shown below:</p><blockquote><p><i>public protocol FloatConvertible : Comparable{<br/>   init&lt;T: FloatConvertible&gt;(_ x: T)<br/>   init(_ other: Float)<br/>   init(_ other: Double)<br/>   init(_ other: Int)</i></p><p><i>   func toFloat() -&gt; Float<br/>   func toDouble() -&gt; Double<br/>   func toInt() -&gt; Int<br/>   static func +(lhs: Self, rhs: Self) -&gt; Self<br/>   static func -(lhs: Self, rhs: Self) -&gt; Self<br/>   static func *(lhs: Self, rhs: Self) -&gt; Self<br/>   static func /(lhs: Self, rhs: Self) -&gt; Self<br/>}</i></p><p><i>extension Float: FloatConvertible {<br/>   public init&lt;T: FloatConvertible&gt;(_ x: T) {self = x.toFloat()}<br/>   public func toFloat() -&gt; Float {return Float(self)}<br/>   public func toDouble() -&gt; Double {return Double(self)}<br/>   public func toInt() -&gt; Int {return Int(self)}<br/>}</i></p><p><i>extension Double: FloatConvertible {<br/>  public init&lt;T: FloatConvertible&gt;(_ x: T) {self = x.toDouble()}<br/>  public func toFloat() -&gt; Float {return Float(self)}<br/>  public func toDouble() -&gt; Double {return Double(self)}<br/>  public func toInt() -&gt; Int {return Int(self)}<br/>}</i></p></blockquote><p>Now, each plot class would have generics accepting values conforming to the FloatConvertible protocol. I’m using Floats for calculations at most places. As the input data conforms to FloatConvertible we can convert each value to a Float before any operation. This method also avoids type erasure. Most of you might notice that there’s no extension for the Int data type. That’s because I’m facing some issues with it. Whenever I use Integers I get a fatal error while execution, the reason to which I haven’t been able to figure out yet. So, currently we can use Float and Double.</p><p>The next issue I came across was when I was testing plotting different values. I had forgotten to consider a case when the range of values was less than 1, i.e. the plot markers had to have decimal values. So what I did was if the range was between 1 and 2, I plotted each marker with an increment of half times the inverse of the range. And when the range was less than 1, each increment was one-tenth of the range. I also rounded the values to two significant digits. This worked well for most cases.</p><p>Brad pointed out that the current plots weren’t as aesthetically pleasing as those generated by currently existing frameworks. The following needed to be changed:</p><p>1. Font</p><p>2. Line Size</p><p>3. Spacing of numbers from axis hatching</p><p>4. Enable a grid</p><p>Changing the line size, spacing and enabling a grid were simple tasks and didn’t take a lot of time. The tricky part was using a custom font. Let’s take a look at the approach used with both AGG and SVG Renderers.</p><p>AGG provides a way to draw text using custom fonts using the FreeType library. Either we need to include FreeType with SwiftPlot or we need a way so that Swift Package Manager can use a version of FreeType installed on the device. I initially wanted to include FreeType with SwiftPlot, but FreeType has its own build system and it also had a few Python files in its source. So I ruled that out. In order to use the install on the device I needed a module that lets SPM know which library to look for. I found <a href="https://github.com/PureSwift/CFreeType">this</a> C module on github which with a few changes I got working. Then I changed the old text functions to use the FreeType functions provided by AGG. The default font I used was <i>Roboto-Regular</i>. I had two reasons for choosing this font. One, it was very clean and professional looking. Second, this font was available in the Google Fonts API(This came in useful for SVG).</p><p>I couldn’t find any simple way to use custom fonts in SVG that worked everywhere. The only method I found was to use CSS, which worked only in a browser. Brad said that people would use SVG primarily in a browser so supporting that could be a good beginning. The next problem was how to set a default font in SVG? We couldn’t include the font in the SVG file, and including the ttf file along with the SVG file would be very inconvenient. Here the Google Fonts API came in useful. We just need to specify the font family and it would fetch the font whenever the image was loaded into the browser.</p><p>This almost concludes my work on aesthetics. The only problem left is to get FreeType to work with Jupyter. Currently, It isn’t able to find the FreeType installed on the system.</p><figure class="tmblr-full" data-orig-height="660" data-orig-width="1000"><img src="https://64.media.tumblr.com/fb53bffe37850d1e12de4b4e40ca3f6e/4d189dd4a9520cd4-59/s540x810/547eda1e76f1ec5699160e632c0ed7dbfa7f518a.png" data-orig-height="660" data-orig-width="1000"/></figure><blockquote><p>Histogram with updated font and grid</p></blockquote><p>Apart from this my main objectives are complete. In the leftover time I have started work on a CoreGraphics Renderer for macOS. This would be a great addition to the library and increase its audience.</p><p>That’s all for this post. I’ll post an update when I have CoreGraphics working. Stay tuned!</p>