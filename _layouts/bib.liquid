<div class="row">
  <div id="{{ entry.key }}" class="col-sm-10">
    
    {% if site.enable_publication_thumbnails %}
      <!-- Thumbnail is floated left inside the wide column -->
      <div class="publication-thumbnail" style="float: left; margin-right: 15px;">
        {% if entry.abbr %}
          {% if site.data.venues[entry.abbr] %}
            {% assign venue_style = null %}
            {% if site.data.venues[entry.abbr].color != blank %}
              {% assign venue_style = site.data.venues[entry.abbr].color | prepend: 'style="background-color:' | append: '"' %}
            {% endif %}
            <abbr class="badge rounded" {% if venue_style %}{{ venue_style }}{% endif %}>
              {% if site.data.venues[entry.abbr].url %}
                <a href="{{ site.data.venues[entry.abbr].url }}">{{ entry.abbr }}</a>
              {% else %}
                <div>{{ entry.abbr }}</div>
              {% endif %}
            </abbr>
          {% else %}
            <abbr class="badge rounded">{{ entry.abbr }}</abbr>
          {% endif %}
        {% endif %}
        {% if entry.preview %}
          {% if entry.preview contains '://' %}
            <img class="preview z-depth-1 rounded" src="{{ entry.preview }}">
          {% else %}
            {% assign entry_path = entry.preview | prepend: '/assets/img/publication_preview/' %}
            {% include figure.liquid loading="eager" path=entry_path sizes="200px" class="preview z-depth-1 rounded" zoomable=true alt=entry.preview %}
          {% endif %}
        {% endif %}
      </div>
    {% endif %}

    <!-- Inline Author, Title, and Periodical Info -->
    <span class="author">
      {%- assign author_array_size = entry.author_array | size -%}
      {%- assign author_array_limit = author_array_size -%}
      {%- if site.max_author_limit and author_array_size > site.max_author_limit -%}
        {%- assign author_array_limit = site.max_author_limit -%}
      {%- endif -%}
      {%- for author in entry.author_array limit: author_array_limit -%}
        {%- assign author_is_self = false -%}
        {%- assign author_last_name = author.last | regex_replace: '[*∗†‡§¶‖&^]', '' -%}
        {%- assign author_last_html = author.last | regex_replace: '([*∗†‡§¶‖&^]+)', '<sup>\1</sup>' -%}
        {% if site.scholar.last_name contains author_last_name %}
          {% if site.scholar.first_name contains author.first %}
            {% assign author_is_self = true %}
          {% endif %}
        {% endif %}
        {%- assign coauthor_url = null -%}
        {%- assign clean_last_name = author_last_name | downcase | remove_accents -%}
        {% if site.data.coauthors[clean_last_name] %}
          {%- for coauthor in site.data.coauthors[clean_last_name] -%}
            {%- if coauthor.firstname contains author.first -%}
              {%- assign coauthor_url = coauthor.url -%}
              {% break %}
            {%- endif -%}
          {%- endfor -%}
        {% endif %}
        {%- if forloop.length > 1 -%}
          {%- if forloop.first == false -%},&nbsp;{%- endif -%}
          {%- if forloop.last and author_array_limit == author_array_size -%}and&nbsp;{%- endif -%}
        {%- endif -%}
        {%- if author_is_self -%}
          <em>{{ author.first }} {{ author_last_html }}</em>
        {%- else -%}
          {%- if coauthor_url -%}
            <a href="{{ coauthor_url }}">{{ author.first }} {{ author_last_html }}</a>
          {%- else -%}
            {{ author.first }} {{ author_last_html }}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </span>,
    <span class="title">{{ entry.title }}</span>,
    <span class="periodical">
      {% assign proceedings = "inproceedings,incollection" | split: ',' %}
      {% assign thesis = "thesis,mastersthesis,phdthesis" | split: ',' %}
      {% if entry.type == "article" %}
        <em>{{ entry.journal }}</em>,
      {% elsif proceedings contains entry.type %}
        <em>In {{ entry.booktitle }}</em>,
      {% elsif thesis contains entry.type %}
        <em>{{ entry.school }}</em>,
      {% endif %}
      {% if entry.month %}
        {{ entry.month | capitalize }}, 
      {% endif %}
      {{ entry.year }}
    </span>
    <span class="periodical">{{ entry.note | strip }}</span>

    <!-- Links/Buttons and Inline Dynamic Badges -->
    <div class="links">
      {% if entry.award %}
        <a class="award btn btn-sm btn-outline-red z-depth-0" role="button">
          {%- if entry.award_name %}{{ entry.award_name }}{% else %}Awarded{% endif -%}
        </a>
      {% endif %}
      {% if entry.abstract %}
        <a class="abstract btn btn-sm btn-outline-red z-depth-0" role="button">Abstract</a>
      {% endif %}
      {% if entry.doi %}
        <a href="https://doi.org/{{ entry.doi }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">DOI</a>
      {% endif %}
      {% if entry.arxiv %}
        <a href="http://arxiv.org/abs/{{ entry.arxiv }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">arXiv</a>
      {% endif %}
      {% if entry.bibtex_show %}
        <a class="bibtex btn btn-sm btn-outline-red z-depth-0" role="button">BibTeX</a>
      {% endif %}
      {% if entry.html %}
        {% if entry.html contains '://' %}
          <a href="{{ entry.html }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">HTML</a>
        {% else %}
          <a href="{{ entry.html | prepend: '/assets/html/' | relative_url }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">HTML</a>
        {% endif %}
      {% endif %}
      {% if entry.pdf %}
        {% if entry.pdf contains '://' %}
          <a href="{{ entry.pdf }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">PDF</a>
        {% else %}
          <a href="{{ entry.pdf | prepend: '/assets/pdf/' | relative_url }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">PDF</a>
        {% endif %}
      {% endif %}
      {% if entry.supp %}
        {% if entry.supp contains '://' %}
          <a href="{{ entry.supp }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Supp</a>
        {% else %}
          <a href="{{ entry.supp | prepend: '/assets/pdf/' | relative_url }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Supp</a>
        {% endif %}
      {% endif %}
      {% if entry.video and site.enable_video_embedding %}
        <a class="abstract btn btn-sm btn-outline-red z-depth-0" role="button">Video</a>
      {% elsif entry.video %}
        <a href="{{ entry.video }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Video</a>
      {% endif %}
      {% if entry.blog %}
        <a href="{{ entry.blog }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Blog</a>
      {% endif %}
      {% if entry.code %}
        <a href="{{ entry.code }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Code</a>
      {% endif %}
      {% if entry.poster %}
        {% if entry.poster contains '://' %}
          <a href="{{ entry.poster }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Poster</a>
        {% else %}
          <a href="{{ entry.poster | prepend: '/assets/pdf/' | relative_url }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Poster</a>
        {% endif %}
      {% endif %}
      {% if entry.slides %}
        {% if entry.slides contains '://' %}
          <a href="{{ entry.slides }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Slides</a>
        {% else %}
          <a href="{{ entry.slides | prepend: '/assets/pdf/' | relative_url }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Slides</a>
        {% endif %}
      {% endif %}
      {% if entry.website %}
        <a href="{{ entry.website }}" class="btn btn-sm btn-outline-red z-depth-0" role="button">Website</a>
      {% endif %}

      {% if entry.altmetric %}
        <!-- Inline Altmetric Badge -->
        <script type="text/javascript" src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
        <span data-altmetric-id="{{ entry.altmetric }}" class="altmetric-embed inline-badge" data-hide-no-mentions="true" data-hide-less-than="15" data-badge-popover="right" data-badge-type="2"></span>
      {% endif %}

      {% if site.enable_publication_badges %}
        {% assign entry_has_altmetric_badge = false %}
        {% if entry.altmetric and entry.altmetric != 'false' %}
          {% assign entry_has_altmetric_badge = true %}
        {% endif %}
        {% assign entry_has_dimensions_badge = false %}
        {% if entry.dimensions and entry.dimensions != 'false' %}
          {% assign entry_has_dimensions_badge = true %}
        {% endif %}
        {% assign entry_has_google_scholar_badge = false %}
        {% if entry.google_scholar_id %}
          {% assign entry_has_google_scholar_badge = true %}
        {% endif %}
        {% assign entry_has_inspirehep_badge = false %}
        {% if entry.inspirehep_id %}
          {% assign entry_has_inspirehep_badge = true %}
        {% endif %}
        {% if entry_has_altmetric_badge or entry_has_dimensions_badge or entry_has_google_scholar_badge or entry_has_inspirehep_badge %}
          <span class="badges inline-badge">
            {% if site.enable_publication_badges.altmetric and entry_has_altmetric_badge %}
              <span class="altmetric-embed inline-badge"
                {% if entry.altmetric != blank and entry.altmetric != 'true' %}
                  data-altmetric-id="{{ entry.altmetric }}"
                {% elsif entry.arxiv %}
                  data-arxiv-id="{{ entry.arxiv }}"
                {% elsif entry.eprint %}
                  data-arxiv-id="{{ entry.eprint }}"
                {% elsif entry.doi %}
                  data-doi="{{ entry.doi }}"
                {% elsif entry.pmid %}
                  data-pmid="{{ entry.pmid }}"
                {% elsif entry.isbn %}
                  data-isbn="{{ entry.isbn }}"
                {% endif %} data-badge-type="2" data-badge-popover="right"></span>
            {% endif %}
            {% if site.enable_publication_badges.dimensions and entry_has_dimensions_badge %}
              <span class="__dimensions_badge_embed__ inline-badge"
                {% if entry.dimensions != blank and entry.dimensions != 'true' %}
                  data-id="{{ entry.dimensions }}"
                {% elsif entry.doi %}
                  data-doi="{{ entry.doi }}"
                {% else %}
                  data-pmid="{{ entry.pmid }}"
                {% endif %}
                data-style="small_rectangle" data-legend="hover-right"></span>
            {% endif %}
            {% if site.enable_publication_badges.google_scholar and entry_has_google_scholar_badge %}
              <a href="https://scholar.google.com/citations?view_op=view_citation&hl=en&user={{ site.data.socials.scholar_userid }}&citation_for_view={{ site.data.socials.scholar_userid }}:{{ entry.google_scholar_id }}" class="inline-badge" aria-label="Google Scholar link" role="button">
                <img src="https://img.shields.io/badge/scholar-{% google_scholar_citations site.data.socials.scholar_userid entry.google_scholar_id %}-4285F4?logo=googlescholar&amp;labelColor=beige" alt="{% google_scholar_citations site.data.socials.scholar_userid entry.google_scholar_id %} Google Scholar citations">
              </a>
            {% endif %}
            {% if site.enable_publication_badges.inspirehep and entry_has_inspirehep_badge %}
              <a href="https://inspirehep.net/literature/{{ entry.inspirehep_id }}" class="inline-badge" aria-label="InspireHEP link" role="button">
                <img src="https://img.shields.io/badge/inspire-{% inspirehep_citations entry.inspirehep_id %}-001628?logo=inspire&amp;logoColor=001628&amp;labelColor=beige" alt="{% inspirehep_citations entry.inspirehep_id %} InspireHEP citations">
              </a>
            {% endif %}
          </span>
        {% endif %}
      {% endif %}
    </div>

    <!-- Hidden Blocks -->
    {% if entry.award %}
      <div class="award hidden d-print-inline">
        <p>{{ entry.award | markdownify }}</p>
      </div>
    {% endif %}
    {% if entry.abstract %}
      <div class="abstract hidden">
        <p>{{ entry.abstract }}</p>
      </div>
    {% endif %}
    {% if entry.bibtex_show %}
      <div class="bibtex hidden">
        <pre id="bibtex-content-{{ entry.key }}" style="margin-bottom: 0; background-color: ##EDEDED;">
{% highlight bibtex %}
{{ entry.bibtex | hideCustomBibtex }}
{% endhighlight %}
        </pre>
        <button class="copy-btn btn btn-sm btn-outline-red z-depth-0" style="margin-top: 4px;" onclick="copyBibtex('{{ entry.key }}')">Copy</button>
      </div>
    {% endif %}
    {% if entry.video and site.enable_video_embedding %}
      <div class="abstract hidden">
        <div style="text-align: center;">
          {% include video.liquid path=entry.video class="img-fluid rounded z-depth-1" controls=true %}
        </div>
      </div>
    {% endif %}
  </div>
</div>

<script>
function copyBibtex(entryId) {
  const bibtexContent = document.getElementById(`bibtex-content-${entryId}`).textContent;
  navigator.clipboard.writeText(bibtexContent).catch(function(error) {
      console.error("Failed to copy BibTeX entry:", error);
  });
}
</script>

<style>
/* Custom red outline button style */
.btn-outline-red {
  border-color: #D32F2F !important;
  color: #D32F2F !important;
}

/* Ensure white background for BibTeX block */
.bibtex pre {
  background-color: #EDEDED !important;
}

/* Inline badges styling – badges now display on the same line as buttons
   and use a transparent background to match the page */
.inline-badge {
  display: inline-block;
  background-color: transparent !important;
  vertical-align: middle;
  margin-left: 5px;
}

/* Optional: Adjust syntax highlighting within the BibTeX block */
.bibtex .highlight .k { color: #D32F2F !important; }
.bibtex .highlight .s { color: #000000 !important; }
.bibtex .highlight .n { color: #000000 !important; }
</style>
